<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<title>mask_template</title>
		<link rel="stylesheet" type="text/css" href="css/style.css">
	</head>
	<body>		
			<script type="text/javascript" src="js/lib/three.min_69.js"></script>

			<div id="render-canvas"></div>

			<!-- indie -->
			<div id="blocker" style="display: -webkit-box;">
				<div id="instructions" >
					<img width="60" height="60" src="images/click.gif">
				</div>
			</div>


			<!-- cam -->
			<p id="errorMessage" style="display:none"></p>
			<video id="video" autoplay loop width="480" height="320" style="display:none"></video>	
			<canvas id="videoImage" width="480" height="320" style="z-index:10000000001; position:absolute; left:0px; top:0px; display:none;">

			<script type="text/javascript">
				var video = document.getElementById('video');
				var videoImage = document.getElementById('videoImage');

				// ref: https://github.com/samdutton/simpl/blob/master/getusermedia/sources/js/main.js
				var audioSource = null, videoSource = null, camUserID = null, camEnvironmentID = null;
				var mediaConstraints = {};

				function gotSources(sourceInfos) {
					for (var i = 0; i !== sourceInfos.length; ++i) {
					    var sourceInfo = sourceInfos[i];

					   	if (sourceInfo.kind === 'video') {

					   		if (sourceInfo.facing === 'user') camUserID = sourceInfo.id;
					   		else if (sourceInfo.facing === 'environment') {

					   			camEnvironmentID = sourceInfo.id;
					   			mediaConstraints = {
									video: {
										mandatory: {
									    	maxWidth: 480,
									    	maxHeight: 320,
									    	minWidth: 480,
									    	minHeight: 320
									    },
										optional: [{sourceId: camEnvironmentID}]
									}
								};
								navigator.getUserMedia(mediaConstraints, successCallback, errorCallback);
					   		}
					   		else {
					   			camEnvironmentID = sourceInfo.id;
					   			mediaConstraints = {
									video: {
										mandatory: {
									    	maxWidth: 480,
									    	maxHeight: 320,
									    	minWidth: 480,
									    	minHeight: 320
									    },
										optional: [{sourceId: camEnvironmentID}]
									}
								};
								navigator.getUserMedia(mediaConstraints, successCallback, errorCallback);
					   		}
					    } 
					}
				}

				// for selecting back camera of phone
				if (typeof MediaStreamTrack.getSources === 'undefined'){
				  alert('This browser does not support MediaStreamTrack.\n\nTry Chrome Canary.');
				} else {
				  MediaStreamTrack.getSources(gotSources);
				}

				navigator.getUserMedia = navigator.getUserMedia || 
					navigator.webkitGetUserMedia || navigator.mozGetUserMedia;


				function successCallback(stream) {
				  // window.stream = stream; // make stream available to console
				  video.src = window.URL.createObjectURL(stream);
				  video.play();

				  // init MASK world
					  init();
				}

				function errorCallback(error){
					var msg = 'No camera available.';
					if (error.code == 1) 
					{   msg = 'User denied access to use camera.';   }
					document.getElementById('errorMessage').textContent = msg;
					console.log('navigator.getUserMedia error: ', error);
				}

			</script>
			

			<script src="js/StereoEffect.js"></script>
  			<script src="js/controls/DeviceControls.js"></script>
			<script type="text/javascript" src="js/Detector.js"></script>
			<script type="text/javascript" src="js/lib/tween.min.js"></script>
			<script type="text/javascript" src="js/stats.min.js"></script>
			<script type="text/javascript" src="js/script.js"></script>
	</body>
</html>
