<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>m o t i v a t i o n</title>
		<link rel="stylesheet" type="text/css" href="css/style.css">
	</head>
	<body>		
			<script type="text/javascript" src="js/lib/three.min_69.js"></script>
			<script src="https://cdn.firebase.com/js/client/2.1.1/firebase.js"></script>
			<script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
			
			<!-- data -->
			<div id="insert-data">
				<input type='text' id='nameInput' placeholder='Name'>
	   			<input type='text' id='messageInput' placeholder='Motivation'>
			</div>

			<div id="render-canvas"></div>

			<!-- indie -->
			<div id="blocker" style="display: -webkit-box;">
				<div id="instructions" >
					<img width="60" height="60" src="images/click.gif">
				</div>
			</div>

			<div id='messagesDiv'></div>

			<!-- Firebase -->
			<script>

				var myID, myName, myStartX = Math.random()*20, myStartZ = Math.random()*20;
				var ghostRef, locationRef, getNameRef;
				var formFilled = false;
				var historyData;

				// init database
				var myDataRef = new Firebase('https://motivationghost.firebaseio.com/');

				ghostRef = myDataRef.child("ghosts");
				// locationRef = myDataRef.child("locations");


				// insert username
				$('#messageInput').keypress(function(e) {
					var keycode = (e.keyCode ? e.keyCode : e.which);
				    if(keycode == 13) {
				    	myName = $('#nameInput').val();
				    	var text = $('#messageInput').val();

				    	if(myName != ''){
					    	// ghostRef = myDataRef.child("ghosts");

					    	// var ghostID = ghostRef.push({
					    	var ghostID = myDataRef.push({
					    		name: myName,
					    		// loc_x: myStartX,
					    		// loc_z: myStartZ,
					    		loc: myStartX + " " + myStartZ
					    	});

					    	myID = ghostID;

					    	$('#nameInput').val('');
					    	$('#messageInput').val('');

					        $('#insert-data').hide();

					        formFilled = true;
				        }
				    }
				});

				// read data
				// var ghostsPos = [];

				// myDataRef.on('child_added', function(snapshot){
				// 	var data = snapshot.val();
				// 	displayData( data.name, data.text );
				// 	console.log('upload to database');
				// });

				// playerRef.child("name").once("value", function(snap){
				// 	var test = snap.val();
				// 	console.log( test );
				// });


				function displayData(name, text){
					$('<div/>').text(text).prepend( $('<em/>').text(name+': ') ).appendTo( $('#messagesDiv') );
					$('#messagesDiv')[0].scrollTop = $('#messagesDiv')[0].scrollHeight;
				}

			</script>

			<script type="text/javascript" src="js/controls/OrbitControls_cb.js"></script>
			<script type="text/javascript" src="js/controls/PointerLockControls.js"></script>
			<script src="js/StereoEffect.js"></script>
  			<script src="js/controls/DeviceControls_v4.js"></script>
			<script type="text/javascript" src="js/Detector.js"></script>
			<script type="text/javascript" src="js/KeyboardState.js"></script>
			<script type="text/javascript" src="js/lib/tween.min.js"></script>
			<script type="text/javascript" src="js/stats.min.js"></script>
			<script type="text/javascript" src="js/wave.js"></script>
			<script type="text/javascript" src="js/motivation_firebase.js"></script>

			<script type="text/javascript">
				// playerRef.once("value", function(snap){
				// 	historyData = snap.val();

				// 	var ghostAmount = historyData.length/2 - 1;	//2

				// 	for(var i=0; i<ghostAmount; i++){
				// 		//get location history data
				// 		ghostsPos = historyData[ghostAmount+1+i]

				// 		loadModelG("models/poseMan_S.js", ghostMat, controls.posX(), controls.posZ(), myName);
				// 	}
					
				// 	console.log( snap.val() );
				// });		

			</script>
	</body>
</html>
