function Cardboard(e){this.renderer=new THREE.WebGLRenderer({antialias:!0,canvas:e.canvas}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.scene=new THREE.Scene,this.effect=new THREE.StereoEffect(this.renderer),this.camera=new THREE.PerspectiveCamera(90,window.innerWidth/window.innerHeight,.001,700),this.scene.add(this.camera),this.controls=new THREE.DeviceOrientationControls(this.camera,!0),this.orbitControls=new THREE.OrbitControls(this.camera,this.renderer.domElement),this.orbitControls.noZoom=!0,this.orbitControls.noPan=!0,this.orbitControls.autoRotate=!1}function detectScreenSize(e){e=e||window;var t=detectScreenHeight();if(!t)return null;var r=e.innerWidth,n=e.innerHeight,i=getOrientation();if(0===i||180===i){var o=r;r=n,n=o}var a=r/n,s=t*a;return{mm:{x:s,y:t},px:{x:r,y:n}}}function get(e,t,r){var n=new XMLHttpRequest;n.onreadystatechange=function(){4==n.readyState&&200==n.status&&t.call(r,n.responseText)},n.open("GET",e,!0),n.send()}function pointer(e,t){function r(e){e.touches?(0==e.touches.length?(e.x=0,e.y=0):(e.x=e.touches[0].clientX,e.y=e.touches[0].clientY),e.button=0):(e.x=e.clientX,e.y=e.clientY)}function n(t){return function(n){var i=e.getBoundingClientRect();r(n),n.localX=n.x-i.left,n.localY=n.y-i.top,t(n)}}function i(t,r,n,i){return i=i||e,i.addEventListener(t,r,!1),function(){i.removeEventListener(t,r,!1)}}function o(t,n,o){function a(e){r(e),"dragend"==t&&n.call(this,e),f(),d()}var s,l,c,u,f,d,p,m;i(h?"touchstart":"mousedown",function(g){return r(g),m=e.getBoundingClientRect(),g.preventDefault(),g.stopPropagation(),c=s=g.x,u=l=g.y,p=!1,f=i(h?"touchmove":"mousemove",function(e){r(e),e.localX=e.x-m.left,e.localY=e.y-m.top,e.movementX=e.x-s,e.movementY=e.y-l,e.deltaX=e.x-c,e.deltaY=e.y-u,e.px=s,e.py=l,s=e.x,l=e.y,p||(p=!0,"dragstart"==t&&n.call(this,e)),"drag"==t&&n.call(this,e)},o,window),d=i(h?"touchend":"mouseup",a,o,window),!1})}function a(e,n,o){function a(){clearTimeout(v),f&&f(),d&&d()}function s(r){"tap"==e&&l()-g<t.holdDuration&&n.call(this,r),a()}function u(e){r(e),c(e.x,e.y,p,m)>t.tapMoveThreshold&&a()}var f,d,p,m,g,v;a(),i(h?"touchstart":"mousedown",function(a){r(a),g=Date.now(),p=a.x,m=a.y,"hold"==e&&(v=setTimeout(function(){n.call(o,a)},t.holdDuration)),f=i(h?"touchend":"mouseup",s,o,window),d=i(h?"touchmove":"mousemove",u,o,window)},o)}function s(e,t){for(var r in t)void 0===e[r]&&(e[r]=t[r]);return e}function l(){return+new Date}function c(e,t,r,n){return(e-r)*(e-r)+(t-n)*(t-n)}t=s(t||{},pointer.DEFAULTS);var h=function(){try{return document.createEvent("TouchEvent"),!0}catch(e){return!1}}();return{on:function(t,r,s){switch(s=s||e,t){case"tap":case"singletap":case"hold":a(t,n(r),s);break;case"doubletap":i("dblclick",n(r),s);break;case"drag":case"dragend":case"dragstart":o(t,r,s);break;case"touch":i(h?"touchstart":"mousedown",n(r),s);break;case"move":i(h?"touchmove":"mousemove",n(r),s);break;case"release":i(h?"touchend":"mouseup",n(r),s);break;case"enter":i(h?"touchenter":"mouseover",n(r),s);break;case"leave":i(h?"touchleave":"mouseout",n(r),s)}return this}}}function Video(e){this.slug=e.slug,Video[e.slug]=this,this.deps=e.deps||{},this._teardown=e.teardown||function(){},this._start=e.start||function(e,t){t()},this._setPosition=e.setPosition||function(){},this._loop=e.loop,this._resize=e.resize,this._canPlay=e.canPlay||function(){return!0},_.extend(this,e.methods||{}),this.smoothPosition=!0,this.maxSmooth=300,this.offset=e.offset,this.lastPosition=this.position=0,this.started=!1}function PianoRollGeometry(e,t,r,n,i){function o(e){return e.highValue<<7|e.lowValue}function a(e,t){var r=n[e];if(void 0===r||0==r.length)return 0;for(var i=0,a=r.length;a>i;i++){var s=r[i];if(s.playTime==t)return o(s);if(s.playTime>t&&i>0)return o(r[i-1])}return 0}function s(e,r,n,i,o,a,s){function l(t,r,n,i,o,a){c.position.array[c.position.i++]=t.x,c.position.array[c.position.i++]=t.y,c.position.array[c.position.i++]=t.z,c.position.array[c.position.i++]=r.x,c.position.array[c.position.i++]=r.y,c.position.array[c.position.i++]=r.z,c.position.array[c.position.i++]=n.x,c.position.array[c.position.i++]=n.y,c.position.array[c.position.i++]=n.z;for(var s=0;3>s;s++)c.normal.array[c.normal.i++]=i,c.normal.array[c.normal.i++]=o,c.normal.array[c.normal.i++]=a,c.color.array[c.color.i++]=e.x,c.color.array[c.color.i++]=e.y,c.color.array[c.color.i++]=e.z,c.bounds.array[c.bounds.i++]=h.x,c.bounds.array[c.bounds.i++]=h.y}void 0==a&&(a=o);var h={x:n,y:i},u=i-n;s&&(u=Math.max(0,u-25));var f=1,d=1,p=PianoRollGeometry.x(u),m=PianoRollGeometry.x(n+u/2),g=PianoRollGeometry.y(o),v=PianoRollGeometry.y(a),E=PianoRollGeometry.z(r,t),y=new THREE.Vector3(m-p/2,g-f/2,E-d/2),T=new THREE.Vector3(m+p/2,v-f/2,E-d/2),x=new THREE.Vector3(m+p/2,v-f/2,E+d/2),w=new THREE.Vector3(m-p/2,g-f/2,E+d/2),b=new THREE.Vector3(m-p/2,g+f/2,E-d/2),R=new THREE.Vector3(m+p/2,v+f/2,E-d/2),_=new THREE.Vector3(m+p/2,v+f/2,E+d/2),H=new THREE.Vector3(m-p/2,g+f/2,E+d/2);l(y,T,x,0,1,0),l(x,w,y,0,1,0),l(_,R,b,0,-1,0),l(b,H,_,0,-1,0),l(y,w,H,1,0,0),l(H,b,y,1,0,0),l(x,T,R,-1,0,0),l(R,_,x,-1,0,0),l(w,x,_,0,0,1),l(_,H,w,0,0,1),l(T,y,b,0,0,-1),l(b,R,T,0,0,-1)}THREE.BufferGeometry.call(this);var l=0;_.each(r,function(t,r){for(var n=0,i=t.length;i>n;n++){var o=t[n],s=t[n-1],c=a(r,o.start);if(0!=n&&s.end==o.start){var h=60/e*1e3*c/480;l+=h>=o.dur?12:24}else l+=12}}),l*=2;var c=this.attributes={position:{i:0,itemSize:3,array:new Float32Array(3*l*3)},normal:{i:0,itemSize:3,array:new Float32Array(3*l*3)},bounds:{i:0,itemSize:2,array:new Float32Array(2*l*3)},color:{i:0,itemSize:3,array:new Float32Array(3*l*3)}};_.each(r,function(t,r){for(var n=0,o=t.length;o>n;n++){var l=t[n],c=t[n-1],h=t[n+1],u=a(r,l.start),f=h&&l.end!==h.start;if(0!=n&&c.end==l.start){var d=60/e*1e3*u/480;if(d>=l.dur){var p=Math.map(l.dur,0,d,c.note,l.note);s(i[l.velocity],r,l.start,l.end,c.note,p,f)}else{var m=l.start+d;s(i[l.velocity],r,l.start,m,c.note,l.note),s(i[l.velocity],r,m,l.end,l.note,l.note,f)}}else s(i[l.velocity],r,l.start,l.end,l.note,l.note,f)}}),this.computeBoundingSphere()}function PianoRollVideo(e,t,r,n){n=n||{};for(var i={},o=1e3,a=[];a.length<127;)a.push(new THREE.Vector3(Math.random(.5,1),Math.random(.3,1),Math.random(.5,1)));var s,l,c,h,u,f,d,p,m,g,v,E,y,T,x=!1,w=has.mobile,b={playhead:{type:"f",value:0}},R=!1,H=[{position:{x:-2965.8590458155036,y:2235.5054451015108,z:3467.8805523319147},rotation:{x:-.5725920499272357,y:-.6232494536532424,z:-.35987178331501773}},{position:{x:0,y:1e4,z:0},rotation:{x:-Math.HALF_PI,y:0,z:0}},{position:{x:4952.937923945333,y:-75.39736997065991,z:1132.5728047255002},rotation:{x:.06647368377615936,y:1.345513565303963,z:-.06479871684945059}},{position:{x:0,y:0,z:5080},rotation:{x:0,y:0,z:0}},{position:{x:-2e3,y:500,z:0},rotation:{x:0,y:0,z:0}}],M={position:{x:-3403.9172412110474,y:2101.353999906835,z:4036.8047358695467},rotation:{x:-.4799512237452751,_y:-.6421887695903379,_z:-.3022310914885656}},S={position:new THREE.Vector3,rotation:new THREE.Vector3,fov:0};return new Video({slug:e,deps:{noteShader:{vs:"shaders/iii/pianoroll.vs",fs:"shaders/iii/pianoroll.fs"},floorShader:{vs:"shaders/iii/floor.vs",fs:"shaders/iii/floor.fs"},particleShader:{vs:"shaders/iii/particles.vs",fs:"shaders/iii/particles.fs"},templates:{camera:"templates/iii/camera.html"}},canPlay:function(){return Detector.webgl?!0:"webgl"},setPosition:function(e){x=!0,this.loop(e),E.killAll()},offset:PianoRollVideo.OFFSET,start:function(e,r){console.log("about to build Scene"),this.buildScene(e&&e.canvas),this.buildEnvironment(),E=new PianoRollParticles(t,this.deps.particleShader.vs,this.deps.particleShader.fs),l.add(E.object),this.buildNotes(),y=new TWEEN.Tween(i),n.start&&n.start(),r()},resize:function(e,t,r){return console.log(c,T,s),this.width=e,this.height=t,c&&(r&&(c.devicePixelRatio=r),c.setSize(e,t)),T&&(r&&(T.devicePixelRatio=r),T.setSize(e,t)),s&&(s.aspect=e/t,s.updateProjectionMatrix()),this},loop:function(e){if(x=!0,void 0===e||e!=g||x){x=!1,e=e||g;var t=PianoRollVideo.OFFSET-e;d&&(b.playhead.value=-t,d.position.x=t*PianoRollGeometry.TIME_SCALE*PianoRollVideo.SCALE),E.object.position.x=t*PianoRollGeometry.TIME_SCALE*PianoRollVideo.SCALE,p.material.uniforms.offset.value=t*PianoRollGeometry.TIME_SCALE*PianoRollVideo.SCALE,m.rotation.z=e/4e5,e!=g&&E.update(e-PianoRollVideo.OFFSET),w?(h.update(),T.render(l,s)):c.render(l,s),g=e,n.loop&&n.loop(e)}},teardown:function(){u&&u.dispose(),f&&f.dispose(),E&&E.dispose(),v&&v.stop()},methods:{tweenCamera:function(e){S.position.copy(s.position),S.rotation.copy(s.rotation),S.fov=s.fov,y.to(i,1e3).onUpdate(function(t){s.position.x=Math.lerp(S.position.x,e.position.x,t),s.position.y=Math.lerp(S.position.y,e.position.y,t),s.position.z=Math.lerp(S.position.z,e.position.z,t),s.rotation.x=Math.lerp(S.rotation.x,e.rotation.x,t),s.rotation.y=Math.lerp(S.rotation.y,e.rotation.y,t),s.rotation.z=Math.lerp(S.rotation.z,e.rotation.z,t),x=!0}).easing(TWEEN.Easing.Cubic.Out).onStart(function(){R=!0}).onComplete(function(){R=!1}).start()},applyCamera:function(e){s.position.copy(e.position),s.updateProjectionMatrix()},buildScene:function(t){iii.camera=s=new THREE.PerspectiveCamera(40,window.innerWidth/window.innerHeight,1,1e5),this.applyCamera("heaven"==e?M:w?H[4]:H[0]),PianoRollVideo.renderer?(c=PianoRollVideo.renderer,T=PianoRollVideo.effect):(iii.renderer=c=PianoRollVideo.renderer=new THREE.WebGLRenderer({antialias:!1,alpha:!1,canvas:t}),c.setClearColor(1510703,1),c.sortObjects=!1,w&&(T=PianoRollVideo.effect=new THREE.StereoEffect(c),T.separation=.06)),w?(h=new THREE.DeviceOrientationControls(s),h.freeze=!1):h=new THREE.OrbitControls(s,c.domElement),iii.controls=h,document.body.classList.add("grabbable"),l=iii.scene=new THREE.Scene},buildEnvironment:function(){for(var e=2e3,t=new THREE.Geometry,n=new THREE.PointCloudMaterial({color:16777215,size:1,sizeAttenuation:!1}),i=0;e>i;i++){var a=Math.randomRange(2e4),s=Math.randomRange(2e4),c=Math.randomRange(2e4),h=new THREE.Vector3(a,s,c);t.vertices.push(h)}m=new THREE.PointCloud(t,n),l.add(m);var u=50,f=2*u*(1/r)*6e4*PianoRollGeometry.TIME_SCALE*PianoRollVideo.SCALE,d={offset:{type:"f",value:0},gridSize:{type:"f",value:f/u}},g=new THREE.PlaneGeometry(f,f,u,u),v=new THREE.ShaderMaterial({vertexShader:this.deps.floorShader.vs,fragmentShader:this.deps.floorShader.fs,uniforms:d,depthWrite:!1,depthTest:!1,transparent:!0,wireframe:!0,wireframeLinewidth:1,blending:THREE.AdditiveBlending});p=new THREE.Mesh(g,v),p.rotation.x=-Math.HALF_PI,p.position.y=-o,l.add(p)},buildNotes:function(){var e={},r={},n={};_.each(this.player.events,function(t){"pitchBend"==t.type&&(r[t.track]=r[t.track]||[],r[t.track].push(t)),("noteOff"==t.type||"noteOn"==t.type)&&(e[t.track]=e[t.track]||[],e[t.track].push(t))}),_.each(e,function(e,t){var r={},i={},o=n[t]=[];_.each(e,function(e){return r[e.note]||"noteOn"!=e.type?void(r[e.note]&&"noteOff"==e.type&&(r[e.note]=!1,o.push({note:e.note,velocity:e.velocity,start:i[e.note],end:e.playTime,dur:e.playTime-i[e.note]}))):(r[e.note]=!0,void(i[e.note]=e.playTime))})});var i=_.keys(n),o=parseInt(i[i.length-1])+1;E.numTracks=o,E.colors=a,u=new PianoRollGeometry(t,o,n,r,a),f=new THREE.ShaderMaterial({vertexShader:this.deps.noteShader.vs,fragmentShader:this.deps.noteShader.fs,attributes:u.attributes,uniforms:b,transparent:!0,wireframe:!0}),d=new THREE.Mesh(u,f),d.scale.multiplyScalar(PianoRollVideo.SCALE),l.add(d)}}})}function PianoRollParticles(e,t,r){function n(e,t,r,n){var i=h[c];i.init(e+Math.randomRange(.5),t+Math.randomRange(.5),r+Math.randomRange(.5),n),c++,c%=h.length}function i(e){e.update()}function o(e){e.kill()}function a(e){if(void 0!=e){var t,r,i;if(t=PianoRollGeometry.x(d),g[e.track]){var o,a=e.playTime+v[e.track];o=a==e.playTime?g[e.track]:Math.cmap(d,e.playTime,a,e.note,g[e.track]),r=PianoRollGeometry.y(o)}else r=PianoRollGeometry.y(e.note);i=PianoRollGeometry.z(e.track,e.numTracks),n(t,r,i,e.color)}}function s(e){var t=!1,r=new THREE.Vector3(0,200*Math.random(),0),n=new THREE.Vector3(1,1,1);f.attributes.size.value.push(0),f.attributes.color.value.push(n),u.vertices.push(r);var i=0,o=0,a=new THREE.Vector3;this.init=function(s,l,c,h){o=0,a.x=Math.random(2,3),a.y=Math.randomRange(1),a.z=Math.randomRange(1),a.multiplyScalar(iii.params.pianoRollParticleVelocity),r.x=s,r.y=l,r.z=c,t=!0,i=iii.params.pianoRollParticleGravity,f.attributes.size.value[e]=iii.params.pianoRollParticleInitialSize,n.copy(h),f.attributes.color.needsUpdate=!0},this.update=function(){t&&(f.attributes.size.value[e]*=iii.params.pianoRollParticleDecay,f.attributes.size.needsUpdate=!0,r.addVectors(r,a),a.multiplyScalar(iii.params.pianoRollParticleDrag),a.y+=i,o++,o>iii.params.pianoRollParticleLifeSpan&&(f.attributes.size.value[e]=0,t=!1))},this.kill=function(){t=!1,f.attributes.size.value[e]=0,f.attributes.size.needsUpdate=!0}}for(var l=THREE.ImageUtils.loadTexture("images/iii/flare.png"),c=0,h=[],u=new THREE.Geometry,f=new THREE.ShaderMaterial({vertexShader:t,fragmentShader:r,attributes:{color:{type:"v3",value:[]},size:{type:"f",value:[]}},uniforms:{map:{type:"t",value:l},pixelRatio:{type:"f",value:window.devicePixelRatio||1}},depthTest:!1,transparent:!0,blending:THREE.AdditiveBlending}),d=0,p={},m={},g={},v={},E=0;E<PianoRollParticles.COUNT;E++)h.push(new s(E));this.numTracks=0,this.colors=[],this.object=new THREE.PointCloud(u,f),this.object.scale.multiplyScalar(PianoRollVideo.SCALE),this.object.sortParticles=!1,midi.on({type:"pitchBend"},function(t,r){v[r.track]=60/e*1e3*(r.highValue<<7|r.lowValue)/480},this),midi.on({type:"noteOn"},function(e,t){t.color=this.colors[t.velocity],t.numTracks=this.numTracks;var r=m[t.track],i=t;r&&r.playTime==i.playTime?(p[t.track]=r,g[t.track]=i.note):(p[t.track]=i,g[t.track]=void 0,n(PianoRollGeometry.x(t.playTime),PianoRollGeometry.y(t.note),PianoRollGeometry.z(t.track,t.numTracks),t.color),n(PianoRollGeometry.x(t.playTime),PianoRollGeometry.y(t.note),PianoRollGeometry.z(t.track,t.numTracks),t.color),n(PianoRollGeometry.x(t.playTime),PianoRollGeometry.y(t.note),PianoRollGeometry.z(t.track,t.numTracks),t.color)),m[t.track]=void 0},this),this.dispose=midi.on({type:"noteOff"},function(e,t){t.color=this.colors[t.velocity],t.numTracks=this.numTracks,m[t.track]=t,p[t.track]=void 0,g[t.track]=void 0},this).off;var E=0;this.update=function(e){d>e&&this.killAll(),d=e,E++,E%3!=0&&_.each(p,a),_.each(h,i),u.verticesNeedUpdate=!0},this.killAll=function(){_.each(h,o),_.each(p,function(e,t){p[t]=void 0})}}!function(){function e(e,t){return function(){e.apply(t,arguments)}}function t(t){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],s(t,e(n,this),e(i,this))}function r(e){var t=this;return null===this._state?void this._deferreds.push(e):void c(function(){var r=t._state?e.onFulfilled:e.onRejected;if(null===r)return void(t._state?e.resolve:e.reject)(t._value);var n;try{n=r(t._value)}catch(i){return void e.reject(i)}e.resolve(n)})}function n(t){try{if(t===this)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var r=t.then;if("function"==typeof r)return void s(e(r,t),e(n,this),e(i,this))}this._state=!0,this._value=t,o.call(this)}catch(a){i.call(this,a)}}function i(e){this._state=!1,this._value=e,o.call(this)}function o(){for(var e=0,t=this._deferreds.length;t>e;e++)r.call(this,this._deferreds[e]);this._deferreds=null}function a(e,t,r,n){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=r,this.reject=n}function s(e,t,r){var n=!1;try{e(function(e){n||(n=!0,t(e))},function(e){n||(n=!0,r(e))})}catch(i){if(n)return;n=!0,r(i)}}var l;l="object"==typeof window&&window?window:global,"undefined"!=typeof module&&module.exports?module.exports=l.Promise?l.Promise:t:l.Promise||(l.Promise=t);var c=l.setImmediate||function(e){setTimeout(e,1)},h=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};t.prototype["catch"]=function(e){return this.then(null,e)},t.prototype.then=function(e,n){var i=this;return new t(function(t,o){r.call(i,new a(e,n,t,o))})},t.all=function(){var e=Array.prototype.slice.call(1===arguments.length&&h(arguments[0])?arguments[0]:arguments);return new t(function(t,r){function n(o,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var s=a.then;if("function"==typeof s)return void s.call(a,function(e){n(o,e)},r)}e[o]=a,0===--i&&t(e)}catch(l){r(l)}}if(0===e.length)return t([]);for(var i=e.length,o=0;o<e.length;o++)n(o,e[o])})},t.resolve=function(e){return e&&"object"==typeof e&&e.constructor===t?e:new t(function(t){t(e)})},t.reject=function(e){return new t(function(t,r){r(e)})},t.race=function(e){return new t(function(t,r){for(var n=0,i=e.length;i>n;n++)e[n].then(t,r)})}}();var THREE={REVISION:"68"};"object"==typeof module&&(module.exports=THREE),THREE.CullFaceNone=0,THREE.CullFaceBack=1,THREE.CullFaceFront=2,THREE.CullFaceFrontBack=3,THREE.FrontFaceDirectionCW=0,THREE.FrontFaceDirectionCCW=1,THREE.BasicShadowMap=0,THREE.PCFShadowMap=1,THREE.PCFSoftShadowMap=2,THREE.FrontSide=0,THREE.BackSide=1,THREE.DoubleSide=2,THREE.NoShading=0,THREE.FlatShading=1,THREE.SmoothShading=2,THREE.NoColors=0,THREE.FaceColors=1,THREE.VertexColors=2,THREE.NoBlending=0,THREE.NormalBlending=1,THREE.AdditiveBlending=2,THREE.SubtractiveBlending=3,THREE.MultiplyBlending=4,THREE.CustomBlending=5,THREE.AddEquation=100,THREE.SubtractEquation=101,THREE.ReverseSubtractEquation=102,THREE.ZeroFactor=200,THREE.OneFactor=201,THREE.SrcColorFactor=202,THREE.OneMinusSrcColorFactor=203,THREE.SrcAlphaFactor=204,THREE.OneMinusSrcAlphaFactor=205,THREE.DstAlphaFactor=206,THREE.OneMinusDstAlphaFactor=207,THREE.DstColorFactor=208,THREE.OneMinusDstColorFactor=209,THREE.SrcAlphaSaturateFactor=210,THREE.MultiplyOperation=0,THREE.MixOperation=1,THREE.AddOperation=2,THREE.UVMapping=function(){},THREE.CubeReflectionMapping=function(){},THREE.CubeRefractionMapping=function(){},THREE.SphericalReflectionMapping=function(){},THREE.SphericalRefractionMapping=function(){},THREE.RepeatWrapping=1e3,THREE.ClampToEdgeWrapping=1001,THREE.MirroredRepeatWrapping=1002,THREE.NearestFilter=1003,THREE.NearestMipMapNearestFilter=1004,THREE.NearestMipMapLinearFilter=1005,THREE.LinearFilter=1006,THREE.LinearMipMapNearestFilter=1007,THREE.LinearMipMapLinearFilter=1008,THREE.UnsignedByteType=1009,THREE.ByteType=1010,THREE.ShortType=1011,THREE.UnsignedShortType=1012,THREE.IntType=1013,THREE.UnsignedIntType=1014,THREE.FloatType=1015,THREE.UnsignedShort4444Type=1016,THREE.UnsignedShort5551Type=1017,THREE.UnsignedShort565Type=1018,THREE.AlphaFormat=1019,THREE.RGBFormat=1020,THREE.RGBAFormat=1021,THREE.LuminanceFormat=1022,THREE.LuminanceAlphaFormat=1023,THREE.RGB_S3TC_DXT1_Format=2001,THREE.RGBA_S3TC_DXT1_Format=2002,THREE.RGBA_S3TC_DXT3_Format=2003,THREE.RGBA_S3TC_DXT5_Format=2004,THREE.Color=function(e){return 3===arguments.length?this.setRGB(arguments[0],arguments[1],arguments[2]):this.set(e)},THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,set:function(e){return e instanceof THREE.Color?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,r){return this.r=e,this.g=t,this.b=r,this},setHSL:function(e,t,r){if(0===t)this.r=this.g=this.b=r;else{var n=function(e,t,r){return 0>r&&(r+=1),r>1&&(r-=1),1/6>r?e+6*(t-e)*r:.5>r?t:2/3>r?e+6*(t-e)*(2/3-r):e},i=.5>=r?r*(1+t):r+t-r*t,o=2*r-i;this.r=n(o,i,e+1/3),this.g=n(o,i,e),this.b=n(o,i,e-1/3)}return this},setStyle:function(e){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(e)){var t=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(e);return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,this}if(/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(e)){var t=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(e);return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,this}if(/^\#([0-9a-f]{6})$/i.test(e)){var t=/^\#([0-9a-f]{6})$/i.exec(e);return this.setHex(parseInt(t[1],16)),this}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(e)){var t=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(e);return this.setHex(parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3],16)),this}return/^(\w+)$/i.test(e)?(this.setHex(THREE.ColorKeywords[e]),this):void 0},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e){return this.r=e.r*e.r,this.g=e.g*e.g,this.b=e.b*e.b,this},copyLinearToGamma:function(e){return this.r=Math.sqrt(e.r),this.g=Math.sqrt(e.g),this.b=Math.sqrt(e.b),this},convertGammaToLinear:function(){var e=this.r,t=this.g,r=this.b;return this.r=e*e,this.g=t*t,this.b=r*r,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){var t,r,n=e||{h:0,s:0,l:0},i=this.r,o=this.g,a=this.b,s=Math.max(i,o,a),l=Math.min(i,o,a),c=(l+s)/2;if(l===s)t=0,r=0;else{var h=s-l;switch(r=.5>=c?h/(s+l):h/(2-s-l),s){case i:t=(o-a)/h+(a>o?6:0);break;case o:t=(a-i)/h+2;break;case a:t=(i-o)/h+4}t/=6}return n.h=t,n.s=r,n.l=c,n},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,r){var n=this.getHSL();return n.h+=e,n.s+=t,n.l+=r,this.setHSL(n.h,n.s,n.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e){return this.r=e[0],this.g=e[1],this.b=e[2],this},toArray:function(){return[this.r,this.g,this.b]},clone:function(){return(new THREE.Color).setRGB(this.r,this.g,this.b)}},THREE.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},THREE.Quaternion=function(e,t,r,n){this._x=e||0,this._y=t||0,this._z=r||0,this._w=void 0!==n?n:1},THREE.Quaternion.prototype={constructor:THREE.Quaternion,_x:0,_y:0,_z:0,_w:0,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get w(){return this._w},set w(e){this._w=e,this.onChangeCallback()},set:function(e,t,r,n){return this._x=e,this._y=t,this._z=r,this._w=n,this.onChangeCallback(),this},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(e,t){if(e instanceof THREE.Euler==!1)throw new Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var r=Math.cos(e._x/2),n=Math.cos(e._y/2),i=Math.cos(e._z/2),o=Math.sin(e._x/2),a=Math.sin(e._y/2),s=Math.sin(e._z/2);return"XYZ"===e.order?(this._x=o*n*i+r*a*s,this._y=r*a*i-o*n*s,this._z=r*n*s+o*a*i,this._w=r*n*i-o*a*s):"YXZ"===e.order?(this._x=o*n*i+r*a*s,this._y=r*a*i-o*n*s,this._z=r*n*s-o*a*i,this._w=r*n*i+o*a*s):"ZXY"===e.order?(this._x=o*n*i-r*a*s,this._y=r*a*i+o*n*s,this._z=r*n*s+o*a*i,this._w=r*n*i-o*a*s):"ZYX"===e.order?(this._x=o*n*i-r*a*s,this._y=r*a*i+o*n*s,this._z=r*n*s-o*a*i,this._w=r*n*i+o*a*s):"YZX"===e.order?(this._x=o*n*i+r*a*s,this._y=r*a*i+o*n*s,this._z=r*n*s-o*a*i,this._w=r*n*i-o*a*s):"XZY"===e.order&&(this._x=o*n*i-r*a*s,this._y=r*a*i-o*n*s,this._z=r*n*s+o*a*i,this._w=r*n*i+o*a*s),t!==!1&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){var r=t/2,n=Math.sin(r);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(r),this.onChangeCallback(),this},setFromRotationMatrix:function(e){var t,r=e.elements,n=r[0],i=r[4],o=r[8],a=r[1],s=r[5],l=r[9],c=r[2],h=r[6],u=r[10],f=n+s+u;return f>0?(t=.5/Math.sqrt(f+1),this._w=.25/t,this._x=(h-l)*t,this._y=(o-c)*t,this._z=(a-i)*t):n>s&&n>u?(t=2*Math.sqrt(1+n-s-u),this._w=(h-l)/t,this._x=.25*t,this._y=(i+a)/t,this._z=(o+c)/t):s>u?(t=2*Math.sqrt(1+s-n-u),this._w=(o-c)/t,this._x=(i+a)/t,this._y=.25*t,this._z=(l+h)/t):(t=2*Math.sqrt(1+u-n-s),this._w=(a-i)/t,this._x=(o+c)/t,this._y=(l+h)/t,this._z=.25*t),this.onChangeCallback(),this},setFromUnitVectors:function(){var e,t,r=1e-6;return function(n,i){return void 0===e&&(e=new THREE.Vector3),t=n.dot(i)+1,r>t?(t=0,Math.abs(n.x)>Math.abs(n.z)?e.set(-n.y,n.x,0):e.set(0,-n.z,n.y)):e.crossVectors(n,i),this._x=e.x,this._y=e.y,this._z=e.z,this._w=t,this.normalize(),this}}(),inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var r=e._x,n=e._y,i=e._z,o=e._w,a=t._x,s=t._y,l=t._z,c=t._w;return this._x=r*c+o*a+n*l-i*s,this._y=n*c+o*s+i*a-r*l,this._z=i*c+o*l+r*s-n*a,this._w=o*c-r*a-n*s-i*l,this.onChangeCallback(),this},multiplyVector3:function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},slerp:function(e,t){var r=this._x,n=this._y,i=this._z,o=this._w,a=o*e._w+r*e._x+n*e._y+i*e._z;if(0>a?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=r,this._y=n,this._z=i,this;var s=Math.acos(a),l=Math.sqrt(1-a*a);if(Math.abs(l)<.001)return this._w=.5*(o+this._w),this._x=.5*(r+this._x),this._y=.5*(n+this._y),this._z=.5*(i+this._z),this;var c=Math.sin((1-t)*s)/l,h=Math.sin(t*s)/l;return this._w=o*c+this._w*h,this._x=r*c+this._x*h,this._y=n*c+this._y*h,this._z=i*c+this._z*h,this.onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],this._w=e[3],this.onChangeCallback(),this},toArray:function(){return[this._x,this._y,this._z,this._w]},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){},clone:function(){return new THREE.Quaternion(this._x,this._y,this._z,this._w)}},THREE.Quaternion.slerp=function(e,t,r,n){return r.copy(e).slerp(t,n)},THREE.Vector2=function(e,t){this.x=e||0,this.y=t||0},THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScalar:function(e){return this.x+=e,this.y+=e,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t}else this.x=0,this.y=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this},clampScalar:function(){var e,t;return function(r,n){return void 0===e&&(e=new THREE.Vector2,t=new THREE.Vector2),e.set(r,r),t.set(n,n),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this
},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e){return this.x=e[0],this.y=e[1],this},toArray:function(){return[this.x,this.y]},clone:function(){return new THREE.Vector2(this.x,this.y)}},THREE.Vector3=function(e,t,r){this.x=e||0,this.y=t||0,this.z=r||0},THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(e,t,r){return this.x=e,this.y=t,this.z=r,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(){var e;return function(t){return t instanceof THREE.Euler==!1&&console.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order."),void 0===e&&(e=new THREE.Quaternion),this.applyQuaternion(e.setFromEuler(t)),this}}(),applyAxisAngle:function(){var e;return function(t,r){return void 0===e&&(e=new THREE.Quaternion),this.applyQuaternion(e.setFromAxisAngle(t,r)),this}}(),applyMatrix3:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6]*n,this.y=i[1]*t+i[4]*r+i[7]*n,this.z=i[2]*t+i[5]*r+i[8]*n,this},applyMatrix4:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[4]*r+i[8]*n+i[12],this.y=i[1]*t+i[5]*r+i[9]*n+i[13],this.z=i[2]*t+i[6]*r+i[10]*n+i[14],this},applyProjection:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements,o=1/(i[3]*t+i[7]*r+i[11]*n+i[15]);return this.x=(i[0]*t+i[4]*r+i[8]*n+i[12])*o,this.y=(i[1]*t+i[5]*r+i[9]*n+i[13])*o,this.z=(i[2]*t+i[6]*r+i[10]*n+i[14])*o,this},applyQuaternion:function(e){var t=this.x,r=this.y,n=this.z,i=e.x,o=e.y,a=e.z,s=e.w,l=s*t+o*n-a*r,c=s*r+a*t-i*n,h=s*n+i*r-o*t,u=-i*t-o*r-a*n;return this.x=l*s+u*-i+c*-a-h*-o,this.y=c*s+u*-o+h*-i-l*-a,this.z=h*s+u*-a+l*-o-c*-i,this},transformDirection:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[4]*r+i[8]*n,this.y=i[1]*t+i[5]*r+i[9]*n,this.z=i[2]*t+i[6]*r+i[10]*n,this.normalize(),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t}else this.x=0,this.y=0,this.z=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this},clampScalar:function(){var e,t;return function(r,n){return void 0===e&&(e=new THREE.Vector3,t=new THREE.Vector3),e.set(r,r,r),t.set(n,n,n),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},cross:function(e,t){if(void 0!==t)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var r=this.x,n=this.y,i=this.z;return this.x=n*e.z-i*e.y,this.y=i*e.x-r*e.z,this.z=r*e.y-n*e.x,this},crossVectors:function(e,t){var r=e.x,n=e.y,i=e.z,o=t.x,a=t.y,s=t.z;return this.x=n*s-i*a,this.y=i*o-r*s,this.z=r*a-n*o,this},projectOnVector:function(){var e,t;return function(r){return void 0===e&&(e=new THREE.Vector3),e.copy(r).normalize(),t=this.dot(e),this.copy(e).multiplyScalar(t)}}(),projectOnPlane:function(){var e;return function(t){return void 0===e&&(e=new THREE.Vector3),e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e;return function(t){return void 0===e&&(e=new THREE.Vector3),this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){var t=this.dot(e)/(this.length()*e.length());return Math.acos(THREE.Math.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y,n=this.z-e.z;return t*t+r*r+n*n},setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},setFromMatrixPosition:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setFromMatrixScale:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),r=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),n=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=r,this.z=n,this},setFromMatrixColumn:function(e,t){var r=4*e,n=t.elements;return this.x=n[r],this.y=n[r+1],this.z=n[r+2],this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this},toArray:function(){return[this.x,this.y,this.z]},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}},THREE.Vector4=function(e,t,r,n){this.x=e||0,this.y=t||0,this.z=r||0,this.w=void 0!==n?n:1},THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(e,t,r,n){return this.x=e,this.y=t,this.z=r,this.w=n,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,r=this.y,n=this.z,i=this.w,o=e.elements;return this.x=o[0]*t+o[4]*r+o[8]*n+o[12]*i,this.y=o[1]*t+o[5]*r+o[9]*n+o[13]*i,this.z=o[2]*t+o[6]*r+o[10]*n+o[14]*i,this.w=o[3]*t+o[7]*r+o[11]*n+o[15]*i,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t,this.w*=t}else this.x=0,this.y=0,this.z=0,this.w=1;return this},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return 1e-4>t?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,r,n,i,o=.01,a=.1,s=e.elements,l=s[0],c=s[4],h=s[8],u=s[1],f=s[5],d=s[9],p=s[2],m=s[6],g=s[10];if(Math.abs(c-u)<o&&Math.abs(h-p)<o&&Math.abs(d-m)<o){if(Math.abs(c+u)<a&&Math.abs(h+p)<a&&Math.abs(d+m)<a&&Math.abs(l+f+g-3)<a)return this.set(1,0,0,0),this;t=Math.PI;var v=(l+1)/2,E=(f+1)/2,y=(g+1)/2,T=(c+u)/4,x=(h+p)/4,w=(d+m)/4;return v>E&&v>y?o>v?(r=0,n=.707106781,i=.707106781):(r=Math.sqrt(v),n=T/r,i=x/r):E>y?o>E?(r=.707106781,n=0,i=.707106781):(n=Math.sqrt(E),r=T/n,i=w/n):o>y?(r=.707106781,n=.707106781,i=0):(i=Math.sqrt(y),r=x/i,n=w/i),this.set(r,n,i,t),this}var b=Math.sqrt((m-d)*(m-d)+(h-p)*(h-p)+(u-c)*(u-c));return Math.abs(b)<.001&&(b=1),this.x=(m-d)/b,this.y=(h-p)/b,this.z=(u-c)/b,this.w=Math.acos((l+f+g-1)/2),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this.w>e.w&&(this.w=e.w),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this.w<e.w&&(this.w=e.w),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this.w<e.w?this.w=e.w:this.w>t.w&&(this.w=t.w),this},clampScalar:function(){var e,t;return function(r,n){return void 0===e&&(e=new THREE.Vector4,t=new THREE.Vector4),e.set(r,r,r,r),t.set(n,n,n,n),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this.w=e[3],this},toArray:function(){return[this.x,this.y,this.z,this.w]},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}},THREE.Euler=function(e,t,r,n){this._x=e||0,this._y=t||0,this._z=r||0,this._order=n||THREE.Euler.DefaultOrder},THREE.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],THREE.Euler.DefaultOrder="XYZ",THREE.Euler.prototype={constructor:THREE.Euler,_x:0,_y:0,_z:0,_order:THREE.Euler.DefaultOrder,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get order(){return this._order},set order(e){this._order=e,this.onChangeCallback()},set:function(e,t,r,n){return this._x=e,this._y=t,this._z=r,this._order=n||this._order,this.onChangeCallback(),this},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(e,t){var r=THREE.Math.clamp,n=e.elements,i=n[0],o=n[4],a=n[8],s=n[1],l=n[5],c=n[9],h=n[2],u=n[6],f=n[10];return t=t||this._order,"XYZ"===t?(this._y=Math.asin(r(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(-c,f),this._z=Math.atan2(-o,i)):(this._x=Math.atan2(u,l),this._z=0)):"YXZ"===t?(this._x=Math.asin(-r(c,-1,1)),Math.abs(c)<.99999?(this._y=Math.atan2(a,f),this._z=Math.atan2(s,l)):(this._y=Math.atan2(-h,i),this._z=0)):"ZXY"===t?(this._x=Math.asin(r(u,-1,1)),Math.abs(u)<.99999?(this._y=Math.atan2(-h,f),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(s,i))):"ZYX"===t?(this._y=Math.asin(-r(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(u,f),this._z=Math.atan2(s,i)):(this._x=0,this._z=Math.atan2(-o,l))):"YZX"===t?(this._z=Math.asin(r(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-h,i)):(this._x=0,this._y=Math.atan2(a,f))):"XZY"===t?(this._z=Math.asin(-r(o,-1,1)),Math.abs(o)<.99999?(this._x=Math.atan2(u,l),this._y=Math.atan2(a,i)):(this._x=Math.atan2(-c,f),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,this.onChangeCallback(),this},setFromQuaternion:function(e,t,r){var n=THREE.Math.clamp,i=e.x*e.x,o=e.y*e.y,a=e.z*e.z,s=e.w*e.w;return t=t||this._order,"XYZ"===t?(this._x=Math.atan2(2*(e.x*e.w-e.y*e.z),s-i-o+a),this._y=Math.asin(n(2*(e.x*e.z+e.y*e.w),-1,1)),this._z=Math.atan2(2*(e.z*e.w-e.x*e.y),s+i-o-a)):"YXZ"===t?(this._x=Math.asin(n(2*(e.x*e.w-e.y*e.z),-1,1)),this._y=Math.atan2(2*(e.x*e.z+e.y*e.w),s-i-o+a),this._z=Math.atan2(2*(e.x*e.y+e.z*e.w),s-i+o-a)):"ZXY"===t?(this._x=Math.asin(n(2*(e.x*e.w+e.y*e.z),-1,1)),this._y=Math.atan2(2*(e.y*e.w-e.z*e.x),s-i-o+a),this._z=Math.atan2(2*(e.z*e.w-e.x*e.y),s-i+o-a)):"ZYX"===t?(this._x=Math.atan2(2*(e.x*e.w+e.z*e.y),s-i-o+a),this._y=Math.asin(n(2*(e.y*e.w-e.x*e.z),-1,1)),this._z=Math.atan2(2*(e.x*e.y+e.z*e.w),s+i-o-a)):"YZX"===t?(this._x=Math.atan2(2*(e.x*e.w-e.z*e.y),s-i+o-a),this._y=Math.atan2(2*(e.y*e.w-e.x*e.z),s+i-o-a),this._z=Math.asin(n(2*(e.x*e.y+e.z*e.w),-1,1))):"XZY"===t?(this._x=Math.atan2(2*(e.x*e.w+e.y*e.z),s-i+o-a),this._y=Math.atan2(2*(e.x*e.z+e.y*e.w),s+i-o-a),this._z=Math.asin(n(2*(e.z*e.w-e.x*e.y),-1,1))):console.warn("THREE.Euler: .setFromQuaternion() given unsupported order: "+t),this._order=t,r!==!1&&this.onChangeCallback(),this},reorder:function(){var e=new THREE.Quaternion;return function(t){e.setFromEuler(this),this.setFromQuaternion(e,t)}}(),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(){return[this._x,this._y,this._z,this._order]},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){},clone:function(){return new THREE.Euler(this._x,this._y,this._z,this._order)}},THREE.Line3=function(e,t){this.start=void 0!==e?e:new THREE.Vector3,this.end=void 0!==t?t:new THREE.Vector3},THREE.Line3.prototype={constructor:THREE.Line3,set:function(e,t){return this.start.copy(e),this.end.copy(t),this},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},center:function(e){var t=e||new THREE.Vector3;return t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){var t=e||new THREE.Vector3;return t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var r=t||new THREE.Vector3;return this.delta(r).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(r,n){e.subVectors(r,this.start),t.subVectors(this.end,this.start);var i=t.dot(t),o=t.dot(e),a=o/i;return n&&(a=THREE.Math.clamp(a,0,1)),a}}(),closestPointToPoint:function(e,t,r){var n=this.closestPointToPointParameter(e,t),i=r||new THREE.Vector3;return this.delta(i).multiplyScalar(n).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)},clone:function(){return(new THREE.Line3).copy(this)}},THREE.Box2=function(e,t){this.min=void 0!==e?e:new THREE.Vector2(1/0,1/0),this.max=void 0!==t?t:new THREE.Vector2(-1/0,-1/0)},THREE.Box2.prototype={constructor:THREE.Box2,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;r>t;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new THREE.Vector2;return function(t,r){var n=e.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){var t=e||new THREE.Vector2;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new THREE.Vector2;return t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y?!0:!1},getParameter:function(e,t){var r=t||new THREE.Vector2;return r.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y?!1:!0},clampPoint:function(e,t){var r=t||new THREE.Vector2;return r.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new THREE.Vector2;return function(t){var r=e.copy(t).clamp(this.min,this.max);return r.sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new THREE.Box2).copy(this)}},THREE.Box3=function(e,t){this.min=void 0!==e?e:new THREE.Vector3(1/0,1/0,1/0),this.max=void 0!==t?t:new THREE.Vector3(-1/0,-1/0,-1/0)},THREE.Box3.prototype={constructor:THREE.Box3,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;r>t;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new THREE.Vector3;return function(t,r){var n=e.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}}(),setFromObject:function(){var e=new THREE.Vector3;return function(t){var r=this;return t.updateMatrixWorld(!0),this.makeEmpty(),t.traverse(function(t){if(void 0!==t.geometry&&void 0!==t.geometry.vertices)for(var n=t.geometry.vertices,i=0,o=n.length;o>i;i++)e.copy(n[i]),e.applyMatrix4(t.matrixWorld),r.expandByPoint(e)}),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){var t=e||new THREE.Vector3;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new THREE.Vector3;return t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z?!0:!1},getParameter:function(e,t){var r=t||new THREE.Vector3;return r.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z?!1:!0},clampPoint:function(e,t){var r=t||new THREE.Vector3;return r.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new THREE.Vector3;return function(t){var r=e.copy(t).clamp(this.min,this.max);return r.sub(t).length()}}(),getBoundingSphere:function(){var e=new THREE.Vector3;return function(t){var r=t||new THREE.Sphere;return r.center=this.center(),r.radius=.5*this.size(e).length(),r}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var e=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];return function(t){return e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.makeEmpty(),this.setFromPoints(e),this}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new THREE.Box3).copy(this)}},THREE.Matrix3=function(e,t,r,n,i,o,a,s,l){this.elements=new Float32Array(9);var c=this.elements;c[0]=void 0!==e?e:1,c[3]=t||0,c[6]=r||0,c[1]=n||0,c[4]=void 0!==i?i:1,c[7]=o||0,c[2]=a||0,c[5]=s||0,c[8]=void 0!==l?l:1},THREE.Matrix3.prototype={constructor:THREE.Matrix3,set:function(e,t,r,n,i,o,a,s,l){var c=this.elements;return c[0]=e,c[3]=t,c[6]=r,c[1]=n,c[4]=i,c[7]=o,c[2]=a,c[5]=s,c[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]),this},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(e){return console.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)},applyToVector3Array:function(){var e=new THREE.Vector3;return function(t,r,n){void 0===r&&(r=0),void 0===n&&(n=t.length);for(var i=0,o=r;n>i;i+=3,o+=3)e.x=t[o],e.y=t[o+1],e.z=t[o+2],e.applyMatrix3(this),t[o]=e.x,t[o+1]=e.y,t[o+2]=e.z;return t}}(),multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],r=e[1],n=e[2],i=e[3],o=e[4],a=e[5],s=e[6],l=e[7],c=e[8];return t*o*c-t*a*l-r*i*c+r*a*s+n*i*l-n*o*s},getInverse:function(e,t){var r=e.elements,n=this.elements;n[0]=r[10]*r[5]-r[6]*r[9],n[1]=-r[10]*r[1]+r[2]*r[9],n[2]=r[6]*r[1]-r[2]*r[5],n[3]=-r[10]*r[4]+r[6]*r[8],n[4]=r[10]*r[0]-r[2]*r[8],n[5]=-r[6]*r[0]+r[2]*r[4],n[6]=r[9]*r[4]-r[5]*r[8],n[7]=-r[9]*r[0]+r[1]*r[8],n[8]=r[5]*r[0]-r[1]*r[4];var i=r[0]*n[0]+r[1]*n[3]+r[2]*n[6];if(0===i){var o="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(o);return console.warn(o),this.identity(),this}return this.multiplyScalar(1/i),this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},flattenToArrayOffset:function(e,t){var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e},getNormalMatrix:function(e){return this.getInverse(e).transpose(),this},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},clone:function(){var e=this.elements;return new THREE.Matrix3(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])}},THREE.Matrix4=function(e,t,r,n,i,o,a,s,l,c,h,u,f,d,p,m){this.elements=new Float32Array(16);var g=this.elements;g[0]=void 0!==e?e:1,g[4]=t||0,g[8]=r||0,g[12]=n||0,g[1]=i||0,g[5]=void 0!==o?o:1,g[9]=a||0,g[13]=s||0,g[2]=l||0,g[6]=c||0,g[10]=void 0!==h?h:1,g[14]=u||0,g[3]=f||0,g[7]=d||0,g[11]=p||0,g[15]=void 0!==m?m:1},THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(e,t,r,n,i,o,a,s,l,c,h,u,f,d,p,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=r,g[12]=n,g[1]=i,g[5]=o,g[9]=a,g[13]=s,g[2]=l,g[6]=c,g[10]=h,g[14]=u,g[3]=f,g[7]=d,g[11]=p,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return this.elements.set(e.elements),this},extractPosition:function(e){return console.warn("THREEMatrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},copyPosition:function(e){var t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this},extractRotation:function(){var e=new THREE.Vector3;return function(t){var r=this.elements,n=t.elements,i=1/e.set(n[0],n[1],n[2]).length(),o=1/e.set(n[4],n[5],n[6]).length(),a=1/e.set(n[8],n[9],n[10]).length();return r[0]=n[0]*i,r[1]=n[1]*i,r[2]=n[2]*i,r[4]=n[4]*o,r[5]=n[5]*o,r[6]=n[6]*o,r[8]=n[8]*a,r[9]=n[9]*a,r[10]=n[10]*a,this}}(),makeRotationFromEuler:function(e){e instanceof THREE.Euler==!1&&console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,r=e.x,n=e.y,i=e.z,o=Math.cos(r),a=Math.sin(r),s=Math.cos(n),l=Math.sin(n),c=Math.cos(i),h=Math.sin(i);if("XYZ"===e.order){var u=o*c,f=o*h,d=a*c,p=a*h;t[0]=s*c,t[4]=-s*h,t[8]=l,t[1]=f+d*l,t[5]=u-p*l,t[9]=-a*s,t[2]=p-u*l,t[6]=d+f*l,t[10]=o*s}else if("YXZ"===e.order){var m=s*c,g=s*h,v=l*c,E=l*h;t[0]=m+E*a,t[4]=v*a-g,t[8]=o*l,t[1]=o*h,t[5]=o*c,t[9]=-a,t[2]=g*a-v,t[6]=E+m*a,t[10]=o*s}else if("ZXY"===e.order){var m=s*c,g=s*h,v=l*c,E=l*h;t[0]=m-E*a,t[4]=-o*h,t[8]=v+g*a,t[1]=g+v*a,t[5]=o*c,t[9]=E-m*a,t[2]=-o*l,t[6]=a,t[10]=o*s}else if("ZYX"===e.order){var u=o*c,f=o*h,d=a*c,p=a*h;t[0]=s*c,t[4]=d*l-f,t[8]=u*l+p,t[1]=s*h,t[5]=p*l+u,t[9]=f*l-d,t[2]=-l,t[6]=a*s,t[10]=o*s}else if("YZX"===e.order){var y=o*s,T=o*l,x=a*s,w=a*l;t[0]=s*c,t[4]=w-y*h,t[8]=x*h+T,t[1]=h,t[5]=o*c,t[9]=-a*c,t[2]=-l*c,t[6]=T*h+x,t[10]=y-w*h}else if("XZY"===e.order){var y=o*s,T=o*l,x=a*s,w=a*l;t[0]=s*c,t[4]=-h,t[8]=l*c,t[1]=y*h+w,t[5]=o*c,t[9]=T*h-x,t[2]=x*h-T,t[6]=a*c,t[10]=w*h+y}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},makeRotationFromQuaternion:function(e){var t=this.elements,r=e.x,n=e.y,i=e.z,o=e.w,a=r+r,s=n+n,l=i+i,c=r*a,h=r*s,u=r*l,f=n*s,d=n*l,p=i*l,m=o*a,g=o*s,v=o*l;return t[0]=1-(f+p),t[4]=h-v,t[8]=u+g,t[1]=h+v,t[5]=1-(c+p),t[9]=d-m,t[2]=u-g,t[6]=d+m,t[10]=1-(c+f),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(){var e=new THREE.Vector3,t=new THREE.Vector3,r=new THREE.Vector3;return function(n,i,o){var a=this.elements;return r.subVectors(n,i).normalize(),0===r.length()&&(r.z=1),e.crossVectors(o,r).normalize(),0===e.length()&&(r.x+=1e-4,e.crossVectors(o,r).normalize()),t.crossVectors(r,e),a[0]=e.x,a[4]=t.x,a[8]=r.x,a[1]=e.y,a[5]=t.y,a[9]=r.y,a[2]=e.z,a[6]=t.z,a[10]=r.z,this}}(),multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var r=e.elements,n=t.elements,i=this.elements,o=r[0],a=r[4],s=r[8],l=r[12],c=r[1],h=r[5],u=r[9],f=r[13],d=r[2],p=r[6],m=r[10],g=r[14],v=r[3],E=r[7],y=r[11],T=r[15],x=n[0],w=n[4],b=n[8],R=n[12],_=n[1],H=n[5],M=n[9],S=n[13],C=n[2],A=n[6],k=n[10],L=n[14],P=n[3],F=n[7],N=n[11],D=n[15];return i[0]=o*x+a*_+s*C+l*P,i[4]=o*w+a*H+s*A+l*F,i[8]=o*b+a*M+s*k+l*N,i[12]=o*R+a*S+s*L+l*D,i[1]=c*x+h*_+u*C+f*P,i[5]=c*w+h*H+u*A+f*F,i[9]=c*b+h*M+u*k+f*N,i[13]=c*R+h*S+u*L+f*D,i[2]=d*x+p*_+m*C+g*P,i[6]=d*w+p*H+m*A+g*F,i[10]=d*b+p*M+m*k+g*N,i[14]=d*R+p*S+m*L+g*D,i[3]=v*x+E*_+y*C+T*P,i[7]=v*w+E*H+y*A+T*F,i[11]=v*b+E*M+y*k+T*N,i[15]=v*R+E*S+y*L+T*D,this},multiplyToArray:function(e,t,r){var n=this.elements;return this.multiplyMatrices(e,t),r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r[8]=n[8],r[9]=n[9],r[10]=n[10],r[11]=n[11],r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15],this
},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),e.applyProjection(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(e){return console.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)},applyToVector3Array:function(){var e=new THREE.Vector3;return function(t,r,n){void 0===r&&(r=0),void 0===n&&(n=t.length);for(var i=0,o=r;n>i;i+=3,o+=3)e.x=t[o],e.y=t[o+1],e.z=t[o+2],e.applyMatrix4(this),t[o]=e.x,t[o+1]=e.y,t[o+2]=e.z;return t}}(),rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},determinant:function(){var e=this.elements,t=e[0],r=e[4],n=e[8],i=e[12],o=e[1],a=e[5],s=e[9],l=e[13],c=e[2],h=e[6],u=e[10],f=e[14],d=e[3],p=e[7],m=e[11],g=e[15];return d*(+i*s*h-n*l*h-i*a*u+r*l*u+n*a*f-r*s*f)+p*(+t*s*f-t*l*u+i*o*u-n*o*f+n*l*c-i*s*c)+m*(+t*l*h-t*a*f-i*o*h+r*o*f+i*a*c-r*l*c)+g*(-n*a*c-t*s*h+t*a*u+n*o*h-r*o*u+r*s*c)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArrayOffset:function(e,t){var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e},getPosition:function(){var e=new THREE.Vector3;return function(){console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var t=this.elements;return e.set(t[12],t[13],t[14])}}(),setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var r=this.elements,n=e.elements,i=n[0],o=n[4],a=n[8],s=n[12],l=n[1],c=n[5],h=n[9],u=n[13],f=n[2],d=n[6],p=n[10],m=n[14],g=n[3],v=n[7],E=n[11],y=n[15];r[0]=h*m*v-u*p*v+u*d*E-c*m*E-h*d*y+c*p*y,r[4]=s*p*v-a*m*v-s*d*E+o*m*E+a*d*y-o*p*y,r[8]=a*u*v-s*h*v+s*c*E-o*u*E-a*c*y+o*h*y,r[12]=s*h*d-a*u*d-s*c*p+o*u*p+a*c*m-o*h*m,r[1]=u*p*g-h*m*g-u*f*E+l*m*E+h*f*y-l*p*y,r[5]=a*m*g-s*p*g+s*f*E-i*m*E-a*f*y+i*p*y,r[9]=s*h*g-a*u*g-s*l*E+i*u*E+a*l*y-i*h*y,r[13]=a*u*f-s*h*f+s*l*p-i*u*p-a*l*m+i*h*m,r[2]=c*m*g-u*d*g+u*f*v-l*m*v-c*f*y+l*d*y,r[6]=s*d*g-o*m*g-s*f*v+i*m*v+o*f*y-i*d*y,r[10]=o*u*g-s*c*g+s*l*v-i*u*v-o*l*y+i*c*y,r[14]=s*c*f-o*u*f-s*l*d+i*u*d+o*l*m-i*c*m,r[3]=h*d*g-c*p*g-h*f*v+l*p*v+c*f*E-l*d*E,r[7]=o*p*g-a*d*g+a*f*v-i*p*v-o*f*E+i*d*E,r[11]=a*c*g-o*h*g-a*l*v+i*h*v+o*l*E-i*c*E,r[15]=o*h*f-a*c*f+a*l*d-i*h*d-o*l*p+i*c*p;var T=i*r[0]+l*r[4]+f*r[8]+g*r[12];if(0==T){var x="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(x);return console.warn(x),this.identity(),this}return this.multiplyScalar(1/T),this},translate:function(){console.warn("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.warn("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.warn("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.warn("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.warn("THREE.Matrix4: .rotateByAxis() has been removed.")},scale:function(e){var t=this.elements,r=e.x,n=e.y,i=e.z;return t[0]*=r,t[4]*=n,t[8]*=i,t[1]*=r,t[5]*=n,t[9]*=i,t[2]*=r,t[6]*=n,t[10]*=i,t[3]*=r,t[7]*=n,t[11]*=i,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,Math.max(r,n)))},makeTranslation:function(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var r=Math.cos(t),n=Math.sin(t),i=1-r,o=e.x,a=e.y,s=e.z,l=i*o,c=i*a;return this.set(l*o+r,l*a-n*s,l*s+n*a,0,l*a+n*s,c*a+r,c*s-n*o,0,l*s-n*a,c*s+n*o,i*s*s+r,0,0,0,0,1),this},makeScale:function(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this},compose:function(e,t,r){return this.makeRotationFromQuaternion(t),this.scale(r),this.setPosition(e),this},decompose:function(){var e=new THREE.Vector3,t=new THREE.Matrix4;return function(r,n,i){var o=this.elements,a=e.set(o[0],o[1],o[2]).length(),s=e.set(o[4],o[5],o[6]).length(),l=e.set(o[8],o[9],o[10]).length(),c=this.determinant();0>c&&(a=-a),r.x=o[12],r.y=o[13],r.z=o[14],t.elements.set(this.elements);var h=1/a,u=1/s,f=1/l;return t.elements[0]*=h,t.elements[1]*=h,t.elements[2]*=h,t.elements[4]*=u,t.elements[5]*=u,t.elements[6]*=u,t.elements[8]*=f,t.elements[9]*=f,t.elements[10]*=f,n.setFromRotationMatrix(t),i.x=a,i.y=s,i.z=l,this}}(),makeFrustum:function(e,t,r,n,i,o){var a=this.elements,s=2*i/(t-e),l=2*i/(n-r),c=(t+e)/(t-e),h=(n+r)/(n-r),u=-(o+i)/(o-i),f=-2*o*i/(o-i);return a[0]=s,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=l,a[9]=h,a[13]=0,a[2]=0,a[6]=0,a[10]=u,a[14]=f,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makePerspective:function(e,t,r,n){var i=r*Math.tan(THREE.Math.degToRad(.5*e)),o=-i,a=o*t,s=i*t;return this.makeFrustum(a,s,o,i,r,n)},makeOrthographic:function(e,t,r,n,i,o){var a=this.elements,s=t-e,l=r-n,c=o-i,h=(t+e)/s,u=(r+n)/l,f=(o+i)/c;return a[0]=2/s,a[4]=0,a[8]=0,a[12]=-h,a[1]=0,a[5]=2/l,a[9]=0,a[13]=-u,a[2]=0,a[6]=0,a[10]=-2/c,a[14]=-f,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},clone:function(){var e=this.elements;return new THREE.Matrix4(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])}},THREE.Ray=function(e,t){this.origin=void 0!==e?e:new THREE.Vector3,this.direction=void 0!==t?t:new THREE.Vector3},THREE.Ray.prototype={constructor:THREE.Ray,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){var r=t||new THREE.Vector3;return r.copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(){var e=new THREE.Vector3;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){var r=t||new THREE.Vector3;r.subVectors(e,this.origin);var n=r.dot(this.direction);return 0>n?r.copy(this.origin):r.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function(){var e=new THREE.Vector3;return function(t){var r=e.subVectors(t,this.origin).dot(this.direction);return 0>r?this.origin.distanceTo(t):(e.copy(this.direction).multiplyScalar(r).add(this.origin),e.distanceTo(t))}}(),distanceSqToSegment:function(e,t,r,n){var i,o,a,s,l=e.clone().add(t).multiplyScalar(.5),c=t.clone().sub(e).normalize(),h=.5*e.distanceTo(t),u=this.origin.clone().sub(l),f=-this.direction.dot(c),d=u.dot(this.direction),p=-u.dot(c),m=u.lengthSq(),g=Math.abs(1-f*f);if(g>=0)if(i=f*p-d,o=f*d-p,s=h*g,i>=0)if(o>=-s)if(s>=o){var v=1/g;i*=v,o*=v,a=i*(i+f*o+2*d)+o*(f*i+o+2*p)+m}else o=h,i=Math.max(0,-(f*o+d)),a=-i*i+o*(o+2*p)+m;else o=-h,i=Math.max(0,-(f*o+d)),a=-i*i+o*(o+2*p)+m;else-s>=o?(i=Math.max(0,-(-f*h+d)),o=i>0?-h:Math.min(Math.max(-h,-p),h),a=-i*i+o*(o+2*p)+m):s>=o?(i=0,o=Math.min(Math.max(-h,-p),h),a=o*(o+2*p)+m):(i=Math.max(0,-(f*h+d)),o=i>0?h:Math.min(Math.max(-h,-p),h),a=-i*i+o*(o+2*p)+m);else o=f>0?-h:h,i=Math.max(0,-(f*o+d)),a=-i*i+o*(o+2*p)+m;return r&&r.copy(this.direction.clone().multiplyScalar(i).add(this.origin)),n&&n.copy(c.clone().multiplyScalar(o).add(l)),a},isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},intersectSphere:function(){var e=new THREE.Vector3;return function(t,r){e.subVectors(t.center,this.origin);var n=e.dot(this.direction),i=e.dot(e)-n*n,o=t.radius*t.radius;if(i>o)return null;var a=Math.sqrt(o-i),s=n-a,l=n+a;return 0>s&&0>l?null:0>s?this.at(l,r):this.at(s,r)}}(),isIntersectionPlane:function(e){var t=e.distanceToPoint(this.origin);if(0===t)return!0;var r=e.normal.dot(this.direction);return 0>r*t?!0:!1},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0==t)return 0==e.distanceToPoint(this.origin)?0:null;var r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null},intersectPlane:function(e,t){var r=this.distanceToPlane(e);return null===r?null:this.at(r,t)},isIntersectionBox:function(){var e=new THREE.Vector3;return function(t){return null!==this.intersectBox(t,e)}}(),intersectBox:function(e,t){var r,n,i,o,a,s,l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,u=this.origin;return l>=0?(r=(e.min.x-u.x)*l,n=(e.max.x-u.x)*l):(r=(e.max.x-u.x)*l,n=(e.min.x-u.x)*l),c>=0?(i=(e.min.y-u.y)*c,o=(e.max.y-u.y)*c):(i=(e.max.y-u.y)*c,o=(e.min.y-u.y)*c),r>o||i>n?null:((i>r||r!==r)&&(r=i),(n>o||n!==n)&&(n=o),h>=0?(a=(e.min.z-u.z)*h,s=(e.max.z-u.z)*h):(a=(e.max.z-u.z)*h,s=(e.min.z-u.z)*h),r>s||a>n?null:((a>r||r!==r)&&(r=a),(n>s||n!==n)&&(n=s),0>n?null:this.at(r>=0?r:n,t)))},intersectTriangle:function(){var e=new THREE.Vector3,t=new THREE.Vector3,r=new THREE.Vector3,n=new THREE.Vector3;return function(i,o,a,s,l){t.subVectors(o,i),r.subVectors(a,i),n.crossVectors(t,r);var c,h=this.direction.dot(n);if(h>0){if(s)return null;c=1}else{if(!(0>h))return null;c=-1,h=-h}e.subVectors(this.origin,i);var u=c*this.direction.dot(r.crossVectors(e,r));if(0>u)return null;var f=c*this.direction.dot(t.cross(e));if(0>f)return null;if(u+f>h)return null;var d=-c*e.dot(n);return 0>d?null:this.at(d/h,l)}}(),applyMatrix4:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)},clone:function(){return(new THREE.Ray).copy(this)}},THREE.Sphere=function(e,t){this.center=void 0!==e?e:new THREE.Vector3,this.radius=void 0!==t?t:0},THREE.Sphere.prototype={constructor:THREE.Sphere,set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(){var e=new THREE.Box3;return function(t,r){var n=this.center;void 0!==r?n.copy(r):e.setFromPoints(t).center(n);for(var i=0,o=0,a=t.length;a>o;o++)i=Math.max(i,n.distanceToSquared(t[o]));return this.radius=Math.sqrt(i),this}}(),copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(e,t){var r=this.center.distanceToSquared(e),n=t||new THREE.Vector3;return n.copy(e),r>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center)),n},getBoundingBox:function(e){var t=e||new THREE.Box3;return t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius},clone:function(){return(new THREE.Sphere).copy(this)}},THREE.Frustum=function(e,t,r,n,i,o){this.planes=[void 0!==e?e:new THREE.Plane,void 0!==t?t:new THREE.Plane,void 0!==r?r:new THREE.Plane,void 0!==n?n:new THREE.Plane,void 0!==i?i:new THREE.Plane,void 0!==o?o:new THREE.Plane]},THREE.Frustum.prototype={constructor:THREE.Frustum,set:function(e,t,r,n,i,o){var a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(r),a[3].copy(n),a[4].copy(i),a[5].copy(o),this},copy:function(e){for(var t=this.planes,r=0;6>r;r++)t[r].copy(e.planes[r]);return this},setFromMatrix:function(e){var t=this.planes,r=e.elements,n=r[0],i=r[1],o=r[2],a=r[3],s=r[4],l=r[5],c=r[6],h=r[7],u=r[8],f=r[9],d=r[10],p=r[11],m=r[12],g=r[13],v=r[14],E=r[15];return t[0].setComponents(a-n,h-s,p-u,E-m).normalize(),t[1].setComponents(a+n,h+s,p+u,E+m).normalize(),t[2].setComponents(a+i,h+l,p+f,E+g).normalize(),t[3].setComponents(a-i,h-l,p-f,E-g).normalize(),t[4].setComponents(a-o,h-c,p-d,E-v).normalize(),t[5].setComponents(a+o,h+c,p+d,E+v).normalize(),this},intersectsObject:function(){var e=new THREE.Sphere;return function(t){var r=t.geometry;return null===r.boundingSphere&&r.computeBoundingSphere(),e.copy(r.boundingSphere),e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){for(var t=this.planes,r=e.center,n=-e.radius,i=0;6>i;i++){var o=t[i].distanceToPoint(r);if(n>o)return!1}return!0},intersectsBox:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(r){for(var n=this.planes,i=0;6>i;i++){var o=n[i];e.x=o.normal.x>0?r.min.x:r.max.x,t.x=o.normal.x>0?r.max.x:r.min.x,e.y=o.normal.y>0?r.min.y:r.max.y,t.y=o.normal.y>0?r.max.y:r.min.y,e.z=o.normal.z>0?r.min.z:r.max.z,t.z=o.normal.z>0?r.max.z:r.min.z;var a=o.distanceToPoint(e),s=o.distanceToPoint(t);if(0>a&&0>s)return!1}return!0}}(),containsPoint:function(e){for(var t=this.planes,r=0;6>r;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0},clone:function(){return(new THREE.Frustum).copy(this)}},THREE.Plane=function(e,t){this.normal=void 0!==e?e:new THREE.Vector3(1,0,0),this.constant=void 0!==t?t:0},THREE.Plane.prototype={constructor:THREE.Plane,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,r,n){return this.normal.set(e,t,r),this.constant=n,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(r,n,i){var o=e.subVectors(i,n).cross(t.subVectors(r,n)).normalize();return this.setFromNormalAndCoplanarPoint(o,r),this}}(),copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var r=this.distanceToPoint(e),n=t||new THREE.Vector3;return n.copy(this.normal).multiplyScalar(r)},isIntersectionLine:function(e){var t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return 0>t&&r>0||0>r&&t>0},intersectLine:function(){var e=new THREE.Vector3;return function(t,r){var n=r||new THREE.Vector3,i=t.delta(e),o=this.normal.dot(i);if(0==o)return 0==this.distanceToPoint(t.start)?n.copy(t.start):void 0;var a=-(t.start.dot(this.normal)+this.constant)/o;return 0>a||a>1?void 0:n.copy(i).multiplyScalar(a).add(t.start)}}(),coplanarPoint:function(e){var t=e||new THREE.Vector3;return t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new THREE.Vector3,t=new THREE.Vector3,r=new THREE.Matrix3;return function(n,i){var o=i||r.getNormalMatrix(n),a=e.copy(this.normal).applyMatrix3(o),s=this.coplanarPoint(t);return s.applyMatrix4(n),this.setFromNormalAndCoplanarPoint(a,s),this}}(),translate:function(e){return this.constant=this.constant-e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant==this.constant},clone:function(){return(new THREE.Plane).copy(this)}},THREE.Math={generateUUID:function(){var e,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),r=new Array(36),n=0;return function(){for(var i=0;36>i;i++)8==i||13==i||18==i||23==i?r[i]="-":14==i?r[i]="4":(2>=n&&(n=33554432+16777216*Math.random()|0),e=15&n,n>>=4,r[i]=t[19==i?3&e|8:e]);return r.join("")}}(),clamp:function(e,t,r){return t>e?t:e>r?r:e},clampBottom:function(e,t){return t>e?t:e},mapLinear:function(e,t,r,n,i){return n+(e-t)*(i-n)/(r-t)},smoothstep:function(e,t,r){return t>=e?0:e>=r?1:(e=(e-t)/(r-t),e*e*(3-2*e))},smootherstep:function(e,t,r){return t>=e?0:e>=r?1:(e=(e-t)/(r-t),e*e*e*(e*(6*e-15)+10))},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},sign:function(e){return 0>e?-1:e>0?1:0},degToRad:function(){var e=Math.PI/180;return function(t){return t*e}}(),radToDeg:function(){var e=180/Math.PI;return function(t){return t*e}}(),isPowerOfTwo:function(e){return 0===(e&e-1)&&0!==e}},THREE.Spline=function(e){function t(e,t,r,n,i,o,a){var s=.5*(r-e),l=.5*(n-t);return(2*(t-r)+s+l)*a+(-3*(t-r)-2*s-l)*o+s*i+t}this.points=e;var r,n,i,o,a,s,l,c,h,u=[],f={x:0,y:0,z:0};this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return r=(this.points.length-1)*e,n=Math.floor(r),i=r-n,u[0]=0===n?n:n-1,u[1]=n,u[2]=n>this.points.length-2?this.points.length-1:n+1,u[3]=n>this.points.length-3?this.points.length-1:n+2,s=this.points[u[0]],l=this.points[u[1]],c=this.points[u[2]],h=this.points[u[3]],o=i*i,a=i*o,f.x=t(s.x,l.x,c.x,h.x,i,o,a),f.y=t(s.y,l.y,c.y,h.y,i,o,a),f.z=t(s.z,l.z,c.z,h.z,i,o,a),f},this.getControlPointsArray=function(){var e,t,r=this.points.length,n=[];for(e=0;r>e;e++)t=this.points[e],n[e]=[t.x,t.y,t.z];return n},this.getLength=function(e){var t,r,n,i,o=0,a=0,s=0,l=new THREE.Vector3,c=new THREE.Vector3,h=[],u=0;for(h[0]=0,e||(e=100),n=this.points.length*e,l.copy(this.points[0]),t=1;n>t;t++)r=t/n,i=this.getPoint(r),c.copy(i),u+=c.distanceTo(l),l.copy(i),o=(this.points.length-1)*r,a=Math.floor(o),a!=s&&(h[a]=u,s=a);return h[h.length]=u,{chunks:h,total:u}},this.reparametrizeByArcLength=function(e){var t,r,n,i,o,a,s,l,c=[],h=new THREE.Vector3,u=this.getLength();for(c.push(h.copy(this.points[0]).clone()),t=1;t<this.points.length;t++){for(a=u.chunks[t]-u.chunks[t-1],s=Math.ceil(e*a/u.total),i=(t-1)/(this.points.length-1),o=t/(this.points.length-1),r=1;s-1>r;r++)n=i+r*(1/s)*(o-i),l=this.getPoint(n),c.push(h.copy(l).clone());c.push(h.copy(this.points[t]).clone())}this.points=c}},THREE.Triangle=function(e,t,r){this.a=void 0!==e?e:new THREE.Vector3,this.b=void 0!==t?t:new THREE.Vector3,this.c=void 0!==r?r:new THREE.Vector3},THREE.Triangle.normal=function(){var e=new THREE.Vector3;return function(t,r,n,i){var o=i||new THREE.Vector3;o.subVectors(n,r),e.subVectors(t,r),o.cross(e);var a=o.lengthSq();return a>0?o.multiplyScalar(1/Math.sqrt(a)):o.set(0,0,0)}}(),THREE.Triangle.barycoordFromPoint=function(){var e=new THREE.Vector3,t=new THREE.Vector3,r=new THREE.Vector3;return function(n,i,o,a,s){e.subVectors(a,i),t.subVectors(o,i),r.subVectors(n,i);var l=e.dot(e),c=e.dot(t),h=e.dot(r),u=t.dot(t),f=t.dot(r),d=l*u-c*c,p=s||new THREE.Vector3;if(0==d)return p.set(-2,-1,-1);var m=1/d,g=(u*h-c*f)*m,v=(l*f-c*h)*m;return p.set(1-g-v,v,g)}}(),THREE.Triangle.containsPoint=function(){var e=new THREE.Vector3;return function(t,r,n,i){var o=THREE.Triangle.barycoordFromPoint(t,r,n,i,e);return o.x>=0&&o.y>=0&&o.x+o.y<=1}}(),THREE.Triangle.prototype={constructor:THREE.Triangle,set:function(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this},setFromPointsAndIndices:function(e,t,r,n){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[n]),this},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),midpoint:function(e){var t=e||new THREE.Vector3;return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return THREE.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){var t=e||new THREE.Plane;return t.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return THREE.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return THREE.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)},clone:function(){return(new THREE.Triangle).copy(this)}},THREE.Clock=function(e){this.autoStart=void 0!==e?e:!0,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1},THREE.Clock.prototype={constructor:THREE.Clock,start:function(){this.startTime=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now(),this.oldTime=this.startTime,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running&&this.start(),this.running){var t=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now();e=.001*(t-this.oldTime),this.oldTime=t,this.elapsedTime+=e}return e}},THREE.EventDispatcher=function(){},THREE.EventDispatcher.prototype={constructor:THREE.EventDispatcher,apply:function(e){e.addEventListener=THREE.EventDispatcher.prototype.addEventListener,e.hasEventListener=THREE.EventDispatcher.prototype.hasEventListener,e.removeEventListener=THREE.EventDispatcher.prototype.removeEventListener,e.dispatchEvent=THREE.EventDispatcher.prototype.dispatchEvent},addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)?!0:!1},removeEventListener:function(e,t){if(void 0!==this._listeners){var r=this._listeners,n=r[e];if(void 0!==n){var i=n.indexOf(t);-1!==i&&n.splice(i,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners,r=t[e.type];if(void 0!==r){e.target=this;for(var n=[],i=r.length,o=0;i>o;o++)n[o]=r[o];for(var o=0;i>o;o++)n[o].call(this,e)}}}},function(e){e.Raycaster=function(t,r,n,i){this.ray=new e.Ray(t,r),this.near=n||0,this.far=i||1/0,this.params={Sprite:{},Mesh:{},PointCloud:{threshold:1},LOD:{},Line:{}}};var t=function(e,t){return e.distance-t.distance},r=function(e,t,n,i){if(e.raycast(t,n),i===!0)for(var o=e.children,a=0,s=o.length;s>a;a++)r(o[a],t,n,!0)};e.Raycaster.prototype={constructor:e.Raycaster,precision:1e-4,linePrecision:1,set:function(e,t){this.ray.set(e,t)},intersectObject:function(e,n){var i=[];return r(e,this,i,n),i.sort(t),i},intersectObjects:function(e,n){for(var i=[],o=0,a=e.length;a>o;o++)r(e[o],this,i,n);return i.sort(t),i}}}(THREE),THREE.Object3D=function(){this.id=THREE.Object3DIdCount++,this.uuid=THREE.Math.generateUUID(),this.name="",this.parent=void 0,this.children=[],this.up=THREE.Object3D.DefaultUp.clone();var e=new THREE.Vector3,t=new THREE.Euler,r=new THREE.Quaternion,n=new THREE.Vector3(1,1,1);t.onChange(function(){r.setFromEuler(t,!1)}),r.onChange(function(){t.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{enumerable:!0,value:e},rotation:{enumerable:!0,value:t},quaternion:{enumerable:!0,value:r},scale:{enumerable:!0,value:n}}),this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new THREE.Matrix4,this.matrixWorld=new THREE.Matrix4,this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!1,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.userData={}},THREE.Object3D.DefaultUp=new THREE.Vector3(0,1,0),THREE.Object3D.prototype={constructor:THREE.Object3D,get eulerOrder(){return console.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order."),this.rotation.order},set eulerOrder(e){console.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order."),this.rotation.order=e},get useQuaternion(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(e){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var e=new THREE.Quaternion;return function(t,r){return e.setFromAxisAngle(t,r),this.quaternion.multiply(e),this}}(),rotateX:function(){var e=new THREE.Vector3(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new THREE.Vector3(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new THREE.Vector3(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new THREE.Vector3;return function(t,r){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(r)),this}}(),translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},translateX:function(){var e=new THREE.Vector3(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new THREE.Vector3(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new THREE.Vector3(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new THREE.Matrix4;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new THREE.Matrix4;return function(t){e.lookAt(t,this.position,this.up),this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}if(e===this)return console.error("THREE.Object3D.add:",e,"can't be added as a child of itself."),this;if(e instanceof THREE.Object3D){void 0!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e);for(var r=this;void 0!==r.parent;)r=r.parent;void 0!==r&&r instanceof THREE.Scene&&r.__addObject(e)}else console.error("THREE.Object3D.add:",e,"is not an instance of THREE.Object3D.");return this},remove:function(e){if(arguments.length>1)for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);var r=this.children.indexOf(e);if(-1!==r){e.parent=void 0,e.dispatchEvent({type:"removed"}),this.children.splice(r,1);for(var n=this;void 0!==n.parent;)n=n.parent;void 0!==n&&n instanceof THREE.Scene&&n.__removeObject(e)}},raycast:function(){},traverse:function(e){e(this);for(var t=0,r=this.children.length;r>t;t++)this.children[t].traverse(e)},traverseVisible:function(e){if(this.visible!==!1){e(this);for(var t=0,r=this.children.length;r>t;t++)this.children[t].traverseVisible(e)}},getObjectById:function(e,t){for(var r=0,n=this.children.length;n>r;r++){var i=this.children[r];if(i.id===e)return i;if(t===!0&&(i=i.getObjectById(e,t),void 0!==i))return i}return void 0},getObjectByName:function(e,t){for(var r=0,n=this.children.length;n>r;r++){var i=this.children[r];if(i.name===e)return i;if(t===!0&&(i=i.getObjectByName(e,t),void 0!==i))return i}return void 0},getChildByName:function(e,t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e,t)},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate===!0&&this.updateMatrix(),(this.matrixWorldNeedsUpdate===!0||e===!0)&&(void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,r=this.children.length;r>t;t++)this.children[t].updateMatrixWorld(e)},clone:function(e,t){if(void 0===e&&(e=new THREE.Object3D),void 0===t&&(t=!0),e.name=this.name,e.up.copy(this.up),e.position.copy(this.position),e.quaternion.copy(this.quaternion),e.scale.copy(this.scale),e.renderDepth=this.renderDepth,e.rotationAutoUpdate=this.rotationAutoUpdate,e.matrix.copy(this.matrix),e.matrixWorld.copy(this.matrixWorld),e.matrixAutoUpdate=this.matrixAutoUpdate,e.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,e.visible=this.visible,e.castShadow=this.castShadow,e.receiveShadow=this.receiveShadow,e.frustumCulled=this.frustumCulled,e.userData=JSON.parse(JSON.stringify(this.userData)),t===!0)for(var r=0;r<this.children.length;r++){var n=this.children[r];e.add(n.clone())}return e}},THREE.EventDispatcher.prototype.apply(THREE.Object3D.prototype),THREE.Object3DIdCount=0,THREE.Projector=function(){function e(){if(l===y){var e=new THREE.RenderableObject;return E.push(e),y++,l++,e}return E[l++]}function t(){if(h===x){var e=new THREE.RenderableVertex;return T.push(e),x++,h++,e}return T[h++]}function r(){if(f===b){var e=new THREE.RenderableFace;return w.push(e),b++,f++,e}return w[f++]}function n(){if(p===_){var e=new THREE.RenderableLine;return R.push(e),_++,p++,e}return R[p++]}function i(){if(g===M){var e=new THREE.RenderableSprite;return H.push(e),M++,g++,e}return H[g++]}function o(e,t){return e.z!==t.z?t.z-e.z:e.id!==t.id?e.id-t.id:0}function a(e,t){var r=0,n=1,i=e.z+e.w,o=t.z+t.w,a=-e.z+e.w,s=-t.z+t.w;return i>=0&&o>=0&&a>=0&&s>=0?!0:0>i&&0>o||0>a&&0>s?!1:(0>i?r=Math.max(r,i/(i-o)):0>o&&(n=Math.min(n,i/(i-o))),0>a?r=Math.max(r,a/(a-s)):0>s&&(n=Math.min(n,a/(a-s))),r>n?!1:(e.lerp(t,r),t.lerp(e,1-n),!0))}var s,l,c,h,u,f,d,p,m,g,v,E=[],y=0,T=[],x=0,w=[],b=0,R=[],_=0,H=[],M=0,S={objects:[],lights:[],elements:[]},C=new THREE.Vector3,A=new THREE.Vector3,k=new THREE.Vector3,L=new THREE.Vector3,P=new THREE.Vector4,F=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),N=new THREE.Box3,D=new Array(3),U=(new Array(4),new THREE.Matrix4),O=new THREE.Matrix4,z=new THREE.Matrix4,I=new THREE.Matrix3,V=new THREE.Frustum,B=new THREE.Vector4,G=new THREE.Vector4;this.projectVector=function(e,t){return t.matrixWorldInverse.getInverse(t.matrixWorld),O.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),e.applyProjection(O)},this.unprojectVector=function(){var e=new THREE.Matrix4;return function(t,r){return e.getInverse(r.projectionMatrix),O.multiplyMatrices(r.matrixWorld,e),t.applyProjection(O)}}(),this.pickingRay=function(e,t){e.z=-1;var r=new THREE.Vector3(e.x,e.y,1);return this.unprojectVector(e,t),this.unprojectVector(r,t),r.sub(e).normalize(),new THREE.Raycaster(e,r)};var j=function(){var e=[],i=[],o=null,a=null,s=new THREE.Matrix3,l=function(t){o=t,a=o.material,s.getNormalMatrix(o.matrixWorld),e.length=0,i.length=0},h=function(e){var t=e.position,r=e.positionWorld,n=e.positionScreen;r.copy(t).applyMatrix4(v),n.copy(r).applyMatrix4(O);var i=1/n.w;n.x*=i,n.y*=i,n.z*=i,e.visible=n.x>=-1&&n.x<=1&&n.y>=-1&&n.y<=1&&n.z>=-1&&n.z<=1
},f=function(e,r,n){c=t(),c.position.set(e,r,n),h(c)},p=function(t,r,n){e.push(t,r,n)},m=function(e,t){i.push(e,t)},g=function(e,t,r){return e.visible===!0||t.visible===!0||r.visible===!0?!0:(D[0]=e.positionScreen,D[1]=t.positionScreen,D[2]=r.positionScreen,F.isIntersectionBox(N.setFromPoints(D)))},E=function(e,t,r){return(r.positionScreen.x-e.positionScreen.x)*(t.positionScreen.y-e.positionScreen.y)-(r.positionScreen.y-e.positionScreen.y)*(t.positionScreen.x-e.positionScreen.x)<0},y=function(e,t){var r=T[e],i=T[t];d=n(),d.id=o.id,d.v1.copy(r),d.v2.copy(i),d.z=(r.positionScreen.z+i.positionScreen.z)/2,d.material=o.material,S.elements.push(d)},x=function(t,n,l){var c=T[t],h=T[n],f=T[l];if(g(c,h,f)!==!1&&(a.side===THREE.DoubleSide||E(c,h,f)===!0)){u=r(),u.id=o.id,u.v1.copy(c),u.v2.copy(h),u.v3.copy(f),u.z=(c.positionScreen.z+h.positionScreen.z+f.positionScreen.z)/3;for(var d=0;3>d;d++){var p=3*arguments[d],m=u.vertexNormalsModel[d];m.set(e[p],e[p+1],e[p+2]),m.applyMatrix3(s).normalize();var v=2*arguments[d],y=u.uvs[d];y.set(i[v],i[v+1])}u.vertexNormalsLength=3,u.material=o.material,S.elements.push(u)}};return{setObject:l,projectVertex:h,checkTriangleVisibility:g,checkBackfaceCulling:E,pushVertex:f,pushNormal:p,pushUv:m,pushLine:y,pushTriangle:x}},W=new j;this.projectScene=function(c,E,y,x){f=0,p=0,g=0,S.elements.length=0,c.autoUpdate===!0&&c.updateMatrixWorld(),void 0===E.parent&&E.updateMatrixWorld(),U.copy(E.matrixWorldInverse.getInverse(E.matrixWorld)),O.multiplyMatrices(E.projectionMatrix,U),V.setFromMatrix(O),l=0,S.objects.length=0,S.lights.length=0,c.traverseVisible(function(t){t instanceof THREE.Light?S.lights.push(t):(t instanceof THREE.Mesh||t instanceof THREE.Line||t instanceof THREE.Sprite)&&(t.frustumCulled===!1||V.intersectsObject(t)===!0)&&(s=e(),s.id=t.id,s.object=t,null!==t.renderDepth?s.z=t.renderDepth:(L.setFromMatrixPosition(t.matrixWorld),L.applyProjection(O),s.z=L.z),S.objects.push(s))}),y===!0&&S.objects.sort(o);for(var w=0,b=S.objects.length;b>w;w++){var R=S.objects[w].object,_=R.geometry;if(W.setObject(R),v=R.matrixWorld,h=0,R instanceof THREE.Mesh){if(_ instanceof THREE.BufferGeometry){var H=_.attributes,M=_.offsets;if(void 0===H.position)continue;for(var F=H.position.array,N=0,D=F.length;D>N;N+=3)W.pushVertex(F[N],F[N+1],F[N+2]);if(void 0!==H.normal)for(var j=H.normal.array,N=0,D=j.length;D>N;N+=3)W.pushNormal(j[N],j[N+1],j[N+2]);if(void 0!==H.uv)for(var X=H.uv.array,N=0,D=X.length;D>N;N+=2)W.pushUv(X[N],X[N+1]);if(void 0!==H.index){var q=H.index.array;if(M.length>0)for(var w=0;w<M.length;w++)for(var Y=M[w],K=Y.index,N=Y.start,D=Y.start+Y.count;D>N;N+=3)W.pushTriangle(q[N]+K,q[N+1]+K,q[N+2]+K);else for(var N=0,D=q.length;D>N;N+=3)W.pushTriangle(q[N],q[N+1],q[N+2])}else for(var N=0,D=F.length/3;D>N;N+=3)W.pushTriangle(N,N+1,N+2)}else if(_ instanceof THREE.Geometry){var Q=_.vertices,Z=_.faces,$=_.faceVertexUvs[0];I.getNormalMatrix(v);for(var J=R.material instanceof THREE.MeshFaceMaterial,et=J===!0?R.material:null,tt=0,rt=Q.length;rt>tt;tt++){var nt=Q[tt];W.pushVertex(nt.x,nt.y,nt.z)}for(var it=0,ot=Z.length;ot>it;it++){var at=Z[it],st=J===!0?et.materials[at.materialIndex]:R.material;if(void 0!==st){var lt=st.side,ct=T[at.a],ht=T[at.b],ut=T[at.c];if(st.morphTargets===!0){var ft=_.morphTargets,dt=R.morphTargetInfluences,pt=ct.position,mt=ht.position,gt=ut.position;C.set(0,0,0),A.set(0,0,0),k.set(0,0,0);for(var vt=0,Et=ft.length;Et>vt;vt++){var yt=dt[vt];if(0!==yt){var Tt=ft[vt].vertices;C.x+=(Tt[at.a].x-pt.x)*yt,C.y+=(Tt[at.a].y-pt.y)*yt,C.z+=(Tt[at.a].z-pt.z)*yt,A.x+=(Tt[at.b].x-mt.x)*yt,A.y+=(Tt[at.b].y-mt.y)*yt,A.z+=(Tt[at.b].z-mt.z)*yt,k.x+=(Tt[at.c].x-gt.x)*yt,k.y+=(Tt[at.c].y-gt.y)*yt,k.z+=(Tt[at.c].z-gt.z)*yt}}ct.position.add(C),ht.position.add(A),ut.position.add(k),W.projectVertex(ct),W.projectVertex(ht),W.projectVertex(ut)}if(W.checkTriangleVisibility(ct,ht,ut)!==!1){var xt=W.checkBackfaceCulling(ct,ht,ut);if(lt!==THREE.DoubleSide){if(lt===THREE.FrontSide&&xt===!1)continue;if(lt===THREE.BackSide&&xt===!0)continue}u=r(),u.id=R.id,u.v1.copy(ct),u.v2.copy(ht),u.v3.copy(ut),u.normalModel.copy(at.normal),xt!==!1||lt!==THREE.BackSide&&lt!==THREE.DoubleSide||u.normalModel.negate(),u.normalModel.applyMatrix3(I).normalize();for(var wt=at.vertexNormals,bt=0,Rt=Math.min(wt.length,3);Rt>bt;bt++){var _t=u.vertexNormalsModel[bt];_t.copy(wt[bt]),xt!==!1||lt!==THREE.BackSide&&lt!==THREE.DoubleSide||_t.negate(),_t.applyMatrix3(I).normalize()}u.vertexNormalsLength=wt.length;var Ht=$[it];if(void 0!==Ht)for(var Mt=0;3>Mt;Mt++)u.uvs[Mt].copy(Ht[Mt]);u.color=at.color,u.material=st,u.z=(ct.positionScreen.z+ht.positionScreen.z+ut.positionScreen.z)/3,S.elements.push(u)}}}}}else if(R instanceof THREE.Line){if(_ instanceof THREE.BufferGeometry){var H=_.attributes;if(void 0!==H.position){for(var F=H.position.array,N=0,D=F.length;D>N;N+=3)W.pushVertex(F[N],F[N+1],F[N+2]);if(void 0!==H.index)for(var q=H.index.array,N=0,D=q.length;D>N;N+=2)W.pushLine(q[N],q[N+1]);else for(var St=R.type===THREE.LinePieces?2:1,N=0,D=F.length/3-1;D>N;N+=St)W.pushLine(N,N+1)}}else if(_ instanceof THREE.Geometry){z.multiplyMatrices(O,v);var Q=R.geometry.vertices;if(0===Q.length)continue;ct=t(),ct.positionScreen.copy(Q[0]).applyMatrix4(z);for(var St=R.type===THREE.LinePieces?2:1,tt=1,rt=Q.length;rt>tt;tt++)ct=t(),ct.positionScreen.copy(Q[tt]).applyMatrix4(z),(tt+1)%St>0||(ht=T[h-2],B.copy(ct.positionScreen),G.copy(ht.positionScreen),a(B,G)===!0&&(B.multiplyScalar(1/B.w),G.multiplyScalar(1/G.w),d=n(),d.id=R.id,d.v1.positionScreen.copy(B),d.v2.positionScreen.copy(G),d.z=Math.max(B.z,G.z),d.material=R.material,R.material.vertexColors===THREE.VertexColors&&(d.vertexColors[0].copy(R.geometry.colors[tt]),d.vertexColors[1].copy(R.geometry.colors[tt-1])),S.elements.push(d)))}}else if(R instanceof THREE.Sprite){P.set(v.elements[12],v.elements[13],v.elements[14],1),P.applyMatrix4(O);var Ct=1/P.w;P.z*=Ct,P.z>=-1&&P.z<=1&&(m=i(),m.id=R.id,m.x=P.x*Ct,m.y=P.y*Ct,m.z=P.z,m.object=R,m.rotation=R.rotation,m.scale.x=R.scale.x*Math.abs(m.x-(P.x+E.projectionMatrix.elements[0])/(P.w+E.projectionMatrix.elements[12])),m.scale.y=R.scale.y*Math.abs(m.y-(P.y+E.projectionMatrix.elements[5])/(P.w+E.projectionMatrix.elements[13])),m.material=R.material,S.elements.push(m))}}return x===!0&&S.elements.sort(o),S}},THREE.Face3=function(e,t,r,n,i,o){this.a=e,this.b=t,this.c=r,this.normal=n instanceof THREE.Vector3?n:new THREE.Vector3,this.vertexNormals=n instanceof Array?n:[],this.color=i instanceof THREE.Color?i:new THREE.Color,this.vertexColors=i instanceof Array?i:[],this.vertexTangents=[],this.materialIndex=void 0!==o?o:0},THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){var e=new THREE.Face3(this.a,this.b,this.c);e.normal.copy(this.normal),e.color.copy(this.color),e.materialIndex=this.materialIndex;for(var t=0,r=this.vertexNormals.length;r>t;t++)e.vertexNormals[t]=this.vertexNormals[t].clone();for(var t=0,r=this.vertexColors.length;r>t;t++)e.vertexColors[t]=this.vertexColors[t].clone();for(var t=0,r=this.vertexTangents.length;r>t;t++)e.vertexTangents[t]=this.vertexTangents[t].clone();return e}},THREE.Face4=function(e,t,r,n,i,o,a){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new THREE.Face3(e,t,r,i,o,a)},THREE.BufferAttribute=function(e,t){this.array=e,this.itemSize=t},THREE.BufferAttribute.prototype={constructor:THREE.BufferAttribute,get length(){return this.array.length},set:function(e){return this.array.set(e),this},setX:function(e,t){return this.array[e*this.itemSize]=t,this},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},setXY:function(e,t,r){return e*=this.itemSize,this.array[e]=t,this.array[e+1]=r,this},setXYZ:function(e,t,r,n){return e*=this.itemSize,this.array[e]=t,this.array[e+1]=r,this.array[e+2]=n,this},setXYZW:function(e,t,r,n,i){return e*=this.itemSize,this.array[e]=t,this.array[e+1]=r,this.array[e+2]=n,this.array[e+3]=i,this}},THREE.Int8Attribute=function(e,t){return console.warn("THREE.Int8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new THREE.BufferAttribute(e,t)},THREE.Uint8Attribute=function(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new THREE.BufferAttribute(e,t)},THREE.Uint8ClampedAttribute=function(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new THREE.BufferAttribute(e,t)},THREE.Int16Attribute=function(e,t){return console.warn("THREE.Int16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new THREE.BufferAttribute(e,t)},THREE.Uint16Attribute=function(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new THREE.BufferAttribute(e,t)},THREE.Int32Attribute=function(e,t){return console.warn("THREE.Int32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new THREE.BufferAttribute(e,t)},THREE.Uint32Attribute=function(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new THREE.BufferAttribute(e,t)},THREE.Float32Attribute=function(e,t){return console.warn("THREE.Float32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new THREE.BufferAttribute(e,t)},THREE.Float64Attribute=function(e,t){return console.warn("THREE.Float64Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new THREE.BufferAttribute(e,t)},THREE.BufferGeometry=function(){this.id=THREE.GeometryIdCount++,this.uuid=THREE.Math.generateUUID(),this.name="",this.attributes={},this.drawcalls=[],this.offsets=this.drawcalls,this.boundingBox=null,this.boundingSphere=null},THREE.BufferGeometry.prototype={constructor:THREE.BufferGeometry,addAttribute:function(e,t){return t instanceof THREE.BufferAttribute==!1?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),void(this.attributes[e]={array:arguments[1],itemSize:arguments[2]})):void(this.attributes[e]=t)},getAttribute:function(e){return this.attributes[e]},addDrawCall:function(e,t,r){this.drawcalls.push({start:e,count:t,index:void 0!==r?r:0})},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToVector3Array(t.array),t.needsUpdate=!0);var r=this.attributes.normal;if(void 0!==r){var n=(new THREE.Matrix3).getNormalMatrix(e);n.applyToVector3Array(r.array),r.needsUpdate=!0}},fromGeometry:function(e,t){t=t||{vertexColors:THREE.NoColors};var r=e.vertices,n=e.faces,i=e.faceVertexUvs,o=t.vertexColors,a=i[0].length>0,s=3==n[0].vertexNormals.length,l=new Float32Array(3*n.length*3);this.addAttribute("position",new THREE.BufferAttribute(l,3));var c=new Float32Array(3*n.length*3);if(this.addAttribute("normal",new THREE.BufferAttribute(c,3)),o!==THREE.NoColors){var h=new Float32Array(3*n.length*3);this.addAttribute("color",new THREE.BufferAttribute(h,3))}if(a===!0){var u=new Float32Array(3*n.length*2);this.addAttribute("uvs",new THREE.BufferAttribute(u,2))}for(var f=0,d=0,p=0;f<n.length;f++,d+=6,p+=9){var m=n[f],g=r[m.a],v=r[m.b],E=r[m.c];if(l[p]=g.x,l[p+1]=g.y,l[p+2]=g.z,l[p+3]=v.x,l[p+4]=v.y,l[p+5]=v.z,l[p+6]=E.x,l[p+7]=E.y,l[p+8]=E.z,s===!0){var y=m.vertexNormals[0],T=m.vertexNormals[1],x=m.vertexNormals[2];c[p]=y.x,c[p+1]=y.y,c[p+2]=y.z,c[p+3]=T.x,c[p+4]=T.y,c[p+5]=T.z,c[p+6]=x.x,c[p+7]=x.y,c[p+8]=x.z}else{var w=m.normal;c[p]=w.x,c[p+1]=w.y,c[p+2]=w.z,c[p+3]=w.x,c[p+4]=w.y,c[p+5]=w.z,c[p+6]=w.x,c[p+7]=w.y,c[p+8]=w.z}if(o===THREE.FaceColors){var b=m.color;h[p]=b.r,h[p+1]=b.g,h[p+2]=b.b,h[p+3]=b.r,h[p+4]=b.g,h[p+5]=b.b,h[p+6]=b.r,h[p+7]=b.g,h[p+8]=b.b}else if(o===THREE.VertexColors){var R=m.vertexColors[0],_=m.vertexColors[1],H=m.vertexColors[2];h[p]=R.r,h[p+1]=R.g,h[p+2]=R.b,h[p+3]=_.r,h[p+4]=_.g,h[p+5]=_.b,h[p+6]=H.r,h[p+7]=H.g,h[p+8]=H.b}if(a===!0){var M=i[0][f][0],S=i[0][f][1],C=i[0][f][2];u[d]=M.x,u[d+1]=M.y,u[d+2]=S.x,u[d+3]=S.y,u[d+4]=C.x,u[d+5]=C.y}}return this.computeBoundingSphere(),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);var e=this.attributes.position.array;if(e){var t=this.boundingBox;e.length>=3&&(t.min.x=t.max.x=e[0],t.min.y=t.max.y=e[1],t.min.z=t.max.z=e[2]);for(var r=3,n=e.length;n>r;r+=3){var i=e[r],o=e[r+1],a=e[r+2];i<t.min.x?t.min.x=i:i>t.max.x&&(t.max.x=i),o<t.min.y?t.min.y=o:o>t.max.y&&(t.max.y=o),a<t.min.z?t.min.z=a:a>t.max.z&&(t.max.z=a)}}(void 0===e||0===e.length)&&(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0)),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.')},computeBoundingSphere:function(){var e=new THREE.Box3,t=new THREE.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere);var r=this.attributes.position.array;if(r){e.makeEmpty();for(var n=this.boundingSphere.center,i=0,o=r.length;o>i;i+=3)t.set(r[i],r[i+1],r[i+2]),e.expandByPoint(t);e.center(n);for(var a=0,i=0,o=r.length;o>i;i+=3)t.set(r[i],r[i+1],r[i+2]),a=Math.max(a,n.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){if(this.attributes.position){var e,t,r,n,i=this.attributes.position.array.length;if(void 0===this.attributes.normal)this.attributes.normal={itemSize:3,array:new Float32Array(i)};else for(e=0,t=this.attributes.normal.array.length;t>e;e++)this.attributes.normal.array[e]=0;var o,a,s,l,c,h,u=this.attributes.position.array,f=this.attributes.normal.array,d=new THREE.Vector3,p=new THREE.Vector3,m=new THREE.Vector3,g=new THREE.Vector3,v=new THREE.Vector3;if(this.attributes.index){var E=this.attributes.index.array,y=this.offsets.length>0?this.offsets:[{start:0,count:E.length,index:0}];for(r=0,n=y.length;n>r;++r){var T=y[r].start,x=y[r].count,w=y[r].index;for(e=T,t=T+x;t>e;e+=3)o=w+E[e],a=w+E[e+1],s=w+E[e+2],l=u[3*o],c=u[3*o+1],h=u[3*o+2],d.set(l,c,h),l=u[3*a],c=u[3*a+1],h=u[3*a+2],p.set(l,c,h),l=u[3*s],c=u[3*s+1],h=u[3*s+2],m.set(l,c,h),g.subVectors(m,p),v.subVectors(d,p),g.cross(v),f[3*o]+=g.x,f[3*o+1]+=g.y,f[3*o+2]+=g.z,f[3*a]+=g.x,f[3*a+1]+=g.y,f[3*a+2]+=g.z,f[3*s]+=g.x,f[3*s+1]+=g.y,f[3*s+2]+=g.z}}else for(e=0,t=u.length;t>e;e+=9)l=u[e],c=u[e+1],h=u[e+2],d.set(l,c,h),l=u[e+3],c=u[e+4],h=u[e+5],p.set(l,c,h),l=u[e+6],c=u[e+7],h=u[e+8],m.set(l,c,h),g.subVectors(m,p),v.subVectors(d,p),g.cross(v),f[e]=g.x,f[e+1]=g.y,f[e+2]=g.z,f[e+3]=g.x,f[e+4]=g.y,f[e+5]=g.z,f[e+6]=g.x,f[e+7]=g.y,f[e+8]=g.z;this.normalizeNormals(),this.normalsNeedUpdate=!0}},computeTangents:function(){function e(e,t,r){f=n[3*e],d=n[3*e+1],p=n[3*e+2],m=n[3*t],g=n[3*t+1],v=n[3*t+2],E=n[3*r],y=n[3*r+1],T=n[3*r+2],x=o[2*e],w=o[2*e+1],b=o[2*t],R=o[2*t+1],_=o[2*r],H=o[2*r+1],M=m-f,S=E-f,C=g-d,A=y-d,k=v-p,L=T-p,P=b-x,F=_-x,N=R-w,D=H-w,U=1/(P*D-F*N),W.set((D*M-N*S)*U,(D*C-N*A)*U,(D*k-N*L)*U),X.set((P*S-F*M)*U,(P*A-F*C)*U,(P*L-F*k)*U),c[e].add(W),c[t].add(W),c[r].add(W),h[e].add(X),h[t].add(X),h[r].add(X)}function t(e){rt.x=i[3*e],rt.y=i[3*e+1],rt.z=i[3*e+2],nt.copy(rt),$=c[e],et.copy($),et.sub(rt.multiplyScalar(rt.dot($))).normalize(),tt.crossVectors(nt,$),J=tt.dot(h[e]),Z=0>J?-1:1,l[4*e]=et.x,l[4*e+1]=et.y,l[4*e+2]=et.z,l[4*e+3]=Z}if(void 0===this.attributes.index||void 0===this.attributes.position||void 0===this.attributes.normal||void 0===this.attributes.uv)return void console.warn("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");var r=this.attributes.index.array,n=this.attributes.position.array,i=this.attributes.normal.array,o=this.attributes.uv.array,a=n.length/3;if(void 0===this.attributes.tangent){var s=4*a;this.attributes.tangent={itemSize:4,array:new Float32Array(s)}}for(var l=this.attributes.tangent.array,c=[],h=[],u=0;a>u;u++)c[u]=new THREE.Vector3,h[u]=new THREE.Vector3;var f,d,p,m,g,v,E,y,T,x,w,b,R,_,H,M,S,C,A,k,L,P,F,N,D,U,O,z,I,V,B,G,j,W=new THREE.Vector3,X=new THREE.Vector3,q=this.offsets;for(I=0,V=q.length;V>I;++I){var Y=q[I].start,K=q[I].count,Q=q[I].index;for(O=Y,z=Y+K;z>O;O+=3)B=Q+r[O],G=Q+r[O+1],j=Q+r[O+2],e(B,G,j)}var Z,$,J,et=new THREE.Vector3,tt=new THREE.Vector3,rt=new THREE.Vector3,nt=new THREE.Vector3;for(I=0,V=q.length;V>I;++I){var Y=q[I].start,K=q[I].count,Q=q[I].index;for(O=Y,z=Y+K;z>O;O+=3)B=Q+r[O],G=Q+r[O+1],j=Q+r[O+2],t(B),t(G),t(j)}},computeOffsets:function(e){var t=e;void 0===e&&(t=65535);for(var r=(Date.now(),this.attributes.index.array),n=this.attributes.position.array,i=(n.length/3,r.length/3),o=new Uint16Array(r.length),a=0,s=0,l=[{start:0,count:0,index:0}],c=l[0],h=0,u=0,f=new Int32Array(6),d=new Int32Array(n.length),p=new Int32Array(n.length),m=0;m<n.length;m++)d[m]=-1,p[m]=-1;for(var g=0;i>g;g++){u=0;for(var v=0;3>v;v++){var E=r[3*g+v];-1==d[E]?(f[2*v]=E,f[2*v+1]=-1,u++):d[E]<c.index?(f[2*v]=E,f[2*v+1]=-1,h++):(f[2*v]=E,f[2*v+1]=d[E])}var y=s+u;if(y>c.index+t){var T={start:a,count:0,index:s};l.push(T),c=T;for(var x=0;6>x;x+=2){var w=f[x+1];w>-1&&w<c.index&&(f[x+1]=-1)}}for(var x=0;6>x;x+=2){var E=f[x],w=f[x+1];-1===w&&(w=s++),d[E]=w,p[w]=E,o[a++]=w-c.index,c.count++}}return this.reorderBuffers(o,p,s),this.offsets=l,l},merge:function(){console.log("BufferGeometry.merge(): TODO")},normalizeNormals:function(){for(var e,t,r,n,i=this.attributes.normal.array,o=0,a=i.length;a>o;o+=3)e=i[o],t=i[o+1],r=i[o+2],n=1/Math.sqrt(e*e+t*t+r*r),i[o]*=n,i[o+1]*=n,i[o+2]*=n},reorderBuffers:function(e,t,r){var n={},i=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];for(var o in this.attributes)if("index"!=o)for(var a=this.attributes[o].array,s=0,l=i.length;l>s;s++){var c=i[s];if(a instanceof c){n[o]=new c(this.attributes[o].itemSize*r);break}}for(var h=0;r>h;h++){var u=t[h];for(var o in this.attributes)if("index"!=o)for(var f=this.attributes[o].array,d=this.attributes[o].itemSize,p=n[o],m=0;d>m;m++)p[h*d+m]=f[u*d+m]}this.attributes.index.array=e;for(var o in this.attributes)"index"!=o&&(this.attributes[o].array=n[o],this.attributes[o].numItems=this.attributes[o].itemSize*r)},clone:function(){var e=new THREE.BufferGeometry,t=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];for(var r in this.attributes){for(var n=this.attributes[r],i=n.array,o={itemSize:n.itemSize,array:null},a=0,s=t.length;s>a;a++){var l=t[a];if(i instanceof l){o.array=new l(i);break}}e.attributes[r]=o}for(var a=0,s=this.offsets.length;s>a;a++){var c=this.offsets[a];e.offsets.push({start:c.start,index:c.index,count:c.count})}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.BufferGeometry.prototype),THREE.Geometry=function(){this.id=THREE.GeometryIdCount++,this.uuid=THREE.Math.generateUUID(),this.name="",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!1,this.dynamic=!0,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.tangentsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.buffersNeedUpdate=!1,this.groupsNeedUpdate=!1},THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(e){for(var t=(new THREE.Matrix3).getNormalMatrix(e),r=0,n=this.vertices.length;n>r;r++){var i=this.vertices[r];i.applyMatrix4(e)}for(var r=0,n=this.faces.length;n>r;r++){var o=this.faces[r];o.normal.applyMatrix3(t).normalize();for(var a=0,s=o.vertexNormals.length;s>a;a++)o.vertexNormals[a].applyMatrix3(t).normalize()}this.boundingBox instanceof THREE.Box3&&this.computeBoundingBox(),this.boundingSphere instanceof THREE.Sphere&&this.computeBoundingSphere()},center:function(){this.computeBoundingBox();var e=new THREE.Vector3;return e.addVectors(this.boundingBox.min,this.boundingBox.max),e.multiplyScalar(-.5),this.applyMatrix((new THREE.Matrix4).makeTranslation(e.x,e.y,e.z)),this.computeBoundingBox(),e},computeFaceNormals:function(){for(var e=new THREE.Vector3,t=new THREE.Vector3,r=0,n=this.faces.length;n>r;r++){var i=this.faces[r],o=this.vertices[i.a],a=this.vertices[i.b],s=this.vertices[i.c];e.subVectors(s,a),t.subVectors(o,a),e.cross(t),e.normalize(),i.normal.copy(e)}},computeVertexNormals:function(e){var t,r,n,i,o,a;for(a=new Array(this.vertices.length),t=0,r=this.vertices.length;r>t;t++)a[t]=new THREE.Vector3;if(e){{var s,l,c,h=new THREE.Vector3,u=new THREE.Vector3;new THREE.Vector3,new THREE.Vector3,new THREE.Vector3}for(n=0,i=this.faces.length;i>n;n++)o=this.faces[n],s=this.vertices[o.a],l=this.vertices[o.b],c=this.vertices[o.c],h.subVectors(c,l),u.subVectors(s,l),h.cross(u),a[o.a].add(h),a[o.b].add(h),a[o.c].add(h)}else for(n=0,i=this.faces.length;i>n;n++)o=this.faces[n],a[o.a].add(o.normal),a[o.b].add(o.normal),a[o.c].add(o.normal);for(t=0,r=this.vertices.length;r>t;t++)a[t].normalize();for(n=0,i=this.faces.length;i>n;n++)o=this.faces[n],o.vertexNormals[0]=a[o.a].clone(),o.vertexNormals[1]=a[o.b].clone(),o.vertexNormals[2]=a[o.c].clone()},computeMorphNormals:function(){var e,t,r,n,i;for(r=0,n=this.faces.length;n>r;r++)for(i=this.faces[r],i.__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]),e=0,t=i.vertexNormals.length;t>e;e++)i.__originalVertexNormals[e]?i.__originalVertexNormals[e].copy(i.vertexNormals[e]):i.__originalVertexNormals[e]=i.vertexNormals[e].clone();var o=new THREE.Geometry;for(o.faces=this.faces,e=0,t=this.morphTargets.length;t>e;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var a,s,l=this.morphNormals[e].faceNormals,c=this.morphNormals[e].vertexNormals;for(r=0,n=this.faces.length;n>r;r++)a=new THREE.Vector3,s={a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3},l.push(a),c.push(s)}var h=this.morphNormals[e];o.vertices=this.morphTargets[e].vertices,o.computeFaceNormals(),o.computeVertexNormals();var a,s;for(r=0,n=this.faces.length;n>r;r++)i=this.faces[r],a=h.faceNormals[r],s=h.vertexNormals[r],a.copy(i.normal),s.a.copy(i.vertexNormals[0]),s.b.copy(i.vertexNormals[1]),s.c.copy(i.vertexNormals[2])}for(r=0,n=this.faces.length;n>r;r++)i=this.faces[r],i.normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals},computeTangents:function(){function e(e,t,r,n,i,o,a){c=e.vertices[t],h=e.vertices[r],u=e.vertices[n],f=l[i],d=l[o],p=l[a],m=h.x-c.x,g=u.x-c.x,v=h.y-c.y,E=u.y-c.y,y=h.z-c.z,T=u.z-c.z,x=d.x-f.x,w=p.x-f.x,b=d.y-f.y,R=p.y-f.y,_=1/(x*R-w*b),k.set((R*m-b*g)*_,(R*v-b*E)*_,(R*y-b*T)*_),L.set((x*g-w*m)*_,(x*E-w*v)*_,(x*T-w*y)*_),C[t].add(k),C[r].add(k),C[n].add(k),A[t].add(L),A[r].add(L),A[n].add(L)}var t,r,n,i,o,a,s,l,c,h,u,f,d,p,m,g,v,E,y,T,x,w,b,R,_,H,M,S,C=[],A=[],k=new THREE.Vector3,L=new THREE.Vector3,P=new THREE.Vector3,F=new THREE.Vector3,N=new THREE.Vector3;for(n=0,i=this.vertices.length;i>n;n++)C[n]=new THREE.Vector3,A[n]=new THREE.Vector3;for(t=0,r=this.faces.length;r>t;t++)s=this.faces[t],l=this.faceVertexUvs[0][t],e(this,s.a,s.b,s.c,0,1,2);var D=["a","b","c","d"];for(t=0,r=this.faces.length;r>t;t++)for(s=this.faces[t],o=0;o<Math.min(s.vertexNormals.length,3);o++)N.copy(s.vertexNormals[o]),a=s[D[o]],H=C[a],P.copy(H),P.sub(N.multiplyScalar(N.dot(H))).normalize(),F.crossVectors(s.vertexNormals[o],H),M=F.dot(A[a]),S=0>M?-1:1,s.vertexTangents[o]=new THREE.Vector4(P.x,P.y,P.z,S);this.hasTangents=!0},computeLineDistances:function(){for(var e=0,t=this.vertices,r=0,n=t.length;n>r;r++)r>0&&(e+=t[r].distanceTo(t[r-1])),this.lineDistances[r]=e},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,r){if(e instanceof THREE.Geometry==!1)return void console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);var n,i=this.vertices.length,o=(this.faceVertexUvs[0].length,this.vertices),a=e.vertices,s=this.faces,l=e.faces,c=this.faceVertexUvs[0],h=e.faceVertexUvs[0];void 0===r&&(r=0),void 0!==t&&(n=(new THREE.Matrix3).getNormalMatrix(t));for(var u=0,f=a.length;f>u;u++){var d=a[u],p=d.clone();void 0!==t&&p.applyMatrix4(t),o.push(p)}for(u=0,f=l.length;f>u;u++){var m,g,v,E=l[u],y=E.vertexNormals,T=E.vertexColors;m=new THREE.Face3(E.a+i,E.b+i,E.c+i),m.normal.copy(E.normal),void 0!==n&&m.normal.applyMatrix3(n).normalize();for(var x=0,w=y.length;w>x;x++)g=y[x].clone(),void 0!==n&&g.applyMatrix3(n).normalize(),m.vertexNormals.push(g);m.color.copy(E.color);for(var x=0,w=T.length;w>x;x++)v=T[x],m.vertexColors.push(v.clone());m.materialIndex=E.materialIndex+r,s.push(m)}for(u=0,f=h.length;f>u;u++){var b=h[u],R=[];if(void 0!==b){for(var x=0,w=b.length;w>x;x++)R.push(new THREE.Vector2(b[x].x,b[x].y));c.push(R)}}},mergeVertices:function(){var e,t,r,n,i,o,a,s,l={},c=[],h=[],u=4,f=Math.pow(10,u);for(r=0,n=this.vertices.length;n>r;r++)e=this.vertices[r],t=Math.round(e.x*f)+"_"+Math.round(e.y*f)+"_"+Math.round(e.z*f),void 0===l[t]?(l[t]=r,c.push(this.vertices[r]),h[r]=c.length-1):h[r]=h[l[t]];var d=[];for(r=0,n=this.faces.length;n>r;r++){i=this.faces[r],i.a=h[i.a],i.b=h[i.b],i.c=h[i.c],o=[i.a,i.b,i.c];for(var p=-1,m=0;3>m;m++)if(o[m]==o[(m+1)%3]){p=m,d.push(r);break}}for(r=d.length-1;r>=0;r--){var g=d[r];for(this.faces.splice(g,1),a=0,s=this.faceVertexUvs.length;s>a;a++)this.faceVertexUvs[a].splice(g,1)}var v=this.vertices.length-c.length;return this.vertices=c,v},makeGroups:function(){var e=0;return function(t,r){var n,i,o,a,s,l,c={},h=this.morphTargets.length,u=this.morphNormals.length;for(this.geometryGroups={},this.geometryGroupsList=[],n=0,i=this.faces.length;i>n;n++)o=this.faces[n],a=t?o.materialIndex:0,a in c||(c[a]={hash:a,counter:0}),s=c[a].hash+"_"+c[a].counter,s in this.geometryGroups||(l={id:e++,faces3:[],materialIndex:a,vertices:0,numMorphTargets:h,numMorphNormals:u},this.geometryGroups[s]=l,this.geometryGroupsList.push(l)),this.geometryGroups[s].vertices+3>r&&(c[a].counter+=1,s=c[a].hash+"_"+c[a].counter,s in this.geometryGroups||(l={id:e++,faces3:[],materialIndex:a,vertices:0,numMorphTargets:h,numMorphNormals:u},this.geometryGroups[s]=l,this.geometryGroupsList.push(l))),this.geometryGroups[s].faces3.push(n),this.geometryGroups[s].vertices+=3}}(),clone:function(){for(var e=new THREE.Geometry,t=this.vertices,r=0,n=t.length;n>r;r++)e.vertices.push(t[r].clone());for(var i=this.faces,r=0,n=i.length;n>r;r++)e.faces.push(i[r].clone());for(var o=this.faceVertexUvs[0],r=0,n=o.length;n>r;r++){for(var a=o[r],s=[],l=0,c=a.length;c>l;l++)s.push(new THREE.Vector2(a[l].x,a[l].y));e.faceVertexUvs[0].push(s)}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.Geometry.prototype),THREE.GeometryIdCount=0,THREE.Camera=function(){THREE.Object3D.call(this),this.matrixWorldInverse=new THREE.Matrix4,this.projectionMatrix=new THREE.Matrix4},THREE.Camera.prototype=Object.create(THREE.Object3D.prototype),THREE.Camera.prototype.lookAt=function(){var e=new THREE.Matrix4;return function(t){e.lookAt(this.position,t,this.up),this.quaternion.setFromRotationMatrix(e)}}(),THREE.Camera.prototype.clone=function(e){return void 0===e&&(e=new THREE.Camera),THREE.Object3D.prototype.clone.call(this,e),e.matrixWorldInverse.copy(this.matrixWorldInverse),e.projectionMatrix.copy(this.projectionMatrix),e},THREE.CubeCamera=function(e,t,r){THREE.Object3D.call(this);var n=90,i=1,o=new THREE.PerspectiveCamera(n,i,e,t);o.up.set(0,-1,0),o.lookAt(new THREE.Vector3(1,0,0)),this.add(o);var a=new THREE.PerspectiveCamera(n,i,e,t);a.up.set(0,-1,0),a.lookAt(new THREE.Vector3(-1,0,0)),this.add(a);var s=new THREE.PerspectiveCamera(n,i,e,t);s.up.set(0,0,1),s.lookAt(new THREE.Vector3(0,1,0)),this.add(s);var l=new THREE.PerspectiveCamera(n,i,e,t);l.up.set(0,0,-1),l.lookAt(new THREE.Vector3(0,-1,0)),this.add(l);var c=new THREE.PerspectiveCamera(n,i,e,t);c.up.set(0,-1,0),c.lookAt(new THREE.Vector3(0,0,1)),this.add(c);var h=new THREE.PerspectiveCamera(n,i,e,t);h.up.set(0,-1,0),h.lookAt(new THREE.Vector3(0,0,-1)),this.add(h),this.renderTarget=new THREE.WebGLRenderTargetCube(r,r,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter}),this.updateCubeMap=function(e,t){var r=this.renderTarget,n=r.generateMipmaps;r.generateMipmaps=!1,r.activeCubeFace=0,e.render(t,o,r),r.activeCubeFace=1,e.render(t,a,r),r.activeCubeFace=2,e.render(t,s,r),r.activeCubeFace=3,e.render(t,l,r),r.activeCubeFace=4,e.render(t,c,r),r.generateMipmaps=n,r.activeCubeFace=5,e.render(t,h,r)}},THREE.CubeCamera.prototype=Object.create(THREE.Object3D.prototype),THREE.OrthographicCamera=function(e,t,r,n,i,o){THREE.Camera.call(this),this.left=e,this.right=t,this.top=r,this.bottom=n,this.near=void 0!==i?i:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()},THREE.OrthographicCamera.prototype=Object.create(THREE.Camera.prototype),THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far)},THREE.OrthographicCamera.prototype.clone=function(){var e=new THREE.OrthographicCamera;return THREE.Camera.prototype.clone.call(this,e),e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e},THREE.PerspectiveCamera=function(e,t,r,n){THREE.Camera.call(this),this.fov=void 0!==e?e:50,this.aspect=void 0!==t?t:1,this.near=void 0!==r?r:.1,this.far=void 0!==n?n:2e3,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype=Object.create(THREE.Camera.prototype),THREE.PerspectiveCamera.prototype.setLens=function(e,t){void 0===t&&(t=24),this.fov=2*THREE.Math.radToDeg(Math.atan(t/(2*e))),this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.setViewOffset=function(e,t,r,n,i,o){this.fullWidth=e,this.fullHeight=t,this.x=r,this.y=n,this.width=i,this.height=o,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var e=this.fullWidth/this.fullHeight,t=Math.tan(THREE.Math.degToRad(.5*this.fov))*this.near,r=-t,n=e*r,i=e*t,o=Math.abs(i-n),a=Math.abs(t-r);this.projectionMatrix.makeFrustum(n+this.x*o/this.fullWidth,n+(this.x+this.width)*o/this.fullWidth,t-(this.y+this.height)*a/this.fullHeight,t-this.y*a/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)},THREE.PerspectiveCamera.prototype.clone=function(){var e=new THREE.PerspectiveCamera;return THREE.Camera.prototype.clone.call(this,e),e.fov=this.fov,e.aspect=this.aspect,e.near=this.near,e.far=this.far,e},THREE.Light=function(e){THREE.Object3D.call(this),this.color=new THREE.Color(e)},THREE.Light.prototype=Object.create(THREE.Object3D.prototype),THREE.Light.prototype.clone=function(e){return void 0===e&&(e=new THREE.Light),THREE.Object3D.prototype.clone.call(this,e),e.color.copy(this.color),e},THREE.AmbientLight=function(e){THREE.Light.call(this,e)},THREE.AmbientLight.prototype=Object.create(THREE.Light.prototype),THREE.AmbientLight.prototype.clone=function(){var e=new THREE.AmbientLight;return THREE.Light.prototype.clone.call(this,e),e},THREE.AreaLight=function(e,t){THREE.Light.call(this,e),this.normal=new THREE.Vector3(0,-1,0),this.right=new THREE.Vector3(1,0,0),this.intensity=void 0!==t?t:1,this.width=1,this.height=1,this.constantAttenuation=1.5,this.linearAttenuation=.5,this.quadraticAttenuation=.1
},THREE.AreaLight.prototype=Object.create(THREE.Light.prototype),THREE.DirectionalLight=function(e,t){THREE.Light.call(this,e),this.position.set(0,1,0),this.target=new THREE.Object3D,this.intensity=void 0!==t?t:1,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraRight=500,this.shadowCameraTop=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowCascade=!1,this.shadowCascadeOffset=new THREE.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},THREE.DirectionalLight.prototype=Object.create(THREE.Light.prototype),THREE.DirectionalLight.prototype.clone=function(){var e=new THREE.DirectionalLight;return THREE.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e.shadowCameraNear=this.shadowCameraNear,e.shadowCameraFar=this.shadowCameraFar,e.shadowCameraLeft=this.shadowCameraLeft,e.shadowCameraRight=this.shadowCameraRight,e.shadowCameraTop=this.shadowCameraTop,e.shadowCameraBottom=this.shadowCameraBottom,e.shadowCameraVisible=this.shadowCameraVisible,e.shadowBias=this.shadowBias,e.shadowDarkness=this.shadowDarkness,e.shadowMapWidth=this.shadowMapWidth,e.shadowMapHeight=this.shadowMapHeight,e.shadowCascade=this.shadowCascade,e.shadowCascadeOffset.copy(this.shadowCascadeOffset),e.shadowCascadeCount=this.shadowCascadeCount,e.shadowCascadeBias=this.shadowCascadeBias.slice(0),e.shadowCascadeWidth=this.shadowCascadeWidth.slice(0),e.shadowCascadeHeight=this.shadowCascadeHeight.slice(0),e.shadowCascadeNearZ=this.shadowCascadeNearZ.slice(0),e.shadowCascadeFarZ=this.shadowCascadeFarZ.slice(0),e},THREE.HemisphereLight=function(e,t,r){THREE.Light.call(this,e),this.position.set(0,100,0),this.groundColor=new THREE.Color(t),this.intensity=void 0!==r?r:1},THREE.HemisphereLight.prototype=Object.create(THREE.Light.prototype),THREE.HemisphereLight.prototype.clone=function(){var e=new THREE.HemisphereLight;return THREE.Light.prototype.clone.call(this,e),e.groundColor.copy(this.groundColor),e.intensity=this.intensity,e},THREE.PointLight=function(e,t,r){THREE.Light.call(this,e),this.intensity=void 0!==t?t:1,this.distance=void 0!==r?r:0},THREE.PointLight.prototype=Object.create(THREE.Light.prototype),THREE.PointLight.prototype.clone=function(){var e=new THREE.PointLight;return THREE.Light.prototype.clone.call(this,e),e.intensity=this.intensity,e.distance=this.distance,e},THREE.SpotLight=function(e,t,r,n,i){THREE.Light.call(this,e),this.position.set(0,1,0),this.target=new THREE.Object3D,this.intensity=void 0!==t?t:1,this.distance=void 0!==r?r:0,this.angle=void 0!==n?n:Math.PI/3,this.exponent=void 0!==i?i:10,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},THREE.SpotLight.prototype=Object.create(THREE.Light.prototype),THREE.SpotLight.prototype.clone=function(){var e=new THREE.SpotLight;return THREE.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.distance=this.distance,e.angle=this.angle,e.exponent=this.exponent,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e.shadowCameraNear=this.shadowCameraNear,e.shadowCameraFar=this.shadowCameraFar,e.shadowCameraFov=this.shadowCameraFov,e.shadowCameraVisible=this.shadowCameraVisible,e.shadowBias=this.shadowBias,e.shadowDarkness=this.shadowDarkness,e.shadowMapWidth=this.shadowMapWidth,e.shadowMapHeight=this.shadowMapHeight,e},THREE.Cache=function(){this.files={}},THREE.Cache.prototype={constructor:THREE.Cache,add:function(e,t){this.files[e]=t},get:function(e){return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},THREE.Loader=function(e){this.showStatus=e,this.statusDomElement=e?THREE.Loader.prototype.addStatusElement():null,this.imageLoader=new THREE.ImageLoader,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},THREE.Loader.prototype={constructor:THREE.Loader,crossOrigin:void 0,addStatusElement:function(){var e=document.createElement("div");return e.style.position="absolute",e.style.right="0px",e.style.top="0px",e.style.fontSize="0.8em",e.style.textAlign="left",e.style.background="rgba(0,0,0,0.25)",e.style.color="#fff",e.style.width="120px",e.style.padding="0.5em 0.5em 0.5em 0.5em",e.style.zIndex=1e3,e.innerHTML="Loading ...",e},updateProgress:function(e){var t="Loaded ";t+=e.total?(100*e.loaded/e.total).toFixed(0)+"%":(e.loaded/1024).toFixed(2)+" KB",this.statusDomElement.innerHTML=t},extractUrlBase:function(e){var t=e.split("/");return 1===t.length?"./":(t.pop(),t.join("/")+"/")},initMaterials:function(e,t){for(var r=[],n=0;n<e.length;++n)r[n]=this.createMaterial(e[n],t);return r},needsTangents:function(e){for(var t=0,r=e.length;r>t;t++){var n=e[t];if(n instanceof THREE.ShaderMaterial)return!0}return!1},createMaterial:function(e,t){function r(e){var t=Math.log(e)/Math.LN2;return Math.pow(2,Math.round(t))}function n(e,n,i,a,s,l,c){var h,u=t+i,f=THREE.Loader.Handlers.get(u);if(null!==f?h=f.load(u):(h=new THREE.Texture,f=o.imageLoader,f.crossOrigin=o.crossOrigin,f.load(u,function(e){if(THREE.Math.isPowerOfTwo(e.width)===!1||THREE.Math.isPowerOfTwo(e.height)===!1){var t=r(e.width),n=r(e.height),i=document.createElement("canvas");i.width=t,i.height=n;var o=i.getContext("2d");o.drawImage(e,0,0,t,n),h.image=i}else h.image=e;h.needsUpdate=!0})),h.sourceFile=i,a&&(h.repeat.set(a[0],a[1]),1!==a[0]&&(h.wrapS=THREE.RepeatWrapping),1!==a[1]&&(h.wrapT=THREE.RepeatWrapping)),s&&h.offset.set(s[0],s[1]),l){var d={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping};void 0!==d[l[0]]&&(h.wrapS=d[l[0]]),void 0!==d[l[1]]&&(h.wrapT=d[l[1]])}c&&(h.anisotropy=c),e[n]=h}function i(e){return(255*e[0]<<16)+(255*e[1]<<8)+255*e[2]}var o=this,a="MeshLambertMaterial",s={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(e.shading){var l=e.shading.toLowerCase();"phong"===l?a="MeshPhongMaterial":"basic"===l&&(a="MeshBasicMaterial")}if(void 0!==e.blending&&void 0!==THREE[e.blending]&&(s.blending=THREE[e.blending]),(void 0!==e.transparent||e.opacity<1)&&(s.transparent=e.transparent),void 0!==e.depthTest&&(s.depthTest=e.depthTest),void 0!==e.depthWrite&&(s.depthWrite=e.depthWrite),void 0!==e.visible&&(s.visible=e.visible),void 0!==e.flipSided&&(s.side=THREE.BackSide),void 0!==e.doubleSided&&(s.side=THREE.DoubleSide),void 0!==e.wireframe&&(s.wireframe=e.wireframe),void 0!==e.vertexColors&&("face"===e.vertexColors?s.vertexColors=THREE.FaceColors:e.vertexColors&&(s.vertexColors=THREE.VertexColors)),e.colorDiffuse?s.color=i(e.colorDiffuse):e.DbgColor&&(s.color=e.DbgColor),e.colorSpecular&&(s.specular=i(e.colorSpecular)),e.colorAmbient&&(s.ambient=i(e.colorAmbient)),e.colorEmissive&&(s.emissive=i(e.colorEmissive)),e.transparency&&(s.opacity=e.transparency),e.specularCoef&&(s.shininess=e.specularCoef),e.mapDiffuse&&t&&n(s,"map",e.mapDiffuse,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy),e.mapLight&&t&&n(s,"lightMap",e.mapLight,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy),e.mapBump&&t&&n(s,"bumpMap",e.mapBump,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy),e.mapNormal&&t&&n(s,"normalMap",e.mapNormal,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy),e.mapSpecular&&t&&n(s,"specularMap",e.mapSpecular,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy),e.mapAlpha&&t&&n(s,"alphaMap",e.mapAlpha,e.mapAlphaRepeat,e.mapAlphaOffset,e.mapAlphaWrap,e.mapAlphaAnisotropy),e.mapBumpScale&&(s.bumpScale=e.mapBumpScale),e.mapNormal){var c=THREE.ShaderLib.normalmap,h=THREE.UniformsUtils.clone(c.uniforms);h.tNormal.value=s.normalMap,e.mapNormalFactor&&h.uNormalScale.value.set(e.mapNormalFactor,e.mapNormalFactor),s.map&&(h.tDiffuse.value=s.map,h.enableDiffuse.value=!0),s.specularMap&&(h.tSpecular.value=s.specularMap,h.enableSpecular.value=!0),s.lightMap&&(h.tAO.value=s.lightMap,h.enableAO.value=!0),h.diffuse.value.setHex(s.color),h.specular.value.setHex(s.specular),h.ambient.value.setHex(s.ambient),h.shininess.value=s.shininess,void 0!==s.opacity&&(h.opacity.value=s.opacity);var u={fragmentShader:c.fragmentShader,vertexShader:c.vertexShader,uniforms:h,lights:!0,fog:!0},f=new THREE.ShaderMaterial(u);s.transparent&&(f.transparent=!0)}else var f=new THREE[a](s);return void 0!==e.DbgName&&(f.name=e.DbgName),f}},THREE.Loader.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=0,r=this.handlers.length;r>t;t+=2){var n=this.handlers[t],i=this.handlers[t+1];if(n.test(e))return i}return null}},THREE.XHRLoader=function(e){this.cache=new THREE.Cache,this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.XHRLoader.prototype={constructor:THREE.XHRLoader,load:function(e,t,r,n){var i=this,o=i.cache.get(e);if(void 0!==o)return void(t&&t(o));var a=new XMLHttpRequest;a.open("GET",e,!0),a.addEventListener("load",function(){i.cache.add(e,this.response),t&&t(this.response),i.manager.itemEnd(e)},!1),void 0!==r&&a.addEventListener("progress",function(e){r(e)},!1),void 0!==n&&a.addEventListener("error",function(e){n(e)},!1),void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),void 0!==this.responseType&&(a.responseType=this.responseType),a.send(null),i.manager.itemStart(e)},setResponseType:function(e){this.responseType=e},setCrossOrigin:function(e){this.crossOrigin=e}},THREE.ImageLoader=function(e){this.cache=new THREE.Cache,this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.ImageLoader.prototype={constructor:THREE.ImageLoader,load:function(e,t,r,n){var i=this,o=i.cache.get(e);if(void 0!==o)return void t(o);var a=document.createElement("img");return void 0!==t&&a.addEventListener("load",function(){i.cache.add(e,this),t(this),i.manager.itemEnd(e)},!1),void 0!==r&&a.addEventListener("progress",function(e){r(e)},!1),void 0!==n&&a.addEventListener("error",function(e){n(e)},!1),void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),a.src=e,i.manager.itemStart(e),a},setCrossOrigin:function(e){this.crossOrigin=e}},THREE.JSONLoader=function(e){THREE.Loader.call(this,e),this.withCredentials=!1},THREE.JSONLoader.prototype=Object.create(THREE.Loader.prototype),THREE.JSONLoader.prototype.load=function(e,t,r){r=r&&"string"==typeof r?r:this.extractUrlBase(e),this.onLoadStart(),this.loadAjaxJSON(this,e,t,r)},THREE.JSONLoader.prototype.loadAjaxJSON=function(e,t,r,n,i){var o=new XMLHttpRequest,a=0;o.onreadystatechange=function(){if(o.readyState===o.DONE)if(200===o.status||0===o.status){if(o.responseText){var s=JSON.parse(o.responseText);if(void 0!==s.metadata&&"scene"===s.metadata.type)return void console.error('THREE.JSONLoader: "'+t+'" seems to be a Scene. Use THREE.SceneLoader instead.');var l=e.parse(s,n);r(l.geometry,l.materials)}else console.error('THREE.JSONLoader: "'+t+'" seems to be unreachable or the file is empty.');e.onLoadComplete()}else console.error("THREE.JSONLoader: Couldn't load \""+t+'" ('+o.status+")");else o.readyState===o.LOADING?i&&(0===a&&(a=o.getResponseHeader("Content-Length")),i({total:a,loaded:o.responseText.length})):o.readyState===o.HEADERS_RECEIVED&&void 0!==i&&(a=o.getResponseHeader("Content-Length"))},o.open("GET",t,!0),o.withCredentials=this.withCredentials,o.send(null)},THREE.JSONLoader.prototype.parse=function(e,t){function r(t){function r(e,t){return e&1<<t}var n,i,a,s,l,c,h,u,f,d,p,m,g,v,E,y,T,x,w,b,R,_,H,M,S,C,A,k=e.faces,L=e.vertices,P=e.normals,F=e.colors,N=0;if(void 0!==e.uvs){for(n=0;n<e.uvs.length;n++)e.uvs[n].length&&N++;for(n=0;N>n;n++)o.faceVertexUvs[n]=[]}for(s=0,l=L.length;l>s;)x=new THREE.Vector3,x.x=L[s++]*t,x.y=L[s++]*t,x.z=L[s++]*t,o.vertices.push(x);for(s=0,l=k.length;l>s;)if(d=k[s++],p=r(d,0),m=r(d,1),g=r(d,3),v=r(d,4),E=r(d,5),y=r(d,6),T=r(d,7),p){if(b=new THREE.Face3,b.a=k[s],b.b=k[s+1],b.c=k[s+3],R=new THREE.Face3,R.a=k[s+1],R.b=k[s+2],R.c=k[s+3],s+=4,m&&(f=k[s++],b.materialIndex=f,R.materialIndex=f),a=o.faces.length,g)for(n=0;N>n;n++)for(M=e.uvs[n],o.faceVertexUvs[n][a]=[],o.faceVertexUvs[n][a+1]=[],i=0;4>i;i++)u=k[s++],C=M[2*u],A=M[2*u+1],S=new THREE.Vector2(C,A),2!==i&&o.faceVertexUvs[n][a].push(S),0!==i&&o.faceVertexUvs[n][a+1].push(S);if(v&&(h=3*k[s++],b.normal.set(P[h++],P[h++],P[h]),R.normal.copy(b.normal)),E)for(n=0;4>n;n++)h=3*k[s++],H=new THREE.Vector3(P[h++],P[h++],P[h]),2!==n&&b.vertexNormals.push(H),0!==n&&R.vertexNormals.push(H);if(y&&(c=k[s++],_=F[c],b.color.setHex(_),R.color.setHex(_)),T)for(n=0;4>n;n++)c=k[s++],_=F[c],2!==n&&b.vertexColors.push(new THREE.Color(_)),0!==n&&R.vertexColors.push(new THREE.Color(_));o.faces.push(b),o.faces.push(R)}else{if(w=new THREE.Face3,w.a=k[s++],w.b=k[s++],w.c=k[s++],m&&(f=k[s++],w.materialIndex=f),a=o.faces.length,g)for(n=0;N>n;n++)for(M=e.uvs[n],o.faceVertexUvs[n][a]=[],i=0;3>i;i++)u=k[s++],C=M[2*u],A=M[2*u+1],S=new THREE.Vector2(C,A),o.faceVertexUvs[n][a].push(S);if(v&&(h=3*k[s++],w.normal.set(P[h++],P[h++],P[h])),E)for(n=0;3>n;n++)h=3*k[s++],H=new THREE.Vector3(P[h++],P[h++],P[h]),w.vertexNormals.push(H);if(y&&(c=k[s++],w.color.setHex(F[c])),T)for(n=0;3>n;n++)c=k[s++],w.vertexColors.push(new THREE.Color(F[c]));o.faces.push(w)}}function n(){var t=void 0!==e.influencesPerVertex?e.influencesPerVertex:2;if(e.skinWeights)for(var r=0,n=e.skinWeights.length;n>r;r+=t){var i=e.skinWeights[r],a=t>1?e.skinWeights[r+1]:0,s=t>2?e.skinWeights[r+2]:0,l=t>3?e.skinWeights[r+3]:0;o.skinWeights.push(new THREE.Vector4(i,a,s,l))}if(e.skinIndices)for(var r=0,n=e.skinIndices.length;n>r;r+=t){var c=e.skinIndices[r],h=t>1?e.skinIndices[r+1]:0,u=t>2?e.skinIndices[r+2]:0,f=t>3?e.skinIndices[r+3]:0;o.skinIndices.push(new THREE.Vector4(c,h,u,f))}o.bones=e.bones,o.bones&&o.bones.length>0&&(o.skinWeights.length!==o.skinIndices.length||o.skinIndices.length!==o.vertices.length)&&console.warn("When skinning, number of vertices ("+o.vertices.length+"), skinIndices ("+o.skinIndices.length+"), and skinWeights ("+o.skinWeights.length+") should match."),o.animation=e.animation,o.animations=e.animations}function i(t){if(void 0!==e.morphTargets){var r,n,i,a,s,l;for(r=0,n=e.morphTargets.length;n>r;r++)for(o.morphTargets[r]={},o.morphTargets[r].name=e.morphTargets[r].name,o.morphTargets[r].vertices=[],s=o.morphTargets[r].vertices,l=e.morphTargets[r].vertices,i=0,a=l.length;a>i;i+=3){var c=new THREE.Vector3;c.x=l[i]*t,c.y=l[i+1]*t,c.z=l[i+2]*t,s.push(c)}}if(void 0!==e.morphColors){var r,n,h,u,f,d,p;for(r=0,n=e.morphColors.length;n>r;r++)for(o.morphColors[r]={},o.morphColors[r].name=e.morphColors[r].name,o.morphColors[r].colors=[],f=o.morphColors[r].colors,d=e.morphColors[r].colors,h=0,u=d.length;u>h;h+=3)p=new THREE.Color(16755200),p.setRGB(d[h],d[h+1],d[h+2]),f.push(p)}}var o=new THREE.Geometry,a=void 0!==e.scale?1/e.scale:1;if(r(a),n(),i(a),o.computeFaceNormals(),o.computeBoundingSphere(),void 0===e.materials||0===e.materials.length)return{geometry:o};var s=this.initMaterials(e.materials,t);return this.needsTangents(s)&&o.computeTangents(),{geometry:o,materials:s}},THREE.LoadingManager=function(e,t,r){var n=this,i=0,o=0;this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(){o++},this.itemEnd=function(e){i++,void 0!==n.onProgress&&n.onProgress(e,i,o),i===o&&void 0!==n.onLoad&&n.onLoad()}},THREE.DefaultLoadingManager=new THREE.LoadingManager,THREE.BufferGeometryLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.BufferGeometryLoader.prototype={constructor:THREE.BufferGeometryLoader,load:function(e,t,r,n){var i=this,o=new THREE.XHRLoader;o.setCrossOrigin(this.crossOrigin),o.load(e,function(e){t(i.parse(JSON.parse(e)))},r,n)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new THREE.BufferGeometry,r=e.attributes;for(var n in r){var i=r[n];t.attributes[n]={itemSize:i.itemSize,array:new self[i.type](i.array)}}var o=e.offsets;void 0!==o&&(t.offsets=JSON.parse(JSON.stringify(o)));var a=e.boundingSphere;return void 0!==a&&(t.boundingSphere=new THREE.Sphere((new THREE.Vector3).fromArray(void 0!==a.center?a.center:[0,0,0]),a.radius)),t}},THREE.MaterialLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.MaterialLoader.prototype={constructor:THREE.MaterialLoader,load:function(e,t,r,n){var i=this,o=new THREE.XHRLoader;o.setCrossOrigin(this.crossOrigin),o.load(e,function(e){t(i.parse(JSON.parse(e)))},r,n)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new THREE[e.type];if(void 0!==e.color&&t.color.setHex(e.color),void 0!==e.ambient&&t.ambient.setHex(e.ambient),void 0!==e.emissive&&t.emissive.setHex(e.emissive),void 0!==e.specular&&t.specular.setHex(e.specular),void 0!==e.shininess&&(t.shininess=e.shininess),void 0!==e.uniforms&&(t.uniforms=e.uniforms),void 0!==e.vertexShader&&(t.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(t.fragmentShader=e.fragmentShader),void 0!==e.vertexColors&&(t.vertexColors=e.vertexColors),void 0!==e.blending&&(t.blending=e.blending),void 0!==e.side&&(t.side=e.side),void 0!==e.opacity&&(t.opacity=e.opacity),void 0!==e.transparent&&(t.transparent=e.transparent),void 0!==e.wireframe&&(t.wireframe=e.wireframe),void 0!==e.materials)for(var r=0,n=e.materials.length;n>r;r++)t.materials.push(this.parse(e.materials[r]));return t}},THREE.ObjectLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.ObjectLoader.prototype={constructor:THREE.ObjectLoader,load:function(e,t,r,n){var i=this,o=new THREE.XHRLoader(i.manager);o.setCrossOrigin(this.crossOrigin),o.load(e,function(e){t(i.parse(JSON.parse(e)))},r,n)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=this.parseGeometries(e.geometries),r=this.parseMaterials(e.materials),n=this.parseObject(e.object,t,r);return n},parseGeometries:function(e){var t={};if(void 0!==e)for(var r=new THREE.JSONLoader,n=new THREE.BufferGeometryLoader,i=0,o=e.length;o>i;i++){var a,s=e[i];switch(s.type){case"PlaneGeometry":a=new THREE.PlaneGeometry(s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"CubeGeometry":a=new THREE.BoxGeometry(s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":a=new THREE.CircleGeometry(s.radius,s.segments);break;case"CylinderGeometry":a=new THREE.CylinderGeometry(s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded);break;case"SphereGeometry":a=new THREE.SphereGeometry(s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"IcosahedronGeometry":a=new THREE.IcosahedronGeometry(s.radius,s.detail);break;case"TorusGeometry":a=new THREE.TorusGeometry(s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":a=new THREE.TorusKnotGeometry(s.radius,s.tube,s.radialSegments,s.tubularSegments,s.p,s.q,s.heightScale);break;case"BufferGeometry":a=n.parse(s.data);break;case"Geometry":a=r.parse(s.data).geometry}a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),t[s.uuid]=a}return t},parseMaterials:function(e){var t={};if(void 0!==e)for(var r=new THREE.MaterialLoader,n=0,i=e.length;i>n;n++){var o=e[n],a=r.parse(o);a.uuid=o.uuid,void 0!==o.name&&(a.name=o.name),t[o.uuid]=a}return t},parseObject:function(){var e=new THREE.Matrix4;return function(t,r,n){var i;switch(t.type){case"Scene":i=new THREE.Scene;break;case"PerspectiveCamera":i=new THREE.PerspectiveCamera(t.fov,t.aspect,t.near,t.far);break;case"OrthographicCamera":i=new THREE.OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far);break;case"AmbientLight":i=new THREE.AmbientLight(t.color);break;case"DirectionalLight":i=new THREE.DirectionalLight(t.color,t.intensity);break;case"PointLight":i=new THREE.PointLight(t.color,t.intensity,t.distance);break;case"SpotLight":i=new THREE.SpotLight(t.color,t.intensity,t.distance,t.angle,t.exponent);break;case"HemisphereLight":i=new THREE.HemisphereLight(t.color,t.groundColor,t.intensity);break;case"Mesh":var o=r[t.geometry],a=n[t.material];void 0===o&&console.error("THREE.ObjectLoader: Undefined geometry "+t.geometry),void 0===a&&console.error("THREE.ObjectLoader: Undefined material "+t.material),i=new THREE.Mesh(o,a);break;case"Sprite":var a=n[t.material];void 0===a&&console.error("THREE.ObjectLoader: Undefined material "+t.material),i=new THREE.Sprite(a);break;default:i=new THREE.Object3D}if(i.uuid=t.uuid,void 0!==t.name&&(i.name=t.name),void 0!==t.matrix?(e.fromArray(t.matrix),e.decompose(i.position,i.quaternion,i.scale)):(void 0!==t.position&&i.position.fromArray(t.position),void 0!==t.rotation&&i.rotation.fromArray(t.rotation),void 0!==t.scale&&i.scale.fromArray(t.scale)),void 0!==t.visible&&(i.visible=t.visible),void 0!==t.userData&&(i.userData=t.userData),void 0!==t.children)for(var s in t.children)i.add(this.parseObject(t.children[s],r,n));return i}}()},THREE.TextureLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.TextureLoader.prototype={constructor:THREE.TextureLoader,load:function(e,t,r,n){var i=this,o=new THREE.ImageLoader(i.manager);o.setCrossOrigin(this.crossOrigin),o.load(e,function(e){var r=new THREE.Texture(e);r.needsUpdate=!0,void 0!==t&&t(r)},r,n)},setCrossOrigin:function(e){this.crossOrigin=e}},THREE.Material=function(){this.id=THREE.MaterialIdCount++,this.uuid=THREE.Math.generateUUID(),this.name="",this.side=THREE.FrontSide,this.opacity=1,this.transparent=!1,this.blending=THREE.NormalBlending,this.blendSrc=THREE.SrcAlphaFactor,this.blendDst=THREE.OneMinusSrcAlphaFactor,this.blendEquation=THREE.AddEquation,this.depthTest=!0,this.depthWrite=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.overdraw=0,this.visible=!0,this.needsUpdate=!0},THREE.Material.prototype={constructor:THREE.Material,setValues:function(e){if(void 0!==e)for(var t in e){var r=e[t];if(void 0!==r){if(t in this){var n=this[t];n instanceof THREE.Color?n.set(r):n instanceof THREE.Vector3&&r instanceof THREE.Vector3?n.copy(r):this[t]="overdraw"==t?Number(r):r}}else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},clone:function(e){return void 0===e&&(e=new THREE.Material),e.name=this.name,e.side=this.side,e.opacity=this.opacity,e.transparent=this.transparent,e.blending=this.blending,e.blendSrc=this.blendSrc,e.blendDst=this.blendDst,e.blendEquation=this.blendEquation,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,e.polygonOffset=this.polygonOffset,e.polygonOffsetFactor=this.polygonOffsetFactor,e.polygonOffsetUnits=this.polygonOffsetUnits,e.alphaTest=this.alphaTest,e.overdraw=this.overdraw,e.visible=this.visible,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.Material.prototype),THREE.MaterialIdCount=0,THREE.LineBasicMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=THREE.NoColors,this.fog=!0,this.setValues(e)},THREE.LineBasicMaterial.prototype=Object.create(THREE.Material.prototype),THREE.LineBasicMaterial.prototype.clone=function(){var e=new THREE.LineBasicMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.linecap=this.linecap,e.linejoin=this.linejoin,e.vertexColors=this.vertexColors,e.fog=this.fog,e},THREE.LineDashedMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(e)},THREE.LineDashedMaterial.prototype=Object.create(THREE.Material.prototype),THREE.LineDashedMaterial.prototype.clone=function(){var e=new THREE.LineDashedMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.scale=this.scale,e.dashSize=this.dashSize,e.gapSize=this.gapSize,e.vertexColors=this.vertexColors,e.fog=this.fog,e},THREE.MeshBasicMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.map=null,this.lightMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=THREE.NoColors,this.skinning=!1,this.morphTargets=!1,this.setValues(e)},THREE.MeshBasicMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshBasicMaterial.prototype.clone=function(){var e=new THREE.MeshBasicMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.alphaMap=this.alphaMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e},THREE.MeshLambertMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.ambient=new THREE.Color(16777215),this.emissive=new THREE.Color(0),this.wrapAround=!1,this.wrapRGB=new THREE.Vector3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=THREE.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},THREE.MeshLambertMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshLambertMaterial.prototype.clone=function(){var e=new THREE.MeshLambertMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.alphaMap=this.alphaMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},THREE.MeshPhongMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.ambient=new THREE.Color(16777215),this.emissive=new THREE.Color(0),this.specular=new THREE.Color(1118481),this.shininess=30,this.metal=!1,this.wrapAround=!1,this.wrapRGB=new THREE.Vector3(1,1,1),this.map=null,this.lightMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new THREE.Vector2(1,1),this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=THREE.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},THREE.MeshPhongMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshPhongMaterial.prototype.clone=function(){var e=new THREE.MeshPhongMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.specular.copy(this.specular),e.shininess=this.shininess,e.metal=this.metal,e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.bumpMap=this.bumpMap,e.bumpScale=this.bumpScale,e.normalMap=this.normalMap,e.normalScale.copy(this.normalScale),e.specularMap=this.specularMap,e.alphaMap=this.alphaMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},THREE.MeshDepthMaterial=function(e){THREE.Material.call(this),this.morphTargets=!1,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)},THREE.MeshDepthMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshDepthMaterial.prototype.clone=function(){var e=new THREE.MeshDepthMaterial;return THREE.Material.prototype.clone.call(this,e),e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},THREE.MeshNormalMaterial=function(e){THREE.Material.call(this,e),this.shading=THREE.FlatShading,this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(e)},THREE.MeshNormalMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshNormalMaterial.prototype.clone=function(){var e=new THREE.MeshNormalMaterial;return THREE.Material.prototype.clone.call(this,e),e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},THREE.MeshFaceMaterial=function(e){this.materials=e instanceof Array?e:[]},THREE.MeshFaceMaterial.prototype.clone=function(){for(var e=new THREE.MeshFaceMaterial,t=0;t<this.materials.length;t++)e.materials.push(this.materials[t].clone());return e},THREE.PointCloudMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=THREE.NoColors,this.fog=!0,this.setValues(e)},THREE.PointCloudMaterial.prototype=Object.create(THREE.Material.prototype),THREE.PointCloudMaterial.prototype.clone=function(){var e=new THREE.PointCloudMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.size=this.size,e.sizeAttenuation=this.sizeAttenuation,e.vertexColors=this.vertexColors,e.fog=this.fog,e},THREE.ParticleBasicMaterial=function(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointCloudMaterial."),new THREE.PointCloudMaterial(e)},THREE.ParticleSystemMaterial=function(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointCloudMaterial."),new THREE.PointCloudMaterial(e)},THREE.ShaderMaterial=function(e){THREE.Material.call(this),this.defines={},this.uniforms={},this.attributes=null,this.vertexShader="void main() {\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.shading=THREE.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=THREE.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.setValues(e)},THREE.ShaderMaterial.prototype=Object.create(THREE.Material.prototype),THREE.ShaderMaterial.prototype.clone=function(){var e=new THREE.ShaderMaterial;
return THREE.Material.prototype.clone.call(this,e),e.fragmentShader=this.fragmentShader,e.vertexShader=this.vertexShader,e.uniforms=THREE.UniformsUtils.clone(this.uniforms),e.attributes=this.attributes,e.defines=this.defines,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.fog=this.fog,e.lights=this.lights,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},THREE.RawShaderMaterial=function(e){THREE.ShaderMaterial.call(this,e)},THREE.RawShaderMaterial.prototype=Object.create(THREE.ShaderMaterial.prototype),THREE.RawShaderMaterial.prototype.clone=function(){var e=new THREE.RawShaderMaterial;return THREE.ShaderMaterial.prototype.clone.call(this,e),e},THREE.SpriteMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.map=null,this.rotation=0,this.fog=!1,this.setValues(e)},THREE.SpriteMaterial.prototype=Object.create(THREE.Material.prototype),THREE.SpriteMaterial.prototype.clone=function(){var e=new THREE.SpriteMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.rotation=this.rotation,e.fog=this.fog,e},THREE.SpriteCanvasMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.program=function(){},this.setValues(e)},THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype),THREE.SpriteCanvasMaterial.prototype.clone=function(){var e=new THREE.SpriteCanvasMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.program=this.program,e},THREE.ParticleCanvasMaterial=THREE.SpriteCanvasMaterial,THREE.Texture=function(e,t,r,n,i,o,a,s,l){this.id=THREE.TextureIdCount++,this.uuid=THREE.Math.generateUUID(),this.name="",this.image=void 0!==e?e:THREE.Texture.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:THREE.Texture.DEFAULT_MAPPING,this.wrapS=void 0!==r?r:THREE.ClampToEdgeWrapping,this.wrapT=void 0!==n?n:THREE.ClampToEdgeWrapping,this.magFilter=void 0!==i?i:THREE.LinearFilter,this.minFilter=void 0!==o?o:THREE.LinearMipMapLinearFilter,this.anisotropy=void 0!==l?l:1,this.format=void 0!==a?a:THREE.RGBAFormat,this.type=void 0!==s?s:THREE.UnsignedByteType,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this._needsUpdate=!1,this.onUpdate=null},THREE.Texture.DEFAULT_IMAGE=void 0,THREE.Texture.DEFAULT_MAPPING=new THREE.UVMapping,THREE.Texture.prototype={constructor:THREE.Texture,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){e===!0&&this.update(),this._needsUpdate=e},clone:function(e){return void 0===e&&(e=new THREE.Texture),e.image=this.image,e.mipmaps=this.mipmaps.slice(0),e.mapping=this.mapping,e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.format=this.format,e.type=this.type,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.generateMipmaps=this.generateMipmaps,e.premultiplyAlpha=this.premultiplyAlpha,e.flipY=this.flipY,e.unpackAlignment=this.unpackAlignment,e},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.Texture.prototype),THREE.TextureIdCount=0,THREE.CubeTexture=function(e,t,r,n,i,o,a,s,l){THREE.Texture.call(this,e,t,r,n,i,o,a,s,l),this.images=e},THREE.CubeTexture.prototype=Object.create(THREE.Texture.prototype),THREE.CubeTexture.clone=function(e){return void 0===e&&(e=new THREE.CubeTexture),THREE.Texture.prototype.clone.call(this,e),e.images=this.images,e},THREE.CompressedTexture=function(e,t,r,n,i,o,a,s,l,c,h){THREE.Texture.call(this,null,o,a,s,l,c,n,i,h),this.image={width:t,height:r},this.mipmaps=e,this.generateMipmaps=!1},THREE.CompressedTexture.prototype=Object.create(THREE.Texture.prototype),THREE.CompressedTexture.prototype.clone=function(){var e=new THREE.CompressedTexture;return THREE.Texture.prototype.clone.call(this,e),e},THREE.DataTexture=function(e,t,r,n,i,o,a,s,l,c,h){THREE.Texture.call(this,null,o,a,s,l,c,n,i,h),this.image={data:e,width:t,height:r}},THREE.DataTexture.prototype=Object.create(THREE.Texture.prototype),THREE.DataTexture.prototype.clone=function(){var e=new THREE.DataTexture;return THREE.Texture.prototype.clone.call(this,e),e},THREE.PointCloud=function(e,t){THREE.Object3D.call(this),this.geometry=void 0!==e?e:new THREE.Geometry,this.material=void 0!==t?t:new THREE.PointCloudMaterial({color:16777215*Math.random()}),this.sortParticles=!1},THREE.PointCloud.prototype=Object.create(THREE.Object3D.prototype),THREE.PointCloud.prototype.raycast=function(){var e=new THREE.Matrix4,t=new THREE.Ray;return function(r,n){var i=this,o=i.geometry,a=r.params.PointCloud.threshold;if(e.getInverse(this.matrixWorld),t.copy(r.ray).applyMatrix4(e),null===o.boundingBox||t.isIntersectionBox(o.boundingBox)!==!1){var s=a/((this.scale.x+this.scale.y+this.scale.z)/3),l=new THREE.Vector3,c=function(e,o){var a=t.distanceToPoint(e);if(s>a){var l=t.closestPointToPoint(e);l.applyMatrix4(i.matrixWorld);var c=r.ray.origin.distanceTo(l);n.push({distance:c,distanceToRay:a,point:l.clone(),index:o,face:null,object:i})}};if(o instanceof THREE.BufferGeometry){var h=o.attributes,u=h.position.array;if(void 0!==h.index){var f=h.index.array,d=o.offsets;if(0===d.length){var p={start:0,count:f.length,index:0};d=[p]}for(var m=0,g=d.length;g>m;++m)for(var v=d[m].start,E=d[m].count,y=d[m].index,T=v,x=v+E;x>T;T++){var w=y+f[T];l.set(u[3*w],u[3*w+1],u[3*w+2]),c(l,w)}}else for(var b=u.length/3,T=0;b>T;T++)l.set(u[3*T],u[3*T+1],u[3*T+2]),c(l,T)}else for(var R=this.geometry.vertices,T=0;T<R.length;T++)c(R[T],T)}}}(),THREE.PointCloud.prototype.clone=function(e){return void 0===e&&(e=new THREE.PointCloud(this.geometry,this.material)),e.sortParticles=this.sortParticles,THREE.Object3D.prototype.clone.call(this,e),e},THREE.ParticleSystem=function(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.PointCloud."),new THREE.PointCloud(e,t)},THREE.Line=function(e,t,r){THREE.Object3D.call(this),this.geometry=void 0!==e?e:new THREE.Geometry,this.material=void 0!==t?t:new THREE.LineBasicMaterial({color:16777215*Math.random()}),this.type=void 0!==r?r:THREE.LineStrip},THREE.LineStrip=0,THREE.LinePieces=1,THREE.Line.prototype=Object.create(THREE.Object3D.prototype),THREE.Line.prototype.raycast=function(){var e=new THREE.Matrix4,t=new THREE.Ray,r=new THREE.Sphere;return function(n,i){var o=n.linePrecision,a=o*o,s=this.geometry;if(null===s.boundingSphere&&s.computeBoundingSphere(),r.copy(s.boundingSphere),r.applyMatrix4(this.matrixWorld),n.ray.isIntersectionSphere(r)!==!1&&(e.getInverse(this.matrixWorld),t.copy(n.ray).applyMatrix4(e),s instanceof THREE.Geometry))for(var l=s.vertices,c=l.length,h=new THREE.Vector3,u=new THREE.Vector3,f=this.type===THREE.LineStrip?1:2,d=0;c-1>d;d+=f){var p=t.distanceSqToSegment(l[d],l[d+1],u,h);if(!(p>a)){var m=t.origin.distanceTo(u);m<n.near||m>n.far||i.push({distance:m,point:h.clone().applyMatrix4(this.matrixWorld),face:null,faceIndex:null,object:this})}}}}(),THREE.Line.prototype.clone=function(e){return void 0===e&&(e=new THREE.Line(this.geometry,this.material,this.type)),THREE.Object3D.prototype.clone.call(this,e),e},THREE.Mesh=function(e,t){THREE.Object3D.call(this),this.geometry=void 0!==e?e:new THREE.Geometry,this.material=void 0!==t?t:new THREE.MeshBasicMaterial({color:16777215*Math.random()}),this.updateMorphTargets()},THREE.Mesh.prototype=Object.create(THREE.Object3D.prototype),THREE.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&this.geometry.morphTargets.length>0){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;t>e;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}},THREE.Mesh.prototype.getMorphTargetIndexByName=function(e){return void 0!==this.morphTargetDictionary[e]?this.morphTargetDictionary[e]:(console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},THREE.Mesh.prototype.raycast=function(){var e=new THREE.Matrix4,t=new THREE.Ray,r=new THREE.Sphere,n=new THREE.Vector3,i=new THREE.Vector3,o=new THREE.Vector3;return function(a,s){var l=this.geometry;if(null===l.boundingSphere&&l.computeBoundingSphere(),r.copy(l.boundingSphere),r.applyMatrix4(this.matrixWorld),a.ray.isIntersectionSphere(r)!==!1&&(e.getInverse(this.matrixWorld),t.copy(a.ray).applyMatrix4(e),null===l.boundingBox||t.isIntersectionBox(l.boundingBox)!==!1))if(l instanceof THREE.BufferGeometry){var c=this.material;if(void 0===c)return;var h,u,f,d=l.attributes,p=a.precision;if(void 0!==d.index){var m=d.index.array,g=d.position.array,v=l.offsets;0===v.length&&(v=[{start:0,count:m.length,index:0}]);for(var E=0,y=v.length;y>E;++E)for(var T=v[E].start,x=v[E].count,w=v[E].index,b=T,R=T+x;R>b;b+=3){if(h=w+m[b],u=w+m[b+1],f=w+m[b+2],n.set(g[3*h],g[3*h+1],g[3*h+2]),i.set(g[3*u],g[3*u+1],g[3*u+2]),o.set(g[3*f],g[3*f+1],g[3*f+2]),c.side===THREE.BackSide)var _=t.intersectTriangle(o,i,n,!0);else var _=t.intersectTriangle(n,i,o,c.side!==THREE.DoubleSide);if(null!==_){_.applyMatrix4(this.matrixWorld);var H=a.ray.origin.distanceTo(_);p>H||H<a.near||H>a.far||s.push({distance:H,point:_,indices:[h,u,f],face:null,faceIndex:null,object:this})}}}else for(var g=d.position.array,b=0,M=0,R=g.length;R>b;b+=3,M+=9){if(h=b,u=b+1,f=b+2,n.set(g[M],g[M+1],g[M+2]),i.set(g[M+3],g[M+4],g[M+5]),o.set(g[M+6],g[M+7],g[M+8]),c.side===THREE.BackSide)var _=t.intersectTriangle(o,i,n,!0);else var _=t.intersectTriangle(n,i,o,c.side!==THREE.DoubleSide);if(null!==_){_.applyMatrix4(this.matrixWorld);var H=a.ray.origin.distanceTo(_);p>H||H<a.near||H>a.far||s.push({distance:H,point:_,indices:[h,u,f],face:null,faceIndex:null,object:this})}}}else if(l instanceof THREE.Geometry)for(var h,u,f,S=this.material instanceof THREE.MeshFaceMaterial,C=S===!0?this.material.materials:null,p=a.precision,A=l.vertices,k=0,L=l.faces.length;L>k;k++){var P=l.faces[k],c=S===!0?C[P.materialIndex]:this.material;if(void 0!==c){if(h=A[P.a],u=A[P.b],f=A[P.c],c.morphTargets===!0){var F=l.morphTargets,N=this.morphTargetInfluences;n.set(0,0,0),i.set(0,0,0),o.set(0,0,0);for(var D=0,U=F.length;U>D;D++){var O=N[D];if(0!==O){var z=F[D].vertices;n.x+=(z[P.a].x-h.x)*O,n.y+=(z[P.a].y-h.y)*O,n.z+=(z[P.a].z-h.z)*O,i.x+=(z[P.b].x-u.x)*O,i.y+=(z[P.b].y-u.y)*O,i.z+=(z[P.b].z-u.z)*O,o.x+=(z[P.c].x-f.x)*O,o.y+=(z[P.c].y-f.y)*O,o.z+=(z[P.c].z-f.z)*O}}n.add(h),i.add(u),o.add(f),h=n,u=i,f=o}if(c.side===THREE.BackSide)var _=t.intersectTriangle(f,u,h,!0);else var _=t.intersectTriangle(h,u,f,c.side!==THREE.DoubleSide);if(null!==_){_.applyMatrix4(this.matrixWorld);var H=a.ray.origin.distanceTo(_);p>H||H<a.near||H>a.far||s.push({distance:H,point:_,face:P,faceIndex:k,object:this})}}}}}(),THREE.Mesh.prototype.clone=function(e,t){return void 0===e&&(e=new THREE.Mesh(this.geometry,this.material)),THREE.Object3D.prototype.clone.call(this,e,t),e},THREE.Bone=function(e){THREE.Object3D.call(this),this.skin=e,this.accumulatedRotWeight=0,this.accumulatedPosWeight=0,this.accumulatedSclWeight=0},THREE.Bone.prototype=Object.create(THREE.Object3D.prototype),THREE.Bone.prototype.updateMatrixWorld=function(e){THREE.Object3D.prototype.updateMatrixWorld.call(this,e),this.accumulatedRotWeight=0,this.accumulatedPosWeight=0,this.accumulatedSclWeight=0},THREE.Skeleton=function(e,t,r){if(this.useVertexTexture=void 0!==r?r:!0,this.identityMatrix=new THREE.Matrix4,e=e||[],this.bones=e.slice(0),this.useVertexTexture){var n;n=this.bones.length>256?64:this.bones.length>64?32:this.bones.length>16?16:8,this.boneTextureWidth=n,this.boneTextureHeight=n,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new THREE.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,THREE.RGBAFormat,THREE.FloatType),this.boneTexture.minFilter=THREE.NearestFilter,this.boneTexture.magFilter=THREE.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1}else this.boneMatrices=new Float32Array(16*this.bones.length);if(void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton bonInverses is the wrong length."),this.boneInverses=[];for(var i=0,o=this.bones.length;o>i;i++)this.boneInverses.push(new THREE.Matrix4)}},THREE.Skeleton.prototype.calculateInverses=function(){this.boneInverses=[];for(var e=0,t=this.bones.length;t>e;e++){var r=new THREE.Matrix4;this.bones[e]&&r.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(r)}},THREE.Skeleton.prototype.pose=function(){for(var e,t=0,r=this.bones.length;r>t;t++)e=this.bones[t],e&&e.matrixWorld.getInverse(this.boneInverses[t]);for(var t=0,r=this.bones.length;r>t;t++)e=this.bones[t],e&&(e.parent?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},THREE.Skeleton.prototype.update=function(){for(var e=new THREE.Matrix4,t=0,r=this.bones.length;r>t;t++){var n=this.bones[t]?this.bones[t].matrixWorld:this.identityMatrix;e.multiplyMatrices(n,this.boneInverses[t]),e.flattenToArrayOffset(this.boneMatrices,16*t)}this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)},THREE.SkinnedMesh=function(e,t,r){THREE.Mesh.call(this,e,t),this.bindMode="attached",this.bindMatrix=new THREE.Matrix4,this.bindMatrixInverse=new THREE.Matrix4;var n=[];if(this.geometry&&void 0!==this.geometry.bones){for(var i,o,a,s,l,c=0,h=this.geometry.bones.length;h>c;++c)o=this.geometry.bones[c],a=o.pos,s=o.rotq,l=o.scl,i=new THREE.Bone(this),n.push(i),i.name=o.name,i.position.set(a[0],a[1],a[2]),i.quaternion.set(s[0],s[1],s[2],s[3]),void 0!==l?i.scale.set(l[0],l[1],l[2]):i.scale.set(1,1,1);for(var c=0,h=this.geometry.bones.length;h>c;++c)o=this.geometry.bones[c],-1!==o.parent?n[o.parent].add(n[c]):this.add(n[c])}this.normalizeSkinWeights(),this.updateMatrixWorld(!0),this.bind(new THREE.Skeleton(n,void 0,r))},THREE.SkinnedMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.SkinnedMesh.prototype.bind=function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},THREE.SkinnedMesh.prototype.pose=function(){this.skeleton.pose()},THREE.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof THREE.Geometry)for(var e=0;e<this.geometry.skinIndices.length;e++){var t=this.geometry.skinWeights[e],r=1/t.lengthManhattan();1/0!==r?t.multiplyScalar(r):t.set(1)}},THREE.SkinnedMesh.prototype.updateMatrixWorld=function(){THREE.Mesh.prototype.updateMatrixWorld.call(this,!0),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh unreckognized bindMode: "+this.bindMode)},THREE.SkinnedMesh.prototype.clone=function(e){return void 0===e&&(e=new THREE.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)),THREE.Mesh.prototype.clone.call(this,e),e},THREE.MorphAnimMesh=function(e,t){THREE.Mesh.call(this,e,t),this.duration=1e3,this.mirroredLoop=!1,this.time=0,this.lastKeyframe=0,this.currentKeyframe=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)},THREE.MorphAnimMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.MorphAnimMesh.prototype.setFrameRange=function(e,t){this.startKeyframe=e,this.endKeyframe=t,this.length=this.endKeyframe-this.startKeyframe+1},THREE.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},THREE.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},THREE.MorphAnimMesh.prototype.parseAnimations=function(){var e=this.geometry;e.animations||(e.animations={});for(var t,r=e.animations,n=/([a-z]+)_?(\d+)/,i=0,o=e.morphTargets.length;o>i;i++){var a=e.morphTargets[i],s=a.name.match(n);if(s&&s.length>1){{var l=s[1];s[2]}r[l]||(r[l]={start:1/0,end:-1/0});var c=r[l];i<c.start&&(c.start=i),i>c.end&&(c.end=i),t||(t=l)}}e.firstAnimation=t},THREE.MorphAnimMesh.prototype.setAnimationLabel=function(e,t,r){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[e]={start:t,end:r}},THREE.MorphAnimMesh.prototype.playAnimation=function(e,t){var r=this.geometry.animations[e];r?(this.setFrameRange(r.start,r.end),this.duration=1e3*((r.end-r.start)/t),this.time=0):console.warn("animation["+e+"] undefined")},THREE.MorphAnimMesh.prototype.updateAnimation=function(e){var t=this.duration/this.length;this.time+=this.direction*e,this.mirroredLoop?(this.time>this.duration||this.time<0)&&(this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),this.time<0&&(this.time=0,this.directionBackwards=!1)):(this.time=this.time%this.duration,this.time<0&&(this.time+=this.duration));var r=this.startKeyframe+THREE.Math.clamp(Math.floor(this.time/t),0,this.length-1);r!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[r]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=r);var n=this.time%t/t;this.directionBackwards&&(n=1-n),this.morphTargetInfluences[this.currentKeyframe]=n,this.morphTargetInfluences[this.lastKeyframe]=1-n},THREE.MorphAnimMesh.prototype.interpolateTargets=function(e,t,r){for(var n=this.morphTargetInfluences,i=0,o=n.length;o>i;i++)n[i]=0;e>-1&&(n[e]=1-r),t>-1&&(n[t]=r)},THREE.MorphAnimMesh.prototype.clone=function(e){return void 0===e&&(e=new THREE.MorphAnimMesh(this.geometry,this.material)),e.duration=this.duration,e.mirroredLoop=this.mirroredLoop,e.time=this.time,e.lastKeyframe=this.lastKeyframe,e.currentKeyframe=this.currentKeyframe,e.direction=this.direction,e.directionBackwards=this.directionBackwards,THREE.Mesh.prototype.clone.call(this,e),e},THREE.LOD=function(){THREE.Object3D.call(this),this.objects=[]},THREE.LOD.prototype=Object.create(THREE.Object3D.prototype),THREE.LOD.prototype.addLevel=function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var r=0;r<this.objects.length&&!(t<this.objects[r].distance);r++);this.objects.splice(r,0,{distance:t,object:e}),this.add(e)},THREE.LOD.prototype.getObjectForDistance=function(e){for(var t=1,r=this.objects.length;r>t&&!(e<this.objects[t].distance);t++);return this.objects[t-1].object},THREE.LOD.prototype.raycast=function(){var e=new THREE.Vector3;return function(t,r){e.setFromMatrixPosition(this.matrixWorld);var n=t.ray.origin.distanceTo(e);this.getObjectForDistance(n).raycast(t,r)}}(),THREE.LOD.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(r){if(this.objects.length>1){e.setFromMatrixPosition(r.matrixWorld),t.setFromMatrixPosition(this.matrixWorld);var n=e.distanceTo(t);this.objects[0].object.visible=!0;for(var i=1,o=this.objects.length;o>i&&n>=this.objects[i].distance;i++)this.objects[i-1].object.visible=!1,this.objects[i].object.visible=!0;for(;o>i;i++)this.objects[i].object.visible=!1}}}(),THREE.LOD.prototype.clone=function(e){void 0===e&&(e=new THREE.LOD),THREE.Object3D.prototype.clone.call(this,e);for(var t=0,r=this.objects.length;r>t;t++){var n=this.objects[t].object.clone();n.visible=0===t,e.addLevel(n,this.objects[t].distance)}return e},THREE.Sprite=function(){var e=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0]),t=new THREE.BufferGeometry;return t.addAttribute("position",new THREE.BufferAttribute(e,3)),function(e){THREE.Object3D.call(this),this.geometry=t,this.material=void 0!==e?e:new THREE.SpriteMaterial}}(),THREE.Sprite.prototype=Object.create(THREE.Object3D.prototype),THREE.Sprite.prototype.raycast=function(){var e=new THREE.Vector3;return function(t,r){e.setFromMatrixPosition(this.matrixWorld);var n=t.ray.distanceToPoint(e);n>this.scale.x||r.push({distance:n,point:this.position,face:null,object:this})}}(),THREE.Sprite.prototype.updateMatrix=function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},THREE.Sprite.prototype.clone=function(e){return void 0===e&&(e=new THREE.Sprite(this.material)),THREE.Object3D.prototype.clone.call(this,e),e},THREE.Particle=THREE.Sprite,THREE.Scene=function(){THREE.Object3D.call(this),this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,this.matrixAutoUpdate=!1,this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},THREE.Scene.prototype=Object.create(THREE.Object3D.prototype),THREE.Scene.prototype.__addObject=function(e){if(e instanceof THREE.Light)-1===this.__lights.indexOf(e)&&this.__lights.push(e),e.target&&void 0===e.target.parent&&this.add(e.target);else if(!(e instanceof THREE.Camera||e instanceof THREE.Bone)){this.__objectsAdded.push(e);var t=this.__objectsRemoved.indexOf(e);-1!==t&&this.__objectsRemoved.splice(t,1)}this.dispatchEvent({type:"objectAdded",object:e}),e.dispatchEvent({type:"addedToScene",scene:this});for(var r=0;r<e.children.length;r++)this.__addObject(e.children[r])},THREE.Scene.prototype.__removeObject=function(e){if(e instanceof THREE.Light){var t=this.__lights.indexOf(e);if(-1!==t&&this.__lights.splice(t,1),e.shadowCascadeArray)for(var r=0;r<e.shadowCascadeArray.length;r++)this.__removeObject(e.shadowCascadeArray[r])}else if(!(e instanceof THREE.Camera)){this.__objectsRemoved.push(e);var t=this.__objectsAdded.indexOf(e);-1!==t&&this.__objectsAdded.splice(t,1)}this.dispatchEvent({type:"objectRemoved",object:e}),e.dispatchEvent({type:"removedFromScene",scene:this});for(var n=0;n<e.children.length;n++)this.__removeObject(e.children[n])},THREE.Scene.prototype.clone=function(e){return void 0===e&&(e=new THREE.Scene),THREE.Object3D.prototype.clone.call(this,e),null!==this.fog&&(e.fog=this.fog.clone()),null!==this.overrideMaterial&&(e.overrideMaterial=this.overrideMaterial.clone()),e.autoUpdate=this.autoUpdate,e.matrixAutoUpdate=this.matrixAutoUpdate,e},THREE.Fog=function(e,t,r){this.name="",this.color=new THREE.Color(e),this.near=void 0!==t?t:1,this.far=void 0!==r?r:1e3},THREE.Fog.prototype.clone=function(){return new THREE.Fog(this.color.getHex(),this.near,this.far)},THREE.FogExp2=function(e,t){this.name="",this.color=new THREE.Color(e),this.density=void 0!==t?t:25e-5},THREE.FogExp2.prototype.clone=function(){return new THREE.FogExp2(this.color.getHex(),this.density)},THREE.CanvasRenderer=function(e){function t(){Et.setRGB(0,0,0),yt.setRGB(0,0,0),Tt.setRGB(0,0,0);for(var e=0,t=R.length;t>e;e++){var r=R[e],n=r.color;r instanceof THREE.AmbientLight?Et.add(n):r instanceof THREE.DirectionalLight?yt.add(n):r instanceof THREE.PointLight&&Tt.add(n)}}function r(e,t,r){for(var n=0,i=R.length;i>n;n++){var o=R[n];if(dt.copy(o.color),o instanceof THREE.DirectionalLight){var a=xt.setFromMatrixPosition(o.matrixWorld).normalize(),s=t.dot(a);if(0>=s)continue;s*=o.intensity,r.add(dt.multiplyScalar(s))}else if(o instanceof THREE.PointLight){var a=xt.setFromMatrixPosition(o.matrixWorld),s=t.dot(xt.subVectors(a,e).normalize());if(0>=s)continue;if(s*=0==o.distance?1:1-Math.min(e.distanceTo(a)/o.distance,1),0==s)continue;s*=o.intensity,r.add(dt.multiplyScalar(s))}}}function n(e,t,r){d(r.opacity),p(r.blending);var n=t.scale.x*q,i=t.scale.y*Y,o=.5*Math.sqrt(n*n+i*i);if(vt.min.set(e.x-o,e.y-o),vt.max.set(e.x+o,e.y+o),r instanceof THREE.SpriteMaterial){var a=r.map;if(null!==a&&void 0!==a.image){a.hasEventListener("update",c)===!1&&(a.image.width>0&&h(a),a.addEventListener("update",c));var s=pt[a.id];y(void 0!==s?s:"rgba( 0, 0, 0, 1 )");var l=a.image,u=l.width*a.offset.x,f=l.height*a.offset.y,m=l.width*a.repeat.x,g=l.height*a.repeat.y,v=n/m,T=i/g;J.save(),J.translate(e.x,e.y),0!==r.rotation&&J.rotate(r.rotation),J.translate(-n/2,-i/2),J.scale(v,T),J.translate(-u,-f),J.fillRect(u,f,m,g),J.restore()}else y(r.color.getStyle()),J.save(),J.translate(e.x,e.y),0!==r.rotation&&J.rotate(r.rotation),J.scale(n,-i),J.fillRect(-.5,-.5,1,1),J.restore()}else r instanceof THREE.SpriteCanvasMaterial&&(E(r.color.getStyle()),y(r.color.getStyle()),J.save(),J.translate(e.x,e.y),0!==r.rotation&&J.rotate(r.rotation),J.scale(n,i),r.program(J),J.restore())}function i(e,t,r,n){if(d(n.opacity),p(n.blending),J.beginPath(),J.moveTo(e.positionScreen.x,e.positionScreen.y),J.lineTo(t.positionScreen.x,t.positionScreen.y),n instanceof THREE.LineBasicMaterial){if(m(n.linewidth),g(n.linecap),v(n.linejoin),n.vertexColors!==THREE.VertexColors)E(n.color.getStyle());else{var i=r.vertexColors[0].getStyle(),o=r.vertexColors[1].getStyle();if(i===o)E(i);else{try{var a=J.createLinearGradient(e.positionScreen.x,e.positionScreen.y,t.positionScreen.x,t.positionScreen.y);a.addColorStop(0,i),a.addColorStop(1,o)}catch(s){a=i}E(a)}}J.stroke(),vt.expandByScalar(2*n.linewidth)}else n instanceof THREE.LineDashedMaterial&&(m(n.linewidth),g(n.linecap),v(n.linejoin),E(n.color.getStyle()),T([n.dashSize,n.gapSize]),J.stroke(),vt.expandByScalar(2*n.linewidth),T([]))}function o(e,t,n,i,o,c,h,f){B.info.render.vertices+=3,B.info.render.faces++,d(f.opacity),p(f.blending),C=e.positionScreen.x,A=e.positionScreen.y,k=t.positionScreen.x,L=t.positionScreen.y,P=n.positionScreen.x,F=n.positionScreen.y,a(C,A,k,L,P,F),(f instanceof THREE.MeshLambertMaterial||f instanceof THREE.MeshPhongMaterial)&&null===f.map?(ut.copy(f.color),ft.copy(f.emissive),f.vertexColors===THREE.FaceColors&&ut.multiply(h.color),ht.copy(Et),wt.copy(e.positionWorld).add(t.positionWorld).add(n.positionWorld).divideScalar(3),r(wt,h.normalModel,ht),ht.multiply(ut).add(ft),f.wireframe===!0?s(ht,f.wireframeLinewidth,f.wireframeLinecap,f.wireframeLinejoin):l(ht)):f instanceof THREE.MeshBasicMaterial||f instanceof THREE.MeshLambertMaterial||f instanceof THREE.MeshPhongMaterial?null!==f.map?f.map.mapping instanceof THREE.UVMapping&&(N=h.uvs,u(C,A,k,L,P,F,N[i].x,N[i].y,N[o].x,N[o].y,N[c].x,N[c].y,f.map)):null!==f.envMap?f.envMap.mapping instanceof THREE.SphericalReflectionMapping?(bt.copy(h.vertexNormalsModel[i]).applyMatrix3(Rt),D=.5*bt.x+.5,U=.5*bt.y+.5,bt.copy(h.vertexNormalsModel[o]).applyMatrix3(Rt),O=.5*bt.x+.5,z=.5*bt.y+.5,bt.copy(h.vertexNormalsModel[c]).applyMatrix3(Rt),I=.5*bt.x+.5,V=.5*bt.y+.5,u(C,A,k,L,P,F,D,U,O,z,I,V,f.envMap)):f.envMap.mapping instanceof THREE.SphericalRefractionMapping&&(bt.copy(h.vertexNormalsModel[i]).applyMatrix3(Rt),D=-.5*bt.x+.5,U=-.5*bt.y+.5,bt.copy(h.vertexNormalsModel[o]).applyMatrix3(Rt),O=-.5*bt.x+.5,z=-.5*bt.y+.5,bt.copy(h.vertexNormalsModel[c]).applyMatrix3(Rt),I=-.5*bt.x+.5,V=-.5*bt.y+.5,u(C,A,k,L,P,F,D,U,O,z,I,V,f.envMap)):(ht.copy(f.color),f.vertexColors===THREE.FaceColors&&ht.multiply(h.color),f.wireframe===!0?s(ht,f.wireframeLinewidth,f.wireframeLinecap,f.wireframeLinejoin):l(ht)):f instanceof THREE.MeshDepthMaterial?(ht.r=ht.g=ht.b=1-x(e.positionScreen.z*e.positionScreen.w,_.near,_.far),f.wireframe===!0?s(ht,f.wireframeLinewidth,f.wireframeLinecap,f.wireframeLinejoin):l(ht)):f instanceof THREE.MeshNormalMaterial?(bt.copy(h.normalModel).applyMatrix3(Rt),ht.setRGB(bt.x,bt.y,bt.z).multiplyScalar(.5).addScalar(.5),f.wireframe===!0?s(ht,f.wireframeLinewidth,f.wireframeLinecap,f.wireframeLinejoin):l(ht)):(ht.setRGB(1,1,1),f.wireframe===!0?s(ht,f.wireframeLinewidth,f.wireframeLinecap,f.wireframeLinejoin):l(ht))}function a(e,t,r,n,i,o){J.beginPath(),J.moveTo(e,t),J.lineTo(r,n),J.lineTo(i,o),J.closePath()}function s(e,t,r,n){m(t),g(r),v(n),E(e.getStyle()),J.stroke(),vt.expandByScalar(2*t)}function l(e){y(e.getStyle()),J.fill()}function c(e){h(e.target)}function h(e){if(!(e instanceof THREE.CompressedTexture)){var t=e.wrapS===THREE.RepeatWrapping,r=e.wrapT===THREE.RepeatWrapping,n=e.image,i=document.createElement("canvas");i.width=n.width,i.height=n.height;var o=i.getContext("2d");o.setTransform(1,0,0,-1,0,n.height),o.drawImage(n,0,0),pt[e.id]=J.createPattern(i,t===!0&&r===!0?"repeat":t===!0&&r===!1?"repeat-x":t===!1&&r===!0?"repeat-y":"no-repeat")}}function u(e,t,r,n,i,o,a,s,l,u,f,d,p){if(!(p instanceof THREE.DataTexture)){p.hasEventListener("update",c)===!1&&(void 0!==p.image&&p.image.width>0&&h(p),p.addEventListener("update",c));var m=pt[p.id];if(void 0===m)return y("rgba(0,0,0,1)"),void J.fill();y(m);var g,v,E,T,x,w,b,R,_=p.offset.x/p.repeat.x,H=p.offset.y/p.repeat.y,M=p.image.width*p.repeat.x,S=p.image.height*p.repeat.y;a=(a+_)*M,s=(s+H)*S,l=(l+_)*M,u=(u+H)*S,f=(f+_)*M,d=(d+H)*S,r-=e,n-=t,i-=e,o-=t,l-=a,u-=s,f-=a,d-=s,b=l*d-f*u,0!==b&&(R=1/b,g=(d*r-u*i)*R,v=(d*n-u*o)*R,E=(l*i-f*r)*R,T=(l*o-f*n)*R,x=e-g*a-E*s,w=t-v*a-T*s,J.save(),J.transform(g,v,E,T,x,w),J.fill(),J.restore())}}function f(e,t,r){var n,i=t.x-e.x,o=t.y-e.y,a=i*i+o*o;0!==a&&(n=r/Math.sqrt(a),i*=n,o*=n,t.x+=i,t.y+=o,e.x-=i,e.y-=o)}function d(e){rt!==e&&(J.globalAlpha=e,rt=e)}function p(e){nt!==e&&(e===THREE.NormalBlending?J.globalCompositeOperation="source-over":e===THREE.AdditiveBlending?J.globalCompositeOperation="lighter":e===THREE.SubtractiveBlending&&(J.globalCompositeOperation="darker"),nt=e)}function m(e){at!==e&&(J.lineWidth=e,at=e)}function g(e){st!==e&&(J.lineCap=e,st=e)}function v(e){lt!==e&&(J.lineJoin=e,lt=e)}function E(e){it!==e&&(J.strokeStyle=e,it=e)}function y(e){ot!==e&&(J.fillStyle=e,ot=e)}function T(e){ct.length!==e.length&&(J.setLineDash(e),ct=e)}console.log("THREE.CanvasRenderer",THREE.REVISION);var x=THREE.Math.smoothstep;e=e||{};var w,b,R,_,H,M,S,C,A,k,L,P,F,N,D,U,O,z,I,V,B=this,G=new THREE.Projector,j=void 0!==e.canvas?e.canvas:document.createElement("canvas"),W=j.width,X=j.height,q=Math.floor(W/2),Y=Math.floor(X/2),K=0,Q=0,Z=W,$=X,J=j.getContext("2d",{alpha:e.alpha===!0}),et=new THREE.Color(0),tt=0,rt=1,nt=0,it=null,ot=null,at=null,st=null,lt=null,ct=[],ht=(new THREE.RenderableVertex,new THREE.RenderableVertex,new THREE.Color),ut=(new THREE.Color,new THREE.Color,new THREE.Color,new THREE.Color,new THREE.Color),ft=new THREE.Color,dt=new THREE.Color,pt={},mt=new THREE.Box2,gt=new THREE.Box2,vt=new THREE.Box2,Et=new THREE.Color,yt=new THREE.Color,Tt=new THREE.Color,xt=new THREE.Vector3,wt=new THREE.Vector3,bt=new THREE.Vector3,Rt=new THREE.Matrix3;void 0===J.setLineDash&&(J.setLineDash=function(){}),this.domElement=j,this.devicePixelRatio=void 0!==e.devicePixelRatio?e.devicePixelRatio:void 0!==self.devicePixelRatio?self.devicePixelRatio:1,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.setSize=function(e,t,r){W=e*this.devicePixelRatio,X=t*this.devicePixelRatio,j.width=W,j.height=X,q=Math.floor(W/2),Y=Math.floor(X/2),r!==!1&&(j.style.width=e+"px",j.style.height=t+"px"),mt.min.set(-q,-Y),mt.max.set(q,Y),gt.min.set(-q,-Y),gt.max.set(q,Y),rt=1,nt=0,it=null,ot=null,at=null,st=null,lt=null,this.setViewport(0,0,e,t)},this.setViewport=function(e,t,r,n){K=e*this.devicePixelRatio,Q=t*this.devicePixelRatio,Z=r*this.devicePixelRatio,$=n*this.devicePixelRatio},this.setScissor=function(){},this.enableScissorTest=function(){},this.setClearColor=function(e,t){et.set(e),tt=void 0!==t?t:1,gt.min.set(-q,-Y),gt.max.set(q,Y)},this.setClearColorHex=function(e,t){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getClearColor=function(){return et},this.getClearAlpha=function(){return tt},this.getMaxAnisotropy=function(){return 0},this.clear=function(){gt.empty()===!1&&(gt.intersect(mt),gt.expandByScalar(2),gt.min.x=gt.min.x+q,gt.min.y=-gt.min.y+Y,gt.max.x=gt.max.x+q,gt.max.y=-gt.max.y+Y,1>tt&&J.clearRect(0|gt.min.x,0|gt.min.y,gt.max.x-gt.min.x|0,gt.max.y-gt.min.y|0),tt>0&&(p(THREE.NormalBlending),d(1),y("rgba("+Math.floor(255*et.r)+","+Math.floor(255*et.g)+","+Math.floor(255*et.b)+","+tt+")"),J.fillRect(0|gt.min.x,0|gt.min.y,gt.max.x-gt.min.x|0,gt.max.y-gt.min.y|0)),gt.makeEmpty())},this.clearColor=function(){},this.clearDepth=function(){},this.clearStencil=function(){},this.render=function(e,r){if(r instanceof THREE.Camera==!1)return void console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");
this.autoClear===!0&&this.clear(),B.info.render.vertices=0,B.info.render.faces=0,J.setTransform(Z/W,0,0,-$/X,K,X-Q),J.translate(q,Y),w=G.projectScene(e,r,this.sortObjects,this.sortElements),b=w.elements,R=w.lights,_=r,Rt.getNormalMatrix(r.matrixWorldInverse),t();for(var a=0,s=b.length;s>a;a++){var l=b[a],c=l.material;if(void 0!==c&&0!==c.opacity){if(vt.makeEmpty(),l instanceof THREE.RenderableSprite)H=l,H.x*=q,H.y*=Y,n(H,l,c);else if(l instanceof THREE.RenderableLine)H=l.v1,M=l.v2,H.positionScreen.x*=q,H.positionScreen.y*=Y,M.positionScreen.x*=q,M.positionScreen.y*=Y,vt.setFromPoints([H.positionScreen,M.positionScreen]),mt.isIntersectionBox(vt)===!0&&i(H,M,l,c);else if(l instanceof THREE.RenderableFace){if(H=l.v1,M=l.v2,S=l.v3,H.positionScreen.z<-1||H.positionScreen.z>1)continue;if(M.positionScreen.z<-1||M.positionScreen.z>1)continue;if(S.positionScreen.z<-1||S.positionScreen.z>1)continue;H.positionScreen.x*=q,H.positionScreen.y*=Y,M.positionScreen.x*=q,M.positionScreen.y*=Y,S.positionScreen.x*=q,S.positionScreen.y*=Y,c.overdraw>0&&(f(H.positionScreen,M.positionScreen,c.overdraw),f(M.positionScreen,S.positionScreen,c.overdraw),f(S.positionScreen,H.positionScreen,c.overdraw)),vt.setFromPoints([H.positionScreen,M.positionScreen,S.positionScreen]),mt.isIntersectionBox(vt)===!0&&o(H,M,S,0,1,2,l,c)}gt.union(vt)}}J.setTransform(1,0,0,1,0,0)}},THREE.ShaderChunk={},THREE.ShaderChunk.alphatest_fragment="#ifdef ALPHATEST\n\n	if ( gl_FragColor.a < ALPHATEST ) discard;\n\n#endif\n",THREE.ShaderChunk.lights_lambert_vertex="vLightFront = vec3( 0.0 );\n\n#ifdef DOUBLE_SIDED\n\n	vLightBack = vec3( 0.0 );\n\n#endif\n\ntransformedNormal = normalize( transformedNormal );\n\n#if MAX_DIR_LIGHTS > 0\n\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n	vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n	vec3 dirVector = normalize( lDirection.xyz );\n\n	float dotProduct = dot( transformedNormal, dirVector );\n	vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n	#ifdef DOUBLE_SIDED\n\n		vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n		#ifdef WRAP_AROUND\n\n			vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n		#endif\n\n	#endif\n\n	#ifdef WRAP_AROUND\n\n		vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n		directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n\n		#ifdef DOUBLE_SIDED\n\n			directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n\n		#endif\n\n	#endif\n\n	vLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n\n	#ifdef DOUBLE_SIDED\n\n		vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n\n	#endif\n\n}\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n		vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n		float lDistance = 1.0;\n		if ( pointLightDistance[ i ] > 0.0 )\n			lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\n\n		lVector = normalize( lVector );\n		float dotProduct = dot( transformedNormal, lVector );\n\n		vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n		#ifdef DOUBLE_SIDED\n\n			vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n			#ifdef WRAP_AROUND\n\n				vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n			#endif\n\n		#endif\n\n		#ifdef WRAP_AROUND\n\n			vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n			pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n\n			#ifdef DOUBLE_SIDED\n\n				pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n\n			#endif\n\n		#endif\n\n		vLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;\n\n		#ifdef DOUBLE_SIDED\n\n			vLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;\n\n		#endif\n\n	}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n		vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n		float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );\n\n		if ( spotEffect > spotLightAngleCos[ i ] ) {\n\n			spotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n			float lDistance = 1.0;\n			if ( spotLightDistance[ i ] > 0.0 )\n				lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\n\n			lVector = normalize( lVector );\n\n			float dotProduct = dot( transformedNormal, lVector );\n			vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n			#ifdef DOUBLE_SIDED\n\n				vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n				#ifdef WRAP_AROUND\n\n					vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n				#endif\n\n			#endif\n\n			#ifdef WRAP_AROUND\n\n				vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n				spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n\n				#ifdef DOUBLE_SIDED\n\n					spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n\n				#endif\n\n			#endif\n\n			vLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;\n\n			#ifdef DOUBLE_SIDED\n\n				vLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;\n\n			#endif\n\n		}\n\n	}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n		vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\n		vec3 lVector = normalize( lDirection.xyz );\n\n		float dotProduct = dot( transformedNormal, lVector );\n\n		float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n		float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\n\n		vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n		#ifdef DOUBLE_SIDED\n\n			vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n\n		#endif\n\n	}\n\n#endif\n\nvLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;\n\n#ifdef DOUBLE_SIDED\n\n	vLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;\n\n#endif",THREE.ShaderChunk.map_particle_pars_fragment="#ifdef USE_MAP\n\n	uniform sampler2D map;\n\n#endif",THREE.ShaderChunk.default_vertex="vec4 mvPosition;\n\n#ifdef USE_SKINNING\n\n	mvPosition = modelViewMatrix * skinned;\n\n#endif\n\n#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )\n\n	mvPosition = modelViewMatrix * vec4( morphed, 1.0 );\n\n#endif\n\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )\n\n	mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\n#endif\n\ngl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.map_pars_fragment="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n	varying vec2 vUv;\n\n#endif\n\n#ifdef USE_MAP\n\n	uniform sampler2D map;\n\n#endif",THREE.ShaderChunk.skinnormal_vertex="#ifdef USE_SKINNING\n\n	mat4 skinMatrix = mat4( 0.0 );\n	skinMatrix += skinWeight.x * boneMatX;\n	skinMatrix += skinWeight.y * boneMatY;\n	skinMatrix += skinWeight.z * boneMatZ;\n	skinMatrix += skinWeight.w * boneMatW;\n	skinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\n	#ifdef USE_MORPHNORMALS\n\n	vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\n\n	#else\n\n	vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\n\n	#endif\n\n#endif\n",THREE.ShaderChunk.logdepthbuf_pars_vertex="#ifdef USE_LOGDEPTHBUF\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		varying float vFragDepth;\n\n	#endif\n\n	uniform float logDepthBufFC;\n\n#endif",THREE.ShaderChunk.lightmap_pars_vertex="#ifdef USE_LIGHTMAP\n\n	varying vec2 vUv2;\n\n#endif",THREE.ShaderChunk.lights_phong_fragment="vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\n\n#ifdef DOUBLE_SIDED\n\n	normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\n#endif\n\n#ifdef USE_NORMALMAP\n\n	normal = perturbNormal2Arb( -vViewPosition, normal );\n\n#elif defined( USE_BUMPMAP )\n\n	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	vec3 pointDiffuse = vec3( 0.0 );\n	vec3 pointSpecular = vec3( 0.0 );\n\n	for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n		vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n		float lDistance = 1.0;\n		if ( pointLightDistance[ i ] > 0.0 )\n			lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\n\n		lVector = normalize( lVector );\n\n				// diffuse\n\n		float dotProduct = dot( normal, lVector );\n\n		#ifdef WRAP_AROUND\n\n			float pointDiffuseWeightFull = max( dotProduct, 0.0 );\n			float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n			vec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n\n		#else\n\n			float pointDiffuseWeight = max( dotProduct, 0.0 );\n\n		#endif\n\n		pointDiffuse += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;\n\n				// specular\n\n		vec3 pointHalfVector = normalize( lVector + viewPosition );\n		float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\n		float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n\n		float specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n		vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );\n		pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;\n\n	}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	vec3 spotDiffuse = vec3( 0.0 );\n	vec3 spotSpecular = vec3( 0.0 );\n\n	for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n		vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n		float lDistance = 1.0;\n		if ( spotLightDistance[ i ] > 0.0 )\n			lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\n\n		lVector = normalize( lVector );\n\n		float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\n\n		if ( spotEffect > spotLightAngleCos[ i ] ) {\n\n			spotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n					// diffuse\n\n			float dotProduct = dot( normal, lVector );\n\n			#ifdef WRAP_AROUND\n\n				float spotDiffuseWeightFull = max( dotProduct, 0.0 );\n				float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n				vec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n\n			#else\n\n				float spotDiffuseWeight = max( dotProduct, 0.0 );\n\n			#endif\n\n			spotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;\n\n					// specular\n\n			vec3 spotHalfVector = normalize( lVector + viewPosition );\n			float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\n			float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n\n			float specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n			vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, spotHalfVector ), 0.0 ), 5.0 );\n			spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\n\n		}\n\n	}\n\n#endif\n\n#if MAX_DIR_LIGHTS > 0\n\n	vec3 dirDiffuse = vec3( 0.0 );\n	vec3 dirSpecular = vec3( 0.0 );\n\n	for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n		vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n		vec3 dirVector = normalize( lDirection.xyz );\n\n				// diffuse\n\n		float dotProduct = dot( normal, dirVector );\n\n		#ifdef WRAP_AROUND\n\n			float dirDiffuseWeightFull = max( dotProduct, 0.0 );\n			float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n			vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n\n		#else\n\n			float dirDiffuseWeight = max( dotProduct, 0.0 );\n\n		#endif\n\n		dirDiffuse += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\n\n		// specular\n\n		vec3 dirHalfVector = normalize( dirVector + viewPosition );\n		float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\n		float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n\n		/*\n		// fresnel term from skin shader\n		const float F0 = 0.128;\n\n		float base = 1.0 - dot( viewPosition, dirHalfVector );\n		float exponential = pow( base, 5.0 );\n\n		float fresnel = exponential + F0 * ( 1.0 - exponential );\n		*/\n\n		/*\n		// fresnel term from fresnel shader\n		const float mFresnelBias = 0.08;\n		const float mFresnelScale = 0.3;\n		const float mFresnelPower = 5.0;\n\n		float fresnel = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( -viewPosition ), normal ), mFresnelPower );\n		*/\n\n		float specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n		// 		dirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization * fresnel;\n\n		vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );\n		dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n\n\n	}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	vec3 hemiDiffuse = vec3( 0.0 );\n	vec3 hemiSpecular = vec3( 0.0 );\n\n	for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n		vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\n		vec3 lVector = normalize( lDirection.xyz );\n\n		// diffuse\n\n		float dotProduct = dot( normal, lVector );\n		float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\n		vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n		hemiDiffuse += diffuse * hemiColor;\n\n		// specular (sky light)\n\n		vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\n		float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\n		float hemiSpecularWeightSky = specularStrength * max( pow( max( hemiDotNormalHalfSky, 0.0 ), shininess ), 0.0 );\n\n		// specular (ground light)\n\n		vec3 lVectorGround = -lVector;\n\n		vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\n		float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\n		float hemiSpecularWeightGround = specularStrength * max( pow( max( hemiDotNormalHalfGround, 0.0 ), shininess ), 0.0 );\n\n		float dotProductGround = dot( normal, lVectorGround );\n\n		float specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n		vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );\n		vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );\n		hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n\n	}\n\n#endif\n\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n\n#if MAX_DIR_LIGHTS > 0\n\n	totalDiffuse += dirDiffuse;\n	totalSpecular += dirSpecular;\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	totalDiffuse += hemiDiffuse;\n	totalSpecular += hemiSpecular;\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	totalDiffuse += pointDiffuse;\n	totalSpecular += pointSpecular;\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	totalDiffuse += spotDiffuse;\n	totalSpecular += spotSpecular;\n\n#endif\n\n#ifdef METAL\n\n	gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );\n\n#else\n\n	gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n\n#endif",THREE.ShaderChunk.fog_pars_fragment="#ifdef USE_FOG\n\n	uniform vec3 fogColor;\n\n	#ifdef FOG_EXP2\n\n		uniform float fogDensity;\n\n	#else\n\n		uniform float fogNear;\n		uniform float fogFar;\n	#endif\n\n#endif",THREE.ShaderChunk.morphnormal_vertex="#ifdef USE_MORPHNORMALS\n\n	vec3 morphedNormal = vec3( 0.0 );\n\n	morphedNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n	morphedNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n	morphedNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n	morphedNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n\n	morphedNormal += normal;\n\n#endif",THREE.ShaderChunk.envmap_pars_fragment="#ifdef USE_ENVMAP\n\n	uniform float reflectivity;\n	uniform samplerCube envMap;\n	uniform float flipEnvMap;\n	uniform int combine;\n\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\n		uniform bool useRefract;\n		uniform float refractionRatio;\n\n	#else\n\n		varying vec3 vReflect;\n\n	#endif\n\n#endif",THREE.ShaderChunk.logdepthbuf_fragment="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n	gl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n#endif",THREE.ShaderChunk.normalmap_pars_fragment="#ifdef USE_NORMALMAP\n\n	uniform sampler2D normalMap;\n	uniform vec2 normalScale;\n\n			// Per-Pixel Tangent Space Normal Mapping\n			// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\n		vec3 q0 = dFdx( eye_pos.xyz );\n		vec3 q1 = dFdy( eye_pos.xyz );\n		vec2 st0 = dFdx( vUv.st );\n		vec2 st1 = dFdy( vUv.st );\n\n		vec3 S = normalize( q0 * st1.t - q1 * st0.t );\n		vec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n		vec3 N = normalize( surf_norm );\n\n		vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n		mapN.xy = normalScale * mapN.xy;\n		mat3 tsn = mat3( S, T, N );\n		return normalize( tsn * mapN );\n\n	}\n\n#endif\n",THREE.ShaderChunk.lights_phong_pars_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n	varying vec3 vWorldPosition;\n\n#endif\n",THREE.ShaderChunk.lightmap_pars_fragment="#ifdef USE_LIGHTMAP\n\n	varying vec2 vUv2;\n	uniform sampler2D lightMap;\n\n#endif",THREE.ShaderChunk.shadowmap_vertex="#ifdef USE_SHADOWMAP\n\n	for( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n		vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n\n	}\n\n#endif",THREE.ShaderChunk.lights_phong_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n	vWorldPosition = worldPosition.xyz;\n\n#endif",THREE.ShaderChunk.map_fragment="#ifdef USE_MAP\n\n	vec4 texelColor = texture2D( map, vUv );\n\n	#ifdef GAMMA_INPUT\n\n		texelColor.xyz *= texelColor.xyz;\n\n	#endif\n\n	gl_FragColor = gl_FragColor * texelColor;\n\n#endif",THREE.ShaderChunk.lightmap_vertex="#ifdef USE_LIGHTMAP\n\n	vUv2 = uv2;\n\n#endif",THREE.ShaderChunk.map_particle_fragment="#ifdef USE_MAP\n\n	gl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );\n\n#endif",THREE.ShaderChunk.color_pars_fragment="#ifdef USE_COLOR\n\n	varying vec3 vColor;\n\n#endif\n",THREE.ShaderChunk.color_vertex="#ifdef USE_COLOR\n\n	#ifdef GAMMA_INPUT\n\n		vColor = color * color;\n\n	#else\n\n		vColor = color;\n\n	#endif\n\n#endif",THREE.ShaderChunk.skinning_vertex="#ifdef USE_SKINNING\n\n	#ifdef USE_MORPHTARGETS\n\n	vec4 skinVertex = bindMatrix * vec4( morphed, 1.0 );\n\n	#else\n\n	vec4 skinVertex = bindMatrix * vec4( position, 1.0 );\n\n	#endif\n\n	vec4 skinned = vec4( 0.0 );\n	skinned += boneMatX * skinVertex * skinWeight.x;\n	skinned += boneMatY * skinVertex * skinWeight.y;\n	skinned += boneMatZ * skinVertex * skinWeight.z;\n	skinned += boneMatW * skinVertex * skinWeight.w;\n	skinned  = bindMatrixInverse * skinned;\n\n#endif\n",THREE.ShaderChunk.envmap_pars_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\n\n	varying vec3 vReflect;\n\n	uniform float refractionRatio;\n	uniform bool useRefract;\n\n#endif\n",THREE.ShaderChunk.linear_to_gamma_fragment="#ifdef GAMMA_OUTPUT\n\n	gl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n\n#endif",THREE.ShaderChunk.color_pars_vertex="#ifdef USE_COLOR\n\n	varying vec3 vColor;\n\n#endif",THREE.ShaderChunk.lights_lambert_pars_vertex="uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 emissive;\n\nuniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#ifdef WRAP_AROUND\n\n	uniform vec3 wrapRGB;\n\n#endif\n",THREE.ShaderChunk.map_pars_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n	varying vec2 vUv;\n	uniform vec4 offsetRepeat;\n\n#endif\n",THREE.ShaderChunk.envmap_fragment="#ifdef USE_ENVMAP\n\n	vec3 reflectVec;\n\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\n		vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\n		// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\n		// Transforming Normal Vectors with the Inverse Transformation\n\n		vec3 worldNormal = normalize( vec3( vec4( normal, 0.0 ) * viewMatrix ) );\n\n		if ( useRefract ) {\n\n			reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\n		} else { \n\n			reflectVec = reflect( cameraToVertex, worldNormal );\n\n		}\n\n	#else\n\n		reflectVec = vReflect;\n\n	#endif\n\n	#ifdef DOUBLE_SIDED\n\n		float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n		vec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n	#else\n\n		vec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n	#endif\n\n	#ifdef GAMMA_INPUT\n\n		cubeColor.xyz *= cubeColor.xyz;\n\n	#endif\n\n	if ( combine == 1 ) {\n\n		gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );\n\n	} else if ( combine == 2 ) {\n\n		gl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;\n\n	} else {\n\n		gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );\n\n	}\n\n#endif",THREE.ShaderChunk.specularmap_pars_fragment="#ifdef USE_SPECULARMAP\n\n	uniform sampler2D specularMap;\n\n#endif",THREE.ShaderChunk.logdepthbuf_vertex="#ifdef USE_LOGDEPTHBUF\n\n	gl_Position.z = log2(max(1e-6, gl_Position.w + 1.0)) * logDepthBufFC;\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		vFragDepth = 1.0 + gl_Position.w;\n\n#else\n\n		gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n	#endif\n\n#endif",THREE.ShaderChunk.morphtarget_pars_vertex="#ifdef USE_MORPHTARGETS\n\n	#ifndef USE_MORPHNORMALS\n\n	uniform float morphTargetInfluences[ 8 ];\n\n	#else\n\n	uniform float morphTargetInfluences[ 4 ];\n\n	#endif\n\n#endif",THREE.ShaderChunk.specularmap_fragment="float specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n	vec4 texelSpecular = texture2D( specularMap, vUv );\n	specularStrength = texelSpecular.r;\n\n#else\n\n	specularStrength = 1.0;\n\n#endif",THREE.ShaderChunk.fog_fragment="#ifdef USE_FOG\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		float depth = gl_FragDepthEXT / gl_FragCoord.w;\n\n	#else\n\n		float depth = gl_FragCoord.z / gl_FragCoord.w;\n\n	#endif\n\n	#ifdef FOG_EXP2\n\n		const float LOG2 = 1.442695;\n		float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\n		fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n\n	#else\n\n		float fogFactor = smoothstep( fogNear, fogFar, depth );\n\n	#endif\n	\n	gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n\n#endif",THREE.ShaderChunk.bumpmap_pars_fragment="#ifdef USE_BUMPMAP\n\n	uniform sampler2D bumpMap;\n	uniform float bumpScale;\n\n			// Derivative maps - bump mapping unparametrized surfaces by Morten Mikkelsen\n			//	http://mmikkelsen3d.blogspot.sk/2011/07/derivative-maps.html\n\n			// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n	vec2 dHdxy_fwd() {\n\n		vec2 dSTdx = dFdx( vUv );\n		vec2 dSTdy = dFdy( vUv );\n\n		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n		return vec2( dBx, dBy );\n\n	}\n\n	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n		vec3 vSigmaX = dFdx( surf_pos );\n		vec3 vSigmaY = dFdy( surf_pos );\n		vec3 vN = surf_norm;		// normalized\n\n		vec3 R1 = cross( vSigmaY, vN );\n		vec3 R2 = cross( vN, vSigmaX );\n\n		float fDet = dot( vSigmaX, R1 );\n\n		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n		return normalize( abs( fDet ) * surf_norm - vGrad );\n\n	}\n\n#endif",THREE.ShaderChunk.defaultnormal_vertex="vec3 objectNormal;\n\n#ifdef USE_SKINNING\n\n	objectNormal = skinnedNormal.xyz;\n\n#endif\n\n#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )\n\n	objectNormal = morphedNormal;\n\n#endif\n\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )\n\n	objectNormal = normal;\n\n#endif\n\n#ifdef FLIP_SIDED\n\n	objectNormal = -objectNormal;\n\n#endif\n\nvec3 transformedNormal = normalMatrix * objectNormal;",THREE.ShaderChunk.lights_phong_pars_fragment="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\n	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n	varying vec3 vWorldPosition;\n\n#endif\n\n#ifdef WRAP_AROUND\n\n	uniform vec3 wrapRGB;\n\n#endif\n\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",THREE.ShaderChunk.skinbase_vertex="#ifdef USE_SKINNING\n\n	mat4 boneMatX = getBoneMatrix( skinIndex.x );\n	mat4 boneMatY = getBoneMatrix( skinIndex.y );\n	mat4 boneMatZ = getBoneMatrix( skinIndex.z );\n	mat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif",THREE.ShaderChunk.map_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n	vUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n\n#endif",THREE.ShaderChunk.lightmap_fragment="#ifdef USE_LIGHTMAP\n\n	gl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n\n#endif",THREE.ShaderChunk.shadowmap_pars_vertex="#ifdef USE_SHADOWMAP\n\n	varying vec4 vShadowCoord[ MAX_SHADOWS ];\n	uniform mat4 shadowMatrix[ MAX_SHADOWS ];\n\n#endif",THREE.ShaderChunk.color_fragment="#ifdef USE_COLOR\n\n	gl_FragColor = gl_FragColor * vec4( vColor, 1.0 );\n\n#endif",THREE.ShaderChunk.morphtarget_vertex="#ifdef USE_MORPHTARGETS\n\n	vec3 morphed = vec3( 0.0 );\n	morphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n	morphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n	morphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n	morphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\n	#ifndef USE_MORPHNORMALS\n\n	morphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n	morphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n	morphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n	morphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\n	#endif\n\n	morphed += position;\n\n#endif",THREE.ShaderChunk.envmap_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\n\n	vec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;\n	worldNormal = normalize( worldNormal );\n\n	vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n	if ( useRefract ) {\n\n		vReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n	} else {\n\n		vReflect = reflect( cameraToVertex, worldNormal );\n\n	}\n\n#endif",THREE.ShaderChunk.shadowmap_fragment="#ifdef USE_SHADOWMAP\n\n	#ifdef SHADOWMAP_DEBUG\n\n		vec3 frustumColors[3];\n		frustumColors[0] = vec3( 1.0, 0.5, 0.0 );\n		frustumColors[1] = vec3( 0.0, 1.0, 0.8 );\n		frustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n\n	#endif\n\n	#ifdef SHADOWMAP_CASCADE\n\n		int inFrustumCount = 0;\n\n	#endif\n\n	float fDepth;\n	vec3 shadowColor = vec3( 1.0 );\n\n	for( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n		vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\n\n				// if ( something && something ) breaks ATI OpenGL shader compiler\n				// if ( all( something, something ) ) using this instead\n\n		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n		bool inFrustum = all( inFrustumVec );\n\n				// don't shadow pixels outside of light frustum\n				// use just first frustum (for cascades)\n				// don't shadow pixels behind far plane of light frustum\n\n		#ifdef SHADOWMAP_CASCADE\n\n			inFrustumCount += int( inFrustum );\n			bvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n\n		#else\n\n			bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n		#endif\n\n		bool frustumTest = all( frustumTestVec );\n\n		if ( frustumTest ) {\n\n			shadowCoord.z += shadowBias[ i ];\n\n			#if defined( SHADOWMAP_TYPE_PCF )\n\n						// Percentage-close filtering\n						// (9 pixel kernel)\n						// http://fabiensanglard.net/shadowmappingPCF/\n\n				float shadow = 0.0;\n\n		/*\n						// nested loops breaks shader compiler / validator on some ATI cards when using OpenGL\n						// must enroll loop manually\n\n				for ( float y = -1.25; y <= 1.25; y += 1.25 )\n					for ( float x = -1.25; x <= 1.25; x += 1.25 ) {\n\n						vec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\n\n								// doesn't seem to produce any noticeable visual difference compared to simple texture2D lookup\n								//vec4 rgbaDepth = texture2DProj( shadowMap[ i ], vec4( vShadowCoord[ i ].w * ( vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy ), 0.05, vShadowCoord[ i ].w ) );\n\n						float fDepth = unpackDepth( rgbaDepth );\n\n						if ( fDepth < shadowCoord.z )\n							shadow += 1.0;\n\n				}\n\n				shadow /= 9.0;\n\n		*/\n\n				const float shadowDelta = 1.0 / 9.0;\n\n				float xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n				float yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n				float dx0 = -1.25 * xPixelOffset;\n				float dy0 = -1.25 * yPixelOffset;\n				float dx1 = 1.25 * xPixelOffset;\n				float dy1 = 1.25 * yPixelOffset;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n			#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n						// Percentage-close filtering\n						// (9 pixel kernel)\n						// http://fabiensanglard.net/shadowmappingPCF/\n\n				float shadow = 0.0;\n\n				float xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n				float yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n				float dx0 = -1.0 * xPixelOffset;\n				float dy0 = -1.0 * yPixelOffset;\n				float dx1 = 1.0 * xPixelOffset;\n				float dy1 = 1.0 * yPixelOffset;\n\n				mat3 shadowKernel;\n				mat3 depthKernel;\n\n				depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n				depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n				depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n				depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n				depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n				depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n				depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n				depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n				depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\n				vec3 shadowZ = vec3( shadowCoord.z );\n				shadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\n				shadowKernel[0] *= vec3(0.25);\n\n				shadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\n				shadowKernel[1] *= vec3(0.25);\n\n				shadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\n				shadowKernel[2] *= vec3(0.25);\n\n				vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\n\n				shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\n				shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\n\n				vec4 shadowValues;\n				shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\n				shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\n				shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\n				shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\n\n				shadow = dot( shadowValues, vec4( 1.0 ) );\n\n				shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n			#else\n\n				vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\n				float fDepth = unpackDepth( rgbaDepth );\n\n				if ( fDepth < shadowCoord.z )\n\n		// spot with multiple shadows is darker\n\n					shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n\n		// spot with multiple shadows has the same color as single shadow spot\n\n		// 					shadowColor = min( shadowColor, vec3( shadowDarkness[ i ] ) );\n\n			#endif\n\n		}\n\n\n		#ifdef SHADOWMAP_DEBUG\n\n			#ifdef SHADOWMAP_CASCADE\n\n				if ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];\n\n			#else\n\n				if ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];\n\n			#endif\n\n		#endif\n\n	}\n\n	#ifdef GAMMA_OUTPUT\n\n		shadowColor *= shadowColor;\n\n	#endif\n\n	gl_FragColor.xyz = gl_FragColor.xyz * shadowColor;\n\n#endif\n",THREE.ShaderChunk.worldpos_vertex="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\n	#ifdef USE_SKINNING\n\n		vec4 worldPosition = modelMatrix * skinned;\n\n	#endif\n\n	#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\n\n		vec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );\n\n	#endif\n\n	#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\n\n		vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\n	#endif\n\n#endif",THREE.ShaderChunk.shadowmap_pars_fragment="#ifdef USE_SHADOWMAP\n\n	uniform sampler2D shadowMap[ MAX_SHADOWS ];\n	uniform vec2 shadowMapSize[ MAX_SHADOWS ];\n\n	uniform float shadowDarkness[ MAX_SHADOWS ];\n	uniform float shadowBias[ MAX_SHADOWS ];\n\n	varying vec4 vShadowCoord[ MAX_SHADOWS ];\n\n	float unpackDepth( const in vec4 rgba_depth ) {\n\n		const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n		float depth = dot( rgba_depth, bit_shift );\n		return depth;\n\n	}\n\n#endif",THREE.ShaderChunk.skinning_pars_vertex="#ifdef USE_SKINNING\n\n	uniform mat4 bindMatrix;\n	uniform mat4 bindMatrixInverse;\n\n	#ifdef BONE_TEXTURE\n\n		uniform sampler2D boneTexture;\n		uniform int boneTextureWidth;\n		uniform int boneTextureHeight;\n\n		mat4 getBoneMatrix( const in float i ) {\n\n			float j = i * 4.0;\n			float x = mod( j, float( boneTextureWidth ) );\n			float y = floor( j / float( boneTextureWidth ) );\n\n			float dx = 1.0 / float( boneTextureWidth );\n			float dy = 1.0 / float( boneTextureHeight );\n\n			y = dy * ( y + 0.5 );\n\n			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n			mat4 bone = mat4( v1, v2, v3, v4 );\n\n			return bone;\n\n		}\n\n	#else\n\n		uniform mat4 boneGlobalMatrices[ MAX_BONES ];\n\n		mat4 getBoneMatrix( const in float i ) {\n\n			mat4 bone = boneGlobalMatrices[ int(i) ];\n			return bone;\n\n		}\n\n	#endif\n\n#endif\n",THREE.ShaderChunk.logdepthbuf_pars_fragment="#ifdef USE_LOGDEPTHBUF\n\n	uniform float logDepthBufFC;\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		#extension GL_EXT_frag_depth : enable\n		varying float vFragDepth;\n\n	#endif\n\n#endif",THREE.ShaderChunk.alphamap_fragment="#ifdef USE_ALPHAMAP\n\n	gl_FragColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n",THREE.ShaderChunk.alphamap_pars_fragment="#ifdef USE_ALPHAMAP\n\n	uniform sampler2D alphaMap;\n\n#endif\n",THREE.UniformsUtils={merge:function(e){var t,r,n,i={};
for(t=0;t<e.length;t++){n=this.clone(e[t]);for(r in n)i[r]=n[r]}return i},clone:function(e){var t,r,n,i={};for(t in e){i[t]={};for(r in e[t])n=e[t][r],i[t][r]=n instanceof THREE.Color||n instanceof THREE.Vector2||n instanceof THREE.Vector3||n instanceof THREE.Vector4||n instanceof THREE.Matrix4||n instanceof THREE.Texture?n.clone():n instanceof Array?n.slice():n}return i}},THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},alphaMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new THREE.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},THREE.ShaderLib={basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.shadowmap]),vertexShader:[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinbase_vertex,"	#ifdef USE_ENVMAP",THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"	#endif",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.alphamap_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	gl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphamap_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","#endif",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_lambert_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_lambert_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","#endif",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.alphamap_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	gl_FragColor = vec4( vec3( 1.0 ), opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphamap_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,"	#ifdef DOUBLE_SIDED","		if ( gl_FrontFacing )","			gl_FragColor.xyz *= vLightFront;","		else","			gl_FragColor.xyz *= vLightBack;","	#else","		gl_FragColor.xyz *= vLightFront;","	#endif",THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.bump,THREE.UniformsLib.normalmap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","varying vec3 vNormal;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_phong_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"	vNormal = normalize( transformedNormal );",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"	vViewPosition = -mvPosition.xyz;",THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_phong_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform vec3 ambient;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.alphamap_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_phong_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.bumpmap_pars_fragment,THREE.ShaderChunk.normalmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	gl_FragColor = vec4( vec3( 1.0 ), opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphamap_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.lights_phong_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.particle,THREE.UniformsLib.shadowmap]),vertexShader:["uniform float size;","uniform float scale;",THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","	#ifdef USE_SIZEATTENUATION","		gl_PointSize = size * ( scale / length( mvPosition.xyz ) );","	#else","		gl_PointSize = size;","	#endif","	gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	gl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},dashed:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"	vLineDistance = scale * lineDistance;","	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","	gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	if ( mod( vLineDistance, totalSize ) > dashSize ) {","		discard;","	}","	gl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:[THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;",THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {",THREE.ShaderChunk.logdepthbuf_fragment,"	#ifdef USE_LOGDEPTHBUF_EXT","		float depth = gl_FragDepthEXT / gl_FragCoord.w;","	#else","		float depth = gl_FragCoord.z / gl_FragCoord.w;","	#endif","	float color = 1.0 - smoothstep( mNear, mFar, depth );","	gl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","	vNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;",THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},normalmap:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new THREE.Vector2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},diffuse:{type:"c",value:new THREE.Color(16777215)},specular:{type:"c",value:new THREE.Color(1118481)},ambient:{type:"c",value:new THREE.Color(16777215)},shininess:{type:"f",value:30},opacity:{type:"f",value:1},useRefract:{type:"i",value:0},refractionRatio:{type:"f",value:.98},reflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new THREE.Vector2(0,0)},uRepeat:{type:"v2",value:new THREE.Vector2(1,1)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;","uniform bool enableDiffuse;","uniform bool enableSpecular;","uniform bool enableAO;","uniform bool enableReflection;","uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tAO;","uniform samplerCube tCube;","uniform vec2 uNormalScale;","uniform bool useRefract;","uniform float refractionRatio;","uniform float reflectivity;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","	uniform vec3 wrapRGB;","#endif","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {",THREE.ShaderChunk.logdepthbuf_fragment,"	gl_FragColor = vec4( vec3( 1.0 ), opacity );","	vec3 specularTex = vec3( 1.0 );","	vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;","	normalTex.xy *= uNormalScale;","	normalTex = normalize( normalTex );","	if( enableDiffuse ) {","		#ifdef GAMMA_INPUT","			vec4 texelColor = texture2D( tDiffuse, vUv );","			texelColor.xyz *= texelColor.xyz;","			gl_FragColor = gl_FragColor * texelColor;","		#else","			gl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );","		#endif","	}","	if( enableAO ) {","		#ifdef GAMMA_INPUT","			vec4 aoColor = texture2D( tAO, vUv );","			aoColor.xyz *= aoColor.xyz;","			gl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;","		#else","			gl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;","		#endif","	}",THREE.ShaderChunk.alphatest_fragment,"	if( enableSpecular )","		specularTex = texture2D( tSpecular, vUv ).xyz;","	mat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );","	vec3 finalNormal = tsb * normalTex;","	#ifdef FLIP_SIDED","		finalNormal = -finalNormal;","	#endif","	vec3 normal = normalize( finalNormal );","	vec3 viewPosition = normalize( vViewPosition );","	#if MAX_POINT_LIGHTS > 0","		vec3 pointDiffuse = vec3( 0.0 );","		vec3 pointSpecular = vec3( 0.0 );","		for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","			vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","			vec3 pointVector = lPosition.xyz + vViewPosition.xyz;","			float pointDistance = 1.0;","			if ( pointLightDistance[ i ] > 0.0 )","				pointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );","			pointVector = normalize( pointVector );","			#ifdef WRAP_AROUND","				float pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );","				float pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );","				vec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","			#else","				float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );","			#endif","			pointDiffuse += pointDistance * pointLightColor[ i ] * diffuse * pointDiffuseWeight;","			vec3 pointHalfVector = normalize( pointVector + viewPosition );","			float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","			float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, shininess ), 0.0 );","			float specularNormalization = ( shininess + 2.0 ) / 8.0;","			vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( pointVector, pointHalfVector ), 0.0 ), 5.0 );","			pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;","		}","	#endif","	#if MAX_SPOT_LIGHTS > 0","		vec3 spotDiffuse = vec3( 0.0 );","		vec3 spotSpecular = vec3( 0.0 );","		for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","			vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","			vec3 spotVector = lPosition.xyz + vViewPosition.xyz;","			float spotDistance = 1.0;","			if ( spotLightDistance[ i ] > 0.0 )","				spotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );","			spotVector = normalize( spotVector );","			float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","			if ( spotEffect > spotLightAngleCos[ i ] ) {","				spotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );","				#ifdef WRAP_AROUND","					float spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );","					float spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );","					vec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","				#else","					float spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );","				#endif","				spotDiffuse += spotDistance * spotLightColor[ i ] * diffuse * spotDiffuseWeight * spotEffect;","				vec3 spotHalfVector = normalize( spotVector + viewPosition );","				float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","				float spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, shininess ), 0.0 );","				float specularNormalization = ( shininess + 2.0 ) / 8.0;","				vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( spotVector, spotHalfVector ), 0.0 ), 5.0 );","				spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;","			}","		}","	#endif","	#if MAX_DIR_LIGHTS > 0","		vec3 dirDiffuse = vec3( 0.0 );","		vec3 dirSpecular = vec3( 0.0 );","		for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","			vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","			vec3 dirVector = normalize( lDirection.xyz );","			#ifdef WRAP_AROUND","				float directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );","				float directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );","				vec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );","			#else","				float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","			#endif","			dirDiffuse += directionalLightColor[ i ] * diffuse * dirDiffuseWeight;","			vec3 dirHalfVector = normalize( dirVector + viewPosition );","			float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","			float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, shininess ), 0.0 );","			float specularNormalization = ( shininess + 2.0 ) / 8.0;","			vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );","			dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","		}","	#endif","	#if MAX_HEMI_LIGHTS > 0","		vec3 hemiDiffuse = vec3( 0.0 );","		vec3 hemiSpecular = vec3( 0.0 );","		for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","			vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","			vec3 lVector = normalize( lDirection.xyz );","			float dotProduct = dot( normal, lVector );","			float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","			vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","			hemiDiffuse += diffuse * hemiColor;","			vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","			float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","			float hemiSpecularWeightSky = specularTex.r * max( pow( max( hemiDotNormalHalfSky, 0.0 ), shininess ), 0.0 );","			vec3 lVectorGround = -lVector;","			vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","			float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","			float hemiSpecularWeightGround = specularTex.r * max( pow( max( hemiDotNormalHalfGround, 0.0 ), shininess ), 0.0 );","			float dotProductGround = dot( normal, lVectorGround );","			float specularNormalization = ( shininess + 2.0 ) / 8.0;","			vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );","			vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );","			hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","		}","	#endif","	vec3 totalDiffuse = vec3( 0.0 );","	vec3 totalSpecular = vec3( 0.0 );","	#if MAX_DIR_LIGHTS > 0","		totalDiffuse += dirDiffuse;","		totalSpecular += dirSpecular;","	#endif","	#if MAX_HEMI_LIGHTS > 0","		totalDiffuse += hemiDiffuse;","		totalSpecular += hemiSpecular;","	#endif","	#if MAX_POINT_LIGHTS > 0","		totalDiffuse += pointDiffuse;","		totalSpecular += pointSpecular;","	#endif","	#if MAX_SPOT_LIGHTS > 0","		totalDiffuse += spotDiffuse;","		totalSpecular += spotSpecular;","	#endif","	#ifdef METAL","		gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient + totalSpecular );","	#else","		gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient ) + totalSpecular;","	#endif","	if ( enableReflection ) {","		vec3 vReflect;","		vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","		if ( useRefract ) {","			vReflect = refract( cameraToVertex, normal, refractionRatio );","		} else {","			vReflect = reflect( cameraToVertex, normal );","		}","		vec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","		#ifdef GAMMA_INPUT","			cubeColor.xyz *= cubeColor.xyz;","		#endif","		gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * reflectivity );","	}",THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uOffset;","uniform vec2 uRepeat;","uniform bool enableDisplacement;","#ifdef VERTEX_TEXTURES","	uniform sampler2D tDisplacement;","	uniform float uDisplacementScale;","	uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,"	#ifdef USE_SKINNING","		vNormal = normalize( normalMatrix * skinnedNormal.xyz );","		vec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );","		vTangent = normalize( normalMatrix * skinnedTangent.xyz );","	#else","		vNormal = normalize( normalMatrix * normal );","		vTangent = normalize( normalMatrix * tangent.xyz );","	#endif","	vBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );","	vUv = uv * uRepeat + uOffset;","	vec3 displacedPosition;","	#ifdef VERTEX_TEXTURES","		if ( enableDisplacement ) {","			vec3 dv = texture2D( tDisplacement, uv ).xyz;","			float df = uDisplacementScale * dv.x + uDisplacementBias;","			displacedPosition = position + normalize( normal ) * df;","		} else {","			#ifdef USE_SKINNING","				vec4 skinVertex = bindMatrix * vec4( position, 1.0 );","				vec4 skinned = vec4( 0.0 );","				skinned += boneMatX * skinVertex * skinWeight.x;","				skinned += boneMatY * skinVertex * skinWeight.y;","				skinned += boneMatZ * skinVertex * skinWeight.z;","				skinned += boneMatW * skinVertex * skinWeight.w;","				skinned  = bindMatrixInverse * skinned;","				displacedPosition = skinned.xyz;","			#else","				displacedPosition = position;","			#endif","		}","	#else","		#ifdef USE_SKINNING","			vec4 skinVertex = bindMatrix * vec4( position, 1.0 );","			vec4 skinned = vec4( 0.0 );","			skinned += boneMatX * skinVertex * skinWeight.x;","			skinned += boneMatY * skinVertex * skinWeight.y;","			skinned += boneMatZ * skinVertex * skinWeight.z;","			skinned += boneMatW * skinVertex * skinWeight.w;","			skinned  = bindMatrixInverse * skinned;","			displacedPosition = skinned.xyz;","		#else","			displacedPosition = position;","		#endif","	#endif","	vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","	vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","	gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.logdepthbuf_vertex,"	vWorldPosition = worldPosition.xyz;","	vViewPosition = -mvPosition.xyz;","	#ifdef USE_SHADOWMAP","		for( int i = 0; i < MAX_SHADOWS; i ++ ) {","			vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","		}","	#endif","}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","	vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","	vWorldPosition = worldPosition.xyz;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;",THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );",THREE.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:[THREE.ShaderChunk.logdepthbuf_pars_fragment,"vec4 pack_depth( const in float depth ) {","	const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","	const vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","	vec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );","	res -= res.xxyz * bit_mask;","	return res;","}","void main() {",THREE.ShaderChunk.logdepthbuf_fragment,"	#ifdef USE_LOGDEPTHBUF_EXT","		gl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );","	#else","		gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","	#endif","}"].join("\n")}},THREE.WebGLRenderer=function(e){function t(e){e.__webglVertexBuffer=Dt.createBuffer(),e.__webglColorBuffer=Dt.createBuffer(),jt.info.memory.geometries++}function r(e){e.__webglVertexBuffer=Dt.createBuffer(),e.__webglColorBuffer=Dt.createBuffer(),e.__webglLineDistanceBuffer=Dt.createBuffer(),jt.info.memory.geometries++}function n(e){e.__webglVertexBuffer=Dt.createBuffer(),e.__webglNormalBuffer=Dt.createBuffer(),e.__webglTangentBuffer=Dt.createBuffer(),e.__webglColorBuffer=Dt.createBuffer(),e.__webglUVBuffer=Dt.createBuffer(),e.__webglUV2Buffer=Dt.createBuffer(),e.__webglSkinIndicesBuffer=Dt.createBuffer(),e.__webglSkinWeightsBuffer=Dt.createBuffer(),e.__webglFaceBuffer=Dt.createBuffer(),e.__webglLineBuffer=Dt.createBuffer();var t,r;if(e.numMorphTargets)for(e.__webglMorphTargetsBuffers=[],t=0,r=e.numMorphTargets;r>t;t++)e.__webglMorphTargetsBuffers.push(Dt.createBuffer());if(e.numMorphNormals)for(e.__webglMorphNormalsBuffers=[],t=0,r=e.numMorphNormals;r>t;t++)e.__webglMorphNormalsBuffers.push(Dt.createBuffer());jt.info.memory.geometries++}function i(e,t){var r=e.vertices.length,n=t.material;if(n.attributes){void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]);for(var i in n.attributes){var o=n.attributes[i];if(!o.__webglInitialized||o.createUniqueBuffers){o.__webglInitialized=!0;var a=1;"v2"===o.type?a=2:"v3"===o.type?a=3:"v4"===o.type?a=4:"c"===o.type&&(a=3),o.size=a,o.array=new Float32Array(r*a),o.buffer=Dt.createBuffer(),o.buffer.belongsToAttribute=i,o.needsUpdate=!0}e.__webglCustomAttributesList.push(o)}}}function o(e,t){var r=e.vertices.length;e.__vertexArray=new Float32Array(3*r),e.__colorArray=new Float32Array(3*r),e.__sortArray=[],e.__webglParticleCount=r,i(e,t)}function a(e,t){var r=e.vertices.length;e.__vertexArray=new Float32Array(3*r),e.__colorArray=new Float32Array(3*r),e.__lineDistanceArray=new Float32Array(1*r),e.__webglLineCount=r,i(e,t)}function s(e,t){var r=t.geometry,n=e.faces3,i=3*n.length,o=1*n.length,a=3*n.length,s=l(t,e),c=f(s),d=h(s),p=u(s);e.__vertexArray=new Float32Array(3*i),d&&(e.__normalArray=new Float32Array(3*i)),r.hasTangents&&(e.__tangentArray=new Float32Array(4*i)),p&&(e.__colorArray=new Float32Array(3*i)),c&&(r.faceVertexUvs.length>0&&(e.__uvArray=new Float32Array(2*i)),r.faceVertexUvs.length>1&&(e.__uv2Array=new Float32Array(2*i))),t.geometry.skinWeights.length&&t.geometry.skinIndices.length&&(e.__skinIndexArray=new Float32Array(4*i),e.__skinWeightArray=new Float32Array(4*i));
var m=null!==Bt&&o>21845?Uint32Array:Uint16Array;e.__typeArray=m,e.__faceArray=new m(3*o),e.__lineArray=new m(2*a);var g,v;if(e.numMorphTargets)for(e.__morphTargetsArrays=[],g=0,v=e.numMorphTargets;v>g;g++)e.__morphTargetsArrays.push(new Float32Array(3*i));if(e.numMorphNormals)for(e.__morphNormalsArrays=[],g=0,v=e.numMorphNormals;v>g;g++)e.__morphNormalsArrays.push(new Float32Array(3*i));if(e.__webglFaceCount=3*o,e.__webglLineCount=2*a,s.attributes){void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]);for(var E in s.attributes){var y=s.attributes[E],T={};for(var x in y)T[x]=y[x];if(!T.__webglInitialized||T.createUniqueBuffers){T.__webglInitialized=!0;var w=1;"v2"===T.type?w=2:"v3"===T.type?w=3:"v4"===T.type?w=4:"c"===T.type&&(w=3),T.size=w,T.array=new Float32Array(i*w),T.buffer=Dt.createBuffer(),T.buffer.belongsToAttribute=E,y.needsUpdate=!0,T.__original=y}e.__webglCustomAttributesList.push(T)}}e.__inittedArrays=!0}function l(e,t){return e.material instanceof THREE.MeshFaceMaterial?e.material.materials[t.materialIndex]:e.material}function c(e){return e&&void 0!==e.shading&&e.shading===THREE.SmoothShading}function h(e){return e instanceof THREE.MeshBasicMaterial&&!e.envMap||e instanceof THREE.MeshDepthMaterial?!1:c(e)?THREE.SmoothShading:THREE.FlatShading}function u(e){return e.vertexColors?e.vertexColors:!1}function f(e){return e.map||e.lightMap||e.bumpMap||e.normalMap||e.specularMap||e.alphaMap||e instanceof THREE.ShaderMaterial?!0:!1}function d(e){for(var t in e.attributes){var r="index"===t?Dt.ELEMENT_ARRAY_BUFFER:Dt.ARRAY_BUFFER,n=e.attributes[t];n.buffer=Dt.createBuffer(),Dt.bindBuffer(r,n.buffer),Dt.bufferData(r,n.array,Dt.STATIC_DRAW)}}function p(e,t,r){var n,i,o,a,s,l,c,h,u,f,d,p,m=e.vertices,g=m.length,v=e.colors,E=v.length,y=e.__vertexArray,T=e.__colorArray,x=e.__sortArray,w=e.verticesNeedUpdate,b=(e.elementsNeedUpdate,e.colorsNeedUpdate),R=e.__webglCustomAttributesList;if(r.sortParticles){for(Tr.copy(yr),Tr.multiply(r.matrixWorld),n=0;g>n;n++)o=m[n],xr.copy(o),xr.applyProjection(Tr),x[n]=[xr.z,n];for(x.sort(_),n=0;g>n;n++)o=m[x[n][1]],a=3*n,y[a]=o.x,y[a+1]=o.y,y[a+2]=o.z;for(i=0;E>i;i++)a=3*i,l=v[x[i][1]],T[a]=l.r,T[a+1]=l.g,T[a+2]=l.b;if(R)for(c=0,h=R.length;h>c;c++)if(p=R[c],void 0===p.boundTo||"vertices"===p.boundTo)if(a=0,f=p.value.length,1===p.size)for(u=0;f>u;u++)s=x[u][1],p.array[u]=p.value[s];else if(2===p.size)for(u=0;f>u;u++)s=x[u][1],d=p.value[s],p.array[a]=d.x,p.array[a+1]=d.y,a+=2;else if(3===p.size)if("c"===p.type)for(u=0;f>u;u++)s=x[u][1],d=p.value[s],p.array[a]=d.r,p.array[a+1]=d.g,p.array[a+2]=d.b,a+=3;else for(u=0;f>u;u++)s=x[u][1],d=p.value[s],p.array[a]=d.x,p.array[a+1]=d.y,p.array[a+2]=d.z,a+=3;else if(4===p.size)for(u=0;f>u;u++)s=x[u][1],d=p.value[s],p.array[a]=d.x,p.array[a+1]=d.y,p.array[a+2]=d.z,p.array[a+3]=d.w,a+=4}else{if(w)for(n=0;g>n;n++)o=m[n],a=3*n,y[a]=o.x,y[a+1]=o.y,y[a+2]=o.z;if(b)for(i=0;E>i;i++)l=v[i],a=3*i,T[a]=l.r,T[a+1]=l.g,T[a+2]=l.b;if(R)for(c=0,h=R.length;h>c;c++)if(p=R[c],p.needsUpdate&&(void 0===p.boundTo||"vertices"===p.boundTo))if(f=p.value.length,a=0,1===p.size)for(u=0;f>u;u++)p.array[u]=p.value[u];else if(2===p.size)for(u=0;f>u;u++)d=p.value[u],p.array[a]=d.x,p.array[a+1]=d.y,a+=2;else if(3===p.size)if("c"===p.type)for(u=0;f>u;u++)d=p.value[u],p.array[a]=d.r,p.array[a+1]=d.g,p.array[a+2]=d.b,a+=3;else for(u=0;f>u;u++)d=p.value[u],p.array[a]=d.x,p.array[a+1]=d.y,p.array[a+2]=d.z,a+=3;else if(4===p.size)for(u=0;f>u;u++)d=p.value[u],p.array[a]=d.x,p.array[a+1]=d.y,p.array[a+2]=d.z,p.array[a+3]=d.w,a+=4}if((w||r.sortParticles)&&(Dt.bindBuffer(Dt.ARRAY_BUFFER,e.__webglVertexBuffer),Dt.bufferData(Dt.ARRAY_BUFFER,y,t)),(b||r.sortParticles)&&(Dt.bindBuffer(Dt.ARRAY_BUFFER,e.__webglColorBuffer),Dt.bufferData(Dt.ARRAY_BUFFER,T,t)),R)for(c=0,h=R.length;h>c;c++)p=R[c],(p.needsUpdate||r.sortParticles)&&(Dt.bindBuffer(Dt.ARRAY_BUFFER,p.buffer),Dt.bufferData(Dt.ARRAY_BUFFER,p.array,t))}function m(e,t){var r,n,i,o,a,s,l,c,h,u,f,d,p=e.vertices,m=e.colors,g=e.lineDistances,v=p.length,E=m.length,y=g.length,T=e.__vertexArray,x=e.__colorArray,w=e.__lineDistanceArray,b=e.verticesNeedUpdate,R=e.colorsNeedUpdate,_=e.lineDistancesNeedUpdate,H=e.__webglCustomAttributesList;if(b){for(r=0;v>r;r++)o=p[r],a=3*r,T[a]=o.x,T[a+1]=o.y,T[a+2]=o.z;Dt.bindBuffer(Dt.ARRAY_BUFFER,e.__webglVertexBuffer),Dt.bufferData(Dt.ARRAY_BUFFER,T,t)}if(R){for(n=0;E>n;n++)s=m[n],a=3*n,x[a]=s.r,x[a+1]=s.g,x[a+2]=s.b;Dt.bindBuffer(Dt.ARRAY_BUFFER,e.__webglColorBuffer),Dt.bufferData(Dt.ARRAY_BUFFER,x,t)}if(_){for(i=0;y>i;i++)w[i]=g[i];Dt.bindBuffer(Dt.ARRAY_BUFFER,e.__webglLineDistanceBuffer),Dt.bufferData(Dt.ARRAY_BUFFER,w,t)}if(H)for(l=0,c=H.length;c>l;l++)if(d=H[l],d.needsUpdate&&(void 0===d.boundTo||"vertices"===d.boundTo)){if(a=0,u=d.value.length,1===d.size)for(h=0;u>h;h++)d.array[h]=d.value[h];else if(2===d.size)for(h=0;u>h;h++)f=d.value[h],d.array[a]=f.x,d.array[a+1]=f.y,a+=2;else if(3===d.size)if("c"===d.type)for(h=0;u>h;h++)f=d.value[h],d.array[a]=f.r,d.array[a+1]=f.g,d.array[a+2]=f.b,a+=3;else for(h=0;u>h;h++)f=d.value[h],d.array[a]=f.x,d.array[a+1]=f.y,d.array[a+2]=f.z,a+=3;else if(4===d.size)for(h=0;u>h;h++)f=d.value[h],d.array[a]=f.x,d.array[a+1]=f.y,d.array[a+2]=f.z,d.array[a+3]=f.w,a+=4;Dt.bindBuffer(Dt.ARRAY_BUFFER,d.buffer),Dt.bufferData(Dt.ARRAY_BUFFER,d.array,t)}}function g(e,t,r,n,i){if(e.__inittedArrays){var o,a,s,l,c,d,p,m,g,v,E,y,T,x,w,b,R,_,H,M,S,C,A,k,L,P,F,N,D,U,O,z,I,V,B,G,j,W,X,q,Y,K,Q=h(i),Z=u(i),$=f(i),J=Q===THREE.SmoothShading,et=0,tt=0,rt=0,nt=0,it=0,ot=0,at=0,st=0,lt=0,ct=0,ht=0,ut=0,ft=0,dt=e.__vertexArray,pt=e.__uvArray,mt=e.__uv2Array,gt=e.__normalArray,vt=e.__tangentArray,Et=e.__colorArray,yt=e.__skinIndexArray,Tt=e.__skinWeightArray,xt=e.__morphTargetsArrays,wt=e.__morphNormalsArrays,bt=e.__webglCustomAttributesList,Rt=e.__faceArray,_t=e.__lineArray,Ht=t.geometry,Mt=Ht.verticesNeedUpdate,St=Ht.elementsNeedUpdate,Ct=Ht.uvsNeedUpdate,At=Ht.normalsNeedUpdate,kt=Ht.tangentsNeedUpdate,Lt=Ht.colorsNeedUpdate,Pt=Ht.morphTargetsNeedUpdate,Ft=Ht.vertices,Nt=e.faces3,Ut=Ht.faces,Ot=Ht.faceVertexUvs[0],zt=Ht.faceVertexUvs[1],It=(Ht.colors,Ht.skinIndices),Vt=Ht.skinWeights,Bt=Ht.morphTargets,Gt=Ht.morphNormals;if(Mt){for(o=0,a=Nt.length;a>o;o++)l=Ut[Nt[o]],y=Ft[l.a],T=Ft[l.b],x=Ft[l.c],dt[tt]=y.x,dt[tt+1]=y.y,dt[tt+2]=y.z,dt[tt+3]=T.x,dt[tt+4]=T.y,dt[tt+5]=T.z,dt[tt+6]=x.x,dt[tt+7]=x.y,dt[tt+8]=x.z,tt+=9;Dt.bindBuffer(Dt.ARRAY_BUFFER,e.__webglVertexBuffer),Dt.bufferData(Dt.ARRAY_BUFFER,dt,r)}if(Pt)for(B=0,G=Bt.length;G>B;B++){for(ht=0,o=0,a=Nt.length;a>o;o++)X=Nt[o],l=Ut[X],y=Bt[B].vertices[l.a],T=Bt[B].vertices[l.b],x=Bt[B].vertices[l.c],j=xt[B],j[ht]=y.x,j[ht+1]=y.y,j[ht+2]=y.z,j[ht+3]=T.x,j[ht+4]=T.y,j[ht+5]=T.z,j[ht+6]=x.x,j[ht+7]=x.y,j[ht+8]=x.z,i.morphNormals&&(J?(q=Gt[B].vertexNormals[X],_=q.a,H=q.b,M=q.c):(_=Gt[B].faceNormals[X],H=_,M=_),W=wt[B],W[ht]=_.x,W[ht+1]=_.y,W[ht+2]=_.z,W[ht+3]=H.x,W[ht+4]=H.y,W[ht+5]=H.z,W[ht+6]=M.x,W[ht+7]=M.y,W[ht+8]=M.z),ht+=9;Dt.bindBuffer(Dt.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[B]),Dt.bufferData(Dt.ARRAY_BUFFER,xt[B],r),i.morphNormals&&(Dt.bindBuffer(Dt.ARRAY_BUFFER,e.__webglMorphNormalsBuffers[B]),Dt.bufferData(Dt.ARRAY_BUFFER,wt[B],r))}if(Vt.length){for(o=0,a=Nt.length;a>o;o++)l=Ut[Nt[o]],k=Vt[l.a],L=Vt[l.b],P=Vt[l.c],Tt[ct]=k.x,Tt[ct+1]=k.y,Tt[ct+2]=k.z,Tt[ct+3]=k.w,Tt[ct+4]=L.x,Tt[ct+5]=L.y,Tt[ct+6]=L.z,Tt[ct+7]=L.w,Tt[ct+8]=P.x,Tt[ct+9]=P.y,Tt[ct+10]=P.z,Tt[ct+11]=P.w,F=It[l.a],N=It[l.b],D=It[l.c],yt[ct]=F.x,yt[ct+1]=F.y,yt[ct+2]=F.z,yt[ct+3]=F.w,yt[ct+4]=N.x,yt[ct+5]=N.y,yt[ct+6]=N.z,yt[ct+7]=N.w,yt[ct+8]=D.x,yt[ct+9]=D.y,yt[ct+10]=D.z,yt[ct+11]=D.w,ct+=12;ct>0&&(Dt.bindBuffer(Dt.ARRAY_BUFFER,e.__webglSkinIndicesBuffer),Dt.bufferData(Dt.ARRAY_BUFFER,yt,r),Dt.bindBuffer(Dt.ARRAY_BUFFER,e.__webglSkinWeightsBuffer),Dt.bufferData(Dt.ARRAY_BUFFER,Tt,r))}if(Lt&&Z){for(o=0,a=Nt.length;a>o;o++)l=Ut[Nt[o]],p=l.vertexColors,m=l.color,3===p.length&&Z===THREE.VertexColors?(S=p[0],C=p[1],A=p[2]):(S=m,C=m,A=m),Et[lt]=S.r,Et[lt+1]=S.g,Et[lt+2]=S.b,Et[lt+3]=C.r,Et[lt+4]=C.g,Et[lt+5]=C.b,Et[lt+6]=A.r,Et[lt+7]=A.g,Et[lt+8]=A.b,lt+=9;lt>0&&(Dt.bindBuffer(Dt.ARRAY_BUFFER,e.__webglColorBuffer),Dt.bufferData(Dt.ARRAY_BUFFER,Et,r))}if(kt&&Ht.hasTangents){for(o=0,a=Nt.length;a>o;o++)l=Ut[Nt[o]],g=l.vertexTangents,w=g[0],b=g[1],R=g[2],vt[at]=w.x,vt[at+1]=w.y,vt[at+2]=w.z,vt[at+3]=w.w,vt[at+4]=b.x,vt[at+5]=b.y,vt[at+6]=b.z,vt[at+7]=b.w,vt[at+8]=R.x,vt[at+9]=R.y,vt[at+10]=R.z,vt[at+11]=R.w,at+=12;Dt.bindBuffer(Dt.ARRAY_BUFFER,e.__webglTangentBuffer),Dt.bufferData(Dt.ARRAY_BUFFER,vt,r)}if(At&&Q){for(o=0,a=Nt.length;a>o;o++)if(l=Ut[Nt[o]],c=l.vertexNormals,d=l.normal,3===c.length&&J)for(U=0;3>U;U++)z=c[U],gt[ot]=z.x,gt[ot+1]=z.y,gt[ot+2]=z.z,ot+=3;else for(U=0;3>U;U++)gt[ot]=d.x,gt[ot+1]=d.y,gt[ot+2]=d.z,ot+=3;Dt.bindBuffer(Dt.ARRAY_BUFFER,e.__webglNormalBuffer),Dt.bufferData(Dt.ARRAY_BUFFER,gt,r)}if(Ct&&Ot&&$){for(o=0,a=Nt.length;a>o;o++)if(s=Nt[o],v=Ot[s],void 0!==v)for(U=0;3>U;U++)I=v[U],pt[rt]=I.x,pt[rt+1]=I.y,rt+=2;rt>0&&(Dt.bindBuffer(Dt.ARRAY_BUFFER,e.__webglUVBuffer),Dt.bufferData(Dt.ARRAY_BUFFER,pt,r))}if(Ct&&zt&&$){for(o=0,a=Nt.length;a>o;o++)if(s=Nt[o],E=zt[s],void 0!==E)for(U=0;3>U;U++)V=E[U],mt[nt]=V.x,mt[nt+1]=V.y,nt+=2;nt>0&&(Dt.bindBuffer(Dt.ARRAY_BUFFER,e.__webglUV2Buffer),Dt.bufferData(Dt.ARRAY_BUFFER,mt,r))}if(St){for(o=0,a=Nt.length;a>o;o++)Rt[it]=et,Rt[it+1]=et+1,Rt[it+2]=et+2,it+=3,_t[st]=et,_t[st+1]=et+1,_t[st+2]=et,_t[st+3]=et+2,_t[st+4]=et+1,_t[st+5]=et+2,st+=6,et+=3;Dt.bindBuffer(Dt.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer),Dt.bufferData(Dt.ELEMENT_ARRAY_BUFFER,Rt,r),Dt.bindBuffer(Dt.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer),Dt.bufferData(Dt.ELEMENT_ARRAY_BUFFER,_t,r)}if(bt)for(U=0,O=bt.length;O>U;U++)if(K=bt[U],K.__original.needsUpdate){if(ut=0,ft=0,1===K.size){if(void 0===K.boundTo||"vertices"===K.boundTo)for(o=0,a=Nt.length;a>o;o++)l=Ut[Nt[o]],K.array[ut]=K.value[l.a],K.array[ut+1]=K.value[l.b],K.array[ut+2]=K.value[l.c],ut+=3;else if("faces"===K.boundTo)for(o=0,a=Nt.length;a>o;o++)Y=K.value[Nt[o]],K.array[ut]=Y,K.array[ut+1]=Y,K.array[ut+2]=Y,ut+=3}else if(2===K.size){if(void 0===K.boundTo||"vertices"===K.boundTo)for(o=0,a=Nt.length;a>o;o++)l=Ut[Nt[o]],y=K.value[l.a],T=K.value[l.b],x=K.value[l.c],K.array[ut]=y.x,K.array[ut+1]=y.y,K.array[ut+2]=T.x,K.array[ut+3]=T.y,K.array[ut+4]=x.x,K.array[ut+5]=x.y,ut+=6;else if("faces"===K.boundTo)for(o=0,a=Nt.length;a>o;o++)Y=K.value[Nt[o]],y=Y,T=Y,x=Y,K.array[ut]=y.x,K.array[ut+1]=y.y,K.array[ut+2]=T.x,K.array[ut+3]=T.y,K.array[ut+4]=x.x,K.array[ut+5]=x.y,ut+=6}else if(3===K.size){var jt;if(jt="c"===K.type?["r","g","b"]:["x","y","z"],void 0===K.boundTo||"vertices"===K.boundTo)for(o=0,a=Nt.length;a>o;o++)l=Ut[Nt[o]],y=K.value[l.a],T=K.value[l.b],x=K.value[l.c],K.array[ut]=y[jt[0]],K.array[ut+1]=y[jt[1]],K.array[ut+2]=y[jt[2]],K.array[ut+3]=T[jt[0]],K.array[ut+4]=T[jt[1]],K.array[ut+5]=T[jt[2]],K.array[ut+6]=x[jt[0]],K.array[ut+7]=x[jt[1]],K.array[ut+8]=x[jt[2]],ut+=9;else if("faces"===K.boundTo)for(o=0,a=Nt.length;a>o;o++)Y=K.value[Nt[o]],y=Y,T=Y,x=Y,K.array[ut]=y[jt[0]],K.array[ut+1]=y[jt[1]],K.array[ut+2]=y[jt[2]],K.array[ut+3]=T[jt[0]],K.array[ut+4]=T[jt[1]],K.array[ut+5]=T[jt[2]],K.array[ut+6]=x[jt[0]],K.array[ut+7]=x[jt[1]],K.array[ut+8]=x[jt[2]],ut+=9;else if("faceVertices"===K.boundTo)for(o=0,a=Nt.length;a>o;o++)Y=K.value[Nt[o]],y=Y[0],T=Y[1],x=Y[2],K.array[ut]=y[jt[0]],K.array[ut+1]=y[jt[1]],K.array[ut+2]=y[jt[2]],K.array[ut+3]=T[jt[0]],K.array[ut+4]=T[jt[1]],K.array[ut+5]=T[jt[2]],K.array[ut+6]=x[jt[0]],K.array[ut+7]=x[jt[1]],K.array[ut+8]=x[jt[2]],ut+=9}else if(4===K.size)if(void 0===K.boundTo||"vertices"===K.boundTo)for(o=0,a=Nt.length;a>o;o++)l=Ut[Nt[o]],y=K.value[l.a],T=K.value[l.b],x=K.value[l.c],K.array[ut]=y.x,K.array[ut+1]=y.y,K.array[ut+2]=y.z,K.array[ut+3]=y.w,K.array[ut+4]=T.x,K.array[ut+5]=T.y,K.array[ut+6]=T.z,K.array[ut+7]=T.w,K.array[ut+8]=x.x,K.array[ut+9]=x.y,K.array[ut+10]=x.z,K.array[ut+11]=x.w,ut+=12;else if("faces"===K.boundTo)for(o=0,a=Nt.length;a>o;o++)Y=K.value[Nt[o]],y=Y,T=Y,x=Y,K.array[ut]=y.x,K.array[ut+1]=y.y,K.array[ut+2]=y.z,K.array[ut+3]=y.w,K.array[ut+4]=T.x,K.array[ut+5]=T.y,K.array[ut+6]=T.z,K.array[ut+7]=T.w,K.array[ut+8]=x.x,K.array[ut+9]=x.y,K.array[ut+10]=x.z,K.array[ut+11]=x.w,ut+=12;else if("faceVertices"===K.boundTo)for(o=0,a=Nt.length;a>o;o++)Y=K.value[Nt[o]],y=Y[0],T=Y[1],x=Y[2],K.array[ut]=y.x,K.array[ut+1]=y.y,K.array[ut+2]=y.z,K.array[ut+3]=y.w,K.array[ut+4]=T.x,K.array[ut+5]=T.y,K.array[ut+6]=T.z,K.array[ut+7]=T.w,K.array[ut+8]=x.x,K.array[ut+9]=x.y,K.array[ut+10]=x.z,K.array[ut+11]=x.w,ut+=12;Dt.bindBuffer(Dt.ARRAY_BUFFER,K.buffer),Dt.bufferData(Dt.ARRAY_BUFFER,K.array,r)}n&&(delete e.__inittedArrays,delete e.__colorArray,delete e.__normalArray,delete e.__tangentArray,delete e.__uvArray,delete e.__uv2Array,delete e.__faceArray,delete e.__vertexArray,delete e.__lineArray,delete e.__skinIndexArray,delete e.__skinWeightArray)}}function v(e,t){var r,n,i=e.attributes;for(r in i)n=i[r],n.needsUpdate&&("index"===r?(Dt.bindBuffer(Dt.ELEMENT_ARRAY_BUFFER,n.buffer),Dt.bufferData(Dt.ELEMENT_ARRAY_BUFFER,n.array,t)):(Dt.bindBuffer(Dt.ARRAY_BUFFER,n.buffer),Dt.bufferData(Dt.ARRAY_BUFFER,n.array,t)),n.needsUpdate=!1)}function E(e,t,r,n){for(var i in t){var o=t[i],a=r[i];if(o>=0)if(a){var s=a.itemSize;Dt.bindBuffer(Dt.ARRAY_BUFFER,a.buffer),T(o),Dt.vertexAttribPointer(o,s,Dt.FLOAT,!1,0,n*s*4)}else e.defaultAttributeValues&&(2===e.defaultAttributeValues[i].length?Dt.vertexAttrib2fv(o,e.defaultAttributeValues[i]):3===e.defaultAttributeValues[i].length&&Dt.vertexAttrib3fv(o,e.defaultAttributeValues[i]))}x()}function y(){for(var e=0,t=gr.length;t>e;e++)gr[e]=0}function T(e){gr[e]=1,0===vr[e]&&(Dt.enableVertexAttribArray(e),vr[e]=1)}function x(){for(var e=0,t=vr.length;t>e;e++)vr[e]!==gr[e]&&(Dt.disableVertexAttribArray(e),vr[e]=0)}function w(e,t,r){var n=e.program.attributes;if(-1!==r.morphTargetBase&&n.position>=0?(Dt.bindBuffer(Dt.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[r.morphTargetBase]),T(n.position),Dt.vertexAttribPointer(n.position,3,Dt.FLOAT,!1,0,0)):n.position>=0&&(Dt.bindBuffer(Dt.ARRAY_BUFFER,t.__webglVertexBuffer),T(n.position),Dt.vertexAttribPointer(n.position,3,Dt.FLOAT,!1,0,0)),r.morphTargetForcedOrder.length)for(var i=0,o=r.morphTargetForcedOrder,a=r.morphTargetInfluences;i<e.numSupportedMorphTargets&&i<o.length;)n["morphTarget"+i]>=0&&(Dt.bindBuffer(Dt.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[o[i]]),T(n["morphTarget"+i]),Dt.vertexAttribPointer(n["morphTarget"+i],3,Dt.FLOAT,!1,0,0)),n["morphNormal"+i]>=0&&e.morphNormals&&(Dt.bindBuffer(Dt.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[o[i]]),T(n["morphNormal"+i]),Dt.vertexAttribPointer(n["morphNormal"+i],3,Dt.FLOAT,!1,0,0)),r.__webglMorphTargetInfluences[i]=a[o[i]],i++;else{var s,l,c=[],a=r.morphTargetInfluences,h=a.length;for(l=0;h>l;l++)s=a[l],s>0&&c.push([s,l]);c.length>e.numSupportedMorphTargets?(c.sort(_),c.length=e.numSupportedMorphTargets):c.length>e.numSupportedMorphNormals?c.sort(_):0===c.length&&c.push([0,0]);for(var u,i=0;i<e.numSupportedMorphTargets;)c[i]?(u=c[i][1],n["morphTarget"+i]>=0&&(Dt.bindBuffer(Dt.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[u]),T(n["morphTarget"+i]),Dt.vertexAttribPointer(n["morphTarget"+i],3,Dt.FLOAT,!1,0,0)),n["morphNormal"+i]>=0&&e.morphNormals&&(Dt.bindBuffer(Dt.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[u]),T(n["morphNormal"+i]),Dt.vertexAttribPointer(n["morphNormal"+i],3,Dt.FLOAT,!1,0,0)),r.__webglMorphTargetInfluences[i]=a[u]):r.__webglMorphTargetInfluences[i]=0,i++}null!==e.program.uniforms.morphTargetInfluences&&Dt.uniform1fv(e.program.uniforms.morphTargetInfluences,r.__webglMorphTargetInfluences)}function b(e,t){return e.z!==t.z?t.z-e.z:e.id-t.id}function R(e,t){return e.z!==t.z?e.z-t.z:e.id-t.id}function _(e,t){return t[0]-e[0]}function H(e,t,r){if(t.visible!==!1){var n=e.__webglObjects[t.id];if(n&&(t.frustumCulled===!1||Er.intersectsObject(t)===!0)){D(e,t);for(var i=0,o=n.length;o>i;i++){var a=n[i];k(a),a.render=!0,jt.sortObjects===!0&&(null!==t.renderDepth?a.z=t.renderDepth:(xr.setFromMatrixPosition(t.matrixWorld),xr.applyProjection(yr),a.z=xr.z))}}for(var i=0,o=t.children.length;o>i;i++)H(e,t.children[i],r)}}function M(e,t,r){if(0!==e.length)for(var n=0,i=e.length;i>n;n++)Xt=null,Qt=null,er=-1,ir=-1,or=-1,$t=-1,Jt=-1,Kt=-1,Yt=-1,br=!0,e[n].render(t,r,pr,mr),Xt=null,Qt=null,er=-1,ir=-1,or=-1,$t=-1,Jt=-1,Kt=-1,Yt=-1,br=!0}function S(e,t,r,n,i,o){for(var a,s,l,c,h=e.length-1;-1!==h;h--){if(a=e[h],s=a.object,l=a.buffer,rt(s,t),o)c=o;else{if(c=a.material,!c)continue;i&&jt.setBlending(c.blending,c.blendEquation,c.blendSrc,c.blendDst),jt.setDepthTest(c.depthTest),jt.setDepthWrite(c.depthWrite),st(c.polygonOffset,c.polygonOffsetFactor,c.polygonOffsetUnits)}jt.setMaterialFaces(c),l instanceof THREE.BufferGeometry?jt.renderBufferDirect(t,r,n,c,l,s):jt.renderBuffer(t,r,n,c,l,s)}}function C(e,t,r,n,i,o,a){for(var s,l,c,h=0,u=e.length;u>h;h++)if(s=e[h],l=s.object,l.visible){if(a)c=a;else{if(c=s[t],!c)continue;o&&jt.setBlending(c.blending,c.blendEquation,c.blendSrc,c.blendDst),jt.setDepthTest(c.depthTest),jt.setDepthWrite(c.depthWrite),st(c.polygonOffset,c.polygonOffsetFactor,c.polygonOffsetUnits)}jt.renderImmediateObject(r,n,i,c,l)}}function A(e){var t=e.object,r=t.material;r.transparent?(e.transparent=r,e.opaque=null):(e.opaque=r,e.transparent=null)}function k(e){var t=e.object,r=e.buffer,n=t.geometry,i=t.material;if(i instanceof THREE.MeshFaceMaterial){var o=n instanceof THREE.BufferGeometry?0:r.materialIndex;i=i.materials[o],i.transparent?(e.material=i,Nt.push(e)):(e.material=i,Ft.push(e))}else i&&(i.transparent?(e.material=i,Nt.push(e)):(e.material=i,Ft.push(e)))}function L(e,n){var i,s;if(void 0===e.__webglInit&&(e.__webglInit=!0,e._modelViewMatrix=new THREE.Matrix4,e._normalMatrix=new THREE.Matrix3),i=e.geometry,void 0===i||void 0===i.__webglInit&&(i.__webglInit=!0,i.addEventListener("dispose",Ur),i instanceof THREE.BufferGeometry?d(i):e instanceof THREE.Mesh?(void 0!==e.__webglActive&&z(e,n),P(n,e,i)):e instanceof THREE.Line?i.__webglVertexBuffer||(r(i),a(i,e),i.verticesNeedUpdate=!0,i.colorsNeedUpdate=!0,i.lineDistancesNeedUpdate=!0):e instanceof THREE.PointCloud&&(i.__webglVertexBuffer||(t(i),o(i,e),i.verticesNeedUpdate=!0,i.colorsNeedUpdate=!0))),void 0===e.__webglActive){if(e instanceof THREE.Mesh){if(i=e.geometry,i instanceof THREE.BufferGeometry)F(n.__webglObjects,i,e);else if(i instanceof THREE.Geometry)for(var l=0,c=i.geometryGroupsList.length;c>l;l++)s=i.geometryGroupsList[l],F(n.__webglObjects,s,e)}else e instanceof THREE.Line||e instanceof THREE.PointCloud?(i=e.geometry,F(n.__webglObjects,i,e)):(e instanceof THREE.ImmediateRenderObject||e.immediateRenderCallback)&&N(n.__webglObjectsImmediate,e);e.__webglActive=!0}}function P(e,t,r){var i,o,a=!1;o=t.material,(void 0===r.geometryGroups||r.groupsNeedUpdate)&&(delete e.__webglObjects[t.id],r.makeGroups(o instanceof THREE.MeshFaceMaterial,Bt?4294967296:65535),r.groupsNeedUpdate=!1);for(var l=0,c=r.geometryGroupsList.length;c>l;l++)i=r.geometryGroupsList[l],i.__webglVertexBuffer?a=!1:(n(i),s(i,t),r.verticesNeedUpdate=!0,r.morphTargetsNeedUpdate=!0,r.elementsNeedUpdate=!0,r.uvsNeedUpdate=!0,r.normalsNeedUpdate=!0,r.tangentsNeedUpdate=!0,r.colorsNeedUpdate=!0,a=!0),(a||void 0===t.__webglActive)&&F(e.__webglObjects,i,t);t.__webglActive=!0}function F(e,t,r){var n=r.id;e[n]=e[n]||[],e[n].push({id:n,buffer:t,object:r,material:null,z:0})}function N(e,t){e.push({id:null,object:t,opaque:null,transparent:null,z:0})}function D(e,t){var r,n,i,o=t.geometry;if(o instanceof THREE.BufferGeometry)v(o,Dt.DYNAMIC_DRAW);else if(t instanceof THREE.Mesh){(o.buffersNeedUpdate||o.groupsNeedUpdate)&&(o instanceof THREE.BufferGeometry?d(o):t instanceof THREE.Mesh&&P(e,t,o));for(var a=0,c=o.geometryGroupsList.length;c>a;a++)r=o.geometryGroupsList[a],i=l(t,r),(o.buffersNeedUpdate||o.groupsNeedUpdate)&&s(r,t),n=i.attributes&&U(i),(o.verticesNeedUpdate||o.morphTargetsNeedUpdate||o.elementsNeedUpdate||o.uvsNeedUpdate||o.normalsNeedUpdate||o.colorsNeedUpdate||o.tangentsNeedUpdate||n)&&g(r,t,Dt.DYNAMIC_DRAW,!o.dynamic,i);o.verticesNeedUpdate=!1,o.morphTargetsNeedUpdate=!1,o.elementsNeedUpdate=!1,o.uvsNeedUpdate=!1,o.normalsNeedUpdate=!1,o.colorsNeedUpdate=!1,o.tangentsNeedUpdate=!1,o.buffersNeedUpdate=!1,i.attributes&&O(i)}else t instanceof THREE.Line?(i=l(t,o),n=i.attributes&&U(i),(o.verticesNeedUpdate||o.colorsNeedUpdate||o.lineDistancesNeedUpdate||n)&&m(o,Dt.DYNAMIC_DRAW),o.verticesNeedUpdate=!1,o.colorsNeedUpdate=!1,o.lineDistancesNeedUpdate=!1,i.attributes&&O(i)):t instanceof THREE.PointCloud&&(i=l(t,o),n=i.attributes&&U(i),(o.verticesNeedUpdate||o.colorsNeedUpdate||t.sortParticles||n)&&p(o,Dt.DYNAMIC_DRAW,t),o.verticesNeedUpdate=!1,o.colorsNeedUpdate=!1,i.attributes&&O(i))}function U(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return!0;return!1}function O(e){for(var t in e.attributes)e.attributes[t].needsUpdate=!1}function z(e,t){e instanceof THREE.Mesh||e instanceof THREE.PointCloud||e instanceof THREE.Line?I(t.__webglObjects,e):(e instanceof THREE.ImmediateRenderObject||e.immediateRenderCallback)&&V(t.__webglObjectsImmediate,e),delete e.__webglActive}function I(e,t){delete e[t.id]}function V(e,t){for(var r=e.length-1;r>=0;r--)e[r].object===t&&e.splice(r,1)}function B(e,t,r,n,i){Zt=0,n.needsUpdate&&(n.program&&Wr(n),jt.initMaterial(n,t,r,i),n.needsUpdate=!1),n.morphTargets&&(i.__webglMorphTargetInfluences||(i.__webglMorphTargetInfluences=new Float32Array(jt.maxMorphTargets)));var o=!1,a=!1,s=!1,l=n.program,c=l.uniforms,h=n.__webglShader.uniforms;if(l.id!==Xt&&(Dt.useProgram(l.program),Xt=l.id,o=!0,a=!0,s=!0),n.id!==Yt&&(-1===Yt&&(s=!0),Yt=n.id,a=!0),(o||e!==Qt)&&(Dt.uniformMatrix4fv(c.projectionMatrix,!1,e.projectionMatrix.elements),kt&&Dt.uniform1f(c.logDepthBufFC,2/(Math.log(e.far+1)/Math.LN2)),e!==Qt&&(Qt=e),(n instanceof THREE.ShaderMaterial||n instanceof THREE.MeshPhongMaterial||n.envMap)&&null!==c.cameraPosition&&(xr.setFromMatrixPosition(e.matrixWorld),Dt.uniform3f(c.cameraPosition,xr.x,xr.y,xr.z)),(n instanceof THREE.MeshPhongMaterial||n instanceof THREE.MeshLambertMaterial||n instanceof THREE.ShaderMaterial||n.skinning)&&null!==c.viewMatrix&&Dt.uniformMatrix4fv(c.viewMatrix,!1,e.matrixWorldInverse.elements)),n.skinning)if(i.bindMatrix&&null!==c.bindMatrix&&Dt.uniformMatrix4fv(c.bindMatrix,!1,i.bindMatrix.elements),i.bindMatrixInverse&&null!==c.bindMatrixInverse&&Dt.uniformMatrix4fv(c.bindMatrixInverse,!1,i.bindMatrixInverse.elements),Ar&&i.skeleton&&i.skeleton.useVertexTexture){if(null!==c.boneTexture){var u=et();Dt.uniform1i(c.boneTexture,u),jt.setTexture(i.skeleton.boneTexture,u)}null!==c.boneTextureWidth&&Dt.uniform1i(c.boneTextureWidth,i.skeleton.boneTextureWidth),null!==c.boneTextureHeight&&Dt.uniform1i(c.boneTextureHeight,i.skeleton.boneTextureHeight)}else i.skeleton&&i.skeleton.boneMatrices&&null!==c.boneGlobalMatrices&&Dt.uniformMatrix4fv(c.boneGlobalMatrices,!1,i.skeleton.boneMatrices);return a&&(r&&n.fog&&q(h,r),(n instanceof THREE.MeshPhongMaterial||n instanceof THREE.MeshLambertMaterial||n.lights)&&(br&&(s=!0,ot(t),br=!1),s?(Q(h,Rr),Z(h,!0)):Z(h,!1)),(n instanceof THREE.MeshBasicMaterial||n instanceof THREE.MeshLambertMaterial||n instanceof THREE.MeshPhongMaterial)&&G(h,n),n instanceof THREE.LineBasicMaterial?j(h,n):n instanceof THREE.LineDashedMaterial?(j(h,n),W(h,n)):n instanceof THREE.PointCloudMaterial?X(h,n):n instanceof THREE.MeshPhongMaterial?Y(h,n):n instanceof THREE.MeshLambertMaterial?K(h,n):n instanceof THREE.MeshDepthMaterial?(h.mNear.value=e.near,h.mFar.value=e.far,h.opacity.value=n.opacity):n instanceof THREE.MeshNormalMaterial&&(h.opacity.value=n.opacity),i.receiveShadow&&!n._shadowPass&&$(h,t),tt(n.uniformsList)),J(c,i),null!==c.modelMatrix&&Dt.uniformMatrix4fv(c.modelMatrix,!1,i.matrixWorld.elements),l}function G(e,t){e.opacity.value=t.opacity,jt.gammaInput?e.diffuse.value.copyGammaToLinear(t.color):e.diffuse.value=t.color,e.map.value=t.map,e.lightMap.value=t.lightMap,e.specularMap.value=t.specularMap,e.alphaMap.value=t.alphaMap,t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale));var r;if(t.map?r=t.map:t.specularMap?r=t.specularMap:t.normalMap?r=t.normalMap:t.bumpMap?r=t.bumpMap:t.alphaMap&&(r=t.alphaMap),void 0!==r){var n=r.offset,i=r.repeat;e.offsetRepeat.value.set(n.x,n.y,i.x,i.y)}e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap instanceof THREE.WebGLRenderTargetCube?1:-1,e.reflectivity.value=jt.gammaInput?t.reflectivity:t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.combine.value=t.combine,e.useRefract.value=t.envMap&&t.envMap.mapping instanceof THREE.CubeRefractionMapping}function j(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}function W(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}function X(e,t){e.psColor.value=t.color,e.opacity.value=t.opacity,e.size.value=t.size,e.scale.value=wt.height/2,e.map.value=t.map}function q(e,t){e.fogColor.value=t.color,t instanceof THREE.Fog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t instanceof THREE.FogExp2&&(e.fogDensity.value=t.density)}function Y(e,t){e.shininess.value=t.shininess,jt.gammaInput?(e.ambient.value.copyGammaToLinear(t.ambient),e.emissive.value.copyGammaToLinear(t.emissive),e.specular.value.copyGammaToLinear(t.specular)):(e.ambient.value=t.ambient,e.emissive.value=t.emissive,e.specular.value=t.specular),t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}function K(e,t){jt.gammaInput?(e.ambient.value.copyGammaToLinear(t.ambient),e.emissive.value.copyGammaToLinear(t.emissive)):(e.ambient.value=t.ambient,e.emissive.value=t.emissive),t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}function Q(e,t){e.ambientLightColor.value=t.ambient,e.directionalLightColor.value=t.directional.colors,e.directionalLightDirection.value=t.directional.positions,e.pointLightColor.value=t.point.colors,e.pointLightPosition.value=t.point.positions,e.pointLightDistance.value=t.point.distances,e.spotLightColor.value=t.spot.colors,e.spotLightPosition.value=t.spot.positions,e.spotLightDistance.value=t.spot.distances,e.spotLightDirection.value=t.spot.directions,e.spotLightAngleCos.value=t.spot.anglesCos,e.spotLightExponent.value=t.spot.exponents,e.hemisphereLightSkyColor.value=t.hemi.skyColors,e.hemisphereLightGroundColor.value=t.hemi.groundColors,e.hemisphereLightDirection.value=t.hemi.positions}function Z(e,t){e.ambientLightColor.needsUpdate=t,e.directionalLightColor.needsUpdate=t,e.directionalLightDirection.needsUpdate=t,e.pointLightColor.needsUpdate=t,e.pointLightPosition.needsUpdate=t,e.pointLightDistance.needsUpdate=t,e.spotLightColor.needsUpdate=t,e.spotLightPosition.needsUpdate=t,e.spotLightDistance.needsUpdate=t,e.spotLightDirection.needsUpdate=t,e.spotLightAngleCos.needsUpdate=t,e.spotLightExponent.needsUpdate=t,e.hemisphereLightSkyColor.needsUpdate=t,e.hemisphereLightGroundColor.needsUpdate=t,e.hemisphereLightDirection.needsUpdate=t}function $(e,t){if(e.shadowMatrix)for(var r=0,n=0,i=t.length;i>n;n++){var o=t[n];o.castShadow&&(o instanceof THREE.SpotLight||o instanceof THREE.DirectionalLight&&!o.shadowCascade)&&(e.shadowMap.value[r]=o.shadowMap,e.shadowMapSize.value[r]=o.shadowMapSize,e.shadowMatrix.value[r]=o.shadowMatrix,e.shadowDarkness.value[r]=o.shadowDarkness,e.shadowBias.value[r]=o.shadowBias,r++)}}function J(e,t){Dt.uniformMatrix4fv(e.modelViewMatrix,!1,t._modelViewMatrix.elements),e.normalMatrix&&Dt.uniformMatrix3fv(e.normalMatrix,!1,t._normalMatrix.elements)}function et(){var e=Zt;return e>=_r&&console.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+_r),Zt+=1,e}function tt(e){for(var t,r,n,i=0,o=e.length;o>i;i++){var a=e[i][0];if(a.needsUpdate!==!1){var s=a.type,l=a.value,c=e[i][1];switch(s){case"1i":Dt.uniform1i(c,l);break;case"1f":Dt.uniform1f(c,l);break;case"2f":Dt.uniform2f(c,l[0],l[1]);break;case"3f":Dt.uniform3f(c,l[0],l[1],l[2]);break;case"4f":Dt.uniform4f(c,l[0],l[1],l[2],l[3]);break;case"1iv":Dt.uniform1iv(c,l);break;case"3iv":Dt.uniform3iv(c,l);break;case"1fv":Dt.uniform1fv(c,l);break;case"2fv":Dt.uniform2fv(c,l);break;case"3fv":Dt.uniform3fv(c,l);break;case"4fv":Dt.uniform4fv(c,l);break;case"Matrix3fv":Dt.uniformMatrix3fv(c,!1,l);break;case"Matrix4fv":Dt.uniformMatrix4fv(c,!1,l);break;case"i":Dt.uniform1i(c,l);break;case"f":Dt.uniform1f(c,l);break;case"v2":Dt.uniform2f(c,l.x,l.y);break;case"v3":Dt.uniform3f(c,l.x,l.y,l.z);break;case"v4":Dt.uniform4f(c,l.x,l.y,l.z,l.w);break;case"c":Dt.uniform3f(c,l.r,l.g,l.b);break;case"iv1":Dt.uniform1iv(c,l);break;case"iv":Dt.uniform3iv(c,l);break;case"fv1":Dt.uniform1fv(c,l);break;case"fv":Dt.uniform3fv(c,l);break;case"v2v":void 0===a._array&&(a._array=new Float32Array(2*l.length));for(var h=0,u=l.length;u>h;h++)n=2*h,a._array[n]=l[h].x,a._array[n+1]=l[h].y;Dt.uniform2fv(c,a._array);break;case"v3v":void 0===a._array&&(a._array=new Float32Array(3*l.length));for(var h=0,u=l.length;u>h;h++)n=3*h,a._array[n]=l[h].x,a._array[n+1]=l[h].y,a._array[n+2]=l[h].z;Dt.uniform3fv(c,a._array);break;case"v4v":void 0===a._array&&(a._array=new Float32Array(4*l.length));for(var h=0,u=l.length;u>h;h++)n=4*h,a._array[n]=l[h].x,a._array[n+1]=l[h].y,a._array[n+2]=l[h].z,a._array[n+3]=l[h].w;Dt.uniform4fv(c,a._array);break;case"m3":Dt.uniformMatrix3fv(c,!1,l.elements);break;case"m3v":void 0===a._array&&(a._array=new Float32Array(9*l.length));for(var h=0,u=l.length;u>h;h++)l[h].flattenToArrayOffset(a._array,9*h);Dt.uniformMatrix3fv(c,!1,a._array);break;case"m4":Dt.uniformMatrix4fv(c,!1,l.elements);break;case"m4v":void 0===a._array&&(a._array=new Float32Array(16*l.length));for(var h=0,u=l.length;u>h;h++)l[h].flattenToArrayOffset(a._array,16*h);Dt.uniformMatrix4fv(c,!1,a._array);break;case"t":if(t=l,r=et(),Dt.uniform1i(c,r),!t)continue;t instanceof THREE.CubeTexture||t.image instanceof Array&&6===t.image.length?ht(t,r):t instanceof THREE.WebGLRenderTargetCube?ut(t,r):jt.setTexture(t,r);break;case"tv":void 0===a._array&&(a._array=[]);for(var h=0,u=a.value.length;u>h;h++)a._array[h]=et();Dt.uniform1iv(c,a._array);for(var h=0,u=a.value.length;u>h;h++)t=a.value[h],r=a._array[h],t&&jt.setTexture(t,r);break;default:console.warn("THREE.WebGLRenderer: Unknown uniform type: "+s)}}}}function rt(e,t){e._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld),e._normalMatrix.getNormalMatrix(e._modelViewMatrix)}function nt(e,t,r,n){e[t]=r.r*r.r*n,e[t+1]=r.g*r.g*n,e[t+2]=r.b*r.b*n}function it(e,t,r,n){e[t]=r.r*n,e[t+1]=r.g*n,e[t+2]=r.b*n}function ot(e){var t,r,n,i,o,a,s,l,c,h=0,u=0,f=0,d=Rr,p=d.directional.colors,m=d.directional.positions,g=d.point.colors,v=d.point.positions,E=d.point.distances,y=d.spot.colors,T=d.spot.positions,x=d.spot.distances,w=d.spot.directions,b=d.spot.anglesCos,R=d.spot.exponents,_=d.hemi.skyColors,H=d.hemi.groundColors,M=d.hemi.positions,S=0,C=0,A=0,k=0,L=0,P=0,F=0,N=0,D=0,U=0,O=0,z=0;for(t=0,r=e.length;r>t;t++)if(n=e[t],!n.onlyShadow)if(i=n.color,s=n.intensity,c=n.distance,n instanceof THREE.AmbientLight){if(!n.visible)continue;jt.gammaInput?(h+=i.r*i.r,u+=i.g*i.g,f+=i.b*i.b):(h+=i.r,u+=i.g,f+=i.b)}else if(n instanceof THREE.DirectionalLight){if(L+=1,!n.visible)continue;wr.setFromMatrixPosition(n.matrixWorld),xr.setFromMatrixPosition(n.target.matrixWorld),wr.sub(xr),wr.normalize(),D=3*S,m[D]=wr.x,m[D+1]=wr.y,m[D+2]=wr.z,jt.gammaInput?nt(p,D,i,s*s):it(p,D,i,s),S+=1}else if(n instanceof THREE.PointLight){if(P+=1,!n.visible)continue;U=3*C,jt.gammaInput?nt(g,U,i,s*s):it(g,U,i,s),xr.setFromMatrixPosition(n.matrixWorld),v[U]=xr.x,v[U+1]=xr.y,v[U+2]=xr.z,E[C]=c,C+=1}else if(n instanceof THREE.SpotLight){if(F+=1,!n.visible)continue;O=3*A,jt.gammaInput?nt(y,O,i,s*s):it(y,O,i,s),xr.setFromMatrixPosition(n.matrixWorld),T[O]=xr.x,T[O+1]=xr.y,T[O+2]=xr.z,x[A]=c,wr.copy(xr),xr.setFromMatrixPosition(n.target.matrixWorld),wr.sub(xr),wr.normalize(),w[O]=wr.x,w[O+1]=wr.y,w[O+2]=wr.z,b[A]=Math.cos(n.angle),R[A]=n.exponent,A+=1}else if(n instanceof THREE.HemisphereLight){if(N+=1,!n.visible)continue;wr.setFromMatrixPosition(n.matrixWorld),wr.normalize(),z=3*k,M[z]=wr.x,M[z+1]=wr.y,M[z+2]=wr.z,o=n.color,a=n.groundColor,jt.gammaInput?(l=s*s,nt(_,z,o,l),nt(H,z,a,l)):(it(_,z,o,s),it(H,z,a,s)),k+=1
}for(t=3*S,r=Math.max(p.length,3*L);r>t;t++)p[t]=0;for(t=3*C,r=Math.max(g.length,3*P);r>t;t++)g[t]=0;for(t=3*A,r=Math.max(y.length,3*F);r>t;t++)y[t]=0;for(t=3*k,r=Math.max(_.length,3*N);r>t;t++)_[t]=0;for(t=3*k,r=Math.max(H.length,3*N);r>t;t++)H[t]=0;d.directional.length=S,d.point.length=C,d.spot.length=A,d.hemi.length=k,d.ambient[0]=h,d.ambient[1]=u,d.ambient[2]=f}function at(e){e!==cr&&(Dt.lineWidth(e),cr=e)}function st(e,t,r){ar!==e&&(e?Dt.enable(Dt.POLYGON_OFFSET_FILL):Dt.disable(Dt.POLYGON_OFFSET_FILL),ar=e),!e||sr===t&&lr===r||(Dt.polygonOffset(t,r),sr=t,lr=r)}function lt(e,t,r){r?(Dt.texParameteri(e,Dt.TEXTURE_WRAP_S,gt(t.wrapS)),Dt.texParameteri(e,Dt.TEXTURE_WRAP_T,gt(t.wrapT)),Dt.texParameteri(e,Dt.TEXTURE_MAG_FILTER,gt(t.magFilter)),Dt.texParameteri(e,Dt.TEXTURE_MIN_FILTER,gt(t.minFilter))):(Dt.texParameteri(e,Dt.TEXTURE_WRAP_S,Dt.CLAMP_TO_EDGE),Dt.texParameteri(e,Dt.TEXTURE_WRAP_T,Dt.CLAMP_TO_EDGE),Dt.texParameteri(e,Dt.TEXTURE_MAG_FILTER,mt(t.magFilter)),Dt.texParameteri(e,Dt.TEXTURE_MIN_FILTER,mt(t.minFilter))),It&&t.type!==THREE.FloatType&&(t.anisotropy>1||t.__oldAnisotropy)&&(Dt.texParameterf(e,It.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,Sr)),t.__oldAnisotropy=t.anisotropy)}function ct(e,t){if(e.width<=t&&e.height<=t)return e;var r=Math.max(e.width,e.height),n=Math.floor(e.width*t/r),i=Math.floor(e.height*t/r),o=document.createElement("canvas");o.width=n,o.height=i;var a=o.getContext("2d");return a.drawImage(e,0,0,e.width,e.height,0,0,n,i),o}function ht(e,t){if(6===e.image.length)if(e.needsUpdate){e.image.__webglTextureCube||(e.addEventListener("dispose",Or),e.image.__webglTextureCube=Dt.createTexture(),jt.info.memory.textures++),Dt.activeTexture(Dt.TEXTURE0+t),Dt.bindTexture(Dt.TEXTURE_CUBE_MAP,e.image.__webglTextureCube),Dt.pixelStorei(Dt.UNPACK_FLIP_Y_WEBGL,e.flipY);for(var r=e instanceof THREE.CompressedTexture,n=[],i=0;6>i;i++)n[i]=jt.autoScaleCubemaps&&!r?ct(e.image[i],Mr):e.image[i];var o=n[0],a=THREE.Math.isPowerOfTwo(o.width)&&THREE.Math.isPowerOfTwo(o.height),s=gt(e.format),l=gt(e.type);lt(Dt.TEXTURE_CUBE_MAP,e,a);for(var i=0;6>i;i++)if(r)for(var c,h=n[i].mipmaps,u=0,f=h.length;f>u;u++)c=h[u],e.format!==THREE.RGBAFormat?Dt.compressedTexImage2D(Dt.TEXTURE_CUBE_MAP_POSITIVE_X+i,u,s,c.width,c.height,0,c.data):Dt.texImage2D(Dt.TEXTURE_CUBE_MAP_POSITIVE_X+i,u,s,c.width,c.height,0,s,l,c.data);else Dt.texImage2D(Dt.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,s,s,l,n[i]);e.generateMipmaps&&a&&Dt.generateMipmap(Dt.TEXTURE_CUBE_MAP),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else Dt.activeTexture(Dt.TEXTURE0+t),Dt.bindTexture(Dt.TEXTURE_CUBE_MAP,e.image.__webglTextureCube)}function ut(e,t){Dt.activeTexture(Dt.TEXTURE0+t),Dt.bindTexture(Dt.TEXTURE_CUBE_MAP,e.__webglTexture)}function ft(e,t,r){Dt.bindFramebuffer(Dt.FRAMEBUFFER,e),Dt.framebufferTexture2D(Dt.FRAMEBUFFER,Dt.COLOR_ATTACHMENT0,r,t.__webglTexture,0)}function dt(e,t){Dt.bindRenderbuffer(Dt.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(Dt.renderbufferStorage(Dt.RENDERBUFFER,Dt.DEPTH_COMPONENT16,t.width,t.height),Dt.framebufferRenderbuffer(Dt.FRAMEBUFFER,Dt.DEPTH_ATTACHMENT,Dt.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(Dt.renderbufferStorage(Dt.RENDERBUFFER,Dt.DEPTH_STENCIL,t.width,t.height),Dt.framebufferRenderbuffer(Dt.FRAMEBUFFER,Dt.DEPTH_STENCIL_ATTACHMENT,Dt.RENDERBUFFER,e)):Dt.renderbufferStorage(Dt.RENDERBUFFER,Dt.RGBA4,t.width,t.height)}function pt(e){e instanceof THREE.WebGLRenderTargetCube?(Dt.bindTexture(Dt.TEXTURE_CUBE_MAP,e.__webglTexture),Dt.generateMipmap(Dt.TEXTURE_CUBE_MAP),Dt.bindTexture(Dt.TEXTURE_CUBE_MAP,null)):(Dt.bindTexture(Dt.TEXTURE_2D,e.__webglTexture),Dt.generateMipmap(Dt.TEXTURE_2D),Dt.bindTexture(Dt.TEXTURE_2D,null))}function mt(e){return e===THREE.NearestFilter||e===THREE.NearestMipMapNearestFilter||e===THREE.NearestMipMapLinearFilter?Dt.NEAREST:Dt.LINEAR}function gt(e){if(e===THREE.RepeatWrapping)return Dt.REPEAT;if(e===THREE.ClampToEdgeWrapping)return Dt.CLAMP_TO_EDGE;if(e===THREE.MirroredRepeatWrapping)return Dt.MIRRORED_REPEAT;if(e===THREE.NearestFilter)return Dt.NEAREST;if(e===THREE.NearestMipMapNearestFilter)return Dt.NEAREST_MIPMAP_NEAREST;if(e===THREE.NearestMipMapLinearFilter)return Dt.NEAREST_MIPMAP_LINEAR;if(e===THREE.LinearFilter)return Dt.LINEAR;if(e===THREE.LinearMipMapNearestFilter)return Dt.LINEAR_MIPMAP_NEAREST;if(e===THREE.LinearMipMapLinearFilter)return Dt.LINEAR_MIPMAP_LINEAR;if(e===THREE.UnsignedByteType)return Dt.UNSIGNED_BYTE;if(e===THREE.UnsignedShort4444Type)return Dt.UNSIGNED_SHORT_4_4_4_4;if(e===THREE.UnsignedShort5551Type)return Dt.UNSIGNED_SHORT_5_5_5_1;if(e===THREE.UnsignedShort565Type)return Dt.UNSIGNED_SHORT_5_6_5;if(e===THREE.ByteType)return Dt.BYTE;if(e===THREE.ShortType)return Dt.SHORT;if(e===THREE.UnsignedShortType)return Dt.UNSIGNED_SHORT;if(e===THREE.IntType)return Dt.INT;if(e===THREE.UnsignedIntType)return Dt.UNSIGNED_INT;if(e===THREE.FloatType)return Dt.FLOAT;if(e===THREE.AlphaFormat)return Dt.ALPHA;if(e===THREE.RGBFormat)return Dt.RGB;if(e===THREE.RGBAFormat)return Dt.RGBA;if(e===THREE.LuminanceFormat)return Dt.LUMINANCE;if(e===THREE.LuminanceAlphaFormat)return Dt.LUMINANCE_ALPHA;if(e===THREE.AddEquation)return Dt.FUNC_ADD;if(e===THREE.SubtractEquation)return Dt.FUNC_SUBTRACT;if(e===THREE.ReverseSubtractEquation)return Dt.FUNC_REVERSE_SUBTRACT;if(e===THREE.ZeroFactor)return Dt.ZERO;if(e===THREE.OneFactor)return Dt.ONE;if(e===THREE.SrcColorFactor)return Dt.SRC_COLOR;if(e===THREE.OneMinusSrcColorFactor)return Dt.ONE_MINUS_SRC_COLOR;if(e===THREE.SrcAlphaFactor)return Dt.SRC_ALPHA;if(e===THREE.OneMinusSrcAlphaFactor)return Dt.ONE_MINUS_SRC_ALPHA;if(e===THREE.DstAlphaFactor)return Dt.DST_ALPHA;if(e===THREE.OneMinusDstAlphaFactor)return Dt.ONE_MINUS_DST_ALPHA;if(e===THREE.DstColorFactor)return Dt.DST_COLOR;if(e===THREE.OneMinusDstColorFactor)return Dt.ONE_MINUS_DST_COLOR;if(e===THREE.SrcAlphaSaturateFactor)return Dt.SRC_ALPHA_SATURATE;if(void 0!==Vt){if(e===THREE.RGB_S3TC_DXT1_Format)return Vt.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT1_Format)return Vt.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT3_Format)return Vt.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===THREE.RGBA_S3TC_DXT5_Format)return Vt.COMPRESSED_RGBA_S3TC_DXT5_EXT}return 0}function vt(e){if(Ar&&e&&e.skeleton&&e.skeleton.useVertexTexture)return 1024;var t=Dt.getParameter(Dt.MAX_VERTEX_UNIFORM_VECTORS),r=Math.floor((t-20)/4),n=r;return void 0!==e&&e instanceof THREE.SkinnedMesh&&(n=Math.min(e.skeleton.bones.length,n),n<e.skeleton.bones.length&&console.warn("WebGLRenderer: too many bones - "+e.skeleton.bones.length+", this GPU supports just "+n+" (try OpenGL instead of ANGLE)")),n}function Et(e){for(var t=0,r=0,n=0,i=0,o=0,a=e.length;a>o;o++){var s=e[o];s.onlyShadow||s.visible===!1||(s instanceof THREE.DirectionalLight&&t++,s instanceof THREE.PointLight&&r++,s instanceof THREE.SpotLight&&n++,s instanceof THREE.HemisphereLight&&i++)}return{directional:t,point:r,spot:n,hemi:i}}function yt(e){for(var t=0,r=0,n=e.length;n>r;r++){var i=e[r];i.castShadow&&(i instanceof THREE.SpotLight&&t++,i instanceof THREE.DirectionalLight&&!i.shadowCascade&&t++)}return t}function Tt(){try{var e={alpha:_t,depth:Ht,stencil:Mt,antialias:St,premultipliedAlpha:Ct,preserveDrawingBuffer:At};if(Dt=bt||wt.getContext("webgl",e)||wt.getContext("experimental-webgl",e),null===Dt)throw"Error creating WebGL context."}catch(t){console.error(t)}Ut=Dt.getExtension("OES_texture_float"),Ot=Dt.getExtension("OES_texture_float_linear"),zt=Dt.getExtension("OES_standard_derivatives"),It=Dt.getExtension("EXT_texture_filter_anisotropic")||Dt.getExtension("MOZ_EXT_texture_filter_anisotropic")||Dt.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),Vt=Dt.getExtension("WEBGL_compressed_texture_s3tc")||Dt.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||Dt.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),Bt=Dt.getExtension("OES_element_index_uint"),null===Ut&&console.log("THREE.WebGLRenderer: Float textures not supported."),null===zt&&console.log("THREE.WebGLRenderer: Standard derivatives not supported."),null===It&&console.log("THREE.WebGLRenderer: Anisotropic texture filtering not supported."),null===Vt&&console.log("THREE.WebGLRenderer: S3TC compressed textures not supported."),null===Bt&&console.log("THREE.WebGLRenderer: elementindex as unsigned integer not supported."),void 0===Dt.getShaderPrecisionFormat&&(Dt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}),kt&&(Gt=Dt.getExtension("EXT_frag_depth"))}function xt(){Dt.clearColor(0,0,0,1),Dt.clearDepth(1),Dt.clearStencil(0),Dt.enable(Dt.DEPTH_TEST),Dt.depthFunc(Dt.LEQUAL),Dt.frontFace(Dt.CCW),Dt.cullFace(Dt.BACK),Dt.enable(Dt.CULL_FACE),Dt.enable(Dt.BLEND),Dt.blendEquation(Dt.FUNC_ADD),Dt.blendFunc(Dt.SRC_ALPHA,Dt.ONE_MINUS_SRC_ALPHA),Dt.viewport(hr,ur,fr,dr),Dt.clearColor(Lt.r,Lt.g,Lt.b,Pt)}console.log("THREE.WebGLRenderer",THREE.REVISION),e=e||{};var wt=void 0!==e.canvas?e.canvas:document.createElement("canvas"),bt=void 0!==e.context?e.context:null,Rt=void 0!==e.precision?e.precision:"highp",_t=void 0!==e.alpha?e.alpha:!1,Ht=void 0!==e.depth?e.depth:!0,Mt=void 0!==e.stencil?e.stencil:!0,St=void 0!==e.antialias?e.antialias:!1,Ct=void 0!==e.premultipliedAlpha?e.premultipliedAlpha:!0,At=void 0!==e.preserveDrawingBuffer?e.preserveDrawingBuffer:!1,kt=void 0!==e.logarithmicDepthBuffer?e.logarithmicDepthBuffer:!1,Lt=new THREE.Color(0),Pt=0,Ft=[],Nt=[];this.domElement=wt,this.context=null,this.devicePixelRatio=void 0!==e.devicePixelRatio?e.devicePixelRatio:void 0!==self.devicePixelRatio?self.devicePixelRatio:1,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.gammaInput=!1,this.gammaOutput=!1,this.shadowMapEnabled=!1,this.shadowMapAutoUpdate=!0,this.shadowMapType=THREE.PCFShadowMap,this.shadowMapCullFace=THREE.CullFaceFront,this.shadowMapDebug=!1,this.shadowMapCascade=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.renderPluginsPre=[],this.renderPluginsPost=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var Dt,Ut,Ot,zt,It,Vt,Bt,Gt,jt=this,Wt=[],Xt=null,qt=null,Yt=-1,Kt=null,Qt=null,Zt=0,$t=-1,Jt=-1,er=-1,tr=-1,rr=-1,nr=-1,ir=-1,or=-1,ar=null,sr=null,lr=null,cr=null,hr=0,ur=0,fr=wt.width,dr=wt.height,pr=0,mr=0,gr=new Uint8Array(16),vr=new Uint8Array(16),Er=new THREE.Frustum,yr=new THREE.Matrix4,Tr=new THREE.Matrix4,xr=new THREE.Vector3,wr=new THREE.Vector3,br=!0,Rr={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}};Tt(),xt(),this.context=Dt;var _r=Dt.getParameter(Dt.MAX_TEXTURE_IMAGE_UNITS),Hr=Dt.getParameter(Dt.MAX_VERTEX_TEXTURE_IMAGE_UNITS),Mr=(Dt.getParameter(Dt.MAX_TEXTURE_SIZE),Dt.getParameter(Dt.MAX_CUBE_MAP_TEXTURE_SIZE)),Sr=It?Dt.getParameter(It.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,Cr=Hr>0,Ar=Cr&&Ut,kr=(Vt?Dt.getParameter(Dt.COMPRESSED_TEXTURE_FORMATS):[],Dt.getShaderPrecisionFormat(Dt.VERTEX_SHADER,Dt.HIGH_FLOAT)),Lr=Dt.getShaderPrecisionFormat(Dt.VERTEX_SHADER,Dt.MEDIUM_FLOAT),Pr=(Dt.getShaderPrecisionFormat(Dt.VERTEX_SHADER,Dt.LOW_FLOAT),Dt.getShaderPrecisionFormat(Dt.FRAGMENT_SHADER,Dt.HIGH_FLOAT)),Fr=Dt.getShaderPrecisionFormat(Dt.FRAGMENT_SHADER,Dt.MEDIUM_FLOAT),Nr=(Dt.getShaderPrecisionFormat(Dt.FRAGMENT_SHADER,Dt.LOW_FLOAT),kr.precision>0&&Pr.precision>0),Dr=Lr.precision>0&&Fr.precision>0;"highp"!==Rt||Nr||(Dr?(Rt="mediump",console.warn("THREE.WebGLRenderer: highp not supported, using mediump.")):(Rt="lowp",console.warn("THREE.WebGLRenderer: highp and mediump not supported, using lowp."))),"mediump"!==Rt||Dr||(Rt="lowp",console.warn("THREE.WebGLRenderer: mediump not supported, using lowp.")),this.getContext=function(){return Dt},this.supportsVertexTextures=function(){return Cr},this.supportsFloatTextures=function(){return Ut},this.supportsStandardDerivatives=function(){return zt},this.supportsCompressedTextureS3TC=function(){return Vt},this.getMaxAnisotropy=function(){return Sr},this.getPrecision=function(){return Rt},this.setSize=function(e,t,r){wt.width=e*this.devicePixelRatio,wt.height=t*this.devicePixelRatio,r!==!1&&(wt.style.width=e+"px",wt.style.height=t+"px"),this.setViewport(0,0,e,t)},this.setViewport=function(e,t,r,n){hr=e*this.devicePixelRatio,ur=t*this.devicePixelRatio,fr=r*this.devicePixelRatio,dr=n*this.devicePixelRatio,Dt.viewport(hr,ur,fr,dr)},this.setScissor=function(e,t,r,n){Dt.scissor(e*this.devicePixelRatio,t*this.devicePixelRatio,r*this.devicePixelRatio,n*this.devicePixelRatio)},this.enableScissorTest=function(e){e?Dt.enable(Dt.SCISSOR_TEST):Dt.disable(Dt.SCISSOR_TEST)},this.setClearColor=function(e,t){Lt.set(e),Pt=void 0!==t?t:1,Dt.clearColor(Lt.r,Lt.g,Lt.b,Pt)},this.setClearColorHex=function(e,t){console.warn("THREE.WebGLRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getClearColor=function(){return Lt},this.getClearAlpha=function(){return Pt},this.clear=function(e,t,r){var n=0;(void 0===e||e)&&(n|=Dt.COLOR_BUFFER_BIT),(void 0===t||t)&&(n|=Dt.DEPTH_BUFFER_BIT),(void 0===r||r)&&(n|=Dt.STENCIL_BUFFER_BIT),Dt.clear(n)},this.clearColor=function(){Dt.clear(Dt.COLOR_BUFFER_BIT)},this.clearDepth=function(){Dt.clear(Dt.DEPTH_BUFFER_BIT)},this.clearStencil=function(){Dt.clear(Dt.STENCIL_BUFFER_BIT)},this.clearTarget=function(e,t,r,n){this.setRenderTarget(e),this.clear(t,r,n)},this.addPostPlugin=function(e){e.init(this),this.renderPluginsPost.push(e)},this.addPrePlugin=function(e){e.init(this),this.renderPluginsPre.push(e)},this.updateShadowMap=function(e,t){Xt=null,er=-1,ir=-1,or=-1,Kt=-1,Yt=-1,br=!0,$t=-1,Jt=-1,Xr(e),this.shadowMapPlugin.update(e,t)};var Ur=function(e){var t=e.target;t.removeEventListener("dispose",Ur),Br(t)},Or=function(e){var t=e.target;t.removeEventListener("dispose",Or),Gr(t),jt.info.memory.textures--},zr=function(e){var t=e.target;t.removeEventListener("dispose",zr),jr(t),jt.info.memory.textures--},Ir=function(e){var t=e.target;t.removeEventListener("dispose",Ir),Wr(t)},Vr=function(e){if(void 0!==e.__webglVertexBuffer&&Dt.deleteBuffer(e.__webglVertexBuffer),void 0!==e.__webglNormalBuffer&&Dt.deleteBuffer(e.__webglNormalBuffer),void 0!==e.__webglTangentBuffer&&Dt.deleteBuffer(e.__webglTangentBuffer),void 0!==e.__webglColorBuffer&&Dt.deleteBuffer(e.__webglColorBuffer),void 0!==e.__webglUVBuffer&&Dt.deleteBuffer(e.__webglUVBuffer),void 0!==e.__webglUV2Buffer&&Dt.deleteBuffer(e.__webglUV2Buffer),void 0!==e.__webglSkinIndicesBuffer&&Dt.deleteBuffer(e.__webglSkinIndicesBuffer),void 0!==e.__webglSkinWeightsBuffer&&Dt.deleteBuffer(e.__webglSkinWeightsBuffer),void 0!==e.__webglFaceBuffer&&Dt.deleteBuffer(e.__webglFaceBuffer),void 0!==e.__webglLineBuffer&&Dt.deleteBuffer(e.__webglLineBuffer),void 0!==e.__webglLineDistanceBuffer&&Dt.deleteBuffer(e.__webglLineDistanceBuffer),void 0!==e.__webglCustomAttributesList)for(var t in e.__webglCustomAttributesList)Dt.deleteBuffer(e.__webglCustomAttributesList[t].buffer);jt.info.memory.geometries--},Br=function(e){if(e.__webglInit=void 0,e instanceof THREE.BufferGeometry){var t=e.attributes;for(var r in t)void 0!==t[r].buffer&&Dt.deleteBuffer(t[r].buffer);jt.info.memory.geometries--}else if(void 0!==e.geometryGroups)for(var n=0,i=e.geometryGroupsList.length;i>n;n++){var o=e.geometryGroupsList[n];if(void 0!==o.numMorphTargets)for(var a=0,s=o.numMorphTargets;s>a;a++)Dt.deleteBuffer(o.__webglMorphTargetsBuffers[a]);if(void 0!==o.numMorphNormals)for(var a=0,s=o.numMorphNormals;s>a;a++)Dt.deleteBuffer(o.__webglMorphNormalsBuffers[a]);Vr(o)}else Vr(e)},Gr=function(e){if(e.image&&e.image.__webglTextureCube)Dt.deleteTexture(e.image.__webglTextureCube);else{if(!e.__webglInit)return;e.__webglInit=!1,Dt.deleteTexture(e.__webglTexture)}},jr=function(e){if(e&&e.__webglTexture)if(Dt.deleteTexture(e.__webglTexture),e instanceof THREE.WebGLRenderTargetCube)for(var t=0;6>t;t++)Dt.deleteFramebuffer(e.__webglFramebuffer[t]),Dt.deleteRenderbuffer(e.__webglRenderbuffer[t]);else Dt.deleteFramebuffer(e.__webglFramebuffer),Dt.deleteRenderbuffer(e.__webglRenderbuffer)},Wr=function(e){var t=e.program.program;if(void 0!==t){e.program=void 0;var r,n,i,o=!1;for(r=0,n=Wt.length;n>r;r++)if(i=Wt[r],i.program===t){i.usedTimes--,0===i.usedTimes&&(o=!0);break}if(o===!0){var a=[];for(r=0,n=Wt.length;n>r;r++)i=Wt[r],i.program!==t&&a.push(i);Wt=a,Dt.deleteProgram(t),jt.info.memory.programs--}}};this.renderBufferImmediate=function(e,t,r){if(y(),e.hasPositions&&!e.__webglVertexBuffer&&(e.__webglVertexBuffer=Dt.createBuffer()),e.hasNormals&&!e.__webglNormalBuffer&&(e.__webglNormalBuffer=Dt.createBuffer()),e.hasUvs&&!e.__webglUvBuffer&&(e.__webglUvBuffer=Dt.createBuffer()),e.hasColors&&!e.__webglColorBuffer&&(e.__webglColorBuffer=Dt.createBuffer()),e.hasPositions&&(Dt.bindBuffer(Dt.ARRAY_BUFFER,e.__webglVertexBuffer),Dt.bufferData(Dt.ARRAY_BUFFER,e.positionArray,Dt.DYNAMIC_DRAW),T(t.attributes.position),Dt.vertexAttribPointer(t.attributes.position,3,Dt.FLOAT,!1,0,0)),e.hasNormals){if(Dt.bindBuffer(Dt.ARRAY_BUFFER,e.__webglNormalBuffer),r.shading===THREE.FlatShading){var n,i,o,a,s,l,c,h,u,f,d,p,m,g,v=3*e.count;for(g=0;v>g;g+=9)m=e.normalArray,a=m[g],c=m[g+1],f=m[g+2],s=m[g+3],h=m[g+4],d=m[g+5],l=m[g+6],u=m[g+7],p=m[g+8],n=(a+s+l)/3,i=(c+h+u)/3,o=(f+d+p)/3,m[g]=n,m[g+1]=i,m[g+2]=o,m[g+3]=n,m[g+4]=i,m[g+5]=o,m[g+6]=n,m[g+7]=i,m[g+8]=o}Dt.bufferData(Dt.ARRAY_BUFFER,e.normalArray,Dt.DYNAMIC_DRAW),T(t.attributes.normal),Dt.vertexAttribPointer(t.attributes.normal,3,Dt.FLOAT,!1,0,0)}e.hasUvs&&r.map&&(Dt.bindBuffer(Dt.ARRAY_BUFFER,e.__webglUvBuffer),Dt.bufferData(Dt.ARRAY_BUFFER,e.uvArray,Dt.DYNAMIC_DRAW),T(t.attributes.uv),Dt.vertexAttribPointer(t.attributes.uv,2,Dt.FLOAT,!1,0,0)),e.hasColors&&r.vertexColors!==THREE.NoColors&&(Dt.bindBuffer(Dt.ARRAY_BUFFER,e.__webglColorBuffer),Dt.bufferData(Dt.ARRAY_BUFFER,e.colorArray,Dt.DYNAMIC_DRAW),T(t.attributes.color),Dt.vertexAttribPointer(t.attributes.color,3,Dt.FLOAT,!1,0,0)),x(),Dt.drawArrays(Dt.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,r,n,i,o){if(n.visible!==!1){var a=B(e,t,r,n,o),s=a.attributes,l=i.attributes,c=!1,h=n.wireframe?1:0,u=16777215*i.id+2*a.id+h;if(u!==Kt&&(Kt=u,c=!0),c&&y(),o instanceof THREE.Mesh){var f=l.index;if(f){var d,p;f.array instanceof Uint32Array?(d=Dt.UNSIGNED_INT,p=4):(d=Dt.UNSIGNED_SHORT,p=2);var m=i.offsets;if(0===m.length)c&&(E(n,s,l,0),Dt.bindBuffer(Dt.ELEMENT_ARRAY_BUFFER,f.buffer)),Dt.drawElements(Dt.TRIANGLES,f.array.length,d,0),jt.info.render.calls++,jt.info.render.vertices+=f.array.length,jt.info.render.faces+=f.array.length/3;else{c=!0;for(var g=0,v=m.length;v>g;g++){var T=m[g].index;c&&(E(n,s,l,T),Dt.bindBuffer(Dt.ELEMENT_ARRAY_BUFFER,f.buffer)),Dt.drawElements(Dt.TRIANGLES,m[g].count,d,m[g].start*p),jt.info.render.calls++,jt.info.render.vertices+=m[g].count,jt.info.render.faces+=m[g].count/3}}}else{c&&E(n,s,l,0);var x=i.attributes.position;Dt.drawArrays(Dt.TRIANGLES,0,x.array.length/3),jt.info.render.calls++,jt.info.render.vertices+=x.array.length/3,jt.info.render.faces+=x.array.length/9}}else if(o instanceof THREE.PointCloud){c&&E(n,s,l,0);var x=l.position;Dt.drawArrays(Dt.POINTS,0,x.array.length/3),jt.info.render.calls++,jt.info.render.points+=x.array.length/3}else if(o instanceof THREE.Line){var w=o.type===THREE.LineStrip?Dt.LINE_STRIP:Dt.LINES;at(n.linewidth);var f=l.index;if(f){var d,p;f.array instanceof Uint32Array?(d=Dt.UNSIGNED_INT,p=4):(d=Dt.UNSIGNED_SHORT,p=2);var m=i.offsets;if(0===m.length)c&&(E(n,s,l,0),Dt.bindBuffer(Dt.ELEMENT_ARRAY_BUFFER,f.buffer)),Dt.drawElements(w,f.array.length,d,0),jt.info.render.calls++,jt.info.render.vertices+=f.array.length;else{m.length>1&&(c=!0);for(var g=0,v=m.length;v>g;g++){var T=m[g].index;c&&(E(n,s,l,T),Dt.bindBuffer(Dt.ELEMENT_ARRAY_BUFFER,f.buffer)),Dt.drawElements(w,m[g].count,d,m[g].start*p),jt.info.render.calls++,jt.info.render.vertices+=m[g].count}}}else{c&&E(n,s,l,0);var x=l.position;Dt.drawArrays(w,0,x.array.length/3),jt.info.render.calls++,jt.info.render.points+=x.array.length/3}}}},this.renderBuffer=function(e,t,r,n,i,o){if(n.visible!==!1){var a,s,l,c=B(e,t,r,n,o),h=c.attributes,u=!1,f=n.wireframe?1:0,d=16777215*i.id+2*c.id+f;if(d!==Kt&&(Kt=d,u=!0),u&&y(),!n.morphTargets&&h.position>=0?u&&(Dt.bindBuffer(Dt.ARRAY_BUFFER,i.__webglVertexBuffer),T(h.position),Dt.vertexAttribPointer(h.position,3,Dt.FLOAT,!1,0,0)):o.morphTargetBase&&w(n,i,o),u){if(i.__webglCustomAttributesList)for(s=0,l=i.__webglCustomAttributesList.length;l>s;s++)a=i.__webglCustomAttributesList[s],h[a.buffer.belongsToAttribute]>=0&&(Dt.bindBuffer(Dt.ARRAY_BUFFER,a.buffer),T(h[a.buffer.belongsToAttribute]),Dt.vertexAttribPointer(h[a.buffer.belongsToAttribute],a.size,Dt.FLOAT,!1,0,0));h.color>=0&&(o.geometry.colors.length>0||o.geometry.faces.length>0?(Dt.bindBuffer(Dt.ARRAY_BUFFER,i.__webglColorBuffer),T(h.color),Dt.vertexAttribPointer(h.color,3,Dt.FLOAT,!1,0,0)):n.defaultAttributeValues&&Dt.vertexAttrib3fv(h.color,n.defaultAttributeValues.color)),h.normal>=0&&(Dt.bindBuffer(Dt.ARRAY_BUFFER,i.__webglNormalBuffer),T(h.normal),Dt.vertexAttribPointer(h.normal,3,Dt.FLOAT,!1,0,0)),h.tangent>=0&&(Dt.bindBuffer(Dt.ARRAY_BUFFER,i.__webglTangentBuffer),T(h.tangent),Dt.vertexAttribPointer(h.tangent,4,Dt.FLOAT,!1,0,0)),h.uv>=0&&(o.geometry.faceVertexUvs[0]?(Dt.bindBuffer(Dt.ARRAY_BUFFER,i.__webglUVBuffer),T(h.uv),Dt.vertexAttribPointer(h.uv,2,Dt.FLOAT,!1,0,0)):n.defaultAttributeValues&&Dt.vertexAttrib2fv(h.uv,n.defaultAttributeValues.uv)),h.uv2>=0&&(o.geometry.faceVertexUvs[1]?(Dt.bindBuffer(Dt.ARRAY_BUFFER,i.__webglUV2Buffer),T(h.uv2),Dt.vertexAttribPointer(h.uv2,2,Dt.FLOAT,!1,0,0)):n.defaultAttributeValues&&Dt.vertexAttrib2fv(h.uv2,n.defaultAttributeValues.uv2)),n.skinning&&h.skinIndex>=0&&h.skinWeight>=0&&(Dt.bindBuffer(Dt.ARRAY_BUFFER,i.__webglSkinIndicesBuffer),T(h.skinIndex),Dt.vertexAttribPointer(h.skinIndex,4,Dt.FLOAT,!1,0,0),Dt.bindBuffer(Dt.ARRAY_BUFFER,i.__webglSkinWeightsBuffer),T(h.skinWeight),Dt.vertexAttribPointer(h.skinWeight,4,Dt.FLOAT,!1,0,0)),h.lineDistance>=0&&(Dt.bindBuffer(Dt.ARRAY_BUFFER,i.__webglLineDistanceBuffer),T(h.lineDistance),Dt.vertexAttribPointer(h.lineDistance,1,Dt.FLOAT,!1,0,0))}if(x(),o instanceof THREE.Mesh){var p=i.__typeArray===Uint32Array?Dt.UNSIGNED_INT:Dt.UNSIGNED_SHORT;n.wireframe?(at(n.wireframeLinewidth),u&&Dt.bindBuffer(Dt.ELEMENT_ARRAY_BUFFER,i.__webglLineBuffer),Dt.drawElements(Dt.LINES,i.__webglLineCount,p,0)):(u&&Dt.bindBuffer(Dt.ELEMENT_ARRAY_BUFFER,i.__webglFaceBuffer),Dt.drawElements(Dt.TRIANGLES,i.__webglFaceCount,p,0)),jt.info.render.calls++,jt.info.render.vertices+=i.__webglFaceCount,jt.info.render.faces+=i.__webglFaceCount/3}else if(o instanceof THREE.Line){var m=o.type===THREE.LineStrip?Dt.LINE_STRIP:Dt.LINES;at(n.linewidth),Dt.drawArrays(m,0,i.__webglLineCount),jt.info.render.calls++}else o instanceof THREE.PointCloud&&(Dt.drawArrays(Dt.POINTS,0,i.__webglParticleCount),jt.info.render.calls++,jt.info.render.points+=i.__webglParticleCount)}},this.render=function(e,t,r,n){function i(e){e instanceof THREE.SkinnedMesh&&e.skeleton.update();for(var t=0,r=e.children.length;r>t;t++)i(e.children[t])}if(t instanceof THREE.Camera==!1)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");var o,a,s,l,c,h=e.__lights,u=e.fog;for(Yt=-1,Qt=null,br=!0,e.autoUpdate===!0&&e.updateMatrixWorld(),void 0===t.parent&&t.updateMatrixWorld(),i(e),t.matrixWorldInverse.getInverse(t.matrixWorld),yr.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),Er.setFromMatrix(yr),Xr(e),Ft.length=0,Nt.length=0,H(e,e,t),jt.sortObjects===!0&&(Ft.sort(b),Nt.sort(R)),M(this.renderPluginsPre,e,t),jt.info.render.calls=0,jt.info.render.vertices=0,jt.info.render.faces=0,jt.info.render.points=0,this.setRenderTarget(r),(this.autoClear||n)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),c=e.__webglObjectsImmediate,o=0,a=c.length;a>o;o++)s=c[o],l=s.object,l.visible&&(rt(l,t),A(s));if(e.overrideMaterial){var f=e.overrideMaterial;this.setBlending(f.blending,f.blendEquation,f.blendSrc,f.blendDst),this.setDepthTest(f.depthTest),this.setDepthWrite(f.depthWrite),st(f.polygonOffset,f.polygonOffsetFactor,f.polygonOffsetUnits),S(Ft,t,h,u,!0,f),S(Nt,t,h,u,!0,f),C(e.__webglObjectsImmediate,"",t,h,u,!1,f)}else{var f=null;this.setBlending(THREE.NoBlending),S(Ft,t,h,u,!1,f),C(e.__webglObjectsImmediate,"opaque",t,h,u,!1,f),S(Nt,t,h,u,!0,f),C(e.__webglObjectsImmediate,"transparent",t,h,u,!0,f)}M(this.renderPluginsPost,e,t),r&&r.generateMipmaps&&r.minFilter!==THREE.NearestFilter&&r.minFilter!==THREE.LinearFilter&&pt(r),this.setDepthTest(!0),this.setDepthWrite(!0)},this.renderImmediateObject=function(e,t,r,n,i){var o=B(e,t,r,n,i);Kt=-1,jt.setMaterialFaces(n),i.immediateRenderCallback?i.immediateRenderCallback(o,Dt,Er):i.render(function(e){jt.renderBufferImmediate(e,o,n)})};var Xr=function(e){for(e.__webglObjects||(e.__webglObjects={},e.__webglObjectsImmediate=[]);e.__objectsAdded.length;)L(e.__objectsAdded[0],e),e.__objectsAdded.splice(0,1);for(;e.__objectsRemoved.length;)z(e.__objectsRemoved[0],e),e.__objectsRemoved.splice(0,1)};this.initMaterial=function(e,t,r,n){e.addEventListener("dispose",Ir);var i,o,a,s,l,c,h;if(e instanceof THREE.MeshDepthMaterial?h="depth":e instanceof THREE.MeshNormalMaterial?h="normal":e instanceof THREE.MeshBasicMaterial?h="basic":e instanceof THREE.MeshLambertMaterial?h="lambert":e instanceof THREE.MeshPhongMaterial?h="phong":e instanceof THREE.LineBasicMaterial?h="basic":e instanceof THREE.LineDashedMaterial?h="dashed":e instanceof THREE.PointCloudMaterial&&(h="particle_basic"),h){var u=THREE.ShaderLib[h];e.__webglShader={uniforms:THREE.UniformsUtils.clone(u.uniforms),vertexShader:u.vertexShader,fragmentShader:u.fragmentShader}}else e.__webglShader={uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};s=Et(t),c=yt(t),l=vt(n),a={precision:Rt,supportsVertexTextures:Cr,map:!!e.map,envMap:!!e.envMap,lightMap:!!e.lightMap,bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,specularMap:!!e.specularMap,alphaMap:!!e.alphaMap,vertexColors:e.vertexColors,fog:r,useFog:e.fog,fogExp:r instanceof THREE.FogExp2,sizeAttenuation:e.sizeAttenuation,logarithmicDepthBuffer:kt,skinning:e.skinning,maxBones:l,useVertexTexture:Ar&&n&&n.skeleton&&n.skeleton.useVertexTexture,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:s.directional,maxPointLights:s.point,maxSpotLights:s.spot,maxHemiLights:s.hemi,maxShadows:c,shadowMapEnabled:this.shadowMapEnabled&&n.receiveShadow&&c>0,shadowMapType:this.shadowMapType,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:e.alphaTest,metal:e.metal,wrapAround:e.wrapAround,doubleSided:e.side===THREE.DoubleSide,flipSided:e.side===THREE.BackSide};var f=[];h?f.push(h):(f.push(e.fragmentShader),f.push(e.vertexShader));for(var d in e.defines)f.push(d),f.push(e.defines[d]);for(var p in a)f.push(p),f.push(a[p]);for(var m,g=f.join(),p=0,v=Wt.length;v>p;p++){var E=Wt[p];if(E.code===g){m=E,m.usedTimes++;break}}void 0===m&&(m=new THREE.WebGLProgram(this,g,e,a),Wt.push(m),jt.info.memory.programs=Wt.length),e.program=m;var y=e.program.attributes;if(e.morphTargets){e.numSupportedMorphTargets=0;var T,x="morphTarget";for(o=0;o<this.maxMorphTargets;o++)T=x+o,y[T]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;var T,x="morphNormal";for(o=0;o<this.maxMorphNormals;o++)T=x+o,y[T]>=0&&e.numSupportedMorphNormals++}e.uniformsList=[];for(i in e.__webglShader.uniforms){var w=e.program.uniforms[i];w&&e.uniformsList.push([e.__webglShader.uniforms[i],w])}},this.setFaceCulling=function(e,t){e===THREE.CullFaceNone?Dt.disable(Dt.CULL_FACE):(Dt.frontFace(t===THREE.FrontFaceDirectionCW?Dt.CW:Dt.CCW),Dt.cullFace(e===THREE.CullFaceBack?Dt.BACK:e===THREE.CullFaceFront?Dt.FRONT:Dt.FRONT_AND_BACK),Dt.enable(Dt.CULL_FACE))},this.setMaterialFaces=function(e){var t=e.side===THREE.DoubleSide,r=e.side===THREE.BackSide;$t!==t&&(t?Dt.disable(Dt.CULL_FACE):Dt.enable(Dt.CULL_FACE),$t=t),Jt!==r&&(Dt.frontFace(r?Dt.CW:Dt.CCW),Jt=r)},this.setDepthTest=function(e){ir!==e&&(e?Dt.enable(Dt.DEPTH_TEST):Dt.disable(Dt.DEPTH_TEST),ir=e)},this.setDepthWrite=function(e){or!==e&&(Dt.depthMask(e),or=e)},this.setBlending=function(e,t,r,n){e!==er&&(e===THREE.NoBlending?Dt.disable(Dt.BLEND):e===THREE.AdditiveBlending?(Dt.enable(Dt.BLEND),Dt.blendEquation(Dt.FUNC_ADD),Dt.blendFunc(Dt.SRC_ALPHA,Dt.ONE)):e===THREE.SubtractiveBlending?(Dt.enable(Dt.BLEND),Dt.blendEquation(Dt.FUNC_ADD),Dt.blendFunc(Dt.ZERO,Dt.ONE_MINUS_SRC_COLOR)):e===THREE.MultiplyBlending?(Dt.enable(Dt.BLEND),Dt.blendEquation(Dt.FUNC_ADD),Dt.blendFunc(Dt.ZERO,Dt.SRC_COLOR)):e===THREE.CustomBlending?Dt.enable(Dt.BLEND):(Dt.enable(Dt.BLEND),Dt.blendEquationSeparate(Dt.FUNC_ADD,Dt.FUNC_ADD),Dt.blendFuncSeparate(Dt.SRC_ALPHA,Dt.ONE_MINUS_SRC_ALPHA,Dt.ONE,Dt.ONE_MINUS_SRC_ALPHA)),er=e),e===THREE.CustomBlending?(t!==tr&&(Dt.blendEquation(gt(t)),tr=t),(r!==rr||n!==nr)&&(Dt.blendFunc(gt(r),gt(n)),rr=r,nr=n)):(tr=null,rr=null,nr=null)},this.setTexture=function(e,t){if(e.needsUpdate){e.__webglInit||(e.__webglInit=!0,e.addEventListener("dispose",Or),e.__webglTexture=Dt.createTexture(),jt.info.memory.textures++),Dt.activeTexture(Dt.TEXTURE0+t),Dt.bindTexture(Dt.TEXTURE_2D,e.__webglTexture),Dt.pixelStorei(Dt.UNPACK_FLIP_Y_WEBGL,e.flipY),Dt.pixelStorei(Dt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),Dt.pixelStorei(Dt.UNPACK_ALIGNMENT,e.unpackAlignment);var r=e.image,n=THREE.Math.isPowerOfTwo(r.width)&&THREE.Math.isPowerOfTwo(r.height),i=gt(e.format),o=gt(e.type);lt(Dt.TEXTURE_2D,e,n);var a,s=e.mipmaps;if(e instanceof THREE.DataTexture)if(s.length>0&&n){for(var l=0,c=s.length;c>l;l++)a=s[l],Dt.texImage2D(Dt.TEXTURE_2D,l,i,a.width,a.height,0,i,o,a.data);e.generateMipmaps=!1}else Dt.texImage2D(Dt.TEXTURE_2D,0,i,r.width,r.height,0,i,o,r.data);else if(e instanceof THREE.CompressedTexture)for(var l=0,c=s.length;c>l;l++)a=s[l],e.format!==THREE.RGBAFormat?Dt.compressedTexImage2D(Dt.TEXTURE_2D,l,i,a.width,a.height,0,a.data):Dt.texImage2D(Dt.TEXTURE_2D,l,i,a.width,a.height,0,i,o,a.data);else if(s.length>0&&n){for(var l=0,c=s.length;c>l;l++)a=s[l],Dt.texImage2D(Dt.TEXTURE_2D,l,i,i,o,a);e.generateMipmaps=!1}else Dt.texImage2D(Dt.TEXTURE_2D,0,i,i,o,e.image);e.generateMipmaps&&n&&Dt.generateMipmap(Dt.TEXTURE_2D),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else Dt.activeTexture(Dt.TEXTURE0+t),Dt.bindTexture(Dt.TEXTURE_2D,e.__webglTexture)},this.setRenderTarget=function(e){var t=e instanceof THREE.WebGLRenderTargetCube;if(e&&!e.__webglFramebuffer){void 0===e.depthBuffer&&(e.depthBuffer=!0),void 0===e.stencilBuffer&&(e.stencilBuffer=!0),e.addEventListener("dispose",zr),e.__webglTexture=Dt.createTexture(),jt.info.memory.textures++;var r=THREE.Math.isPowerOfTwo(e.width)&&THREE.Math.isPowerOfTwo(e.height),n=gt(e.format),i=gt(e.type);if(t){e.__webglFramebuffer=[],e.__webglRenderbuffer=[],Dt.bindTexture(Dt.TEXTURE_CUBE_MAP,e.__webglTexture),lt(Dt.TEXTURE_CUBE_MAP,e,r);for(var o=0;6>o;o++)e.__webglFramebuffer[o]=Dt.createFramebuffer(),e.__webglRenderbuffer[o]=Dt.createRenderbuffer(),Dt.texImage2D(Dt.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,n,e.width,e.height,0,n,i,null),ft(e.__webglFramebuffer[o],e,Dt.TEXTURE_CUBE_MAP_POSITIVE_X+o),dt(e.__webglRenderbuffer[o],e);r&&Dt.generateMipmap(Dt.TEXTURE_CUBE_MAP)}else e.__webglFramebuffer=Dt.createFramebuffer(),e.__webglRenderbuffer=e.shareDepthFrom?e.shareDepthFrom.__webglRenderbuffer:Dt.createRenderbuffer(),Dt.bindTexture(Dt.TEXTURE_2D,e.__webglTexture),lt(Dt.TEXTURE_2D,e,r),Dt.texImage2D(Dt.TEXTURE_2D,0,n,e.width,e.height,0,n,i,null),ft(e.__webglFramebuffer,e,Dt.TEXTURE_2D),e.shareDepthFrom?e.depthBuffer&&!e.stencilBuffer?Dt.framebufferRenderbuffer(Dt.FRAMEBUFFER,Dt.DEPTH_ATTACHMENT,Dt.RENDERBUFFER,e.__webglRenderbuffer):e.depthBuffer&&e.stencilBuffer&&Dt.framebufferRenderbuffer(Dt.FRAMEBUFFER,Dt.DEPTH_STENCIL_ATTACHMENT,Dt.RENDERBUFFER,e.__webglRenderbuffer):dt(e.__webglRenderbuffer,e),r&&Dt.generateMipmap(Dt.TEXTURE_2D);
t?Dt.bindTexture(Dt.TEXTURE_CUBE_MAP,null):Dt.bindTexture(Dt.TEXTURE_2D,null),Dt.bindRenderbuffer(Dt.RENDERBUFFER,null),Dt.bindFramebuffer(Dt.FRAMEBUFFER,null)}var a,s,l,c,h;e?(a=t?e.__webglFramebuffer[e.activeCubeFace]:e.__webglFramebuffer,s=e.width,l=e.height,c=0,h=0):(a=null,s=fr,l=dr,c=hr,h=ur),a!==qt&&(Dt.bindFramebuffer(Dt.FRAMEBUFFER,a),Dt.viewport(c,h,s,l),qt=a),pr=s,mr=l},this.shadowMapPlugin=new THREE.ShadowMapPlugin,this.addPrePlugin(this.shadowMapPlugin),this.addPostPlugin(new THREE.SpritePlugin),this.addPostPlugin(new THREE.LensFlarePlugin)},THREE.WebGLRenderTarget=function(e,t,r){this.width=e,this.height=t,r=r||{},this.wrapS=void 0!==r.wrapS?r.wrapS:THREE.ClampToEdgeWrapping,this.wrapT=void 0!==r.wrapT?r.wrapT:THREE.ClampToEdgeWrapping,this.magFilter=void 0!==r.magFilter?r.magFilter:THREE.LinearFilter,this.minFilter=void 0!==r.minFilter?r.minFilter:THREE.LinearMipMapLinearFilter,this.anisotropy=void 0!==r.anisotropy?r.anisotropy:1,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.format=void 0!==r.format?r.format:THREE.RGBAFormat,this.type=void 0!==r.type?r.type:THREE.UnsignedByteType,this.depthBuffer=void 0!==r.depthBuffer?r.depthBuffer:!0,this.stencilBuffer=void 0!==r.stencilBuffer?r.stencilBuffer:!0,this.generateMipmaps=!0,this.shareDepthFrom=null},THREE.WebGLRenderTarget.prototype={constructor:THREE.WebGLRenderTarget,setSize:function(e,t){this.width=e,this.height=t},clone:function(){var e=new THREE.WebGLRenderTarget(this.width,this.height);return e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.format=this.format,e.type=this.type,e.depthBuffer=this.depthBuffer,e.stencilBuffer=this.stencilBuffer,e.generateMipmaps=this.generateMipmaps,e.shareDepthFrom=this.shareDepthFrom,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.WebGLRenderTarget.prototype),THREE.WebGLRenderTargetCube=function(e,t,r){THREE.WebGLRenderTarget.call(this,e,t,r),this.activeCubeFace=0},THREE.WebGLRenderTargetCube.prototype=Object.create(THREE.WebGLRenderTarget.prototype),THREE.WebGLProgram=function(){var e=0,t=function(e){var t,r,n=[];for(var i in e)t=e[i],t!==!1&&(r="#define "+i+" "+t,n.push(r));return n.join("\n")},r=function(e,t,r){for(var n={},i=0,o=r.length;o>i;i++){var a=r[i];n[a]=e.getUniformLocation(t,a)}return n},n=function(e,t,r){for(var n={},i=0,o=r.length;o>i;i++){var a=r[i];n[a]=e.getAttribLocation(t,a)}return n};return function(i,o,a,s){var l=i,c=l.context,h=a.defines,u=a.__webglShader.uniforms,f=a.attributes,d=a.__webglShader.vertexShader,p=a.__webglShader.fragmentShader,m=a.index0AttributeName;void 0===m&&s.morphTargets===!0&&(m="position");var g="SHADOWMAP_TYPE_BASIC";s.shadowMapType===THREE.PCFShadowMap?g="SHADOWMAP_TYPE_PCF":s.shadowMapType===THREE.PCFSoftShadowMap&&(g="SHADOWMAP_TYPE_PCF_SOFT");var v,E,y=t(h),T=c.createProgram();a instanceof THREE.RawShaderMaterial?(v="",E=""):(v=["precision "+s.precision+" float;","precision "+s.precision+" int;",y,s.supportsVertexTextures?"#define VERTEX_TEXTURES":"",l.gammaInput?"#define GAMMA_INPUT":"",l.gammaOutput?"#define GAMMA_OUTPUT":"","#define MAX_DIR_LIGHTS "+s.maxDirLights,"#define MAX_POINT_LIGHTS "+s.maxPointLights,"#define MAX_SPOT_LIGHTS "+s.maxSpotLights,"#define MAX_HEMI_LIGHTS "+s.maxHemiLights,"#define MAX_SHADOWS "+s.maxShadows,"#define MAX_BONES "+s.maxBones,s.map?"#define USE_MAP":"",s.envMap?"#define USE_ENVMAP":"",s.lightMap?"#define USE_LIGHTMAP":"",s.bumpMap?"#define USE_BUMPMAP":"",s.normalMap?"#define USE_NORMALMAP":"",s.specularMap?"#define USE_SPECULARMAP":"",s.alphaMap?"#define USE_ALPHAMAP":"",s.vertexColors?"#define USE_COLOR":"",s.skinning?"#define USE_SKINNING":"",s.useVertexTexture?"#define BONE_TEXTURE":"",s.morphTargets?"#define USE_MORPHTARGETS":"",s.morphNormals?"#define USE_MORPHNORMALS":"",s.wrapAround?"#define WRAP_AROUND":"",s.doubleSided?"#define DOUBLE_SIDED":"",s.flipSided?"#define FLIP_SIDED":"",s.shadowMapEnabled?"#define USE_SHADOWMAP":"",s.shadowMapEnabled?"#define "+g:"",s.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",s.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",s.sizeAttenuation?"#define USE_SIZEATTENUATION":"",s.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",""].join("\n"),E=["precision "+s.precision+" float;","precision "+s.precision+" int;",s.bumpMap||s.normalMap?"#extension GL_OES_standard_derivatives : enable":"",y,"#define MAX_DIR_LIGHTS "+s.maxDirLights,"#define MAX_POINT_LIGHTS "+s.maxPointLights,"#define MAX_SPOT_LIGHTS "+s.maxSpotLights,"#define MAX_HEMI_LIGHTS "+s.maxHemiLights,"#define MAX_SHADOWS "+s.maxShadows,s.alphaTest?"#define ALPHATEST "+s.alphaTest:"",l.gammaInput?"#define GAMMA_INPUT":"",l.gammaOutput?"#define GAMMA_OUTPUT":"",s.useFog&&s.fog?"#define USE_FOG":"",s.useFog&&s.fogExp?"#define FOG_EXP2":"",s.map?"#define USE_MAP":"",s.envMap?"#define USE_ENVMAP":"",s.lightMap?"#define USE_LIGHTMAP":"",s.bumpMap?"#define USE_BUMPMAP":"",s.normalMap?"#define USE_NORMALMAP":"",s.specularMap?"#define USE_SPECULARMAP":"",s.alphaMap?"#define USE_ALPHAMAP":"",s.vertexColors?"#define USE_COLOR":"",s.metal?"#define METAL":"",s.wrapAround?"#define WRAP_AROUND":"",s.doubleSided?"#define DOUBLE_SIDED":"",s.flipSided?"#define FLIP_SIDED":"",s.shadowMapEnabled?"#define USE_SHADOWMAP":"",s.shadowMapEnabled?"#define "+g:"",s.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",s.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",s.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n"));var x=new THREE.WebGLShader(c,c.VERTEX_SHADER,v+d),w=new THREE.WebGLShader(c,c.FRAGMENT_SHADER,E+p);c.attachShader(T,x),c.attachShader(T,w),void 0!==m&&c.bindAttribLocation(T,0,m),c.linkProgram(T),c.getProgramParameter(T,c.LINK_STATUS)===!1&&(console.error("THREE.WebGLProgram: Could not initialise shader."),console.error("gl.VALIDATE_STATUS",c.getProgramParameter(T,c.VALIDATE_STATUS)),console.error("gl.getError()",c.getError())),""!==c.getProgramInfoLog(T)&&console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",c.getProgramInfoLog(T)),c.deleteShader(x),c.deleteShader(w);var b=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","morphTargetInfluences","bindMatrix","bindMatrixInverse"];s.useVertexTexture?(b.push("boneTexture"),b.push("boneTextureWidth"),b.push("boneTextureHeight")):b.push("boneGlobalMatrices"),s.logarithmicDepthBuffer&&b.push("logDepthBufFC");for(var R in u)b.push(R);this.uniforms=r(c,T,b),b=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight","lineDistance"];for(var _=0;_<s.maxMorphTargets;_++)b.push("morphTarget"+_);for(var _=0;_<s.maxMorphNormals;_++)b.push("morphNormal"+_);for(var H in f)b.push(H);return this.attributes=n(c,T,b),this.id=e++,this.code=o,this.usedTimes=1,this.program=T,this.vertexShader=x,this.fragmentShader=w,this}}(),THREE.WebGLShader=function(){var e=function(e){for(var t=e.split("\n"),r=0;r<t.length;r++)t[r]=r+1+": "+t[r];return t.join("\n")};return function(t,r,n){var i=t.createShader(r);return t.shaderSource(i,n),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS)===!1&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==t.getShaderInfoLog(i)&&(console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",t.getShaderInfoLog(i)),console.warn(e(n))),i}}(),THREE.RenderableVertex=function(){this.position=new THREE.Vector3,this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},THREE.RenderableFace=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.normalModel=new THREE.Vector3,this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsLength=0,this.color=new THREE.Color,this.material=null,this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2],this.z=0},THREE.RenderableObject=function(){this.id=0,this.object=null,this.z=0},THREE.RenderableSprite=function(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new THREE.Vector2,this.material=null},THREE.RenderableLine=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.vertexColors=[new THREE.Color,new THREE.Color],this.material=null,this.z=0},THREE.GeometryUtils={merge:function(e,t,r){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var n;t instanceof THREE.Mesh&&(t.matrixAutoUpdate&&t.updateMatrix(),n=t.matrix,t=t.geometry),e.merge(t,n,r)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}},THREE.ImageUtils={crossOrigin:void 0,loadTexture:function(e,t,r,n){var i=new THREE.ImageLoader;i.crossOrigin=this.crossOrigin;var o=new THREE.Texture(void 0,t);return i.load(e,function(e){o.image=e,o.needsUpdate=!0,r&&r(o)},void 0,function(e){n&&n(e)}),o.sourceFile=e,o},loadTextureCube:function(e,t,r){var n=[],i=new THREE.ImageLoader;i.crossOrigin=this.crossOrigin;var o=new THREE.CubeTexture(n,t);o.flipY=!1;for(var a=0,s=function(t){i.load(e[t],function(e){o.images[t]=e,a+=1,6===a&&(o.needsUpdate=!0,r&&r(o))})},l=0,c=e.length;c>l;++l)s(l);return o},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},getNormalMap:function(e,t){var r=function(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]},n=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]},i=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]};t=1|t;var o=e.width,a=e.height,s=document.createElement("canvas");s.width=o,s.height=a;var l=s.getContext("2d");l.drawImage(e,0,0);for(var c=l.getImageData(0,0,o,a).data,h=l.createImageData(o,a),u=h.data,f=0;o>f;f++)for(var d=0;a>d;d++){var p=0>d-1?0:d-1,m=d+1>a-1?a-1:d+1,g=0>f-1?0:f-1,v=f+1>o-1?o-1:f+1,E=[],y=[0,0,c[4*(d*o+f)]/255*t];E.push([-1,0,c[4*(d*o+g)]/255*t]),E.push([-1,-1,c[4*(p*o+g)]/255*t]),E.push([0,-1,c[4*(p*o+f)]/255*t]),E.push([1,-1,c[4*(p*o+v)]/255*t]),E.push([1,0,c[4*(d*o+v)]/255*t]),E.push([1,1,c[4*(m*o+v)]/255*t]),E.push([0,1,c[4*(m*o+f)]/255*t]),E.push([-1,1,c[4*(m*o+g)]/255*t]);for(var T=[],x=E.length,w=0;x>w;w++){var b=E[w],R=E[(w+1)%x];b=n(b,y),R=n(R,y),T.push(i(r(b,R)))}for(var _=[0,0,0],w=0;w<T.length;w++)_[0]+=T[w][0],_[1]+=T[w][1],_[2]+=T[w][2];_[0]/=T.length,_[1]/=T.length,_[2]/=T.length;var H=4*(d*o+f);u[H]=(_[0]+1)/2*255|0,u[H+1]=(_[1]+1)/2*255|0,u[H+2]=255*_[2]|0,u[H+3]=255}return l.putImageData(h,0,0),s},generateDataTexture:function(e,t,r){for(var n=e*t,i=new Uint8Array(3*n),o=Math.floor(255*r.r),a=Math.floor(255*r.g),s=Math.floor(255*r.b),l=0;n>l;l++)i[3*l]=o,i[3*l+1]=a,i[3*l+2]=s;var c=new THREE.DataTexture(i,e,t,THREE.RGBFormat);return c.needsUpdate=!0,c}},THREE.SceneUtils={createMultiMaterialObject:function(e,t){for(var r=new THREE.Object3D,n=0,i=t.length;i>n;n++)r.add(new THREE.Mesh(e,t[n]));return r},detach:function(e,t,r){e.applyMatrix(t.matrixWorld),t.remove(e),r.add(e)},attach:function(e,t,r){var n=new THREE.Matrix4;n.getInverse(r.matrixWorld),e.applyMatrix(n),t.remove(e),r.add(e)}},THREE.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){try{return this.faces[this.face][this.weight][this.style]}catch(e){throw"The font "+this.face+" with "+this.weight+" weight and "+this.style+" style is missing."}},loadFace:function(e){var t=e.familyName.toLowerCase(),r=this;r.faces[t]=r.faces[t]||{},r.faces[t][e.cssFontWeight]=r.faces[t][e.cssFontWeight]||{},r.faces[t][e.cssFontWeight][e.cssFontStyle]=e;r.faces[t][e.cssFontWeight][e.cssFontStyle]=e;return e},drawText:function(e){var t,r=this.getFace(),n=this.size/r.resolution,i=0,o=String(e).split(""),a=o.length,s=[];for(t=0;a>t;t++){var l=new THREE.Path,c=this.extractGlyphPoints(o[t],r,n,i,l);i+=c.offset,s.push(c.path)}var h=i/2;return{paths:s,offset:h}},extractGlyphPoints:function(e,t,r,n,i){var o,a,s,l,c,h,u,f,d,p,m,g,v,E,y,T,x,w,b,R=[],_=t.glyphs[e]||t.glyphs["?"];if(_){if(_.o)for(l=_._cachedOutline||(_._cachedOutline=_.o.split(" ")),h=l.length,u=r,f=r,o=0;h>o;)switch(c=l[o++]){case"m":d=l[o++]*u+n,p=l[o++]*f,i.moveTo(d,p);break;case"l":d=l[o++]*u+n,p=l[o++]*f,i.lineTo(d,p);break;case"q":if(m=l[o++]*u+n,g=l[o++]*f,y=l[o++]*u+n,T=l[o++]*f,i.quadraticCurveTo(y,T,m,g),b=R[R.length-1])for(v=b.x,E=b.y,a=1,s=this.divisions;s>=a;a++){var H=a/s;THREE.Shape.Utils.b2(H,v,y,m),THREE.Shape.Utils.b2(H,E,T,g)}break;case"b":if(m=l[o++]*u+n,g=l[o++]*f,y=l[o++]*u+n,T=l[o++]*f,x=l[o++]*u+n,w=l[o++]*f,i.bezierCurveTo(y,T,x,w,m,g),b=R[R.length-1])for(v=b.x,E=b.y,a=1,s=this.divisions;s>=a;a++){var H=a/s;THREE.Shape.Utils.b3(H,v,y,x,m),THREE.Shape.Utils.b3(H,E,T,w,g)}}return{offset:_.ha*r,path:i}}}},THREE.FontUtils.generateShapes=function(e,t){t=t||{};var r=void 0!==t.size?t.size:100,n=void 0!==t.curveSegments?t.curveSegments:4,i=void 0!==t.font?t.font:"helvetiker",o=void 0!==t.weight?t.weight:"normal",a=void 0!==t.style?t.style:"normal";THREE.FontUtils.size=r,THREE.FontUtils.divisions=n,THREE.FontUtils.face=i,THREE.FontUtils.weight=o,THREE.FontUtils.style=a;for(var s=THREE.FontUtils.drawText(e),l=s.paths,c=[],h=0,u=l.length;u>h;h++)Array.prototype.push.apply(c,l[h].toShapes());return c},function(e){var t=1e-10,r=function(e,t){var r=e.length;if(3>r)return null;var o,a,s,l=[],c=[],h=[];if(n(e)>0)for(a=0;r>a;a++)c[a]=a;else for(a=0;r>a;a++)c[a]=r-1-a;var u=r,f=2*u;for(a=u-1;u>2;){if(f--<=0)return console.log("Warning, unable to triangulate polygon!"),t?h:l;if(o=a,o>=u&&(o=0),a=o+1,a>=u&&(a=0),s=a+1,s>=u&&(s=0),i(e,o,a,s,u,c)){var d,p,m,g,v;for(d=c[o],p=c[a],m=c[s],l.push([e[d],e[p],e[m]]),h.push([c[o],c[a],c[s]]),g=a,v=a+1;u>v;g++,v++)c[g]=c[v];u--,f=2*u}}return t?h:l},n=function(e){for(var t=e.length,r=0,n=t-1,i=0;t>i;n=i++)r+=e[n].x*e[i].y-e[i].x*e[n].y;return.5*r},i=function(e,r,n,i,o,a){var s,l,c,h,u,f,d,p,m;if(l=e[a[r]].x,c=e[a[r]].y,h=e[a[n]].x,u=e[a[n]].y,f=e[a[i]].x,d=e[a[i]].y,t>(h-l)*(d-c)-(u-c)*(f-l))return!1;var g,v,E,y,T,x,w,b,R,_,H,M,S,C,A;for(g=f-h,v=d-u,E=l-f,y=c-d,T=h-l,x=u-c,s=0;o>s;s++)if(p=e[a[s]].x,m=e[a[s]].y,!(p===l&&m===c||p===h&&m===u||p===f&&m===d)&&(w=p-l,b=m-c,R=p-h,_=m-u,H=p-f,M=m-d,A=g*_-v*R,S=T*b-x*w,C=E*M-y*H,A>=-t&&C>=-t&&S>=-t))return!1;return!0};return e.Triangulate=r,e.Triangulate.area=n,e}(THREE.FontUtils),self._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace},THREE.typeface_js=self._typeface_js,THREE.Curve=function(){},THREE.Curve.prototype.getPoint=function(){return console.log("Warning, getPoint() not implemented!"),null},THREE.Curve.prototype.getPointAt=function(e){var t=this.getUtoTmapping(e);return this.getPoint(t)},THREE.Curve.prototype.getPoints=function(e){e||(e=5);var t,r=[];for(t=0;e>=t;t++)r.push(this.getPoint(t/e));return r},THREE.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var t,r=[];for(t=0;e>=t;t++)r.push(this.getPointAt(t/e));return r},THREE.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]},THREE.Curve.prototype.getLengths=function(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,r,n=[],i=this.getPoint(0),o=0;for(n.push(0),r=1;e>=r;r++)t=this.getPoint(r/e),o+=t.distanceTo(i),n.push(o),i=t;return this.cacheArcLengths=n,n},THREE.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},THREE.Curve.prototype.getUtoTmapping=function(e,t){var r,n=this.getLengths(),i=0,o=n.length;r=t?t:e*n[o-1];for(var a,s=0,l=o-1;l>=s;)if(i=Math.floor(s+(l-s)/2),a=n[i]-r,0>a)s=i+1;else{if(!(a>0)){l=i;break}l=i-1}if(i=l,n[i]==r){var c=i/(o-1);return c}var h=n[i],u=n[i+1],f=u-h,d=(r-h)/f,c=(i+d)/(o-1);return c},THREE.Curve.prototype.getTangent=function(e){var t=1e-4,r=e-t,n=e+t;0>r&&(r=0),n>1&&(n=1);var i=this.getPoint(r),o=this.getPoint(n),a=o.clone().sub(i);return a.normalize()},THREE.Curve.prototype.getTangentAt=function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},THREE.Curve.Utils={tangentQuadraticBezier:function(e,t,r,n){return 2*(1-e)*(r-t)+2*e*(n-r)},tangentCubicBezier:function(e,t,r,n,i){return-3*t*(1-e)*(1-e)+3*r*(1-e)*(1-e)-6*e*r*(1-e)+6*e*n*(1-e)-3*e*e*n+3*e*e*i},tangentSpline:function(e){var t=6*e*e-6*e,r=3*e*e-4*e+1,n=-6*e*e+6*e,i=3*e*e-2*e;return t+r+n+i},interpolate:function(e,t,r,n,i){var o=.5*(r-e),a=.5*(n-t),s=i*i,l=i*s;return(2*t-2*r+o+a)*l+(-3*t+3*r-2*o-a)*s+o*i+t}},THREE.Curve.create=function(e,t){return e.prototype=Object.create(THREE.Curve.prototype),e.prototype.getPoint=t,e},THREE.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},THREE.CurvePath.prototype=Object.create(THREE.Curve.prototype),THREE.CurvePath.prototype.add=function(e){this.curves.push(e)},THREE.CurvePath.prototype.checkConnection=function(){},THREE.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new THREE.LineCurve(t,e))},THREE.CurvePath.prototype.getPoint=function(e){for(var t,r,n=e*this.getLength(),i=this.getCurveLengths(),o=0;o<i.length;){if(i[o]>=n){t=i[o]-n,r=this.curves[o];var a=1-t/r.getLength();return r.getPointAt(a)}o++}return null},THREE.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var e,t=[],r=0,n=this.curves.length;for(e=0;n>e;e++)r+=this.curves[e].getLength(),t.push(r);return this.cacheLengths=t,t},THREE.CurvePath.prototype.getBoundingBox=function(){var e,t,r,n,i,o,a=this.getPoints();e=t=Number.NEGATIVE_INFINITY,n=i=Number.POSITIVE_INFINITY;var s,l,c,h,u=a[0]instanceof THREE.Vector3;for(h=u?new THREE.Vector3:new THREE.Vector2,l=0,c=a.length;c>l;l++)s=a[l],s.x>e?e=s.x:s.x<n&&(n=s.x),s.y>t?t=s.y:s.y<i&&(i=s.y),u&&(s.z>r?r=s.z:s.z<o&&(o=s.z)),h.add(s);var f={minX:n,minY:i,maxX:e,maxY:t};return u&&(f.maxZ=r,f.minZ=o),f},THREE.CurvePath.prototype.createPointsGeometry=function(e){var t=this.getPoints(e,!0);return this.createGeometry(t)},THREE.CurvePath.prototype.createSpacedPointsGeometry=function(e){var t=this.getSpacedPoints(e,!0);return this.createGeometry(t)},THREE.CurvePath.prototype.createGeometry=function(e){for(var t=new THREE.Geometry,r=0;r<e.length;r++)t.vertices.push(new THREE.Vector3(e[r].x,e[r].y,e[r].z||0));return t},THREE.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)},THREE.CurvePath.prototype.getTransformedPoints=function(e,t){var r,n,i=this.getPoints(e);for(t||(t=this.bends),r=0,n=t.length;n>r;r++)i=this.getWrapPoints(i,t[r]);return i},THREE.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var r,n,i=this.getSpacedPoints(e);for(t||(t=this.bends),r=0,n=t.length;n>r;r++)i=this.getWrapPoints(i,t[r]);return i},THREE.CurvePath.prototype.getWrapPoints=function(e,t){var r,n,i,o,a,s,l=this.getBoundingBox();for(r=0,n=e.length;n>r;r++){i=e[r],o=i.x,a=i.y,s=o/l.maxX,s=t.getUtoTmapping(s,o);var c=t.getPoint(s),h=t.getTangent(s);h.set(-h.y,h.x).multiplyScalar(a),i.x=c.x+h.x,i.y=c.y+h.y}return e},THREE.Gyroscope=function(){THREE.Object3D.call(this)},THREE.Gyroscope.prototype=Object.create(THREE.Object3D.prototype),THREE.Gyroscope.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(this.translationWorld,this.quaternionWorld,this.scaleWorld),this.matrix.decompose(this.translationObject,this.quaternionObject,this.scaleObject),this.matrixWorld.compose(this.translationWorld,this.quaternionObject,this.scaleWorld)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,r=this.children.length;r>t;t++)this.children[t].updateMatrixWorld(e)},THREE.Gyroscope.prototype.translationWorld=new THREE.Vector3,THREE.Gyroscope.prototype.translationObject=new THREE.Vector3,THREE.Gyroscope.prototype.quaternionWorld=new THREE.Quaternion,THREE.Gyroscope.prototype.quaternionObject=new THREE.Quaternion,THREE.Gyroscope.prototype.scaleWorld=new THREE.Vector3,THREE.Gyroscope.prototype.scaleObject=new THREE.Vector3,THREE.Path=function(e){THREE.CurvePath.call(this),this.actions=[],e&&this.fromPoints(e)},THREE.Path.prototype=Object.create(THREE.CurvePath.prototype),THREE.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},THREE.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,r=e.length;r>t;t++)this.lineTo(e[t].x,e[t].y)},THREE.Path.prototype.moveTo=function(){var e=Array.prototype.slice.call(arguments);this.actions.push({action:THREE.PathActions.MOVE_TO,args:e})},THREE.Path.prototype.lineTo=function(e,t){var r=Array.prototype.slice.call(arguments),n=this.actions[this.actions.length-1].args,i=n[n.length-2],o=n[n.length-1],a=new THREE.LineCurve(new THREE.Vector2(i,o),new THREE.Vector2(e,t));this.curves.push(a),this.actions.push({action:THREE.PathActions.LINE_TO,args:r})},THREE.Path.prototype.quadraticCurveTo=function(e,t,r,n){var i=Array.prototype.slice.call(arguments),o=this.actions[this.actions.length-1].args,a=o[o.length-2],s=o[o.length-1],l=new THREE.QuadraticBezierCurve(new THREE.Vector2(a,s),new THREE.Vector2(e,t),new THREE.Vector2(r,n));this.curves.push(l),this.actions.push({action:THREE.PathActions.QUADRATIC_CURVE_TO,args:i})},THREE.Path.prototype.bezierCurveTo=function(e,t,r,n,i,o){var a=Array.prototype.slice.call(arguments),s=this.actions[this.actions.length-1].args,l=s[s.length-2],c=s[s.length-1],h=new THREE.CubicBezierCurve(new THREE.Vector2(l,c),new THREE.Vector2(e,t),new THREE.Vector2(r,n),new THREE.Vector2(i,o));this.curves.push(h),this.actions.push({action:THREE.PathActions.BEZIER_CURVE_TO,args:a})},THREE.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),r=this.actions[this.actions.length-1].args,n=r[r.length-2],i=r[r.length-1],o=[new THREE.Vector2(n,i)];Array.prototype.push.apply(o,e);var a=new THREE.SplineCurve(o);this.curves.push(a),this.actions.push({action:THREE.PathActions.CSPLINE_THRU,args:t})},THREE.Path.prototype.arc=function(e,t,r,n,i,o){var a=this.actions[this.actions.length-1].args,s=a[a.length-2],l=a[a.length-1];this.absarc(e+s,t+l,r,n,i,o)},THREE.Path.prototype.absarc=function(e,t,r,n,i,o){this.absellipse(e,t,r,r,n,i,o)},THREE.Path.prototype.ellipse=function(e,t,r,n,i,o,a){var s=this.actions[this.actions.length-1].args,l=s[s.length-2],c=s[s.length-1];this.absellipse(e+l,t+c,r,n,i,o,a)},THREE.Path.prototype.absellipse=function(e,t,r,n,i,o,a){var s=Array.prototype.slice.call(arguments),l=new THREE.EllipseCurve(e,t,r,n,i,o,a);this.curves.push(l);var c=l.getPoint(1);s.push(c.x),s.push(c.y),this.actions.push({action:THREE.PathActions.ELLIPSE,args:s})},THREE.Path.prototype.getSpacedPoints=function(e){e||(e=40);for(var t=[],r=0;e>r;r++)t.push(this.getPoint(r/e));return t},THREE.Path.prototype.getPoints=function(e,t){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(e,t);e=e||12;var r,n,i,o,a,s,l,c,h,u,f,d,p,m,g,v,E,y,T=[];for(r=0,n=this.actions.length;n>r;r++)switch(i=this.actions[r],o=i.action,a=i.args,o){case THREE.PathActions.MOVE_TO:T.push(new THREE.Vector2(a[0],a[1]));break;case THREE.PathActions.LINE_TO:T.push(new THREE.Vector2(a[0],a[1]));break;case THREE.PathActions.QUADRATIC_CURVE_TO:for(s=a[2],l=a[3],u=a[0],f=a[1],T.length>0?(m=T[T.length-1],d=m.x,p=m.y):(m=this.actions[r-1].args,d=m[m.length-2],p=m[m.length-1]),g=1;e>=g;g++)v=g/e,E=THREE.Shape.Utils.b2(v,d,u,s),y=THREE.Shape.Utils.b2(v,p,f,l),T.push(new THREE.Vector2(E,y));break;case THREE.PathActions.BEZIER_CURVE_TO:for(s=a[4],l=a[5],u=a[0],f=a[1],c=a[2],h=a[3],T.length>0?(m=T[T.length-1],d=m.x,p=m.y):(m=this.actions[r-1].args,d=m[m.length-2],p=m[m.length-1]),g=1;e>=g;g++)v=g/e,E=THREE.Shape.Utils.b3(v,d,u,c,s),y=THREE.Shape.Utils.b3(v,p,f,h,l),T.push(new THREE.Vector2(E,y));break;case THREE.PathActions.CSPLINE_THRU:m=this.actions[r-1].args;var x=new THREE.Vector2(m[m.length-2],m[m.length-1]),w=[x],b=e*a[0].length;w=w.concat(a[0]);var R=new THREE.SplineCurve(w);for(g=1;b>=g;g++)T.push(R.getPointAt(g/b));break;case THREE.PathActions.ARC:var _,H=a[0],M=a[1],S=a[2],C=a[3],A=a[4],k=!!a[5],L=A-C,P=2*e;for(g=1;P>=g;g++)v=g/P,k||(v=1-v),_=C+v*L,E=H+S*Math.cos(_),y=M+S*Math.sin(_),T.push(new THREE.Vector2(E,y));break;case THREE.PathActions.ELLIPSE:var _,H=a[0],M=a[1],F=a[2],N=a[3],C=a[4],A=a[5],k=!!a[6],L=A-C,P=2*e;for(g=1;P>=g;g++)v=g/P,k||(v=1-v),_=C+v*L,E=H+F*Math.cos(_),y=M+N*Math.sin(_),T.push(new THREE.Vector2(E,y))}var D=T[T.length-1],U=1e-10;return Math.abs(D.x-T[0].x)<U&&Math.abs(D.y-T[0].y)<U&&T.splice(T.length-1,1),t&&T.push(T[0]),T},THREE.Path.prototype.toShapes=function(e,t){function r(e){var t,r,n,i,o,a=[],s=new THREE.Path;for(t=0,r=e.length;r>t;t++)n=e[t],o=n.args,i=n.action,i==THREE.PathActions.MOVE_TO&&0!=s.actions.length&&(a.push(s),s=new THREE.Path),s[i].apply(s,o);return 0!=s.actions.length&&a.push(s),a}function n(e){for(var t=[],r=0,n=e.length;n>r;r++){var i=e[r],o=new THREE.Shape;o.actions=i.actions,o.curves=i.curves,t.push(o)}return t}function i(e,t){for(var r=1e-10,n=t.length,i=!1,o=n-1,a=0;n>a;o=a++){var s=t[o],l=t[a],c=l.x-s.x,h=l.y-s.y;if(Math.abs(h)>r){if(0>h&&(s=t[a],c=-c,l=t[o],h=-h),e.y<s.y||e.y>l.y)continue;if(e.y==s.y){if(e.x==s.x)return!0}else{var u=h*(e.x-s.x)-c*(e.y-s.y);if(0==u)return!0;if(0>u)continue;i=!i}}else{if(e.y!=s.y)continue;if(l.x<=e.x&&e.x<=s.x||s.x<=e.x&&e.x<=l.x)return!0}}return i}var o=r(this.actions);if(0==o.length)return[];if(t===!0)return n(o);var a,s,l,c=[];if(1==o.length)return s=o[0],l=new THREE.Shape,l.actions=s.actions,l.curves=s.curves,c.push(l),c;var h=!THREE.Shape.Utils.isClockWise(o[0].getPoints());h=e?!h:h;var u,f=[],d=[],p=[],m=0;d[m]=void 0,p[m]=[];var g,v;for(g=0,v=o.length;v>g;g++)s=o[g],u=s.getPoints(),a=THREE.Shape.Utils.isClockWise(u),a=e?!a:a,a?(!h&&d[m]&&m++,d[m]={s:new THREE.Shape,p:u},d[m].s.actions=s.actions,d[m].s.curves=s.curves,h&&m++,p[m]=[]):p[m].push({h:s,p:u[0]});if(!d[0])return n(o);if(d.length>1){for(var E=!1,y=[],T=0,x=d.length;x>T;T++)f[T]=[];for(var T=0,x=d.length;x>T;T++)for(var w=(d[T],p[T]),b=0;b<w.length;b++){for(var R=w[b],_=!0,H=0;H<d.length;H++)i(R.p,d[H].p)&&(T!=H&&y.push({froms:T,tos:H,hole:b}),_?(_=!1,f[H].push(R)):E=!0);_&&f[T].push(R)}y.length>0&&(E||(p=f))}var M,S,C;for(g=0,v=d.length;v>g;g++)for(l=d[g].s,c.push(l),M=p[g],S=0,C=M.length;C>S;S++)l.holes.push(M[S].h);return c},THREE.Shape=function(){THREE.Path.apply(this,arguments),this.holes=[]},THREE.Shape.prototype=Object.create(THREE.Path.prototype),THREE.Shape.prototype.extrude=function(e){var t=new THREE.ExtrudeGeometry(this,e);return t},THREE.Shape.prototype.makeGeometry=function(e){var t=new THREE.ShapeGeometry(this,e);return t},THREE.Shape.prototype.getPointsHoles=function(e){var t,r=this.holes.length,n=[];for(t=0;r>t;t++)n[t]=this.holes[t].getTransformedPoints(e,this.bends);return n},THREE.Shape.prototype.getSpacedPointsHoles=function(e){var t,r=this.holes.length,n=[];for(t=0;r>t;t++)n[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends);return n},THREE.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}},THREE.Shape.prototype.extractPoints=function(e){return this.useSpacedPoints?this.extractAllSpacedPoints(e):this.extractAllPoints(e)},THREE.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}},THREE.Shape.Utils={triangulateShape:function(e,t){function r(e,t,r){return e.x!=t.x?e.x<t.x?e.x<=r.x&&r.x<=t.x:t.x<=r.x&&r.x<=e.x:e.y<t.y?e.y<=r.y&&r.y<=t.y:t.y<=r.y&&r.y<=e.y}function n(e,t,n,i,o){var a=1e-10,s=t.x-e.x,l=t.y-e.y,c=i.x-n.x,h=i.y-n.y,u=e.x-n.x,f=e.y-n.y,d=l*c-s*h,p=l*u-s*f;if(Math.abs(d)>a){var m;if(d>0){if(0>p||p>d)return[];if(m=h*u-c*f,0>m||m>d)return[]}else{if(p>0||d>p)return[];if(m=h*u-c*f,m>0||d>m)return[]}if(0==m)return!o||0!=p&&p!=d?[e]:[];if(m==d)return!o||0!=p&&p!=d?[t]:[];if(0==p)return[n];if(p==d)return[i];var g=m/d;return[{x:e.x+g*s,y:e.y+g*l}]}if(0!=p||h*u!=c*f)return[];var v=0==s&&0==l,E=0==c&&0==h;if(v&&E)return e.x!=n.x||e.y!=n.y?[]:[e];if(v)return r(n,i,e)?[e]:[];if(E)return r(e,t,n)?[n]:[];var y,T,x,w,b,R,_,H;return 0!=s?(e.x<t.x?(y=e,x=e.x,T=t,w=t.x):(y=t,x=t.x,T=e,w=e.x),n.x<i.x?(b=n,_=n.x,R=i,H=i.x):(b=i,_=i.x,R=n,H=n.x)):(e.y<t.y?(y=e,x=e.y,T=t,w=t.y):(y=t,x=t.y,T=e,w=e.y),n.y<i.y?(b=n,_=n.y,R=i,H=i.y):(b=i,_=i.y,R=n,H=n.y)),_>=x?_>w?[]:w==_?o?[]:[b]:H>=w?[b,T]:[b,R]:x>H?[]:x==H?o?[]:[y]:H>=w?[y,T]:[y,R]}function i(e,t,r,n){var i=1e-10,o=t.x-e.x,a=t.y-e.y,s=r.x-e.x,l=r.y-e.y,c=n.x-e.x,h=n.y-e.y,u=o*l-a*s,f=o*h-a*c;if(Math.abs(u)>i){var d=c*l-h*s;return u>0?f>=0&&d>=0:f>=0||d>=0}return f>0}function o(e,t){function r(e,t){var r=E.length-1,n=e-1;0>n&&(n=r);var o=e+1;o>r&&(o=0);var a=i(E[e],E[n],E[o],s[t]);if(!a)return!1;var l=s.length-1,c=t-1;0>c&&(c=l);var h=t+1;return h>l&&(h=0),a=i(s[t],s[c],s[h],E[e]),a?!0:!1}function o(e,t){var r,i,o;for(r=0;r<E.length;r++)if(i=r+1,i%=E.length,o=n(e,t,E[r],E[i],!0),o.length>0)return!0;return!1}function a(e,r){var i,o,a,s,l;for(i=0;i<y.length;i++)for(o=t[y[i]],a=0;a<o.length;a++)if(s=a+1,s%=o.length,l=n(e,r,o[a],o[s],!0),l.length>0)return!0;return!1}for(var s,l,c,h,u,f,d,p,m,g,v,E=e.concat(),y=[],T=[],x=0,w=t.length;w>x;x++)y.push(x);for(var b=0,R=2*y.length;y.length>0;){if(R--,0>R){console.log("Infinite Loop! Holes left:"+y.length+", Probably Hole outside Shape!");break}for(c=b;c<E.length;c++){h=E[c],l=-1;for(var x=0;x<y.length;x++)if(f=y[x],d=h.x+":"+h.y+":"+f,void 0===T[d]){s=t[f];for(var _=0;_<s.length;_++)if(u=s[_],r(c,_)&&!o(h,u)&&!a(h,u)){l=_,y.splice(x,1),p=E.slice(0,c+1),m=E.slice(c),g=s.slice(l),v=s.slice(0,l+1),E=p.concat(g).concat(v).concat(m),b=c;break}if(l>=0)break;T[d]=!0}if(l>=0)break}}return E}for(var a,s,l,c,h,u,f={},d=e.concat(),p=0,m=t.length;m>p;p++)Array.prototype.push.apply(d,t[p]);for(a=0,s=d.length;s>a;a++)h=d[a].x+":"+d[a].y,void 0!==f[h]&&console.log("Duplicate point",h),f[h]=a;var g=o(e,t),v=THREE.FontUtils.Triangulate(g,!1);for(a=0,s=v.length;s>a;a++)for(c=v[a],l=0;3>l;l++)h=c[l].x+":"+c[l].y,u=f[h],void 0!==u&&(c[l]=u);return v.concat()},isClockWise:function(e){return THREE.FontUtils.Triangulate.area(e)<0},b2p0:function(e,t){var r=1-e;return r*r*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t
},b2:function(e,t,r,n){return this.b2p0(e,t)+this.b2p1(e,r)+this.b2p2(e,n)},b3p0:function(e,t){var r=1-e;return r*r*r*t},b3p1:function(e,t){var r=1-e;return 3*r*r*e*t},b3p2:function(e,t){var r=1-e;return 3*r*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,r,n,i){return this.b3p0(e,t)+this.b3p1(e,r)+this.b3p2(e,n)+this.b3p3(e,i)}},THREE.LineCurve=function(e,t){this.v1=e,this.v2=t},THREE.LineCurve.prototype=Object.create(THREE.Curve.prototype),THREE.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},THREE.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},THREE.LineCurve.prototype.getTangent=function(){var e=this.v2.clone().sub(this.v1);return e.normalize()},THREE.QuadraticBezierCurve=function(e,t,r){this.v0=e,this.v1=t,this.v2=r},THREE.QuadraticBezierCurve.prototype=Object.create(THREE.Curve.prototype),THREE.QuadraticBezierCurve.prototype.getPoint=function(e){var t,r;return t=THREE.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),r=THREE.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),new THREE.Vector2(t,r)},THREE.QuadraticBezierCurve.prototype.getTangent=function(e){var t,r;t=THREE.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x),r=THREE.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y);var n=new THREE.Vector2(t,r);return n.normalize(),n},THREE.CubicBezierCurve=function(e,t,r,n){this.v0=e,this.v1=t,this.v2=r,this.v3=n},THREE.CubicBezierCurve.prototype=Object.create(THREE.Curve.prototype),THREE.CubicBezierCurve.prototype.getPoint=function(e){var t,r;return t=THREE.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),r=THREE.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new THREE.Vector2(t,r)},THREE.CubicBezierCurve.prototype.getTangent=function(e){var t,r;t=THREE.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),r=THREE.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var n=new THREE.Vector2(t,r);return n.normalize(),n},THREE.SplineCurve=function(e){this.points=void 0==e?[]:e},THREE.SplineCurve.prototype=Object.create(THREE.Curve.prototype),THREE.SplineCurve.prototype.getPoint=function(e){var t,r,n,i=new THREE.Vector2,o=[],a=this.points;return t=(a.length-1)*e,r=Math.floor(t),n=t-r,o[0]=0==r?r:r-1,o[1]=r,o[2]=r>a.length-2?a.length-1:r+1,o[3]=r>a.length-3?a.length-1:r+2,i.x=THREE.Curve.Utils.interpolate(a[o[0]].x,a[o[1]].x,a[o[2]].x,a[o[3]].x,n),i.y=THREE.Curve.Utils.interpolate(a[o[0]].y,a[o[1]].y,a[o[2]].y,a[o[3]].y,n),i},THREE.EllipseCurve=function(e,t,r,n,i,o,a){this.aX=e,this.aY=t,this.xRadius=r,this.yRadius=n,this.aStartAngle=i,this.aEndAngle=o,this.aClockwise=a},THREE.EllipseCurve.prototype=Object.create(THREE.Curve.prototype),THREE.EllipseCurve.prototype.getPoint=function(e){var t,r=this.aEndAngle-this.aStartAngle;0>r&&(r+=2*Math.PI),r>2*Math.PI&&(r-=2*Math.PI),t=this.aClockwise===!0?this.aEndAngle+(1-e)*(2*Math.PI-r):this.aStartAngle+e*r;var n=this.aX+this.xRadius*Math.cos(t),i=this.aY+this.yRadius*Math.sin(t);return new THREE.Vector2(n,i)},THREE.ArcCurve=function(e,t,r,n,i,o){THREE.EllipseCurve.call(this,e,t,r,r,n,i,o)},THREE.ArcCurve.prototype=Object.create(THREE.EllipseCurve.prototype),THREE.LineCurve3=THREE.Curve.create(function(e,t){this.v1=e,this.v2=t},function(e){var t=new THREE.Vector3;return t.subVectors(this.v2,this.v1),t.multiplyScalar(e),t.add(this.v1),t}),THREE.QuadraticBezierCurve3=THREE.Curve.create(function(e,t,r){this.v0=e,this.v1=t,this.v2=r},function(e){var t,r,n;return t=THREE.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),r=THREE.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),n=THREE.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z),new THREE.Vector3(t,r,n)}),THREE.CubicBezierCurve3=THREE.Curve.create(function(e,t,r,n){this.v0=e,this.v1=t,this.v2=r,this.v3=n},function(e){var t,r,n;return t=THREE.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),r=THREE.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),n=THREE.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new THREE.Vector3(t,r,n)}),THREE.SplineCurve3=THREE.Curve.create(function(e){this.points=void 0==e?[]:e},function(e){var t,r,n,i=new THREE.Vector3,o=[],a=this.points;t=(a.length-1)*e,r=Math.floor(t),n=t-r,o[0]=0==r?r:r-1,o[1]=r,o[2]=r>a.length-2?a.length-1:r+1,o[3]=r>a.length-3?a.length-1:r+2;var s=a[o[0]],l=a[o[1]],c=a[o[2]],h=a[o[3]];return i.x=THREE.Curve.Utils.interpolate(s.x,l.x,c.x,h.x,n),i.y=THREE.Curve.Utils.interpolate(s.y,l.y,c.y,h.y,n),i.z=THREE.Curve.Utils.interpolate(s.z,l.z,c.z,h.z,n),i}),THREE.ClosedSplineCurve3=THREE.Curve.create(function(e){this.points=void 0==e?[]:e},function(e){var t,r,n,i=new THREE.Vector3,o=[],a=this.points;return t=(a.length-0)*e,r=Math.floor(t),n=t-r,r+=r>0?0:(Math.floor(Math.abs(r)/a.length)+1)*a.length,o[0]=(r-1)%a.length,o[1]=r%a.length,o[2]=(r+1)%a.length,o[3]=(r+2)%a.length,i.x=THREE.Curve.Utils.interpolate(a[o[0]].x,a[o[1]].x,a[o[2]].x,a[o[3]].x,n),i.y=THREE.Curve.Utils.interpolate(a[o[0]].y,a[o[1]].y,a[o[2]].y,a[o[3]].y,n),i.z=THREE.Curve.Utils.interpolate(a[o[0]].z,a[o[1]].z,a[o[2]].z,a[o[3]].z,n),i}),THREE.AnimationHandler={LINEAR:0,CATMULLROM:1,CATMULLROM_FORWARD:2,add:function(){console.warn("THREE.AnimationHandler.add() has been deprecated.")},get:function(){console.warn("THREE.AnimationHandler.get() has been deprecated.")},remove:function(){console.warn("THREE.AnimationHandler.remove() has been deprecated.")},animations:[],init:function(e){if(e.initialized!==!0){for(var t=0;t<e.hierarchy.length;t++){for(var r=0;r<e.hierarchy[t].keys.length;r++)if(e.hierarchy[t].keys[r].time<0&&(e.hierarchy[t].keys[r].time=0),void 0!==e.hierarchy[t].keys[r].rot&&!(e.hierarchy[t].keys[r].rot instanceof THREE.Quaternion)){var n=e.hierarchy[t].keys[r].rot;e.hierarchy[t].keys[r].rot=(new THREE.Quaternion).fromArray(n)}if(e.hierarchy[t].keys.length&&void 0!==e.hierarchy[t].keys[0].morphTargets){for(var i={},r=0;r<e.hierarchy[t].keys.length;r++)for(var o=0;o<e.hierarchy[t].keys[r].morphTargets.length;o++){var a=e.hierarchy[t].keys[r].morphTargets[o];i[a]=-1}e.hierarchy[t].usedMorphTargets=i;for(var r=0;r<e.hierarchy[t].keys.length;r++){var s={};for(var a in i){for(var o=0;o<e.hierarchy[t].keys[r].morphTargets.length;o++)if(e.hierarchy[t].keys[r].morphTargets[o]===a){s[a]=e.hierarchy[t].keys[r].morphTargetsInfluences[o];break}o===e.hierarchy[t].keys[r].morphTargets.length&&(s[a]=0)}e.hierarchy[t].keys[r].morphTargetsInfluences=s}}for(var r=1;r<e.hierarchy[t].keys.length;r++)e.hierarchy[t].keys[r].time===e.hierarchy[t].keys[r-1].time&&(e.hierarchy[t].keys.splice(r,1),r--);for(var r=0;r<e.hierarchy[t].keys.length;r++)e.hierarchy[t].keys[r].index=r}return e.initialized=!0,e}},parse:function(e){var t=function(e,r){r.push(e);for(var n=0;n<e.children.length;n++)t(e.children[n],r)},r=[];if(e instanceof THREE.SkinnedMesh)for(var n=0;n<e.skeleton.bones.length;n++)r.push(e.skeleton.bones[n]);else t(e,r);return r},play:function(e){-1===this.animations.indexOf(e)&&this.animations.push(e)},stop:function(e){var t=this.animations.indexOf(e);-1!==t&&this.animations.splice(t,1)},update:function(e){for(var t=0;t<this.animations.length;t++)this.animations[t].update(e)}},THREE.Animation=function(e,t){this.root=e,this.data=THREE.AnimationHandler.init(t),this.hierarchy=THREE.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.loop=!0,this.weight=0,this.interpolationType=THREE.AnimationHandler.LINEAR},THREE.Animation.prototype.keyTypes=["pos","rot","scl"],THREE.Animation.prototype.play=function(e,t){this.currentTime=void 0!==e?e:0,this.weight=void 0!==t?t:1,this.isPlaying=!0,this.reset(),THREE.AnimationHandler.play(this)},THREE.Animation.prototype.stop=function(){this.isPlaying=!1,THREE.AnimationHandler.stop(this)},THREE.Animation.prototype.reset=function(){for(var e=0,t=this.hierarchy.length;t>e;e++){var r=this.hierarchy[e];r.matrixAutoUpdate=!0,void 0===r.animationCache&&(r.animationCache={}),void 0===r.animationCache[this.data.name]&&(r.animationCache[this.data.name]={},r.animationCache[this.data.name].prevKey={pos:0,rot:0,scl:0},r.animationCache[this.data.name].nextKey={pos:0,rot:0,scl:0},r.animationCache[this.data.name].originalMatrix=r.matrix);for(var n=r.animationCache[this.data.name],i=0;3>i;i++){for(var o=this.keyTypes[i],a=this.data.hierarchy[e].keys[0],s=this.getNextKeyWith(o,e,1);s.time<this.currentTime&&s.index>a.index;)a=s,s=this.getNextKeyWith(o,e,s.index+1);n.prevKey[o]=a,n.nextKey[o]=s}}},THREE.Animation.prototype.update=function(){var e=[],t=new THREE.Vector3,r=new THREE.Vector3,n=new THREE.Quaternion,i=function(e,t){var r,n,i,a,s,l,c,h,u,f=[],d=[];return r=(e.length-1)*t,n=Math.floor(r),i=r-n,f[0]=0===n?n:n-1,f[1]=n,f[2]=n>e.length-2?n:n+1,f[3]=n>e.length-3?n:n+2,l=e[f[0]],c=e[f[1]],h=e[f[2]],u=e[f[3]],a=i*i,s=i*a,d[0]=o(l[0],c[0],h[0],u[0],i,a,s),d[1]=o(l[1],c[1],h[1],u[1],i,a,s),d[2]=o(l[2],c[2],h[2],u[2],i,a,s),d},o=function(e,t,r,n,i,o,a){var s=.5*(r-e),l=.5*(n-t);return(2*(t-r)+s+l)*a+(-3*(t-r)-2*s-l)*o+s*i+t};return function(o){if(this.isPlaying!==!1&&(this.currentTime+=o*this.timeScale,0!==this.weight)){var a=this.data.length;if(this.loop===!0&&this.currentTime>a)this.currentTime%=a,this.reset();else if(this.loop===!1&&this.currentTime>a)return void this.stop();for(var s=0,l=this.hierarchy.length;l>s;s++)for(var c=this.hierarchy[s],h=c.animationCache[this.data.name],u=0;3>u;u++){var f=this.keyTypes[u],d=h.prevKey[f],p=h.nextKey[f];if(p.time<=this.currentTime){for(d=this.data.hierarchy[s].keys[0],p=this.getNextKeyWith(f,s,1);p.time<this.currentTime&&p.index>d.index;)d=p,p=this.getNextKeyWith(f,s,p.index+1);h.prevKey[f]=d,h.nextKey[f]=p}c.matrixAutoUpdate=!0,c.matrixWorldNeedsUpdate=!0;var m=(this.currentTime-d.time)/(p.time-d.time),g=d[f],v=p[f];if(0>m&&(m=0),m>1&&(m=1),"pos"===f){if(this.interpolationType===THREE.AnimationHandler.LINEAR)if(r.x=g[0]+(v[0]-g[0])*m,r.y=g[1]+(v[1]-g[1])*m,r.z=g[2]+(v[2]-g[2])*m,c instanceof THREE.Bone){var E=this.weight/(this.weight+c.accumulatedPosWeight);c.position.lerp(r,E),c.accumulatedPosWeight+=this.weight}else c.position.copy(r);else if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){e[0]=this.getPrevKeyWith("pos",s,d.index-1).pos,e[1]=g,e[2]=v,e[3]=this.getNextKeyWith("pos",s,p.index+1).pos,m=.33*m+.33;var y=i(e,m),E=1;c instanceof THREE.Bone&&(E=this.weight/(this.weight+c.accumulatedPosWeight),c.accumulatedPosWeight+=this.weight);var T=c.position;if(T.x=T.x+(y[0]-T.x)*E,T.y=T.y+(y[1]-T.y)*E,T.z=T.z+(y[2]-T.z)*E,this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){var x=i(e,1.01*m);t.set(x[0],x[1],x[2]),t.sub(T),t.y=0,t.normalize();var w=Math.atan2(t.x,t.z);c.rotation.set(0,w,0)}}}else if("rot"===f)if(THREE.Quaternion.slerp(g,v,n,m),c instanceof THREE.Bone)if(0===c.accumulatedRotWeight)c.quaternion.copy(n),c.accumulatedRotWeight=this.weight;else{var E=this.weight/(this.weight+c.accumulatedRotWeight);THREE.Quaternion.slerp(c.quaternion,n,c.quaternion,E),c.accumulatedRotWeight+=this.weight}else c.quaternion.copy(n);else if("scl"===f)if(r.x=g[0]+(v[0]-g[0])*m,r.y=g[1]+(v[1]-g[1])*m,r.z=g[2]+(v[2]-g[2])*m,c instanceof THREE.Bone){var E=this.weight/(this.weight+c.accumulatedSclWeight);c.scale.lerp(r,E),c.accumulatedSclWeight+=this.weight}else c.scale.copy(r)}return!0}}}(),THREE.Animation.prototype.getNextKeyWith=function(e,t,r){var n=this.data.hierarchy[t].keys;for(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?r=r<n.length-1?r:n.length-1:r%=n.length;r<n.length;r++)if(void 0!==n[r][e])return n[r];return this.data.hierarchy[t].keys[0]},THREE.Animation.prototype.getPrevKeyWith=function(e,t,r){var n=this.data.hierarchy[t].keys;for(r=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?r>0?r:0:r>=0?r:r+n.length;r>=0;r--)if(void 0!==n[r][e])return n[r];return this.data.hierarchy[t].keys[n.length-1]},THREE.KeyFrameAnimation=function(e){this.root=e.node,this.data=THREE.AnimationHandler.init(e),this.hierarchy=THREE.AnimationHandler.parse(this.root),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.isPaused=!0,this.loop=!0;for(var t=0,r=this.hierarchy.length;r>t;t++){var n=this.data.hierarchy[t].keys,i=this.data.hierarchy[t].sids,o=this.hierarchy[t];if(n.length&&i){for(var a=0;a<i.length;a++){var s=i[a],l=this.getNextKeyWith(s,t,0);l&&l.apply(s)}o.matrixAutoUpdate=!1,this.data.hierarchy[t].node.updateMatrix(),o.matrixWorldNeedsUpdate=!0}}},THREE.KeyFrameAnimation.prototype.play=function(e){if(this.currentTime=void 0!==e?e:0,this.isPlaying===!1){this.isPlaying=!0;var t,r,n,i=this.hierarchy.length;for(t=0;i>t;t++){r=this.hierarchy[t],n=this.data.hierarchy[t],void 0===n.animationCache&&(n.animationCache={},n.animationCache.prevKey=null,n.animationCache.nextKey=null,n.animationCache.originalMatrix=r.matrix);var o=this.data.hierarchy[t].keys;o.length&&(n.animationCache.prevKey=o[0],n.animationCache.nextKey=o[1],this.startTime=Math.min(o[0].time,this.startTime),this.endTime=Math.max(o[o.length-1].time,this.endTime))}this.update(0)}this.isPaused=!1,THREE.AnimationHandler.play(this)},THREE.KeyFrameAnimation.prototype.stop=function(){this.isPlaying=!1,this.isPaused=!1,THREE.AnimationHandler.stop(this);for(var e=0;e<this.data.hierarchy.length;e++){var t=this.hierarchy[e],r=this.data.hierarchy[e];if(void 0!==r.animationCache){var n=r.animationCache.originalMatrix;n.copy(t.matrix),t.matrix=n,delete r.animationCache}}},THREE.KeyFrameAnimation.prototype.update=function(e){if(this.isPlaying!==!1){this.currentTime+=e*this.timeScale;var t=this.data.length;this.loop===!0&&this.currentTime>t&&(this.currentTime%=t),this.currentTime=Math.min(this.currentTime,t);for(var r=0,n=this.hierarchy.length;n>r;r++){var i=this.hierarchy[r],o=this.data.hierarchy[r],a=o.keys,s=o.animationCache;if(a.length){var l=s.prevKey,c=s.nextKey;if(c.time<=this.currentTime){for(;c.time<this.currentTime&&c.index>l.index;)l=c,c=a[l.index+1];s.prevKey=l,s.nextKey=c}c.time>=this.currentTime?l.interpolate(c,this.currentTime):l.interpolate(c,c.time),this.data.hierarchy[r].node.updateMatrix(),i.matrixWorldNeedsUpdate=!0}}}},THREE.KeyFrameAnimation.prototype.getNextKeyWith=function(e,t,r){var n=this.data.hierarchy[t].keys;for(r%=n.length;r<n.length;r++)if(n[r].hasTarget(e))return n[r];return n[0]},THREE.KeyFrameAnimation.prototype.getPrevKeyWith=function(e,t,r){var n=this.data.hierarchy[t].keys;for(r=r>=0?r:r+n.length;r>=0;r--)if(n[r].hasTarget(e))return n[r];return n[n.length-1]},THREE.MorphAnimation=function(e){this.mesh=e,this.frames=e.morphTargetInfluences.length,this.currentTime=0,this.duration=1e3,this.loop=!0,this.isPlaying=!1},THREE.MorphAnimation.prototype={play:function(){this.isPlaying=!0},pause:function(){this.isPlaying=!1},update:function(){var e=0,t=0;return function(r){if(this.isPlaying!==!1){this.currentTime+=r,this.loop===!0&&this.currentTime>this.duration&&(this.currentTime%=this.duration),this.currentTime=Math.min(this.currentTime,this.duration);var n=this.duration/this.frames,i=Math.floor(this.currentTime/n);i!=t&&(this.mesh.morphTargetInfluences[e]=0,this.mesh.morphTargetInfluences[t]=1,this.mesh.morphTargetInfluences[i]=0,e=t,t=i),this.mesh.morphTargetInfluences[i]=this.currentTime%n/n,this.mesh.morphTargetInfluences[e]=1-this.mesh.morphTargetInfluences[i]}}}()},THREE.BoxGeometry=function(e,t,r,n,i,o){function a(e,t,r,n,i,o,a,l){var c,h,u,f=s.widthSegments,d=s.heightSegments,p=i/2,m=o/2,g=s.vertices.length;"x"===e&&"y"===t||"y"===e&&"x"===t?c="z":"x"===e&&"z"===t||"z"===e&&"x"===t?(c="y",d=s.depthSegments):("z"===e&&"y"===t||"y"===e&&"z"===t)&&(c="x",f=s.depthSegments);var v=f+1,E=d+1,y=i/f,T=o/d,x=new THREE.Vector3;for(x[c]=a>0?1:-1,u=0;E>u;u++)for(h=0;v>h;h++){var w=new THREE.Vector3;w[e]=(h*y-p)*r,w[t]=(u*T-m)*n,w[c]=a,s.vertices.push(w)}for(u=0;d>u;u++)for(h=0;f>h;h++){var b=h+v*u,R=h+v*(u+1),_=h+1+v*(u+1),H=h+1+v*u,M=new THREE.Vector2(h/f,1-u/d),S=new THREE.Vector2(h/f,1-(u+1)/d),C=new THREE.Vector2((h+1)/f,1-(u+1)/d),A=new THREE.Vector2((h+1)/f,1-u/d),k=new THREE.Face3(b+g,R+g,H+g);k.normal.copy(x),k.vertexNormals.push(x.clone(),x.clone(),x.clone()),k.materialIndex=l,s.faces.push(k),s.faceVertexUvs[0].push([M,S,A]),k=new THREE.Face3(R+g,_+g,H+g),k.normal.copy(x),k.vertexNormals.push(x.clone(),x.clone(),x.clone()),k.materialIndex=l,s.faces.push(k),s.faceVertexUvs[0].push([S.clone(),C,A.clone()])}}THREE.Geometry.call(this),this.parameters={width:e,height:t,depth:r,widthSegments:n,heightSegments:i,depthSegments:o},this.widthSegments=n||1,this.heightSegments=i||1,this.depthSegments=o||1;var s=this,l=e/2,c=t/2,h=r/2;a("z","y",-1,-1,r,t,l,0),a("z","y",1,-1,r,t,-l,1),a("x","z",1,1,e,r,c,2),a("x","z",1,-1,e,r,-c,3),a("x","y",1,-1,e,t,h,4),a("x","y",-1,-1,e,t,-h,5),this.mergeVertices()},THREE.BoxGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.CircleGeometry=function(e,t,r,n){THREE.Geometry.call(this),this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:n},e=e||50,t=void 0!==t?Math.max(3,t):8,r=void 0!==r?r:0,n=void 0!==n?n:2*Math.PI;var i,o=[],a=new THREE.Vector3,s=new THREE.Vector2(.5,.5);for(this.vertices.push(a),o.push(s),i=0;t>=i;i++){var l=new THREE.Vector3,c=r+i/t*n;l.x=e*Math.cos(c),l.y=e*Math.sin(c),this.vertices.push(l),o.push(new THREE.Vector2((l.x/e+1)/2,(l.y/e+1)/2))}var h=new THREE.Vector3(0,0,1);for(i=1;t>=i;i++)this.faces.push(new THREE.Face3(i,i+1,0,[h.clone(),h.clone(),h.clone()])),this.faceVertexUvs[0].push([o[i].clone(),o[i+1].clone(),s.clone()]);this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,e)},THREE.CircleGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.CubeGeometry=function(e,t,r,n,i,o){return console.warn("THEE.CubeGeometry has been renamed to THREE.BoxGeometry."),new THREE.BoxGeometry(e,t,r,n,i,o)},THREE.CylinderGeometry=function(e,t,r,n,i,o){THREE.Geometry.call(this),this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:n,heightSegments:i,openEnded:o},e=void 0!==e?e:20,t=void 0!==t?t:20,r=void 0!==r?r:100,n=n||8,i=i||1,o=void 0!==o?o:!1;var a,s,l=r/2,c=[],h=[];for(s=0;i>=s;s++){var u=[],f=[],d=s/i,p=d*(t-e)+e;for(a=0;n>=a;a++){var m=a/n,g=new THREE.Vector3;g.x=p*Math.sin(m*Math.PI*2),g.y=-d*r+l,g.z=p*Math.cos(m*Math.PI*2),this.vertices.push(g),u.push(this.vertices.length-1),f.push(new THREE.Vector2(m,1-d))}c.push(u),h.push(f)}var v,E,y=(t-e)/r;for(a=0;n>a;a++)for(0!==e?(v=this.vertices[c[0][a]].clone(),E=this.vertices[c[0][a+1]].clone()):(v=this.vertices[c[1][a]].clone(),E=this.vertices[c[1][a+1]].clone()),v.setY(Math.sqrt(v.x*v.x+v.z*v.z)*y).normalize(),E.setY(Math.sqrt(E.x*E.x+E.z*E.z)*y).normalize(),s=0;i>s;s++){var T=c[s][a],x=c[s+1][a],w=c[s+1][a+1],b=c[s][a+1],R=v.clone(),_=v.clone(),H=E.clone(),M=E.clone(),S=h[s][a].clone(),C=h[s+1][a].clone(),A=h[s+1][a+1].clone(),k=h[s][a+1].clone();this.faces.push(new THREE.Face3(T,x,b,[R,_,M])),this.faceVertexUvs[0].push([S,C,k]),this.faces.push(new THREE.Face3(x,w,b,[_.clone(),H,M.clone()])),this.faceVertexUvs[0].push([C.clone(),A,k.clone()])}if(o===!1&&e>0)for(this.vertices.push(new THREE.Vector3(0,l,0)),a=0;n>a;a++){var T=c[0][a],x=c[0][a+1],w=this.vertices.length-1,R=new THREE.Vector3(0,1,0),_=new THREE.Vector3(0,1,0),H=new THREE.Vector3(0,1,0),S=h[0][a].clone(),C=h[0][a+1].clone(),A=new THREE.Vector2(C.x,0);this.faces.push(new THREE.Face3(T,x,w,[R,_,H])),this.faceVertexUvs[0].push([S,C,A])}if(o===!1&&t>0)for(this.vertices.push(new THREE.Vector3(0,-l,0)),a=0;n>a;a++){var T=c[s][a+1],x=c[s][a],w=this.vertices.length-1,R=new THREE.Vector3(0,-1,0),_=new THREE.Vector3(0,-1,0),H=new THREE.Vector3(0,-1,0),S=h[s][a+1].clone(),C=h[s][a].clone(),A=new THREE.Vector2(C.x,1);this.faces.push(new THREE.Face3(T,x,w,[R,_,H])),this.faceVertexUvs[0].push([S,C,A])}this.computeFaceNormals()},THREE.CylinderGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ExtrudeGeometry=function(e,t){return"undefined"==typeof e?void(e=[]):(THREE.Geometry.call(this),e=e instanceof Array?e:[e],this.addShapeList(e,t),void this.computeFaceNormals())},THREE.ExtrudeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ExtrudeGeometry.prototype.addShapeList=function(e,t){for(var r=e.length,n=0;r>n;n++){var i=e[n];this.addShape(i,t)}},THREE.ExtrudeGeometry.prototype.addShape=function(e,t){function r(e,t,r){return t||console.log("die"),t.clone().multiplyScalar(r).add(e)}function n(e,t,r){var n,i,o=1e-10,a=THREE.Math.sign,s=1,l=e.x-t.x,c=e.y-t.y,h=r.x-e.x,u=r.y-e.y,f=l*l+c*c,d=l*u-c*h;if(Math.abs(d)>o){var p=Math.sqrt(f),m=Math.sqrt(h*h+u*u),g=t.x-c/p,v=t.y+l/p,E=r.x-u/m,y=r.y+h/m,T=((E-g)*u-(y-v)*h)/(l*u-c*h);n=g+l*T-e.x,i=v+c*T-e.y;var x=n*n+i*i;if(2>=x)return new THREE.Vector2(n,i);s=Math.sqrt(x/2)}else{var w=!1;l>o?h>o&&(w=!0):-o>l?-o>h&&(w=!0):a(c)==a(u)&&(w=!0),w?(n=-c,i=l,s=Math.sqrt(f)):(n=l,i=c,s=Math.sqrt(f/2))}return new THREE.Vector2(n/s,i/s)}function i(){if(y){var e=0,t=j*e;for(q=0;W>q;q++)G=D[q],l(G[2]+t,G[1]+t,G[0]+t,!0);for(e=x+2*E,t=j*e,q=0;W>q;q++)G=D[q],l(G[0]+t,G[1]+t,G[2]+t,!1)}else{for(q=0;W>q;q++)G=D[q],l(G[2],G[1],G[0],!0);for(q=0;W>q;q++)G=D[q],l(G[0]+j*x,G[1]+j*x,G[2]+j*x,!1)}}function o(){var e=0;for(a(U,e),e+=U.length,S=0,C=F.length;C>S;S++)M=F[S],a(M,e),e+=M.length}function a(e,t){var r,n;for(q=e.length;--q>=0;){r=q,n=q-1,0>n&&(n=e.length-1);var i=0,o=x+2*E;for(i=0;o>i;i++){var a=j*i,s=j*(i+1),l=t+r+a,h=t+n+a,u=t+n+s,f=t+r+s;c(l,h,u,f,e,i,o,r,n)}}}function s(e,t,r){A.vertices.push(new THREE.Vector3(e,t,r))}function l(r,n,i,o){r+=k,n+=k,i+=k,A.faces.push(new THREE.Face3(r,n,i,null,null,R));var a=o?H.generateBottomUV(A,e,t,r,n,i):H.generateTopUV(A,e,t,r,n,i);A.faceVertexUvs[0].push(a)}function c(r,n,i,o,a,s,l,c,h){r+=k,n+=k,i+=k,o+=k,A.faces.push(new THREE.Face3(r,n,o,null,null,_)),A.faces.push(new THREE.Face3(n,i,o,null,null,_));var u=H.generateSideWallUV(A,e,a,t,r,n,i,o,s,l,c,h);A.faceVertexUvs[0].push([u[0],u[1],u[3]]),A.faceVertexUvs[0].push([u[1],u[2],u[3]])}var h,u,f,d,p,m=void 0!==t.amount?t.amount:100,g=void 0!==t.bevelThickness?t.bevelThickness:6,v=void 0!==t.bevelSize?t.bevelSize:g-2,E=void 0!==t.bevelSegments?t.bevelSegments:3,y=void 0!==t.bevelEnabled?t.bevelEnabled:!0,T=void 0!==t.curveSegments?t.curveSegments:12,x=void 0!==t.steps?t.steps:1,w=t.extrudePath,b=!1,R=t.material,_=t.extrudeMaterial,H=void 0!==t.UVGenerator?t.UVGenerator:THREE.ExtrudeGeometry.WorldUVGenerator;w&&(h=w.getSpacedPoints(x),b=!0,y=!1,u=void 0!==t.frames?t.frames:new THREE.TubeGeometry.FrenetFrames(w,x,!1),f=new THREE.Vector3,d=new THREE.Vector3,p=new THREE.Vector3),y||(E=0,g=0,v=0);var M,S,C,A=this,k=this.vertices.length,L=e.extractPoints(T),P=L.shape,F=L.holes,N=!THREE.Shape.Utils.isClockWise(P);if(N){for(P=P.reverse(),S=0,C=F.length;C>S;S++)M=F[S],THREE.Shape.Utils.isClockWise(M)&&(F[S]=M.reverse());N=!1}var D=THREE.Shape.Utils.triangulateShape(P,F),U=P;for(S=0,C=F.length;C>S;S++)M=F[S],P=P.concat(M);for(var O,z,I,V,B,G,j=P.length,W=D.length,X=(U.length,180/Math.PI,[]),q=0,Y=U.length,K=Y-1,Q=q+1;Y>q;q++,K++,Q++){K===Y&&(K=0),Q===Y&&(Q=0);{U[q],U[K],U[Q]}X[q]=n(U[q],U[K],U[Q])}var Z,$=[],J=X.concat();for(S=0,C=F.length;C>S;S++){for(M=F[S],Z=[],q=0,Y=M.length,K=Y-1,Q=q+1;Y>q;q++,K++,Q++)K===Y&&(K=0),Q===Y&&(Q=0),Z[q]=n(M[q],M[K],M[Q]);$.push(Z),J=J.concat(Z)}for(O=0;E>O;O++){for(I=O/E,V=g*(1-I),z=v*Math.sin(I*Math.PI/2),q=0,Y=U.length;Y>q;q++)B=r(U[q],X[q],z),s(B.x,B.y,-V);for(S=0,C=F.length;C>S;S++)for(M=F[S],Z=$[S],q=0,Y=M.length;Y>q;q++)B=r(M[q],Z[q],z),s(B.x,B.y,-V)}for(z=v,q=0;j>q;q++)B=y?r(P[q],J[q],z):P[q],b?(d.copy(u.normals[0]).multiplyScalar(B.x),f.copy(u.binormals[0]).multiplyScalar(B.y),p.copy(h[0]).add(d).add(f),s(p.x,p.y,p.z)):s(B.x,B.y,0);var et;for(et=1;x>=et;et++)for(q=0;j>q;q++)B=y?r(P[q],J[q],z):P[q],b?(d.copy(u.normals[et]).multiplyScalar(B.x),f.copy(u.binormals[et]).multiplyScalar(B.y),p.copy(h[et]).add(d).add(f),s(p.x,p.y,p.z)):s(B.x,B.y,m/x*et);for(O=E-1;O>=0;O--){for(I=O/E,V=g*(1-I),z=v*Math.sin(I*Math.PI/2),q=0,Y=U.length;Y>q;q++)B=r(U[q],X[q],z),s(B.x,B.y,m+V);for(S=0,C=F.length;C>S;S++)for(M=F[S],Z=$[S],q=0,Y=M.length;Y>q;q++)B=r(M[q],Z[q],z),b?s(B.x,B.y+h[x-1].y,h[x-1].x+V):s(B.x,B.y,m+V)}i(),o()},THREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,r,n,i,o){var a=e.vertices[n].x,s=e.vertices[n].y,l=e.vertices[i].x,c=e.vertices[i].y,h=e.vertices[o].x,u=e.vertices[o].y;return[new THREE.Vector2(a,s),new THREE.Vector2(l,c),new THREE.Vector2(h,u)]},generateBottomUV:function(e,t,r,n,i,o){return this.generateTopUV(e,t,r,n,i,o)},generateSideWallUV:function(e,t,r,n,i,o,a,s){var l=e.vertices[i].x,c=e.vertices[i].y,h=e.vertices[i].z,u=e.vertices[o].x,f=e.vertices[o].y,d=e.vertices[o].z,p=e.vertices[a].x,m=e.vertices[a].y,g=e.vertices[a].z,v=e.vertices[s].x,E=e.vertices[s].y,y=e.vertices[s].z;return Math.abs(c-f)<.01?[new THREE.Vector2(l,1-h),new THREE.Vector2(u,1-d),new THREE.Vector2(p,1-g),new THREE.Vector2(v,1-y)]:[new THREE.Vector2(c,1-h),new THREE.Vector2(f,1-d),new THREE.Vector2(m,1-g),new THREE.Vector2(E,1-y)]}},THREE.ExtrudeGeometry.__v1=new THREE.Vector2,THREE.ExtrudeGeometry.__v2=new THREE.Vector2,THREE.ExtrudeGeometry.__v3=new THREE.Vector2,THREE.ExtrudeGeometry.__v4=new THREE.Vector2,THREE.ExtrudeGeometry.__v5=new THREE.Vector2,THREE.ExtrudeGeometry.__v6=new THREE.Vector2,THREE.ShapeGeometry=function(e,t){THREE.Geometry.call(this),e instanceof Array==!1&&(e=[e]),this.addShapeList(e,t),this.computeFaceNormals()},THREE.ShapeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ShapeGeometry.prototype.addShapeList=function(e,t){for(var r=0,n=e.length;n>r;r++)this.addShape(e[r],t);return this},THREE.ShapeGeometry.prototype.addShape=function(e,t){void 0===t&&(t={});var r,n,i,o=void 0!==t.curveSegments?t.curveSegments:12,a=t.material,s=void 0===t.UVGenerator?THREE.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator,l=this.vertices.length,c=e.extractPoints(o),h=c.shape,u=c.holes,f=!THREE.Shape.Utils.isClockWise(h);if(f){for(h=h.reverse(),r=0,n=u.length;n>r;r++)i=u[r],THREE.Shape.Utils.isClockWise(i)&&(u[r]=i.reverse());f=!1}var d=THREE.Shape.Utils.triangulateShape(h,u),p=h;for(r=0,n=u.length;n>r;r++)i=u[r],h=h.concat(i);{var m,g,v=h.length,E=d.length;p.length}for(r=0;v>r;r++)m=h[r],this.vertices.push(new THREE.Vector3(m.x,m.y,0));for(r=0;E>r;r++){g=d[r];var y=g[0]+l,T=g[1]+l,x=g[2]+l;this.faces.push(new THREE.Face3(y,T,x,null,null,a)),this.faceVertexUvs[0].push(s.generateBottomUV(this,e,t,y,T,x))}},THREE.LatheGeometry=function(e,t,r,n){THREE.Geometry.call(this),t=t||12,r=r||0,n=n||2*Math.PI;for(var i=1/(e.length-1),o=1/t,a=0,s=t;s>=a;a++)for(var l=r+a*o*n,c=Math.cos(l),h=Math.sin(l),u=0,f=e.length;f>u;u++){var d=e[u],p=new THREE.Vector3;p.x=c*d.x-h*d.y,p.y=h*d.x+c*d.y,p.z=d.z,this.vertices.push(p)}for(var m=e.length,a=0,s=t;s>a;a++)for(var u=0,f=e.length-1;f>u;u++){var g=u+m*a,v=g,E=g+m,c=g+1+m,y=g+1,T=a*o,x=u*i,w=T+o,b=x+i;this.faces.push(new THREE.Face3(v,E,y)),this.faceVertexUvs[0].push([new THREE.Vector2(T,x),new THREE.Vector2(w,x),new THREE.Vector2(T,b)]),this.faces.push(new THREE.Face3(E,c,y)),this.faceVertexUvs[0].push([new THREE.Vector2(w,x),new THREE.Vector2(w,b),new THREE.Vector2(T,b)])}this.mergeVertices(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.LatheGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.PlaneGeometry=function(e,t,r,n){THREE.Geometry.call(this),this.parameters={width:e,height:t,widthSegments:r,heightSegments:n};var i,o,a=e/2,s=t/2,l=r||1,c=n||1,h=l+1,u=c+1,f=e/l,d=t/c,p=new THREE.Vector3(0,0,1);for(o=0;u>o;o++){var m=o*d-s;for(i=0;h>i;i++){var g=i*f-a;this.vertices.push(new THREE.Vector3(g,-m,0))}}for(o=0;c>o;o++)for(i=0;l>i;i++){var v=i+h*o,E=i+h*(o+1),y=i+1+h*(o+1),T=i+1+h*o,x=new THREE.Vector2(i/l,1-o/c),w=new THREE.Vector2(i/l,1-(o+1)/c),b=new THREE.Vector2((i+1)/l,1-(o+1)/c),R=new THREE.Vector2((i+1)/l,1-o/c),_=new THREE.Face3(v,E,T);_.normal.copy(p),_.vertexNormals.push(p.clone(),p.clone(),p.clone()),this.faces.push(_),this.faceVertexUvs[0].push([x,w,R]),_=new THREE.Face3(E,y,T),_.normal.copy(p),_.vertexNormals.push(p.clone(),p.clone(),p.clone()),this.faces.push(_),this.faceVertexUvs[0].push([w.clone(),b,R.clone()])}},THREE.PlaneGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.RingGeometry=function(e,t,r,n,i,o){THREE.Geometry.call(this),e=e||0,t=t||50,i=void 0!==i?i:0,o=void 0!==o?o:2*Math.PI,r=void 0!==r?Math.max(3,r):8,n=void 0!==n?Math.max(1,n):8;var a,s,l=[],c=e,h=(t-e)/n;for(a=0;n+1>a;a++){for(s=0;r+1>s;s++){var u=new THREE.Vector3,f=i+s/r*o;u.x=c*Math.cos(f),u.y=c*Math.sin(f),this.vertices.push(u),l.push(new THREE.Vector2((u.x/t+1)/2,(u.y/t+1)/2))}c+=h}var d=new THREE.Vector3(0,0,1);for(a=0;n>a;a++){var p=a*(r+1);for(s=0;r>s;s++){var f=s+p,m=f,g=f+r+1,v=f+r+2;this.faces.push(new THREE.Face3(m,g,v,[d.clone(),d.clone(),d.clone()])),this.faceVertexUvs[0].push([l[m].clone(),l[g].clone(),l[v].clone()]),m=f,g=f+r+2,v=f+1,this.faces.push(new THREE.Face3(m,g,v,[d.clone(),d.clone(),d.clone()])),this.faceVertexUvs[0].push([l[m].clone(),l[g].clone(),l[v].clone()])}}this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,c)},THREE.RingGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.SphereGeometry=function(e,t,r,n,i,o,a){THREE.Geometry.call(this),this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:n,phiLength:i,thetaStart:o,thetaLength:a},e=e||50,t=Math.max(3,Math.floor(t)||8),r=Math.max(2,Math.floor(r)||6),n=void 0!==n?n:0,i=void 0!==i?i:2*Math.PI,o=void 0!==o?o:0,a=void 0!==a?a:Math.PI;var s,l,c=[],h=[];for(l=0;r>=l;l++){var u=[],f=[];for(s=0;t>=s;s++){var d=s/t,p=l/r,m=new THREE.Vector3;m.x=-e*Math.cos(n+d*i)*Math.sin(o+p*a),m.y=e*Math.cos(o+p*a),m.z=e*Math.sin(n+d*i)*Math.sin(o+p*a),this.vertices.push(m),u.push(this.vertices.length-1),f.push(new THREE.Vector2(d,1-p))}c.push(u),h.push(f)}for(l=0;r>l;l++)for(s=0;t>s;s++){var g=c[l][s+1],v=c[l][s],E=c[l+1][s],y=c[l+1][s+1],T=this.vertices[g].clone().normalize(),x=this.vertices[v].clone().normalize(),w=this.vertices[E].clone().normalize(),b=this.vertices[y].clone().normalize(),R=h[l][s+1].clone(),_=h[l][s].clone(),H=h[l+1][s].clone(),M=h[l+1][s+1].clone();Math.abs(this.vertices[g].y)===e?(R.x=(R.x+_.x)/2,this.faces.push(new THREE.Face3(g,E,y,[T,w,b])),this.faceVertexUvs[0].push([R,H,M])):Math.abs(this.vertices[E].y)===e?(H.x=(H.x+M.x)/2,this.faces.push(new THREE.Face3(g,v,E,[T,x,w])),this.faceVertexUvs[0].push([R,_,H])):(this.faces.push(new THREE.Face3(g,v,y,[T,x,b])),this.faceVertexUvs[0].push([R,_,M]),this.faces.push(new THREE.Face3(v,E,y,[x.clone(),w,b.clone()])),this.faceVertexUvs[0].push([_.clone(),H,M.clone()]))}this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,e)},THREE.SphereGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TextGeometry=function(e,t){t=t||{};var r=THREE.FontUtils.generateShapes(e,t);t.amount=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),THREE.ExtrudeGeometry.call(this,r,t)},THREE.TextGeometry.prototype=Object.create(THREE.ExtrudeGeometry.prototype),THREE.TorusGeometry=function(e,t,r,n,i){THREE.Geometry.call(this),this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:n,arc:i},e=e||100,t=t||40,r=r||8,n=n||6,i=i||2*Math.PI;for(var o=new THREE.Vector3,a=[],s=[],l=0;r>=l;l++)for(var c=0;n>=c;c++){var h=c/n*i,u=l/r*Math.PI*2;o.x=e*Math.cos(h),o.y=e*Math.sin(h);var f=new THREE.Vector3;f.x=(e+t*Math.cos(u))*Math.cos(h),f.y=(e+t*Math.cos(u))*Math.sin(h),f.z=t*Math.sin(u),this.vertices.push(f),a.push(new THREE.Vector2(c/n,l/r)),s.push(f.clone().sub(o).normalize())}for(var l=1;r>=l;l++)for(var c=1;n>=c;c++){var d=(n+1)*l+c-1,p=(n+1)*(l-1)+c-1,m=(n+1)*(l-1)+c,g=(n+1)*l+c,v=new THREE.Face3(d,p,g,[s[d].clone(),s[p].clone(),s[g].clone()]);this.faces.push(v),this.faceVertexUvs[0].push([a[d].clone(),a[p].clone(),a[g].clone()]),v=new THREE.Face3(p,m,g,[s[p].clone(),s[m].clone(),s[g].clone()]),this.faces.push(v),this.faceVertexUvs[0].push([a[p].clone(),a[m].clone(),a[g].clone()])
}this.computeFaceNormals()},THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TorusKnotGeometry=function(e,t,r,n,i,o,a){function s(e,t,r,n,i){var o=Math.cos(e),a=Math.sin(e),s=t/r*e,l=Math.cos(s),c=n*(2+l)*.5*o,h=n*(2+l)*a*.5,u=i*n*Math.sin(s)*.5;return new THREE.Vector3(c,h,u)}THREE.Geometry.call(this),this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:n,p:i,q:o,heightScale:a},e=e||100,t=t||40,r=r||64,n=n||8,i=i||2,o=o||3,a=a||1;for(var l=new Array(r),c=new THREE.Vector3,h=new THREE.Vector3,u=new THREE.Vector3,f=0;r>f;++f){l[f]=new Array(n);var d=f/r*2*i*Math.PI,p=s(d,o,i,e,a),m=s(d+.01,o,i,e,a);c.subVectors(m,p),h.addVectors(m,p),u.crossVectors(c,h),h.crossVectors(u,c),u.normalize(),h.normalize();for(var g=0;n>g;++g){var v=g/n*2*Math.PI,E=-t*Math.cos(v),y=t*Math.sin(v),T=new THREE.Vector3;T.x=p.x+E*h.x+y*u.x,T.y=p.y+E*h.y+y*u.y,T.z=p.z+E*h.z+y*u.z,l[f][g]=this.vertices.push(T)-1}}for(var f=0;r>f;++f)for(var g=0;n>g;++g){var x=(f+1)%r,w=(g+1)%n,b=l[f][g],R=l[x][g],_=l[x][w],H=l[f][w],M=new THREE.Vector2(f/r,g/n),S=new THREE.Vector2((f+1)/r,g/n),C=new THREE.Vector2((f+1)/r,(g+1)/n),A=new THREE.Vector2(f/r,(g+1)/n);this.faces.push(new THREE.Face3(b,R,H)),this.faceVertexUvs[0].push([M,S,A]),this.faces.push(new THREE.Face3(R,_,H)),this.faceVertexUvs[0].push([S.clone(),C,A.clone()])}this.computeFaceNormals(),this.computeVertexNormals()},THREE.TorusKnotGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TubeGeometry=function(e,t,r,n,i){function o(e,t,r){return M.vertices.push(new THREE.Vector3(e,t,r))-1}THREE.Geometry.call(this),this.parameters={path:e,segments:t,radius:r,radialSegments:n,closed:i},t=t||64,r=r||1,n=n||8,i=i||!1;var a,s,l,c,h,u,f,d,p,m,g,v,E,y,T,x,w,b,R,_,H=[],M=this,S=t+1,C=new THREE.Vector3,A=new THREE.TubeGeometry.FrenetFrames(e,t,i),k=A.tangents,L=A.normals,P=A.binormals;for(this.tangents=k,this.normals=L,this.binormals=P,p=0;S>p;p++)for(H[p]=[],c=p/(S-1),d=e.getPointAt(c),a=k[p],s=L[p],l=P[p],m=0;n>m;m++)h=m/n*2*Math.PI,u=-r*Math.cos(h),f=r*Math.sin(h),C.copy(d),C.x+=u*s.x+f*l.x,C.y+=u*s.y+f*l.y,C.z+=u*s.z+f*l.z,H[p][m]=o(C.x,C.y,C.z);for(p=0;t>p;p++)for(m=0;n>m;m++)g=i?(p+1)%t:p+1,v=(m+1)%n,E=H[p][m],y=H[g][m],T=H[g][v],x=H[p][v],w=new THREE.Vector2(p/t,m/n),b=new THREE.Vector2((p+1)/t,m/n),R=new THREE.Vector2((p+1)/t,(m+1)/n),_=new THREE.Vector2(p/t,(m+1)/n),this.faces.push(new THREE.Face3(E,y,x)),this.faceVertexUvs[0].push([w,b,_]),this.faces.push(new THREE.Face3(y,T,x)),this.faceVertexUvs[0].push([b.clone(),R,_.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},THREE.TubeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TubeGeometry.FrenetFrames=function(e,t,r){function n(){d[0]=new THREE.Vector3,p[0]=new THREE.Vector3,o=Number.MAX_VALUE,a=Math.abs(f[0].x),s=Math.abs(f[0].y),l=Math.abs(f[0].z),o>=a&&(o=a,u.set(1,0,0)),o>=s&&(o=s,u.set(0,1,0)),o>=l&&u.set(0,0,1),m.crossVectors(f[0],u).normalize(),d[0].crossVectors(f[0],m),p[0].crossVectors(f[0],d[0])}var i,o,a,s,l,c,h,u=(new THREE.Vector3,new THREE.Vector3),f=(new THREE.Vector3,[]),d=[],p=[],m=new THREE.Vector3,g=new THREE.Matrix4,v=t+1,E=1e-4;for(this.tangents=f,this.normals=d,this.binormals=p,c=0;v>c;c++)h=c/(v-1),f[c]=e.getTangentAt(h),f[c].normalize();for(n(),c=1;v>c;c++)d[c]=d[c-1].clone(),p[c]=p[c-1].clone(),m.crossVectors(f[c-1],f[c]),m.length()>E&&(m.normalize(),i=Math.acos(THREE.Math.clamp(f[c-1].dot(f[c]),-1,1)),d[c].applyMatrix4(g.makeRotationAxis(m,i))),p[c].crossVectors(f[c],d[c]);if(r)for(i=Math.acos(THREE.Math.clamp(d[0].dot(d[v-1]),-1,1)),i/=v-1,f[0].dot(m.crossVectors(d[0],d[v-1]))>0&&(i=-i),c=1;v>c;c++)d[c].applyMatrix4(g.makeRotationAxis(f[c],i*c)),p[c].crossVectors(f[c],d[c])},THREE.PolyhedronGeometry=function(e,t,r,n){function i(e){var t=e.normalize().clone();t.index=h.vertices.push(t)-1;var r=s(e)/2/Math.PI+.5,n=l(e)/Math.PI+.5;return t.uv=new THREE.Vector2(r,1-n),t}function o(e,t,r){var n=new THREE.Face3(e.index,t.index,r.index,[e.clone(),t.clone(),r.clone()]);h.faces.push(n),y.copy(e).add(t).add(r).divideScalar(3);var i=s(y);h.faceVertexUvs[0].push([c(e.uv,e,i),c(t.uv,t,i),c(r.uv,r,i)])}function a(e,t){for(var r=Math.pow(2,t),n=(Math.pow(4,t),i(h.vertices[e.a])),a=i(h.vertices[e.b]),s=i(h.vertices[e.c]),l=[],c=0;r>=c;c++){l[c]=[];for(var u=i(n.clone().lerp(s,c/r)),f=i(a.clone().lerp(s,c/r)),d=r-c,p=0;d>=p;p++)l[c][p]=0==p&&c==r?u:i(u.clone().lerp(f,p/d))}for(var c=0;r>c;c++)for(var p=0;2*(r-c)-1>p;p++){var m=Math.floor(p/2);p%2==0?o(l[c][m+1],l[c+1][m],l[c][m]):o(l[c][m+1],l[c+1][m+1],l[c+1][m])}}function s(e){return Math.atan2(e.z,-e.x)}function l(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}function c(e,t,r){return 0>r&&1===e.x&&(e=new THREE.Vector2(e.x-1,e.y)),0===t.x&&0===t.z&&(e=new THREE.Vector2(r/2/Math.PI+.5,e.y)),e.clone()}THREE.Geometry.call(this),r=r||1,n=n||0;for(var h=this,u=0,f=e.length;f>u;u+=3)i(new THREE.Vector3(e[u],e[u+1],e[u+2]));for(var d=this.vertices,p=[],u=0,m=0,f=t.length;f>u;u+=3,m++){var g=d[t[u]],v=d[t[u+1]],E=d[t[u+2]];p[m]=new THREE.Face3(g.index,v.index,E.index,[g.clone(),v.clone(),E.clone()])}for(var y=new THREE.Vector3,u=0,f=p.length;f>u;u++)a(p[u],n);for(var u=0,f=this.faceVertexUvs[0].length;f>u;u++){var T=this.faceVertexUvs[0][u],x=T[0].x,w=T[1].x,b=T[2].x,R=Math.max(x,Math.max(w,b)),_=Math.min(x,Math.min(w,b));R>.9&&.1>_&&(.2>x&&(T[0].x+=1),.2>w&&(T[1].x+=1),.2>b&&(T[2].x+=1))}for(var u=0,f=this.vertices.length;f>u;u++)this.vertices[u].multiplyScalar(r);this.mergeVertices(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,r)},THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.IcosahedronGeometry=function(e,t){this.parameters={radius:e,detail:t};var r=(1+Math.sqrt(5))/2,n=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],i=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];THREE.PolyhedronGeometry.call(this,n,i,e,t)},THREE.IcosahedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.OctahedronGeometry=function(e,t){this.parameters={radius:e,detail:t};var r=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],n=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];THREE.PolyhedronGeometry.call(this,r,n,e,t)},THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TetrahedronGeometry=function(e,t){var r=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],n=[2,1,0,0,3,2,1,3,0,2,3,1];THREE.PolyhedronGeometry.call(this,r,n,e,t)},THREE.TetrahedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ParametricGeometry=function(e,t,r){THREE.Geometry.call(this);var n,i,o,a,s,l=this.vertices,c=this.faces,h=this.faceVertexUvs[0],u=t+1;for(n=0;r>=n;n++)for(s=n/r,i=0;t>=i;i++)a=i/t,o=e(a,s),l.push(o);var f,d,p,m,g,v,E,y;for(n=0;r>n;n++)for(i=0;t>i;i++)f=n*u+i,d=n*u+i+1,p=(n+1)*u+i+1,m=(n+1)*u+i,g=new THREE.Vector2(i/t,n/r),v=new THREE.Vector2((i+1)/t,n/r),E=new THREE.Vector2((i+1)/t,(n+1)/r),y=new THREE.Vector2(i/t,(n+1)/r),c.push(new THREE.Face3(f,d,m)),h.push([g,v,y]),c.push(new THREE.Face3(d,p,m)),h.push([v.clone(),E,y.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},THREE.ParametricGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.AxisHelper=function(e){e=e||1;var t=new Float32Array([0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e]),r=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]),n=new THREE.BufferGeometry;n.addAttribute("position",new THREE.BufferAttribute(t,3)),n.addAttribute("color",new THREE.BufferAttribute(r,3));var i=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});THREE.Line.call(this,n,i,THREE.LinePieces)},THREE.AxisHelper.prototype=Object.create(THREE.Line.prototype),THREE.ArrowHelper=function(){var e=new THREE.Geometry;e.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0));var t=new THREE.CylinderGeometry(0,.5,1,5,1);return t.applyMatrix((new THREE.Matrix4).makeTranslation(0,-.5,0)),function(r,n,i,o,a,s){THREE.Object3D.call(this),void 0===o&&(o=16776960),void 0===i&&(i=1),void 0===a&&(a=.2*i),void 0===s&&(s=.2*a),this.position.copy(n),this.line=new THREE.Line(e,new THREE.LineBasicMaterial({color:o})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new THREE.Mesh(t,new THREE.MeshBasicMaterial({color:o})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(r),this.setLength(i,a,s)}}(),THREE.ArrowHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.ArrowHelper.prototype.setDirection=function(){var e,t=new THREE.Vector3;return function(r){r.y>.99999?this.quaternion.set(0,0,0,1):r.y<-.99999?this.quaternion.set(1,0,0,0):(t.set(r.z,0,-r.x).normalize(),e=Math.acos(r.y),this.quaternion.setFromAxisAngle(t,e))}}(),THREE.ArrowHelper.prototype.setLength=function(e,t,r){void 0===t&&(t=.2*e),void 0===r&&(r=.2*t),this.line.scale.set(1,e,1),this.line.updateMatrix(),this.cone.scale.set(r,t,r),this.cone.position.y=e,this.cone.updateMatrix()},THREE.ArrowHelper.prototype.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)},THREE.BoxHelper=function(e){var t=new THREE.BufferGeometry;t.addAttribute("position",new THREE.BufferAttribute(new Float32Array(72),3)),THREE.Line.call(this,t,new THREE.LineBasicMaterial({color:16776960}),THREE.LinePieces),void 0!==e&&this.update(e)},THREE.BoxHelper.prototype=Object.create(THREE.Line.prototype),THREE.BoxHelper.prototype.update=function(e){var t=e.geometry;null===t.boundingBox&&t.computeBoundingBox();var r=t.boundingBox.min,n=t.boundingBox.max,i=this.geometry.attributes.position.array;i[0]=n.x,i[1]=n.y,i[2]=n.z,i[3]=r.x,i[4]=n.y,i[5]=n.z,i[6]=r.x,i[7]=n.y,i[8]=n.z,i[9]=r.x,i[10]=r.y,i[11]=n.z,i[12]=r.x,i[13]=r.y,i[14]=n.z,i[15]=n.x,i[16]=r.y,i[17]=n.z,i[18]=n.x,i[19]=r.y,i[20]=n.z,i[21]=n.x,i[22]=n.y,i[23]=n.z,i[24]=n.x,i[25]=n.y,i[26]=r.z,i[27]=r.x,i[28]=n.y,i[29]=r.z,i[30]=r.x,i[31]=n.y,i[32]=r.z,i[33]=r.x,i[34]=r.y,i[35]=r.z,i[36]=r.x,i[37]=r.y,i[38]=r.z,i[39]=n.x,i[40]=r.y,i[41]=r.z,i[42]=n.x,i[43]=r.y,i[44]=r.z,i[45]=n.x,i[46]=n.y,i[47]=r.z,i[48]=n.x,i[49]=n.y,i[50]=n.z,i[51]=n.x,i[52]=n.y,i[53]=r.z,i[54]=r.x,i[55]=n.y,i[56]=n.z,i[57]=r.x,i[58]=n.y,i[59]=r.z,i[60]=r.x,i[61]=r.y,i[62]=n.z,i[63]=r.x,i[64]=r.y,i[65]=r.z,i[66]=n.x,i[67]=r.y,i[68]=n.z,i[69]=n.x,i[70]=r.y,i[71]=r.z,this.geometry.attributes.position.needsUpdate=!0,this.geometry.computeBoundingSphere(),this.matrixAutoUpdate=!1,this.matrixWorld=e.matrixWorld},THREE.BoundingBoxHelper=function(e,t){var r=void 0!==t?t:8947848;this.object=e,this.box=new THREE.Box3,THREE.Mesh.call(this,new THREE.BoxGeometry(1,1,1),new THREE.MeshBasicMaterial({color:r,wireframe:!0}))},THREE.BoundingBoxHelper.prototype=Object.create(THREE.Mesh.prototype),THREE.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object),this.box.size(this.scale),this.box.center(this.position)},THREE.CameraHelper=function(e){function t(e,t,n){r(e,n),r(t,n)}function r(e,t){n.vertices.push(new THREE.Vector3),n.colors.push(new THREE.Color(t)),void 0===o[e]&&(o[e]=[]),o[e].push(n.vertices.length-1)}var n=new THREE.Geometry,i=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors}),o={},a=16755200,s=16711680,l=43775,c=16777215,h=3355443;t("n1","n2",a),t("n2","n4",a),t("n4","n3",a),t("n3","n1",a),t("f1","f2",a),t("f2","f4",a),t("f4","f3",a),t("f3","f1",a),t("n1","f1",a),t("n2","f2",a),t("n3","f3",a),t("n4","f4",a),t("p","n1",s),t("p","n2",s),t("p","n3",s),t("p","n4",s),t("u1","u2",l),t("u2","u3",l),t("u3","u1",l),t("c","t",c),t("p","c",h),t("cn1","cn2",h),t("cn3","cn4",h),t("cf1","cf2",h),t("cf3","cf4",h),THREE.Line.call(this,n,i,THREE.LinePieces),this.camera=e,this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()},THREE.CameraHelper.prototype=Object.create(THREE.Line.prototype),THREE.CameraHelper.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Camera,r=new THREE.Projector;return function(){function n(n,o,a,s){e.set(o,a,s),r.unprojectVector(e,t);var l=i.pointMap[n];if(void 0!==l)for(var c=0,h=l.length;h>c;c++)i.geometry.vertices[l[c]].copy(e)}var i=this,o=1,a=1;t.projectionMatrix.copy(this.camera.projectionMatrix),n("c",0,0,-1),n("t",0,0,1),n("n1",-o,-a,-1),n("n2",o,-a,-1),n("n3",-o,a,-1),n("n4",o,a,-1),n("f1",-o,-a,1),n("f2",o,-a,1),n("f3",-o,a,1),n("f4",o,a,1),n("u1",.7*o,1.1*a,-1),n("u2",.7*-o,1.1*a,-1),n("u3",0,2*a,-1),n("cf1",-o,0,1),n("cf2",o,0,1),n("cf3",0,-a,1),n("cf4",0,a,1),n("cn1",-o,0,-1),n("cn2",o,0,-1),n("cn3",0,-a,-1),n("cn4",0,a,-1),this.geometry.verticesNeedUpdate=!0}}(),THREE.DirectionalLightHelper=function(e,t){THREE.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,t=t||1;var r=new THREE.Geometry;r.vertices.push(new THREE.Vector3(-t,t,0),new THREE.Vector3(t,t,0),new THREE.Vector3(t,-t,0),new THREE.Vector3(-t,-t,0),new THREE.Vector3(-t,t,0));var n=new THREE.LineBasicMaterial({fog:!1});n.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightPlane=new THREE.Line(r,n),this.add(this.lightPlane),r=new THREE.Geometry,r.vertices.push(new THREE.Vector3,new THREE.Vector3),n=new THREE.LineBasicMaterial({fog:!1}),n.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine=new THREE.Line(r,n),this.add(this.targetLine),this.update()},THREE.DirectionalLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},THREE.DirectionalLightHelper.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Vector3,r=new THREE.Vector3;return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),r.subVectors(t,e),this.lightPlane.lookAt(r),this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine.geometry.vertices[1].copy(r),this.targetLine.geometry.verticesNeedUpdate=!0,this.targetLine.material.color.copy(this.lightPlane.material.color)}}(),THREE.EdgesHelper=function(e,t){var r=void 0!==t?t:16777215,n=[0,0],i={},o=function(e,t){return e-t},a=["a","b","c"],s=new THREE.BufferGeometry,l=e.geometry.clone();l.mergeVertices(),l.computeFaceNormals();for(var c=l.vertices,h=l.faces,u=0,f=0,d=h.length;d>f;f++)for(var p=h[f],m=0;3>m;m++){n[0]=p[a[m]],n[1]=p[a[(m+1)%3]],n.sort(o);var g=n.toString();void 0===i[g]?(i[g]={vert1:n[0],vert2:n[1],face1:f,face2:void 0},u++):i[g].face2=f}s.addAttribute("position",new THREE.Float32Attribute(2*u*3,3));var v=s.attributes.position.array,E=0;for(var g in i){var y=i[g];if(void 0===y.face2||h[y.face1].normal.dot(h[y.face2].normal)<.9999){var T=c[y.vert1];v[E++]=T.x,v[E++]=T.y,v[E++]=T.z,T=c[y.vert2],v[E++]=T.x,v[E++]=T.y,v[E++]=T.z}}THREE.Line.call(this,s,new THREE.LineBasicMaterial({color:r}),THREE.LinePieces),this.matrixAutoUpdate=!1,this.matrixWorld=e.matrixWorld},THREE.EdgesHelper.prototype=Object.create(THREE.Line.prototype),THREE.FaceNormalsHelper=function(e,t,r,n){this.object=e,this.size=void 0!==t?t:1;for(var i=void 0!==r?r:16776960,o=void 0!==n?n:1,a=new THREE.Geometry,s=this.object.geometry.faces,l=0,c=s.length;c>l;l++)a.vertices.push(new THREE.Vector3,new THREE.Vector3);THREE.Line.call(this,a,new THREE.LineBasicMaterial({color:i,linewidth:o}),THREE.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new THREE.Matrix3,this.update()},THREE.FaceNormalsHelper.prototype=Object.create(THREE.Line.prototype),THREE.FaceNormalsHelper.prototype.update=function(){var e=this.geometry.vertices,t=this.object,r=t.geometry.vertices,n=t.geometry.faces,i=t.matrixWorld;t.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(i);for(var o=0,a=0,s=n.length;s>o;o++,a+=2){var l=n[o];e[a].copy(r[l.a]).add(r[l.b]).add(r[l.c]).divideScalar(3).applyMatrix4(i),e[a+1].copy(l.normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size).add(e[a])}return this.geometry.verticesNeedUpdate=!0,this},THREE.GridHelper=function(e,t){var r=new THREE.Geometry,n=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});this.color1=new THREE.Color(4473924),this.color2=new THREE.Color(8947848);for(var i=-e;e>=i;i+=t){r.vertices.push(new THREE.Vector3(-e,0,i),new THREE.Vector3(e,0,i),new THREE.Vector3(i,0,-e),new THREE.Vector3(i,0,e));var o=0===i?this.color1:this.color2;r.colors.push(o,o,o,o)}THREE.Line.call(this,r,n,THREE.LinePieces)},THREE.GridHelper.prototype=Object.create(THREE.Line.prototype),THREE.GridHelper.prototype.setColors=function(e,t){this.color1.set(e),this.color2.set(t),this.geometry.colorsNeedUpdate=!0},THREE.HemisphereLightHelper=function(e,t){THREE.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,this.colors=[new THREE.Color,new THREE.Color];var r=new THREE.SphereGeometry(t,4,2);r.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));for(var n=0,i=8;i>n;n++)r.faces[n].color=this.colors[4>n?0:1];var o=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,wireframe:!0});this.lightSphere=new THREE.Mesh(r,o),this.add(this.lightSphere),this.update()},THREE.HemisphereLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose()},THREE.HemisphereLightHelper.prototype.update=function(){var e=new THREE.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity),this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity),this.lightSphere.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate()),this.lightSphere.geometry.colorsNeedUpdate=!0}}(),THREE.PointLightHelper=function(e,t){this.light=e,this.light.updateMatrixWorld();var r=new THREE.SphereGeometry(t,4,2),n=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});n.color.copy(this.light.color).multiplyScalar(this.light.intensity),THREE.Mesh.call(this,r,n),this.matrixWorld=this.light.matrixWorld,this.matrixAutoUpdate=!1},THREE.PointLightHelper.prototype=Object.create(THREE.Mesh.prototype),THREE.PointLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},THREE.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},THREE.SkeletonHelper=function(e){this.bones=this.getBoneList(e);for(var t=new THREE.Geometry,r=0;r<this.bones.length;r++){var n=this.bones[r];n.parent instanceof THREE.Bone&&(t.vertices.push(new THREE.Vector3),t.vertices.push(new THREE.Vector3),t.colors.push(new THREE.Color(0,0,1)),t.colors.push(new THREE.Color(0,1,0)))}var i=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,depthTest:!1,depthWrite:!1,transparent:!0});THREE.Line.call(this,t,i,THREE.LinePieces),this.root=e,this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,this.update()},THREE.SkeletonHelper.prototype=Object.create(THREE.Line.prototype),THREE.SkeletonHelper.prototype.getBoneList=function(e){var t=[];e instanceof THREE.Bone&&t.push(e);for(var r=0;r<e.children.length;r++)t.push.apply(t,this.getBoneList(e.children[r]));return t},THREE.SkeletonHelper.prototype.update=function(){for(var e=this.geometry,t=(new THREE.Matrix4).getInverse(this.root.matrixWorld),r=new THREE.Matrix4,n=0,i=0;i<this.bones.length;i++){var o=this.bones[i];o.parent instanceof THREE.Bone&&(r.multiplyMatrices(t,o.matrixWorld),e.vertices[n].setFromMatrixPosition(r),r.multiplyMatrices(t,o.parent.matrixWorld),e.vertices[n+1].setFromMatrixPosition(r),n+=2)}e.verticesNeedUpdate=!0,e.computeBoundingSphere()},THREE.SpotLightHelper=function(e){THREE.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1;var t=new THREE.CylinderGeometry(0,1,1,8,1,!0);t.applyMatrix((new THREE.Matrix4).makeTranslation(0,-.5,0)),t.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));var r=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});this.cone=new THREE.Mesh(t,r),this.add(this.cone),this.update()},THREE.SpotLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},THREE.SpotLightHelper.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(){var r=this.light.distance?this.light.distance:1e4,n=r*Math.tan(this.light.angle);this.cone.scale.set(n,n,r),e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(t.sub(e)),this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}(),THREE.VertexNormalsHelper=function(e,t,r,n){this.object=e,this.size=void 0!==t?t:1;for(var i=void 0!==r?r:16711680,o=void 0!==n?n:1,a=new THREE.Geometry,s=(e.geometry.vertices,e.geometry.faces),l=0,c=s.length;c>l;l++)for(var h=s[l],u=0,f=h.vertexNormals.length;f>u;u++)a.vertices.push(new THREE.Vector3,new THREE.Vector3);THREE.Line.call(this,a,new THREE.LineBasicMaterial({color:i,linewidth:o}),THREE.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new THREE.Matrix3,this.update()},THREE.VertexNormalsHelper.prototype=Object.create(THREE.Line.prototype),THREE.VertexNormalsHelper.prototype.update=function(){var e=new THREE.Vector3;return function(){var t=["a","b","c","d"];this.object.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(this.object.matrixWorld);for(var r=this.geometry.vertices,n=this.object.geometry.vertices,i=this.object.geometry.faces,o=this.object.matrixWorld,a=0,s=0,l=i.length;l>s;s++)for(var c=i[s],h=0,u=c.vertexNormals.length;u>h;h++){var f=c[t[h]],d=n[f],p=c.vertexNormals[h];r[a].copy(d).applyMatrix4(o),e.copy(p).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size),e.add(r[a]),a+=1,r[a].copy(e),a+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),THREE.VertexTangentsHelper=function(e,t,r,n){this.object=e,this.size=void 0!==t?t:1;for(var i=void 0!==r?r:255,o=void 0!==n?n:1,a=new THREE.Geometry,s=(e.geometry.vertices,e.geometry.faces),l=0,c=s.length;c>l;l++)for(var h=s[l],u=0,f=h.vertexTangents.length;f>u;u++)a.vertices.push(new THREE.Vector3),a.vertices.push(new THREE.Vector3);THREE.Line.call(this,a,new THREE.LineBasicMaterial({color:i,linewidth:o}),THREE.LinePieces),this.matrixAutoUpdate=!1,this.update()},THREE.VertexTangentsHelper.prototype=Object.create(THREE.Line.prototype),THREE.VertexTangentsHelper.prototype.update=function(){var e=new THREE.Vector3;return function(){var t=["a","b","c","d"];this.object.updateMatrixWorld(!0);for(var r=this.geometry.vertices,n=this.object.geometry.vertices,i=this.object.geometry.faces,o=this.object.matrixWorld,a=0,s=0,l=i.length;l>s;s++)for(var c=i[s],h=0,u=c.vertexTangents.length;u>h;h++){var f=c[t[h]],d=n[f],p=c.vertexTangents[h];r[a].copy(d).applyMatrix4(o),e.copy(p).transformDirection(o).multiplyScalar(this.size),e.add(r[a]),a+=1,r[a].copy(e),a+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),THREE.WireframeHelper=function(e,t){var r=void 0!==t?t:16777215,n=[0,0],i={},o=function(e,t){return e-t},a=["a","b","c"],s=new THREE.BufferGeometry;if(e.geometry instanceof THREE.Geometry){for(var l=e.geometry.vertices,c=e.geometry.faces,h=0,u=new Uint32Array(6*c.length),f=0,d=c.length;d>f;f++)for(var p=c[f],m=0;3>m;m++){n[0]=p[a[m]],n[1]=p[a[(m+1)%3]],n.sort(o);var g=n.toString();void 0===i[g]&&(u[2*h]=n[0],u[2*h+1]=n[1],i[g]=!0,h++)}for(var v=new Float32Array(2*h*3),f=0,d=h;d>f;f++)for(var m=0;2>m;m++){var E=l[u[2*f+m]],y=6*f+3*m;v[y+0]=E.x,v[y+1]=E.y,v[y+2]=E.z}s.addAttribute("position",new THREE.BufferAttribute(v,3))}else if(e.geometry instanceof THREE.BufferGeometry)if(void 0!==e.geometry.attributes.index){for(var l=e.geometry.attributes.position.array,T=e.geometry.attributes.index.array,x=e.geometry.offsets,h=0,u=new Uint32Array(2*T.length),w=0,b=x.length;b>w;++w)for(var R=x[w].start,_=x[w].count,y=x[w].index,f=R,H=R+_;H>f;f+=3)for(var m=0;3>m;m++){n[0]=y+T[f+m],n[1]=y+T[f+(m+1)%3],n.sort(o);var g=n.toString();void 0===i[g]&&(u[2*h]=n[0],u[2*h+1]=n[1],i[g]=!0,h++)}for(var v=new Float32Array(2*h*3),f=0,d=h;d>f;f++)for(var m=0;2>m;m++){var y=6*f+3*m,M=3*u[2*f+m];v[y+0]=l[M],v[y+1]=l[M+1],v[y+2]=l[M+2]}s.addAttribute("position",new THREE.BufferAttribute(v,3))}else{for(var l=e.geometry.attributes.position.array,h=l.length/3,S=h/3,v=new Float32Array(2*h*3),f=0,d=S;d>f;f++)for(var m=0;3>m;m++){var y=18*f+6*m,C=9*f+3*m;v[y+0]=l[C],v[y+1]=l[C+1],v[y+2]=l[C+2];var M=9*f+3*((m+1)%3);v[y+3]=l[M],v[y+4]=l[M+1],v[y+5]=l[M+2]}s.addAttribute("position",new THREE.BufferAttribute(v,3))}THREE.Line.call(this,s,new THREE.LineBasicMaterial({color:r}),THREE.LinePieces),this.matrixAutoUpdate=!1,this.matrixWorld=e.matrixWorld},THREE.WireframeHelper.prototype=Object.create(THREE.Line.prototype),THREE.ImmediateRenderObject=function(){THREE.Object3D.call(this),this.render=function(){}},THREE.ImmediateRenderObject.prototype=Object.create(THREE.Object3D.prototype),THREE.LensFlare=function(e,t,r,n,i){THREE.Object3D.call(this),this.lensFlares=[],this.positionScreen=new THREE.Vector3,this.customUpdateCallback=void 0,void 0!==e&&this.add(e,t,r,n,i)},THREE.LensFlare.prototype=Object.create(THREE.Object3D.prototype),THREE.LensFlare.prototype.add=function(e,t,r,n,i,o){void 0===t&&(t=-1),void 0===r&&(r=0),void 0===o&&(o=1),void 0===i&&(i=new THREE.Color(16777215)),void 0===n&&(n=THREE.NormalBlending),r=Math.min(r,Math.max(0,r)),this.lensFlares.push({texture:e,size:t,distance:r,x:0,y:0,z:0,scale:1,rotation:1,opacity:o,color:i,blending:n})},THREE.LensFlare.prototype.updateLensFlares=function(){var e,t,r=this.lensFlares.length,n=2*-this.positionScreen.x,i=2*-this.positionScreen.y;for(e=0;r>e;e++)t=this.lensFlares[e],t.x=this.positionScreen.x+n*t.distance,t.y=this.positionScreen.y+i*t.distance,t.wantedRotation=t.x*Math.PI*.25,t.rotation+=.25*(t.wantedRotation-t.rotation)},THREE.MorphBlendMesh=function(e,t){THREE.Mesh.call(this,e,t),this.animationsMap={},this.animationsList=[];var r=this.geometry.morphTargets.length,n="__default",i=0,o=r-1,a=r/1;this.createAnimation(n,i,o,a),this.setAnimationWeight(n,1)},THREE.MorphBlendMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.MorphBlendMesh.prototype.createAnimation=function(e,t,r,n){var i={startFrame:t,endFrame:r,length:r-t+1,fps:n,duration:(r-t)/n,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[e]=i,this.animationsList.push(i)},THREE.MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var t,r=/([a-z]+)_?(\d+)/,n={},i=this.geometry,o=0,a=i.morphTargets.length;a>o;o++){var s=i.morphTargets[o],l=s.name.match(r);if(l&&l.length>1){{var c=l[1];l[2]}n[c]||(n[c]={start:1/0,end:-1/0});var h=n[c];o<h.start&&(h.start=o),o>h.end&&(h.end=o),t||(t=c)}}for(var c in n){var h=n[c];this.createAnimation(c,h.start,h.end,e)}this.firstAnimation=t},THREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){var t=this.animationsMap[e];t&&(t.direction=1,t.directionBackwards=!1)},THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){var t=this.animationsMap[e];t&&(t.direction=-1,t.directionBackwards=!0)},THREE.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var r=this.animationsMap[e];r&&(r.fps=t,r.duration=(r.end-r.start)/r.fps)},THREE.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var r=this.animationsMap[e];r&&(r.duration=t,r.fps=(r.end-r.start)/r.duration)},THREE.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var r=this.animationsMap[e];r&&(r.weight=t)},THREE.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var r=this.animationsMap[e];r&&(r.time=t)},THREE.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0,r=this.animationsMap[e];return r&&(t=r.time),t},THREE.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1,r=this.animationsMap[e];return r&&(t=r.duration),t},THREE.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):console.warn("animation["+e+"] undefined")},THREE.MorphBlendMesh.prototype.stopAnimation=function(e){var t=this.animationsMap[e];t&&(t.active=!1)},THREE.MorphBlendMesh.prototype.update=function(e){for(var t=0,r=this.animationsList.length;r>t;t++){var n=this.animationsList[t];if(n.active){var i=n.duration/n.length;n.time+=n.direction*e,n.mirroredLoop?(n.time>n.duration||n.time<0)&&(n.direction*=-1,n.time>n.duration&&(n.time=n.duration,n.directionBackwards=!0),n.time<0&&(n.time=0,n.directionBackwards=!1)):(n.time=n.time%n.duration,n.time<0&&(n.time+=n.duration));var o=n.startFrame+THREE.Math.clamp(Math.floor(n.time/i),0,n.length-1),a=n.weight;o!==n.currentFrame&&(this.morphTargetInfluences[n.lastFrame]=0,this.morphTargetInfluences[n.currentFrame]=1*a,this.morphTargetInfluences[o]=0,n.lastFrame=n.currentFrame,n.currentFrame=o);var s=n.time%i/i;n.directionBackwards&&(s=1-s),this.morphTargetInfluences[n.currentFrame]=s*a,this.morphTargetInfluences[n.lastFrame]=(1-s)*a}}},THREE.LensFlarePlugin=function(){function e(e,r){var n=t.createProgram(),i=t.createShader(t.FRAGMENT_SHADER),o=t.createShader(t.VERTEX_SHADER),a="precision "+r+" float;\n";return t.shaderSource(i,a+e.fragmentShader),t.shaderSource(o,a+e.vertexShader),t.compileShader(i),t.compileShader(o),t.attachShader(n,i),t.attachShader(n,o),t.linkProgram(n),n}var t,r,n,i=[],o={};this.init=function(i){t=i.context,r=i,n=i.getPrecision(),o.vertices=new Float32Array(16),o.faces=new Uint16Array(6);var a=0;o.vertices[a++]=-1,o.vertices[a++]=-1,o.vertices[a++]=0,o.vertices[a++]=0,o.vertices[a++]=1,o.vertices[a++]=-1,o.vertices[a++]=1,o.vertices[a++]=0,o.vertices[a++]=1,o.vertices[a++]=1,o.vertices[a++]=1,o.vertices[a++]=1,o.vertices[a++]=-1,o.vertices[a++]=1,o.vertices[a++]=0,o.vertices[a++]=1,a=0,o.faces[a++]=0,o.faces[a++]=1,o.faces[a++]=2,o.faces[a++]=0,o.faces[a++]=2,o.faces[a++]=3,o.vertexBuffer=t.createBuffer(),o.elementBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,o.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,o.vertices,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,o.elementBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,o.faces,t.STATIC_DRAW),o.tempTexture=t.createTexture(),o.occlusionTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,o.tempTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGB,16,16,0,t.RGB,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.bindTexture(t.TEXTURE_2D,o.occlusionTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,16,16,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<=0?(o.hasVertexTexture=!1,o.program=e(THREE.ShaderFlares.lensFlare,n)):(o.hasVertexTexture=!0,o.program=e(THREE.ShaderFlares.lensFlareVertexTexture,n)),o.attributes={},o.uniforms={},o.attributes.vertex=t.getAttribLocation(o.program,"position"),o.attributes.uv=t.getAttribLocation(o.program,"uv"),o.uniforms.renderType=t.getUniformLocation(o.program,"renderType"),o.uniforms.map=t.getUniformLocation(o.program,"map"),o.uniforms.occlusionMap=t.getUniformLocation(o.program,"occlusionMap"),o.uniforms.opacity=t.getUniformLocation(o.program,"opacity"),o.uniforms.color=t.getUniformLocation(o.program,"color"),o.uniforms.scale=t.getUniformLocation(o.program,"scale"),o.uniforms.rotation=t.getUniformLocation(o.program,"rotation"),o.uniforms.screenPosition=t.getUniformLocation(o.program,"screenPosition")},this.render=function(e,n,a,s){if(i.length=0,e.traverseVisible(function(e){e instanceof THREE.LensFlare&&i.push(e)
}),0!==i.length){var l=new THREE.Vector3,c=s/a,h=.5*a,u=.5*s,f=16/s,d=new THREE.Vector2(f*c,f),p=new THREE.Vector3(1,1,0),m=new THREE.Vector2(1,1),g=o.uniforms,v=o.attributes;t.useProgram(o.program),t.enableVertexAttribArray(o.attributes.vertex),t.enableVertexAttribArray(o.attributes.uv),t.uniform1i(g.occlusionMap,0),t.uniform1i(g.map,1),t.bindBuffer(t.ARRAY_BUFFER,o.vertexBuffer),t.vertexAttribPointer(v.vertex,2,t.FLOAT,!1,16,0),t.vertexAttribPointer(v.uv,2,t.FLOAT,!1,16,8),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,o.elementBuffer),t.disable(t.CULL_FACE),t.depthMask(!1);for(var E=0,y=i.length;y>E;E++){f=16/s,d.set(f*c,f);var T=i[E];if(l.set(T.matrixWorld.elements[12],T.matrixWorld.elements[13],T.matrixWorld.elements[14]),l.applyMatrix4(n.matrixWorldInverse),l.applyProjection(n.projectionMatrix),p.copy(l),m.x=p.x*h+h,m.y=p.y*u+u,o.hasVertexTexture||m.x>0&&m.x<a&&m.y>0&&m.y<s){t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,o.tempTexture),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGB,m.x-8,m.y-8,16,16,0),t.uniform1i(g.renderType,0),t.uniform2f(g.scale,d.x,d.y),t.uniform3f(g.screenPosition,p.x,p.y,p.z),t.disable(t.BLEND),t.enable(t.DEPTH_TEST),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,o.occlusionTexture),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,m.x-8,m.y-8,16,16,0),t.uniform1i(g.renderType,1),t.disable(t.DEPTH_TEST),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,o.tempTexture),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),T.positionScreen.copy(p),T.customUpdateCallback?T.customUpdateCallback(T):T.updateLensFlares(),t.uniform1i(g.renderType,2),t.enable(t.BLEND);for(var x=0,w=T.lensFlares.length;w>x;x++){var b=T.lensFlares[x];b.opacity>.001&&b.scale>.001&&(p.x=b.x,p.y=b.y,p.z=b.z,f=b.size*b.scale/s,d.x=f*c,d.y=f,t.uniform3f(g.screenPosition,p.x,p.y,p.z),t.uniform2f(g.scale,d.x,d.y),t.uniform1f(g.rotation,b.rotation),t.uniform1f(g.opacity,b.opacity),t.uniform3f(g.color,b.color.r,b.color.g,b.color.b),r.setBlending(b.blending,b.blendEquation,b.blendSrc,b.blendDst),r.setTexture(b.texture,1),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0))}}}t.enable(t.CULL_FACE),t.enable(t.DEPTH_TEST),t.depthMask(!0)}}},THREE.ShadowMapPlugin=function(){function e(t,r,n){if(r.visible){var i=t.__webglObjects[r.id];if(i&&r.castShadow&&(r.frustumCulled===!1||u.intersectsObject(r)===!0))for(var o=0,a=i.length;a>o;o++){var s=i[o];r._modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,r.matrixWorld),g.push(s)}for(var o=0,a=r.children.length;a>o;o++)e(t,r.children[o],n)}}function t(e,t){var r=new THREE.DirectionalLight;r.isVirtual=!0,r.onlyShadow=!0,r.castShadow=!0,r.shadowCameraNear=e.shadowCameraNear,r.shadowCameraFar=e.shadowCameraFar,r.shadowCameraLeft=e.shadowCameraLeft,r.shadowCameraRight=e.shadowCameraRight,r.shadowCameraBottom=e.shadowCameraBottom,r.shadowCameraTop=e.shadowCameraTop,r.shadowCameraVisible=e.shadowCameraVisible,r.shadowDarkness=e.shadowDarkness,r.shadowBias=e.shadowCascadeBias[t],r.shadowMapWidth=e.shadowCascadeWidth[t],r.shadowMapHeight=e.shadowCascadeHeight[t],r.pointsWorld=[],r.pointsFrustum=[];for(var n=r.pointsWorld,i=r.pointsFrustum,o=0;8>o;o++)n[o]=new THREE.Vector3,i[o]=new THREE.Vector3;var a=e.shadowCascadeNearZ[t],s=e.shadowCascadeFarZ[t];return i[0].set(-1,-1,a),i[1].set(1,-1,a),i[2].set(-1,1,a),i[3].set(1,1,a),i[4].set(-1,-1,s),i[5].set(1,-1,s),i[6].set(-1,1,s),i[7].set(1,1,s),r}function r(e,t){var r=e.shadowCascadeArray[t];r.position.copy(e.position),r.target.position.copy(e.target.position),r.lookAt(r.target),r.shadowCameraVisible=e.shadowCameraVisible,r.shadowDarkness=e.shadowDarkness,r.shadowBias=e.shadowCascadeBias[t];var n=e.shadowCascadeNearZ[t],i=e.shadowCascadeFarZ[t],o=r.pointsFrustum;o[0].z=n,o[1].z=n,o[2].z=n,o[3].z=n,o[4].z=i,o[5].z=i,o[6].z=i,o[7].z=i}function n(e,t){var r=t.shadowCamera,n=t.pointsFrustum,i=t.pointsWorld;d.set(1/0,1/0,1/0),p.set(-1/0,-1/0,-1/0);for(var o=0;8>o;o++){var a=i[o];a.copy(n[o]),THREE.ShadowMapPlugin.__projector.unprojectVector(a,e),a.applyMatrix4(r.matrixWorldInverse),a.x<d.x&&(d.x=a.x),a.x>p.x&&(p.x=a.x),a.y<d.y&&(d.y=a.y),a.y>p.y&&(p.y=a.y),a.z<d.z&&(d.z=a.z),a.z>p.z&&(p.z=a.z)}r.left=d.x,r.right=p.x,r.top=p.y,r.bottom=d.y,r.updateProjectionMatrix()}function i(e){return e.material instanceof THREE.MeshFaceMaterial?e.material.materials[0]:e.material}var o,a,s,l,c,h,u=new THREE.Frustum,f=new THREE.Matrix4,d=new THREE.Vector3,p=new THREE.Vector3,m=new THREE.Vector3,g=[];this.init=function(e){o=e.context,a=e;var t=THREE.ShaderLib.depthRGBA,r=THREE.UniformsUtils.clone(t.uniforms);s=new THREE.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:r}),l=new THREE.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:r,morphTargets:!0}),c=new THREE.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:r,skinning:!0}),h=new THREE.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:r,morphTargets:!0,skinning:!0}),s._shadowPass=!0,l._shadowPass=!0,c._shadowPass=!0,h._shadowPass=!0},this.render=function(e,t){a.shadowMapEnabled&&a.shadowMapAutoUpdate&&this.update(e,t)},this.update=function(d,p){var v,E,y,T,x,w,b,R,_,H,M,S,C,A=[],k=0,L=null;for(o.clearColor(1,1,1,1),o.disable(o.BLEND),o.enable(o.CULL_FACE),o.frontFace(o.CCW),o.cullFace(a.shadowMapCullFace===THREE.CullFaceFront?o.FRONT:o.BACK),a.setDepthTest(!0),v=0,E=d.__lights.length;E>v;v++)if(C=d.__lights[v],C.castShadow)if(C instanceof THREE.DirectionalLight&&C.shadowCascade)for(x=0;x<C.shadowCascadeCount;x++){var P;if(C.shadowCascadeArray[x])P=C.shadowCascadeArray[x];else{P=t(C,x),P.originalCamera=p;var F=new THREE.Gyroscope;F.position.copy(C.shadowCascadeOffset),F.add(P),F.add(P.target),p.add(F),C.shadowCascadeArray[x]=P,console.log("Created virtualLight",P)}r(C,x),A[k]=P,k++}else A[k]=C,k++;for(v=0,E=A.length;E>v;v++){if(C=A[v],!C.shadowMap){var N=THREE.LinearFilter;a.shadowMapType===THREE.PCFSoftShadowMap&&(N=THREE.NearestFilter);var D={minFilter:N,magFilter:N,format:THREE.RGBAFormat};C.shadowMap=new THREE.WebGLRenderTarget(C.shadowMapWidth,C.shadowMapHeight,D),C.shadowMapSize=new THREE.Vector2(C.shadowMapWidth,C.shadowMapHeight),C.shadowMatrix=new THREE.Matrix4}if(!C.shadowCamera){if(C instanceof THREE.SpotLight)C.shadowCamera=new THREE.PerspectiveCamera(C.shadowCameraFov,C.shadowMapWidth/C.shadowMapHeight,C.shadowCameraNear,C.shadowCameraFar);else{if(!(C instanceof THREE.DirectionalLight)){console.error("Unsupported light type for shadow");continue}C.shadowCamera=new THREE.OrthographicCamera(C.shadowCameraLeft,C.shadowCameraRight,C.shadowCameraTop,C.shadowCameraBottom,C.shadowCameraNear,C.shadowCameraFar)}d.add(C.shadowCamera),d.autoUpdate===!0&&d.updateMatrixWorld()}C.shadowCameraVisible&&!C.cameraHelper&&(C.cameraHelper=new THREE.CameraHelper(C.shadowCamera),C.shadowCamera.add(C.cameraHelper)),C.isVirtual&&P.originalCamera==p&&n(p,C),w=C.shadowMap,b=C.shadowMatrix,R=C.shadowCamera,R.position.setFromMatrixPosition(C.matrixWorld),m.setFromMatrixPosition(C.target.matrixWorld),R.lookAt(m),R.updateMatrixWorld(),R.matrixWorldInverse.getInverse(R.matrixWorld),C.cameraHelper&&(C.cameraHelper.visible=C.shadowCameraVisible),C.shadowCameraVisible&&C.cameraHelper.update(),b.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),b.multiply(R.projectionMatrix),b.multiply(R.matrixWorldInverse),f.multiplyMatrices(R.projectionMatrix,R.matrixWorldInverse),u.setFromMatrix(f),a.setRenderTarget(w),a.clear(),g.length=0,e(d,d,R);var U,O,z;for(y=0,T=g.length;T>y;y++)M=g[y],S=M.object,_=M.buffer,U=i(S),O=void 0!==S.geometry.morphTargets&&S.geometry.morphTargets.length>0&&U.morphTargets,z=S instanceof THREE.SkinnedMesh&&U.skinning,H=S.customDepthMaterial?S.customDepthMaterial:z?O?h:c:O?l:s,a.setMaterialFaces(U),_ instanceof THREE.BufferGeometry?a.renderBufferDirect(R,d.__lights,L,H,_,S):a.renderBuffer(R,d.__lights,L,H,_,S);var I=d.__webglObjectsImmediate;for(y=0,T=I.length;T>y;y++)M=I[y],S=M.object,S.visible&&S.castShadow&&(S._modelViewMatrix.multiplyMatrices(R.matrixWorldInverse,S.matrixWorld),a.renderImmediateObject(R,d.__lights,L,s,S))}var V=a.getClearColor(),B=a.getClearAlpha();o.clearColor(V.r,V.g,V.b,B),o.enable(o.BLEND),a.shadowMapCullFace===THREE.CullFaceFront&&o.cullFace(o.BACK)}},THREE.ShadowMapPlugin.__projector=new THREE.Projector,THREE.SpritePlugin=function(){function e(){var e=r.createProgram(),t=r.createShader(r.VERTEX_SHADER),i=r.createShader(r.FRAGMENT_SHADER);return r.shaderSource(t,["precision "+n.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n")),r.shaderSource(i,["precision "+n.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")),r.compileShader(t),r.compileShader(i),r.attachShader(e,t),r.attachShader(e,i),r.linkProgram(e),e}function t(e,t){return e.z!==t.z?t.z-e.z:t.id-e.id}var r,n,i,o,a,s,l,c,h,u,f=[];this.init=function(t){r=t.context,n=t,o=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),a=new Uint16Array([0,1,2,0,2,3]),s=r.createBuffer(),l=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,s),r.bufferData(r.ARRAY_BUFFER,o,r.STATIC_DRAW),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,l),r.bufferData(r.ELEMENT_ARRAY_BUFFER,a,r.STATIC_DRAW),c=e(),h={position:r.getAttribLocation(c,"position"),uv:r.getAttribLocation(c,"uv")},u={uvOffset:r.getUniformLocation(c,"uvOffset"),uvScale:r.getUniformLocation(c,"uvScale"),rotation:r.getUniformLocation(c,"rotation"),scale:r.getUniformLocation(c,"scale"),color:r.getUniformLocation(c,"color"),map:r.getUniformLocation(c,"map"),opacity:r.getUniformLocation(c,"opacity"),modelViewMatrix:r.getUniformLocation(c,"modelViewMatrix"),projectionMatrix:r.getUniformLocation(c,"projectionMatrix"),fogType:r.getUniformLocation(c,"fogType"),fogDensity:r.getUniformLocation(c,"fogDensity"),fogNear:r.getUniformLocation(c,"fogNear"),fogFar:r.getUniformLocation(c,"fogFar"),fogColor:r.getUniformLocation(c,"fogColor"),alphaTest:r.getUniformLocation(c,"alphaTest")};var f=document.createElement("canvas");f.width=8,f.height=8;var d=f.getContext("2d");d.fillStyle="white",d.fillRect(0,0,8,8),i=new THREE.Texture(f),i.needsUpdate=!0},this.render=function(e,o){if(f.length=0,e.traverseVisible(function(e){e instanceof THREE.Sprite&&f.push(e)}),0!==f.length){r.useProgram(c),r.enableVertexAttribArray(h.position),r.enableVertexAttribArray(h.uv),r.disable(r.CULL_FACE),r.enable(r.BLEND),r.bindBuffer(r.ARRAY_BUFFER,s),r.vertexAttribPointer(h.position,2,r.FLOAT,!1,16,0),r.vertexAttribPointer(h.uv,2,r.FLOAT,!1,16,8),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,l),r.uniformMatrix4fv(u.projectionMatrix,!1,o.projectionMatrix.elements),r.activeTexture(r.TEXTURE0),r.uniform1i(u.map,0);var a=0,d=0,p=e.fog;p?(r.uniform3f(u.fogColor,p.color.r,p.color.g,p.color.b),p instanceof THREE.Fog?(r.uniform1f(u.fogNear,p.near),r.uniform1f(u.fogFar,p.far),r.uniform1i(u.fogType,1),a=1,d=1):p instanceof THREE.FogExp2&&(r.uniform1f(u.fogDensity,p.density),r.uniform1i(u.fogType,2),a=2,d=2)):(r.uniform1i(u.fogType,0),a=0,d=0);for(var m=0,g=f.length;g>m;m++){var v=f[m],E=v.material;v._modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,v.matrixWorld),v.z=-v._modelViewMatrix.elements[14]}f.sort(t);for(var y=[],m=0,g=f.length;g>m;m++){var v=f[m],E=v.material;r.uniform1f(u.alphaTest,E.alphaTest),r.uniformMatrix4fv(u.modelViewMatrix,!1,v._modelViewMatrix.elements),y[0]=v.scale.x,y[1]=v.scale.y;var T=0;e.fog&&E.fog&&(T=d),a!==T&&(r.uniform1i(u.fogType,T),a=T),null!==E.map?(r.uniform2f(u.uvOffset,E.map.offset.x,E.map.offset.y),r.uniform2f(u.uvScale,E.map.repeat.x,E.map.repeat.y)):(r.uniform2f(u.uvOffset,0,0),r.uniform2f(u.uvScale,1,1)),r.uniform1f(u.opacity,E.opacity),r.uniform3f(u.color,E.color.r,E.color.g,E.color.b),r.uniform1f(u.rotation,E.rotation),r.uniform2fv(u.scale,y),n.setBlending(E.blending,E.blendEquation,E.blendSrc,E.blendDst),n.setDepthTest(E.depthTest),n.setDepthWrite(E.depthWrite),E.map&&E.map.image&&E.map.image.width?n.setTexture(E.map,0):n.setTexture(i,0),r.drawElements(r.TRIANGLES,6,r.UNSIGNED_SHORT,0)}r.enable(r.CULL_FACE)}}},THREE.DepthPassPlugin=function(){function e(t,r,n){if(r.visible){var i=t.__webglObjects[r.id];if(i&&(r.frustumCulled===!1||l.intersectsObject(r)===!0))for(var o=0,a=i.length;a>o;o++){var s=i[o];r._modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,r.matrixWorld),h.push(s)}for(var o=0,a=r.children.length;a>o;o++)e(t,r.children[o],n)}}function t(e){return e.material instanceof THREE.MeshFaceMaterial?e.material.materials[0]:e.material}this.enabled=!1,this.renderTarget=null;var r,n,i,o,a,s,l=new THREE.Frustum,c=new THREE.Matrix4,h=[];this.init=function(e){r=e.context,n=e;var t=THREE.ShaderLib.depthRGBA,l=THREE.UniformsUtils.clone(t.uniforms);i=new THREE.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:l}),o=new THREE.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:l,morphTargets:!0}),a=new THREE.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:l,skinning:!0}),s=new THREE.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:l,morphTargets:!0,skinning:!0}),i._shadowPass=!0,o._shadowPass=!0,a._shadowPass=!0,s._shadowPass=!0},this.render=function(e,t){this.enabled&&this.update(e,t)},this.update=function(u,f){var d,p,m,g,v,E,y,T=null;r.clearColor(1,1,1,1),r.disable(r.BLEND),n.setDepthTest(!0),u.autoUpdate===!0&&u.updateMatrixWorld(),f.matrixWorldInverse.getInverse(f.matrixWorld),c.multiplyMatrices(f.projectionMatrix,f.matrixWorldInverse),l.setFromMatrix(c),n.setRenderTarget(this.renderTarget),n.clear(),h.length=0,e(u,u,f);var x,w,b;for(d=0,p=h.length;p>d;d++)v=h[d],E=v.object,m=v.buffer,E instanceof THREE.PointCloud&&!E.customDepthMaterial||(x=t(E),x&&n.setMaterialFaces(E.material),w=void 0!==E.geometry.morphTargets&&E.geometry.morphTargets.length>0&&x.morphTargets,b=E instanceof THREE.SkinnedMesh&&x.skinning,g=E.customDepthMaterial?E.customDepthMaterial:b?w?s:a:w?o:i,m instanceof THREE.BufferGeometry?n.renderBufferDirect(f,u.__lights,T,g,m,E):n.renderBuffer(f,u.__lights,T,g,m,E));for(y=u.__webglObjectsImmediate,d=0,p=y.length;p>d;d++)v=y[d],E=v.object,E.visible&&(E._modelViewMatrix.multiplyMatrices(f.matrixWorldInverse,E.matrixWorld),n.renderImmediateObject(f,u.__lights,T,i,E));var R=n.getClearColor(),_=n.getClearAlpha();r.clearColor(R.r,R.g,R.b,_),r.enable(r.BLEND)}},THREE.ShaderFlares={lensFlareVertexTexture:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},lensFlare:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}},function(){var e=this,t=e._,r={},n=Array.prototype,i=Object.prototype,o=Function.prototype,a=n.push,s=n.slice,l=n.concat,c=i.toString,h=i.hasOwnProperty,u=n.forEach,f=n.map,d=n.reduce,p=n.reduceRight,m=n.filter,g=n.every,v=n.some,E=n.indexOf,y=n.lastIndexOf,T=Array.isArray,x=Object.keys,w=o.bind,b=function(e){return e instanceof b?e:this instanceof b?void(this._wrapped=e):new b(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=b),exports._=b):e._=b,b.VERSION="1.5.1";var R=b.each=b.forEach=function(e,t,n){if(null!=e)if(u&&e.forEach===u)e.forEach(t,n);else if(e.length===+e.length){for(var i=0,o=e.length;o>i;i++)if(t.call(n,e[i],i,e)===r)return}else for(var a in e)if(b.has(e,a)&&t.call(n,e[a],a,e)===r)return};b.map=b.collect=function(e,t,r){var n=[];return null==e?n:f&&e.map===f?e.map(t,r):(R(e,function(e,i,o){n.push(t.call(r,e,i,o))}),n)};var _="Reduce of empty array with no initial value";b.reduce=b.foldl=b.inject=function(e,t,r,n){var i=arguments.length>2;if(null==e&&(e=[]),d&&e.reduce===d)return n&&(t=b.bind(t,n)),i?e.reduce(t,r):e.reduce(t);if(R(e,function(e,o,a){i?r=t.call(n,r,e,o,a):(r=e,i=!0)}),!i)throw new TypeError(_);return r},b.reduceRight=b.foldr=function(e,t,r,n){var i=arguments.length>2;if(null==e&&(e=[]),p&&e.reduceRight===p)return n&&(t=b.bind(t,n)),i?e.reduceRight(t,r):e.reduceRight(t);var o=e.length;if(o!==+o){var a=b.keys(e);o=a.length}if(R(e,function(s,l,c){l=a?a[--o]:--o,i?r=t.call(n,r,e[l],l,c):(r=e[l],i=!0)}),!i)throw new TypeError(_);return r},b.find=b.detect=function(e,t,r){var n;return H(e,function(e,i,o){return t.call(r,e,i,o)?(n=e,!0):void 0}),n},b.filter=b.select=function(e,t,r){var n=[];return null==e?n:m&&e.filter===m?e.filter(t,r):(R(e,function(e,i,o){t.call(r,e,i,o)&&n.push(e)}),n)},b.reject=function(e,t,r){return b.filter(e,function(e,n,i){return!t.call(r,e,n,i)},r)},b.every=b.all=function(e,t,n){t||(t=b.identity);var i=!0;return null==e?i:g&&e.every===g?e.every(t,n):(R(e,function(e,o,a){return(i=i&&t.call(n,e,o,a))?void 0:r}),!!i)};var H=b.some=b.any=function(e,t,n){t||(t=b.identity);var i=!1;return null==e?i:v&&e.some===v?e.some(t,n):(R(e,function(e,o,a){return i||(i=t.call(n,e,o,a))?r:void 0}),!!i)};b.contains=b.include=function(e,t){return null==e?!1:E&&e.indexOf===E?-1!=e.indexOf(t):H(e,function(e){return e===t})},b.invoke=function(e,t){var r=s.call(arguments,2),n=b.isFunction(t);return b.map(e,function(e){return(n?t:e[t]).apply(e,r)})},b.pluck=function(e,t){return b.map(e,function(e){return e[t]})},b.where=function(e,t,r){return b.isEmpty(t)?r?void 0:[]:b[r?"find":"filter"](e,function(e){for(var r in t)if(t[r]!==e[r])return!1;return!0})},b.findWhere=function(e,t){return b.where(e,t,!0)},b.max=function(e,t,r){if(!t&&b.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&b.isEmpty(e))return-1/0;var n={computed:-1/0,value:-1/0};return R(e,function(e,i,o){var a=t?t.call(r,e,i,o):e;a>n.computed&&(n={value:e,computed:a})}),n.value},b.min=function(e,t,r){if(!t&&b.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&b.isEmpty(e))return 1/0;var n={computed:1/0,value:1/0};return R(e,function(e,i,o){var a=t?t.call(r,e,i,o):e;a<n.computed&&(n={value:e,computed:a})}),n.value},b.shuffle=function(e){var t,r=0,n=[];return R(e,function(e){t=b.random(r++),n[r-1]=n[t],n[t]=e}),n};var M=function(e){return b.isFunction(e)?e:function(t){return t[e]}};b.sortBy=function(e,t,r){var n=M(t);return b.pluck(b.map(e,function(e,t,i){return{value:e,index:t,criteria:n.call(r,e,t,i)}}).sort(function(e,t){var r=e.criteria,n=t.criteria;if(r!==n){if(r>n||void 0===r)return 1;if(n>r||void 0===n)return-1}return e.index<t.index?-1:1}),"value")};var S=function(e,t,r,n){var i={},o=M(null==t?b.identity:t);return R(e,function(t,a){var s=o.call(r,t,a,e);n(i,s,t)}),i};b.groupBy=function(e,t,r){return S(e,t,r,function(e,t,r){(b.has(e,t)?e[t]:e[t]=[]).push(r)})},b.countBy=function(e,t,r){return S(e,t,r,function(e,t){b.has(e,t)||(e[t]=0),e[t]++})},b.sortedIndex=function(e,t,r,n){r=null==r?b.identity:M(r);for(var i=r.call(n,t),o=0,a=e.length;a>o;){var s=o+a>>>1;r.call(n,e[s])<i?o=s+1:a=s}return o},b.toArray=function(e){return e?b.isArray(e)?s.call(e):e.length===+e.length?b.map(e,b.identity):b.values(e):[]},b.size=function(e){return null==e?0:e.length===+e.length?e.length:b.keys(e).length},b.first=b.head=b.take=function(e,t,r){return null==e?void 0:null==t||r?e[0]:s.call(e,0,t)},b.initial=function(e,t,r){return s.call(e,0,e.length-(null==t||r?1:t))},b.last=function(e,t,r){return null==e?void 0:null==t||r?e[e.length-1]:s.call(e,Math.max(e.length-t,0))},b.rest=b.tail=b.drop=function(e,t,r){return s.call(e,null==t||r?1:t)},b.compact=function(e){return b.filter(e,b.identity)};var C=function(e,t,r){return t&&b.every(e,b.isArray)?l.apply(r,e):(R(e,function(e){b.isArray(e)||b.isArguments(e)?t?a.apply(r,e):C(e,t,r):r.push(e)}),r)};b.flatten=function(e,t){return C(e,t,[])},b.without=function(e){return b.difference(e,s.call(arguments,1))},b.uniq=b.unique=function(e,t,r,n){b.isFunction(t)&&(n=r,r=t,t=!1);var i=r?b.map(e,r,n):e,o=[],a=[];return R(i,function(r,n){(t?n&&a[a.length-1]===r:b.contains(a,r))||(a.push(r),o.push(e[n]))}),o},b.union=function(){return b.uniq(b.flatten(arguments,!0))},b.intersection=function(e){var t=s.call(arguments,1);return b.filter(b.uniq(e),function(e){return b.every(t,function(t){return b.indexOf(t,e)>=0})})},b.difference=function(e){var t=l.apply(n,s.call(arguments,1));return b.filter(e,function(e){return!b.contains(t,e)})},b.zip=function(){for(var e=b.max(b.pluck(arguments,"length").concat(0)),t=new Array(e),r=0;e>r;r++)t[r]=b.pluck(arguments,""+r);return t},b.object=function(e,t){if(null==e)return{};for(var r={},n=0,i=e.length;i>n;n++)t?r[e[n]]=t[n]:r[e[n][0]]=e[n][1];return r},b.indexOf=function(e,t,r){if(null==e)return-1;var n=0,i=e.length;if(r){if("number"!=typeof r)return n=b.sortedIndex(e,t),e[n]===t?n:-1;n=0>r?Math.max(0,i+r):r}if(E&&e.indexOf===E)return e.indexOf(t,r);for(;i>n;n++)if(e[n]===t)return n;return-1},b.lastIndexOf=function(e,t,r){if(null==e)return-1;var n=null!=r;if(y&&e.lastIndexOf===y)return n?e.lastIndexOf(t,r):e.lastIndexOf(t);for(var i=n?r:e.length;i--;)if(e[i]===t)return i;return-1},b.range=function(e,t,r){arguments.length<=1&&(t=e||0,e=0),r=arguments[2]||1;for(var n=Math.max(Math.ceil((t-e)/r),0),i=0,o=new Array(n);n>i;)o[i++]=e,e+=r;return o};var A=function(){};b.bind=function(e,t){var r,n;if(w&&e.bind===w)return w.apply(e,s.call(arguments,1));if(!b.isFunction(e))throw new TypeError;return r=s.call(arguments,2),n=function(){if(!(this instanceof n))return e.apply(t,r.concat(s.call(arguments)));A.prototype=e.prototype;var i=new A;A.prototype=null;var o=e.apply(i,r.concat(s.call(arguments)));return Object(o)===o?o:i}},b.partial=function(e){var t=s.call(arguments,1);return function(){return e.apply(this,t.concat(s.call(arguments)))}},b.bindAll=function(e){var t=s.call(arguments,1);if(0===t.length)throw new Error("bindAll must be passed function names");return R(t,function(t){e[t]=b.bind(e[t],e)}),e},b.memoize=function(e,t){var r={};return t||(t=b.identity),function(){var n=t.apply(this,arguments);return b.has(r,n)?r[n]:r[n]=e.apply(this,arguments)}},b.delay=function(e,t){var r=s.call(arguments,2);return setTimeout(function(){return e.apply(null,r)},t)},b.defer=function(e){return b.delay.apply(b,[e,1].concat(s.call(arguments,1)))},b.throttle=function(e,t,r){var n,i,o,a=null,s=0;r||(r={});var l=function(){s=r.leading===!1?0:new Date,a=null,o=e.apply(n,i)};return function(){var c=new Date;s||r.leading!==!1||(s=c);var h=t-(c-s);return n=this,i=arguments,0>=h?(clearTimeout(a),a=null,s=c,o=e.apply(n,i)):a||r.trailing===!1||(a=setTimeout(l,h)),o}},b.debounce=function(e,t,r){var n,i=null;return function(){var o=this,a=arguments,s=function(){i=null,r||(n=e.apply(o,a))},l=r&&!i;return clearTimeout(i),i=setTimeout(s,t),l&&(n=e.apply(o,a)),n}},b.once=function(e){var t,r=!1;return function(){return r?t:(r=!0,t=e.apply(this,arguments),e=null,t)}},b.wrap=function(e,t){return function(){var r=[e];return a.apply(r,arguments),t.apply(this,r)}},b.compose=function(){var e=arguments;return function(){for(var t=arguments,r=e.length-1;r>=0;r--)t=[e[r].apply(this,t)];return t[0]}},b.after=function(e,t){return function(){return--e<1?t.apply(this,arguments):void 0}},b.keys=x||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var r in e)b.has(e,r)&&t.push(r);return t},b.values=function(e){var t=[];for(var r in e)b.has(e,r)&&t.push(e[r]);return t},b.pairs=function(e){var t=[];for(var r in e)b.has(e,r)&&t.push([r,e[r]]);return t},b.invert=function(e){var t={};for(var r in e)b.has(e,r)&&(t[e[r]]=r);return t},b.functions=b.methods=function(e){var t=[];for(var r in e)b.isFunction(e[r])&&t.push(r);return t.sort()},b.extend=function(e){return R(s.call(arguments,1),function(t){if(t)for(var r in t)e[r]=t[r]}),e},b.pick=function(e){var t={},r=l.apply(n,s.call(arguments,1));return R(r,function(r){r in e&&(t[r]=e[r])}),t},b.omit=function(e){var t={},r=l.apply(n,s.call(arguments,1));for(var i in e)b.contains(r,i)||(t[i]=e[i]);return t},b.defaults=function(e){return R(s.call(arguments,1),function(t){if(t)for(var r in t)void 0===e[r]&&(e[r]=t[r])}),e},b.clone=function(e){return b.isObject(e)?b.isArray(e)?e.slice():b.extend({},e):e},b.tap=function(e,t){return t(e),e};var k=function(e,t,r,n){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof b&&(e=e._wrapped),t instanceof b&&(t=t._wrapped);var i=c.call(e);if(i!=c.call(t))return!1;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var o=r.length;o--;)if(r[o]==e)return n[o]==t;var a=e.constructor,s=t.constructor;if(a!==s&&!(b.isFunction(a)&&a instanceof a&&b.isFunction(s)&&s instanceof s))return!1;r.push(e),n.push(t);var l=0,h=!0;if("[object Array]"==i){if(l=e.length,h=l==t.length)for(;l--&&(h=k(e[l],t[l],r,n)););}else{for(var u in e)if(b.has(e,u)&&(l++,!(h=b.has(t,u)&&k(e[u],t[u],r,n))))break;if(h){for(u in t)if(b.has(t,u)&&!l--)break;h=!l}}return r.pop(),n.pop(),h};b.isEqual=function(e,t){return k(e,t,[],[])},b.isEmpty=function(e){if(null==e)return!0;if(b.isArray(e)||b.isString(e))return 0===e.length;for(var t in e)if(b.has(e,t))return!1;return!0},b.isElement=function(e){return!(!e||1!==e.nodeType)},b.isArray=T||function(e){return"[object Array]"==c.call(e)},b.isObject=function(e){return e===Object(e)},R(["Arguments","Function","String","Number","Date","RegExp"],function(e){b["is"+e]=function(t){return c.call(t)=="[object "+e+"]"}}),b.isArguments(arguments)||(b.isArguments=function(e){return!(!e||!b.has(e,"callee"))}),"function"!=typeof/./&&(b.isFunction=function(e){return"function"==typeof e}),b.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},b.isNaN=function(e){return b.isNumber(e)&&e!=+e},b.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==c.call(e)},b.isNull=function(e){return null===e},b.isUndefined=function(e){return void 0===e},b.has=function(e,t){return h.call(e,t)},b.noConflict=function(){return e._=t,this},b.identity=function(e){return e},b.times=function(e,t,r){for(var n=Array(Math.max(0,e)),i=0;e>i;i++)n[i]=t.call(r,i);return n},b.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var L={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};L.unescape=b.invert(L.escape);var P={escape:new RegExp("["+b.keys(L.escape).join("")+"]","g"),unescape:new RegExp("("+b.keys(L.unescape).join("|")+")","g")};b.each(["escape","unescape"],function(e){b[e]=function(t){return null==t?"":(""+t).replace(P[e],function(t){return L[e][t]})}}),b.result=function(e,t){if(null==e)return void 0;var r=e[t];return b.isFunction(r)?r.call(e):r},b.mixin=function(e){R(b.functions(e),function(t){var r=b[t]=e[t];b.prototype[t]=function(){var e=[this._wrapped];return a.apply(e,arguments),O.call(this,r.apply(b,e))}})};var F=0;b.uniqueId=function(e){var t=++F+"";return e?e+t:t},b.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var N=/(.)^/,D={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},U=/\\|'|\r|\n|\t|\u2028|\u2029/g;b.template=function(e,t,r){var n;r=b.defaults({},r,b.templateSettings);var i=new RegExp([(r.escape||N).source,(r.interpolate||N).source,(r.evaluate||N).source].join("|")+"|$","g"),o=0,a="__p+='";e.replace(i,function(t,r,n,i,s){return a+=e.slice(o,s).replace(U,function(e){return"\\"+D[e]}),r&&(a+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'"),n&&(a+="'+\n((__t=("+n+"))==null?'':__t)+\n'"),i&&(a+="';\n"+i+"\n__p+='"),o=s+t.length,t
}),a+="';\n",r.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{n=new Function(r.variable||"obj","_",a)}catch(s){throw s.source=a,s}if(t)return n(t,b);var l=function(e){return n.call(this,e,b)};return l.source="function("+(r.variable||"obj")+"){\n"+a+"}",l},b.chain=function(e){return b(e).chain()};var O=function(e){return this._chain?b(e).chain():e};b.mixin(b),R(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=n[e];b.prototype[e]=function(){var r=this._wrapped;return t.apply(r,arguments),"shift"!=e&&"splice"!=e||0!==r.length||delete r[0],O.call(this,r)}}),R(["concat","join","slice"],function(e){var t=n[e];b.prototype[e]=function(){return O.call(this,t.apply(this._wrapped,arguments))}}),b.extend(b.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this);var Backbone=Backbone||{};!function(){var e=[],t=e.slice,r=function(e,t,r){var n,i=-1,o=t.length;switch(r.length){case 0:for(;++i<o;)(n=t[i]).callback.call(n.ctx);return;case 1:for(;++i<o;)(n=t[i]).callback.call(n.ctx,r[0]);return;case 2:for(;++i<o;)(n=t[i]).callback.call(n.ctx,r[0],r[1]);return;case 3:for(;++i<o;)(n=t[i]).callback.call(n.ctx,r[0],r[1],r[2]);return;default:for(;++i<o;)(n=t[i]).callback.apply(n.ctx,r)}},n=Backbone.Events={on:function(e,t,r){this._events||(this._events={});var n=this._events[e]||(this._events[e]=[]);return n.push({callback:t,context:r,ctx:r||this}),this},once:function(e,t,r){var n=this,i=_.once(function(){n.off(e,i),t.apply(this,arguments)});return i._callback=t,this.on(e,i,r),this},off:function(e,t,r){var n,i,o,a,s,l,c,h;if(!this._events)return this;if(!e&&!t&&!r)return this._events={},this;for(a=e?[e]:_.keys(this._events),s=0,l=a.length;l>s;s++)if(e=a[s],n=this._events[e]){if(o=[],t||r)for(c=0,h=n.length;h>c;c++)i=n[c],(t&&t!==(i.callback._callback||i.callback)||r&&r!==i.context)&&o.push(i);this._events[e]=o}return this},trigger:function(e){if(!this._events)return this;var n=t.call(arguments,1),i=this._events[e],o=this._events.all;return i&&r(this,i,n),o&&r(this,o,arguments),this},listenTo:function(e,t,r){var n=this._listeners||(this._listeners={}),i=e._listenerId||(e._listenerId=_.uniqueId("l"));return n[i]=e,e.on(t,r||this,this),this},stopListening:function(e,t,r){var n=this._listeners;if(n){if(e)e.off(t,r,this),t||r||delete n[e._listenerId];else{for(var i in n)n[i].off(null,null,this);this._listeners={}}return this}}};n.bind=n.on,n.unbind=n.off,"undefined"!=typeof exports&&("undefined"!=typeof module&&module.exports&&(exports=module.exports=n),exports.Backbone=exports.Backbone||Backbone)}(),function(){function e(e){var n=(new Date).getTime(),i=Math.max(0,16-(n-r)),o=t.setTimeout(function(){e(n+i)},i);return r=n+i,o}var t=this,r=0,n=["ms","moz","webkit","o"];if("undefined"!=typeof exports)return"undefined"!=typeof module&&module.exports&&(exports=module.exports=e),void(exports.requestAnimationFrame=e);for(var i=0;i<n.length&&!t.requestAnimationFrame;++i)t.requestAnimationFrame=t[n[i]+"RequestAnimationFrame"],t.cancelAnimationFrame=t[n[i]+"CancelAnimationFrame"]||t[n[i]+"CancelRequestAnimationFrame"];t.requestAnimationFrame||(t.requestAnimationFrame=e),t.cancelAnimationFrame||(t.cancelAnimationFrame=function(e){clearTimeout(e)})}(),function(){function e(){var e=document.body.getBoundingClientRect(),t=this.width=e.width,r=this.height=e.height;this.renderer.setSize(t,r,this.ratio),this.trigger(g.Events.resize,t,r)}function t(){return(r.performance&&r.performance.now?r.performance:Date).now()}var r=this,n=r.Two||{},i=Math.sin,o=Math.cos,a=Math.atan2,s=Math.sqrt,l=(Math.round,Math.abs,Math.PI),c=2*l,h=l/2,u=Math.pow,f=Math.min,d=Math.max,p=0,m={hasEventListeners:_.isFunction(r.addEventListener),bind:function(e,t,r,n){return this.hasEventListeners?e.addEventListener(t,r,!!n):e.attachEvent("on"+t,r),this},unbind:function(e,t,r,n){return this.hasEventListeners?e.removeEventListeners(t,r,!!n):e.detachEvent("on"+t,r),this}},g=r.Two=function(t){var n=_.defaults(t||{},{fullscreen:!1,width:640,height:480,type:g.Types.svg,autostart:!1});if(_.each(n,function(e,t){"fullscreen"!==t&&"width"!==t&&"height"!==t&&"autostart"!==t&&(this[t]=e)},this),_.isElement(n.domElement)&&(this.type=g.Types[n.domElement.tagName.toLowerCase()]),this.renderer=new g[this.type](this),g.Utils.setPlaying.call(this,n.autostart),this.frameCount=0,n.fullscreen){var i=_.bind(e,this);_.extend(document.body.style,{overflow:"hidden",margin:0,padding:0,top:0,left:0,right:0,bottom:0,position:"fixed"}),_.extend(this.renderer.domElement.style,{display:"block",top:0,left:0,right:0,bottom:0,position:"fixed"}),m.bind(r,"resize",i),i()}else _.isElement(n.domElement)||(this.renderer.setSize(n.width,n.height,this.ratio),this.width=n.width,this.height=n.height);this.scene=this.renderer.scene,g.Instances.push(this)};_.extend(g,{Array:r.Float32Array||Array,Types:{webgl:"WebGLRenderer",svg:"SVGRenderer",canvas:"CanvasRenderer"},Version:"v0.4.0",Identifier:"two-",Properties:{hierarchy:"hierarchy",demotion:"demotion"},Events:{play:"play",pause:"pause",update:"update",render:"render",resize:"resize",change:"change",remove:"remove",insert:"insert"},Commands:{move:"M",line:"L",curve:"C",close:"Z"},Resolution:8,Instances:[],noConflict:function(){return r.Two=n,this},uniqueId:function(){var e=p;return p++,e},Utils:{release:function(e){_.isObject(e)&&(_.isFunction(e.unbind)&&e.unbind(),e.vertices&&(_.isFunction(e.vertices.unbind)&&e.vertices.unbind(),_.each(e.vertices,function(e){_.isFunction(e.unbind)&&e.unbind()})),e.children&&_.each(e.children,function(e){g.Utils.release(e)}))},Curve:{CollinearityEpsilon:u(10,-30),RecursionLimit:16,CuspLimit:0,Tolerance:{distance:.25,angle:0,epsilon:.01},abscissas:[[.5773502691896257],[0,.7745966692414834],[.33998104358485626,.8611363115940526],[0,.5384693101056831,.906179845938664],[.2386191860831969,.6612093864662645,.932469514203152],[0,.4058451513773972,.7415311855993945,.9491079123427585],[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499]],weights:[[1],[.8888888888888888,.5555555555555556],[.6521451548625461,.34785484513745385],[.5688888888888889,.47862867049936647,.23692688505618908],[.46791393457269104,.3607615730481386,.17132449237917036],[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096]]},devicePixelRatio:r.devicePixelRatio||1,getBackingStoreRatio:function(e){return e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1},getRatio:function(e){return g.Utils.devicePixelRatio/w(e)},setPlaying:function(e){return this.playing=!!e,this},getComputedMatrix:function(e,t){t=t&&t.identity()||new g.Matrix;for(var r=e,n=[];r&&r._matrix;)n.push(r._matrix),r=r.parent;return n.reverse(),_.each(n,function(e){var r=e.elements;t.multiply(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8],r[9])}),t},applySvgAttributes:function(e,t){var r={},n={};if(getComputedStyle){var i=getComputedStyle(e);_.each(i,function(e){n[e]=i[e]})}return _.each(e.attributes,function(e){r[e.nodeName]=e.nodeValue}),_.isUndefined(n.opacity)||(n["stroke-opacity"]=n.opacity,n["fill-opacity"]=n.opacity),_.extend(n,r),n.visible="none"!==n.display&&"visible"===n.visibility,_.each(n,function(e,r){switch(r){case"transform":break;case"visible":t.visible=e;break;case"stroke-linecap":t.cap=e;break;case"stroke-linejoin":t.join=e;break;case"stroke-miterlimit":t.miter=e;break;case"stroke-width":t.linewidth=parseFloat(e);break;case"stroke-opacity":case"fill-opacity":case"opacity":t.opacity=parseFloat(e);break;case"fill":case"stroke":t[r]="none"==e?"transparent":e;break;case"id":t.id=e;break;case"class":t.classList||(t.classList=[]),e.split(" ").forEach(function(e){t.classList.push(e)});break;case"class":t.classList||(t.classList=[]),e.split(" ").forEach(function(e){t.classList.push(e)})}}),t},read:{svg:function(){return g.Utils.read.g.apply(this,arguments)},g:function(e){var t=new g.Group;return this.add(t),_.each(e.childNodes,function(e){var r=e.nodeName;if(r){var n=r.replace(/svg\:/gi,"").toLowerCase();if(n in g.Utils.read){var i=g.Utils.read[n].call(this,e);t.add(i)}}},this),g.Utils.applySvgAttributes(e,t)},polygon:function(e,t){var r=e.getAttribute("points"),n=[];r.replace(/(-?[\d\.?]+),(-?[\d\.?]+)/g,function(e,t,r){n.push(new g.Anchor(parseFloat(t),parseFloat(r)))});var i=new g.Polygon(n,!t).noStroke();return i.fill="black",g.Utils.applySvgAttributes(e,i)},polyline:function(e){return g.Utils.read.polygon(e,!0)},path:function(e){var t,r,n,i=e.getAttribute("d"),o=!1,a=!1,s=i.match(/[a-df-z][^a-df-z]*/gi),l=s.length-1,c=_.flatten(_.map(s,function(e,i){var s,c,h,f=e[0],d=f.toLowerCase();n=e.slice(1).trim(),n=n.replace(/(-?\d+(?:\.\d*)?)[eE]([+\-]?\d+)/g,function(e,t,r){return parseFloat(t)*u(10,r)}),n=n.split(/[\s,]+|(?=\s?[+\-])/),o=f===d;var p,m,v,E,y,T,x,w,b;switch(d){case"z":i>=l?a=!0:(c=t.x,h=t.y,s=new g.Anchor(c,h,void 0,void 0,void 0,void 0,g.Commands.close));break;case"m":case"l":c=parseFloat(n[0]),h=parseFloat(n[1]),s=new g.Anchor(c,h,void 0,void 0,void 0,void 0,"m"===d?g.Commands.move:g.Commands.line),o&&s.addSelf(t),t=s;break;case"h":case"v":var R="h"===d?"x":"y",H="x"===R?"y":"x";s=new g.Anchor(void 0,void 0,void 0,void 0,void 0,void 0,g.Commands.line),s[R]=parseFloat(n[0]),s[H]=t[H],o&&(s[R]+=t[R]),t=s;break;case"s":case"c":p=t.x,m=t.y,r||(r=(new g.Vector).copy(t)),"c"===d?(v=parseFloat(n[0]),E=parseFloat(n[1]),y=parseFloat(n[2]),T=parseFloat(n[3]),x=parseFloat(n[4]),w=parseFloat(n[5])):(b=g.Utils.getReflection(t,r,o),v=b.x,E=b.y,y=parseFloat(n[0]),T=parseFloat(n[1]),x=parseFloat(n[2]),w=parseFloat(n[3])),o&&(v+=p,E+=m,y+=p,T+=m,x+=p,w+=m),_.isObject(t.controls)||g.Anchor.AppendCurveProperties(t),t.controls.right.set(v-t.x,E-t.y),s=new g.Anchor(x,w,y-x,T-w,void 0,void 0,g.Commands.curve),t=s,r=s.controls.left;break;case"t":case"q":p=t.x,m=t.y,r||(r=(new g.Vector).copy(t)),r.isZero()?(v=p,E=m):(v=r.x,m=r.y),"q"===d?(y=parseFloat(n[0]),T=parseFloat(n[1]),x=parseFloat(n[1]),w=parseFloat(n[2])):(b=g.Utils.getReflection(t,r,o),y=b.x,T=b.y,x=parseFloat(n[0]),w=parseFloat(n[1])),o&&(v+=p,E+=m,y+=p,T+=m,x+=p,w+=m),_.isObject(t.controls)||g.Anchor.AppendCurveProperties(t),t.controls.right.set(v-t.x,E-t.y),s=new g.Anchor(x,w,y-x,T-w,void 0,void 0,g.Commands.curve),t=s,r=s.controls.left;break;case"a":throw new g.Utils.Error("not yet able to interpret Elliptical Arcs.")}return s}));if(!(c.length<=1)){c=_.compact(c);var h=new g.Polygon(c,a,void 0,!0).noStroke();return h.fill="black",g.Utils.applySvgAttributes(e,h)}},circle:function(e){var t=parseFloat(e.getAttribute("cx")),r=parseFloat(e.getAttribute("cy")),n=parseFloat(e.getAttribute("r")),a=g.Resolution,s=_.map(_.range(a),function(e){var t=e/a,r=t*c,s=n*o(r),l=n*i(r);return new g.Anchor(s,l)},this),l=new g.Polygon(s,!0,!0).noStroke();return l.translation.set(t,r),l.fill="black",g.Utils.applySvgAttributes(e,l)},ellipse:function(e){var t=parseFloat(e.getAttribute("cx")),r=parseFloat(e.getAttribute("cy")),n=parseFloat(e.getAttribute("rx")),a=parseFloat(e.getAttribute("ry")),s=g.Resolution,l=_.map(_.range(s),function(e){var t=e/s,r=t*c,l=n*o(r),h=a*i(r);return new g.Anchor(l,h)},this),h=new g.Polygon(l,!0,!0).noStroke();return h.translation.set(t,r),h.fill="black",g.Utils.applySvgAttributes(e,h)},rect:function(e){var t=parseFloat(e.getAttribute("x")),r=parseFloat(e.getAttribute("y")),n=parseFloat(e.getAttribute("width")),i=parseFloat(e.getAttribute("height")),o=n/2,a=i/2,s=[new g.Anchor(o,a),new g.Anchor(-o,a),new g.Anchor(-o,-a),new g.Anchor(o,-a)],l=new g.Polygon(s,!0).noStroke();return l.translation.set(t+o,r+a),l.fill="black",g.Utils.applySvgAttributes(e,l)},line:function(e){var t=parseFloat(e.getAttribute("x1")),r=parseFloat(e.getAttribute("y1")),n=parseFloat(e.getAttribute("x2")),i=parseFloat(e.getAttribute("y2")),o=n-t,a=i-r,s=o/2,l=a/2,c=[new g.Anchor(-s,-l),new g.Anchor(s,l)],h=new g.Polygon(c).noFill();return h.translation.set(t+s,r+l),g.Utils.applySvgAttributes(e,h)}},subdivide:function(e,t,r,n,i,o,a,s,l){l=l||g.Utils.Curve.RecursionLimit;var c=l+1;return e===a&&t===s?[new g.Anchor(a,s)]:_.map(_.range(0,c),function(l){var h=l/c,u=b(h,e,r,i,a),f=b(h,t,n,o,s);return new g.Anchor(u,f)})},getPointOnCubicBezier:function(e,t,r,n,i){var o=1-e;return o*o*o*t+3*o*o*e*r+3*o*e*e*n+e*e*e*i},getCurveLength:function(e,t,r,n,i,o,a,l,c){if(e===r&&t===n&&i===a&&o===l){var h=a-e,u=l-t;return s(h*h+u*u)}var f=9*(r-i)+3*(a-e),d=6*(e+i)-12*r,p=3*(r-e),m=9*(n-o)+3*(l-t),v=6*(t+o)-12*n,E=3*(n-t),y=function(e){var t=(f*e+d)*e+p,r=(m*e+v)*e+E;return s(t*t+r*r)};return R(y,0,1,c||g.Utils.Curve.RecursionLimit)},integrate:function(e,t,r,n){for(var i=g.Utils.Curve.abscissas[n-2],o=g.Utils.Curve.weights[n-2],a=.5*(r-t),s=a+t,l=0,c=n+1>>1,h=1&n?o[l++]*e(s):0;c>l;){var u=a*i[l];h+=o[l++]*(e(s+u)+e(s-u))}return a*h},getCurveFromPoints:function(e,t){for(var r=e.length,n=r-1,i=0;r>i;i++){var o=e[i];_.isObject(o.controls)||g.Anchor.AppendCurveProperties(o);var a=t?x(i-1,r):d(i-1,0),s=t?x(i+1,r):f(i+1,n),l=e[a],c=o,h=e[s];T(l,c,h),c._command=0===i?g.Commands.move:g.Commands.curve,c.controls.left.x=_.isNumber(c.controls.left.x)?c.controls.left.x:c.x,c.controls.left.y=_.isNumber(c.controls.left.y)?c.controls.left.y:c.y,c.controls.right.x=_.isNumber(c.controls.right.x)?c.controls.right.x:c.x,c.controls.right.y=_.isNumber(c.controls.right.y)?c.controls.right.y:c.y}},getControlPoints:function(e,t,r){var n=y(e,t),a=y(r,t),s=v(e,t),c=v(r,t),u=(n+a)/2;return t.u=_.isObject(t.controls.left)?t.controls.left:new g.Vector(0,0),t.v=_.isObject(t.controls.right)?t.controls.right:new g.Vector(0,0),1e-4>s||1e-4>c?(t._relative||(t.controls.left.copy(t),t.controls.right.copy(t)),t):(s*=.33,c*=.33,n>a?u+=h:u-=h,t.controls.left.x=o(u)*s,t.controls.left.y=i(u)*s,u-=l,t.controls.right.x=o(u)*c,t.controls.right.y=i(u)*c,t._relative||(t.controls.left.x+=t.x,t.controls.left.y+=t.y,t.controls.right.x+=t.x,t.controls.right.y+=t.y),t)},getReflection:function(e,t,r){var n=t.distanceTo(g.Vector.zero),a=y(g.Vector.zero,t);return new g.Vector(n*o(a)+(r?0:e.x),n*i(a)+(r?0:e.y))},angleBetween:function(e,t){var r,n;return arguments.length>=4?(r=arguments[0]-arguments[2],n=arguments[1]-arguments[3],a(n,r)):(r=e.x-t.x,n=e.y-t.y,a(n,r))},distanceBetweenSquared:function(e,t){var r=e.x-t.x,n=e.y-t.y;return r*r+n*n},distanceBetween:function(e,t){return s(E(e,t))},mod:function(e,t){for(;0>e;)e+=t;return e%t},Collection:function(){Array.call(this),arguments.length>1?Array.prototype.push.apply(this,arguments):arguments[0]&&Array.isArray(arguments[0])&&Array.prototype.push.apply(this,arguments[0])},Error:function(e){this.name="two.js",this.message=e}}}),g.Utils.Error.prototype=new Error,g.Utils.Error.prototype.constructor=g.Utils.Error,g.Utils.Collection.prototype=new Array,g.Utils.Collection.constructor=g.Utils.Collection,_.extend(g.Utils.Collection.prototype,Backbone.Events,{pop:function(){var e=Array.prototype.pop.apply(this,arguments);return this.trigger(g.Events.remove,[e]),e},shift:function(){var e=Array.prototype.shift.apply(this,arguments);return this.trigger(g.Events.remove,[e]),e},push:function(){var e=Array.prototype.push.apply(this,arguments);return this.trigger(g.Events.insert,arguments),e},unshift:function(){var e=Array.prototype.unshift.apply(this,arguments);return this.trigger(g.Events.insert,arguments),e},splice:function(){var e,t=Array.prototype.splice.apply(this,arguments);return this.trigger(g.Events.remove,t),arguments.length>2&&(e=this.slice(arguments[0],arguments.length-2),this.trigger(g.Events.insert,e)),t}});var v=g.Utils.distanceBetween,E=g.Utils.distanceBetweenSquared,y=g.Utils.angleBetween,T=g.Utils.getControlPoints,x=(g.Utils.getCurveFromPoints,g.Utils.solveSegmentIntersection,g.Utils.decoupleShapes,g.Utils.mod),w=g.Utils.getBackingStoreRatio,b=g.Utils.getPointOnCubicBezier,R=(g.Utils.getCurveLength,g.Utils.integrate);_.extend(g.prototype,Backbone.Events,{appendTo:function(e){return e.appendChild(this.renderer.domElement),this},play:function(){return g.Utils.setPlaying.call(this,!0),this.trigger(g.Events.play)},pause:function(){return this.playing=!1,this.trigger(g.Events.pause)},update:function(){var e=!!this._lastFrame,r=t();this.frameCount++,e&&(this.timeDelta=parseFloat((r-this._lastFrame).toFixed(3))),this._lastFrame=r;var n=this.width,i=this.height,o=this.renderer;return(n!==o.width||i!==o.height)&&o.setSize(n,i,this.ratio),this.trigger(g.Events.update,this.frameCount,this.timeDelta),this.render()},render:function(){return this.renderer.render(),this.trigger(g.Events.render,this.frameCount)},add:function(e){var t=e;return _.isArray(e)||(t=_.toArray(arguments)),this.scene.add(t),this},remove:function(e){var t=e;return _.isArray(e)||(t=_.toArray(arguments)),this.scene.remove(t),this},clear:function(){return this.scene.remove(_.toArray(this.scene.children)),this},makeLine:function(e,t,r,n){var i=r-e,o=n-t,a=i/2,s=o/2,l=[new g.Anchor(-a,-s),new g.Anchor(a,s)],c=new g.Polygon(l).noFill();return c.translation.set(e+a,t+s),this.scene.add(c),c},makeRectangle:function(e,t,r,n){var i=r/2,o=n/2,a=[new g.Anchor(-i,-o),new g.Anchor(i,-o),new g.Anchor(i,o),new g.Anchor(-i,o)],s=new g.Polygon(a,!0);return s.translation.set(e,t),this.scene.add(s),s},makeCircle:function(e,t,r){return this.makeEllipse(e,t,r,r)},makeEllipse:function(e,t,r,n){var a=g.Resolution,s=_.map(_.range(a),function(e){var t=e/a,s=t*c,l=r*o(s),h=n*i(s);return new g.Anchor(l,h)},this),l=new g.Polygon(s,!0,!0);return l.translation.set(e,t),this.scene.add(l),l},makeCurve:function(e){var t=arguments.length,r=e;if(!_.isArray(e)){r=[];for(var n=0;t>n;n+=2){var i=arguments[n];if(!_.isNumber(i))break;var o=arguments[n+1];r.push(new g.Anchor(i,o))}}var a=arguments[t-1],s=new g.Polygon(r,!(_.isBoolean(a)?a:void 0),!0),l=s.getBoundingClientRect(),c=l.left+l.width/2,h=l.top+l.height/2;return _.each(s.vertices,function(e){e.x-=c,e.y-=h}),s.translation.set(c,h),this.scene.add(s),s},makePolygon:function(e){var t=arguments.length,r=e;if(!_.isArray(e)){r=[];for(var n=0;t>n;n+=2){var i=arguments[n];if(!_.isNumber(i))break;var o=arguments[n+1];r.push(new g.Anchor(i,o))}}var a=arguments[t-1],s=new g.Polygon(r,!(_.isBoolean(a)?a:void 0)),l=s.getBoundingClientRect();return s.center().translation.set(l.left+l.width/2,l.top+l.height/2),this.scene.add(s),s},makeGroup:function(e){var t=e;_.isArray(e)||(t=_.toArray(arguments));var r=new g.Group;return this.scene.add(r),r.add(t),r},interpret:function(e){var t=e.tagName.toLowerCase();if(!(t in g.Utils.read))return null;var r=g.Utils.read[t].call(this,e);return this.add(r),r}}),function(){requestAnimationFrame(arguments.callee),g.Instances.forEach(function(e){e.playing&&e.update()})}(),"function"==typeof define&&define.amd?define(function(){return g}):"undefined"!=typeof module&&module.exports&&(module.exports=g)}(),function(){var e=Two.Vector=function(e,t){this.x=e||0,this.y=t||0};_.extend(e,{zero:new Two.Vector}),_.extend(e.prototype,Backbone.Events,{set:function(e,t){return this.x=e,this.y=t,this},copy:function(e){return this.x=e.x,this.y=e.y,this},clear:function(){return this.x=0,this.y=0,this},clone:function(){return new e(this.x,this.y)},add:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addSelf:function(e){return this.x+=e.x,this.y+=e.y,this},sub:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},subSelf:function(e){return this.x-=e.x,this.y-=e.y,this},multiplySelf:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divideScalar:function(e){return e?(this.x/=e,this.y/=e):this.set(0,0),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y},lengthSquared:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSquared())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r},setLength:function(e){return this.normalize().multiplyScalar(e)},equals:function(e){return this.distanceTo(e)<1e-4},lerp:function(e,t){var r=(e.x-this.x)*t+this.x,n=(e.y-this.y)*t+this.y;return this.set(r,n)},isZero:function(){return this.length()<1e-4},toString:function(){return this.x+","+this.y},toObject:function(){return{x:this.x,y:this.y}}});var t={set:function(e,t){return this._x=e,this._y=t,this.trigger(Two.Events.change)},copy:function(e){return this._x=e.x,this._y=e.y,this.trigger(Two.Events.change)},clear:function(){return this._x=0,this._y=0,this.trigger(Two.Events.change)},clone:function(){return new e(this._x,this._y)},add:function(e,t){return this._x=e.x+t.x,this._y=e.y+t.y,this.trigger(Two.Events.change)},addSelf:function(e){return this._x+=e.x,this._y+=e.y,this.trigger(Two.Events.change)},sub:function(e,t){return this._x=e.x-t.x,this._y=e.y-t.y,this.trigger(Two.Events.change)},subSelf:function(e){return this._x-=e.x,this._y-=e.y,this.trigger(Two.Events.change)},multiplySelf:function(e){return this._x*=e.x,this._y*=e.y,this.trigger(Two.Events.change)},multiplyScalar:function(e){return this._x*=e,this._y*=e,this.trigger(Two.Events.change)},divideScalar:function(e){return e?(this._x/=e,this._y/=e,this.trigger(Two.Events.change)):this.clear()},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this._x*e.x+this._y*e.y},lengthSquared:function(){return this._x*this._x+this._y*this._y},length:function(){return Math.sqrt(this.lengthSquared())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this._x-e.x,r=this._y-e.y;return t*t+r*r},setLength:function(e){return this.normalize().multiplyScalar(e)},equals:function(e){return this.distanceTo(e)<1e-4},lerp:function(e,t){var r=(e.x-this._x)*t+this._x,n=(e.y-this._y)*t+this._y;return this.set(r,n)},isZero:function(){return this.length()<1e-4},toString:function(){return this._x+","+this._y},toObject:function(){return{x:this._x,y:this._y}}},r={get:function(){return this._x},set:function(e){this._x=e,this.trigger(Two.Events.change,"x")}},n={get:function(){return this._y},set:function(e){this._y=e,this.trigger(Two.Events.change,"y")}};Two.Vector.prototype.bind=Two.Vector.prototype.on=function(){return this._bound||(this._x=this.x,this._y=this.y,Object.defineProperty(this,"x",r),Object.defineProperty(this,"y",n),_.extend(this,t),this._bound=!0),Backbone.Events.bind.apply(this,arguments),this}}(),function(){var e=Two.Commands,t=Two.Anchor=function(r,n,i,o,a,s,l){return Two.Vector.call(this,r,n),this._broadcast=_.bind(function(){this.trigger(Two.Events.change)},this),this._command=l||e.move,this._relative=!0,l?(t.AppendCurveProperties(this),_.isNumber(i)&&(this.controls.left.x=i),_.isNumber(o)&&(this.controls.left.y=o),_.isNumber(a)&&(this.controls.right.x=a),void(_.isNumber(s)&&(this.controls.right.y=s))):this};_.extend(t,{AppendCurveProperties:function(e){e._x||e.x,e._y||e.y;e.controls={left:new Two.Vector(0,0),right:new Two.Vector(0,0)}}});var r={listen:function(){return _.isObject(this.controls)||t.AppendCurveProperties(this),_.each(this.controls,function(e){e.bind(Two.Events.change,this._broadcast)},this),this},ignore:function(){return _.each(this.controls,function(e){e.unbind(Two.Events.change,this._broadcast)},this),this},clone:function(){var e=this.controls,t=new Two.Anchor(this.x,this.y,e&&e.left.x,e&&e.left.y,e&&e.right.x,e&&e.right.y,this.command);return t.relative=this._relative,t},toObject:function(){var e={x:this.x,y:this.y};return this._command&&(e.command=this._command),this._relative&&(e.relative=this._relative),this.controls&&(e.controls={left:this.controls.left.toObject(),right:this.controls.right.toObject()}),e}};Object.defineProperty(t.prototype,"command",{get:function(){return this._command},set:function(r){return this._command=r,this._command!==e.curve||_.isObject(this.controls)||t.AppendCurveProperties(this),this.trigger(Two.Events.change)}}),Object.defineProperty(t.prototype,"relative",{get:function(){return this._relative},set:function(e){return this._relative==e?this:(this._relative=!!e,this.trigger(Two.Events.change))}}),_.extend(t.prototype,Two.Vector.prototype,r),Two.Anchor.prototype.bind=Two.Anchor.prototype.on=function(){Two.Vector.prototype.bind.apply(this,arguments),_.extend(this,r)},Two.Anchor.prototype.unbind=Two.Anchor.prototype.off=function(){Two.Vector.prototype.unbind.apply(this,arguments),_.extend(this,r)}}(),function(){var e=Math.cos,t=Math.sin,r=Math.tan,n=Two.Matrix=function(e){this.elements=new Two.Array(9);var t=e;_.isArray(t)||(t=_.toArray(arguments)),this.identity().set(t)};_.extend(n,{Identity:[1,0,0,0,1,0,0,0,1],Multiply:function(e,t,r){if(t.length<=3){var n,i,o,a=e,s=t[0]||0,l=t[1]||0,c=t[2]||0;return n=a[0]*s+a[1]*l+a[2]*c,i=a[3]*s+a[4]*l+a[5]*c,o=a[6]*s+a[7]*l+a[8]*c,{x:n,y:i,z:o}}var h=e[0],u=e[1],f=e[2],d=e[3],p=e[4],m=e[5],g=e[6],v=e[7],E=e[8],y=t[0],T=t[1],x=t[2],w=t[3],b=t[4],R=t[5],_=t[6],H=t[7],M=t[8];return r=r||new Two.Array(9),r[0]=h*y+u*w+f*_,r[1]=h*T+u*b+f*H,r[2]=h*x+u*R+f*M,r[3]=d*y+p*w+m*_,r[4]=d*T+p*b+m*H,r[5]=d*x+p*R+m*M,r[6]=g*y+v*w+E*_,r[7]=g*T+v*b+E*H,r[8]=g*x+v*R+E*M,r}}),_.extend(n.prototype,Backbone.Events,{set:function(e){var t=e;return _.isArray(t)||(t=_.toArray(arguments)),_.each(t,function(e,t){_.isNumber(e)&&(this.elements[t]=e)},this),this.trigger(Two.Events.change)},identity:function(){return this.set(n.Identity),this},multiply:function(e,t,r,n,i){var o=arguments,a=o.length;if(1>=a)return _.each(this.elements,function(t,r){this.elements[r]=t*e},this),this.trigger(Two.Events.change);if(3>=a){var s,l,c;return e=e||0,t=t||0,r=r||0,i=this.elements,s=i[0]*e+i[1]*t+i[2]*r,l=i[3]*e+i[4]*t+i[5]*r,c=i[6]*e+i[7]*t+i[8]*r,{x:s,y:l,z:c}}var h=this.elements,u=o,f=h[0],d=h[1],p=h[2],m=h[3],g=h[4],v=h[5],E=h[6],y=h[7],T=h[8],x=u[0],w=u[1],b=u[2],R=u[3],H=u[4],M=u[5],S=u[6],C=u[7],A=u[8];return this.elements[0]=f*x+d*R+p*S,this.elements[1]=f*w+d*H+p*C,this.elements[2]=f*b+d*M+p*A,this.elements[3]=m*x+g*R+v*S,this.elements[4]=m*w+g*H+v*C,this.elements[5]=m*b+g*M+v*A,this.elements[6]=E*x+y*R+T*S,this.elements[7]=E*w+y*H+T*C,this.elements[8]=E*b+y*M+T*A,this.trigger(Two.Events.change)},inverse:function(e){var t=this.elements;e=e||new Two.Matrix;var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],l=t[6],c=t[7],h=t[8],u=h*a-s*c,f=-h*o+s*l,d=c*o-a*l,p=r*u+n*f+i*d;return p?(p=1/p,e.elements[0]=u*p,e.elements[1]=(-h*n+i*c)*p,e.elements[2]=(s*n-i*a)*p,e.elements[3]=f*p,e.elements[4]=(h*r-i*l)*p,e.elements[5]=(-s*r+i*o)*p,e.elements[6]=d*p,e.elements[7]=(-c*r+n*l)*p,e.elements[8]=(a*r-n*o)*p,e):null},scale:function(e,t){var r=arguments.length;return 1>=r&&(t=e),this.multiply(e,0,0,0,t,0,0,0,1)},rotate:function(r){var n=e(r),i=t(r);return this.multiply(n,-i,0,i,n,0,0,0,1)},translate:function(e,t){return this.multiply(1,0,e,0,1,t,0,0,1)},skewX:function(e){var t=r(e);return this.multiply(1,t,0,0,1,0,0,0,1)},skewY:function(e){var t=r(e);return this.multiply(1,0,0,t,1,0,0,0,1)},toString:function(e){var t=[];return this.toArray(e,t),t.join(" ")},toArray:function(e,t){var r=this.elements,n=!!t,i=parseFloat(r[0].toFixed(3)),o=parseFloat(r[1].toFixed(3)),a=parseFloat(r[2].toFixed(3)),s=parseFloat(r[3].toFixed(3)),l=parseFloat(r[4].toFixed(3)),c=parseFloat(r[5].toFixed(3));if(e){var h=parseFloat(r[6].toFixed(3)),u=parseFloat(r[7].toFixed(3)),f=parseFloat(r[8].toFixed(3));return n?(t[0]=i,t[1]=s,t[2]=h,t[3]=o,t[4]=l,t[5]=u,t[6]=a,t[7]=c,void(t[8]=f)):[i,s,h,o,l,u,a,c,f]}return n?(t[0]=i,t[1]=s,t[2]=o,t[3]=l,t[4]=a,void(t[5]=c)):[i,s,o,l,a,c]},clone:function(){var e,t,r,n,i,o,a,s,l;return e=this.elements[0],t=this.elements[1],r=this.elements[2],n=this.elements[3],i=this.elements[4],o=this.elements[5],a=this.elements[6],s=this.elements[7],l=this.elements[8],new Two.Matrix(e,t,r,n,i,o,a,s,l)}})}(),function(){var e=Two.Utils.mod,t={version:1.1,ns:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",createElement:function(e,r){var n=e,i=document.createElementNS(this.ns,n);return"svg"===n&&(r=_.defaults(r||{},{version:this.version})),_.isObject(r)&&t.setAttributes(i,r),i},setAttribute:function(e,t){this.setAttribute(t,e)},setAttributes:function(e,r){return _.each(r,t.setAttribute,e),this},removeAttribute:function(e,t){this.removeAttribute(t)},removeAttributes:function(e,r){return _.each(r,t.removeAttribute,e),this},toString:function(t,r){var n,i=t.length,o=i-1;return _.map(t,function(a,s){var l,c,h,u,f,d,p,m,g,v=r?e(s-1,i):Math.max(s-1,0),E=r?e(s+1,i):Math.min(s+1,o),y=t[v],T=t[E],x=a.x.toFixed(3),w=a.y.toFixed(3);switch(a._command){case Two.Commands.close:l=Two.Commands.close;break;case Two.Commands.curve:d=y.controls&&y.controls.right||y,p=a.controls&&a.controls.left||a,y._relative?(c=(d.x+y.x).toFixed(3),h=(d.y+y.y).toFixed(3)):(c=d.x.toFixed(3),h=d.y.toFixed(3)),a._relative?(u=(p.x+a.x).toFixed(3),f=(p.y+a.y).toFixed(3)):(u=p.x.toFixed(3),f=p.y.toFixed(3)),l=(0===s?Two.Commands.move:Two.Commands.curve)+" "+c+" "+h+" "+u+" "+f+" "+x+" "+w;break;case Two.Commands.move:n=a,l=Two.Commands.move+" "+x+" "+w;break;default:l=a._command+" "+x+" "+w}return s>=o&&r&&(a._command===Two.Commands.curve&&(T=n,m=a.controls&&a.controls.right||a,g=T.controls&&T.controls.left||T,a._relative?(c=(m.x+a.x).toFixed(3),h=(m.y+a.y).toFixed(3)):(c=m.x.toFixed(3),h=m.y.toFixed(3)),T._relative?(u=(g.x+T.x).toFixed(3),f=(g.y+T.y).toFixed(3)):(u=g.x.toFixed(3),f=g.y.toFixed(3)),x=T.x.toFixed(3),w=T.y.toFixed(3),l+=" C "+c+" "+h+" "+u+" "+f+" "+x+" "+w),l+=" Z"),l}).join(" ")},group:{appendChild:function(e){var t=this.domElement.querySelector("#"+e);t&&this.elem.appendChild(t)},removeChild:function(e){var t=this.domElement.querySelector("#"+e);t&&this.elem.removeChild(t)},renderChild:function(e){t[e._renderer.type].render.call(e,this)},render:function(e){this._update(),this._renderer.elem||(this._renderer.elem=t.createElement("g",{id:this.id}),e.appendChild(this._renderer.elem));var r=this._matrix.manual||this._flagMatrix,n={domElement:e,elem:this._renderer.elem};
r&&this._renderer.elem.setAttribute("transform","matrix("+this._matrix.toString()+")");for(var i in this.children)t.group.renderChild.call(e,this.children[i]);return this._flagAdditions&&_.each(this.additions,t.group.appendChild,n),this._flagSubtractions&&_.each(this.subtractions,t.group.removeChild,n),this.flagReset()}},polygon:{render:function(e){this._update(),this._renderer.elem||(this._renderer.elem=t.createElement("path",{id:this.id}),e.appendChild(this._renderer.elem));var r=this._renderer.elem,n=this._matrix.manual||this._flagMatrix;if(n&&r.setAttribute("transform","matrix("+this._matrix.toString()+")"),this._flagVertices){var i=t.toString(this._vertices,this._closed);r.setAttribute("d",i)}return this._flagFill&&r.setAttribute("fill",this._fill),this._flagStroke&&r.setAttribute("stroke",this._stroke),this._flagLinewidth&&r.setAttribute("stroke-width",this._linewidth),this._flagOpacity&&(r.setAttribute("stroke-opacity",this._opacity),r.setAttribute("fill-opacity",this._opacity)),this._flagVisible&&r.setAttribute("visibility",this._visible?"visible":"hidden"),this._flagCap&&r.setAttribute("stroke-linecap",this._cap),this._flagJoin&&r.setAttribute("stroke-linejoin",this._join),this._flagMiter&&r.setAttribute("stroke-miterlimit",this.miter),this.flagReset()}}},r=Two[Two.Types.svg]=function(e){this.domElement=e.domElement||t.createElement("svg"),this.scene=new Two.Group,this.scene.parent=this};_.extend(r,{Utils:t}),_.extend(r.prototype,Backbone.Events,{setSize:function(e,r){return this.width=e,this.height=r,t.setAttributes(this.domElement,{width:e,height:r}),this},render:function(){return t.group.render.call(this.scene,this.domElement),this}})}(),function(){var e=Two.Utils.mod,t=Two.Utils.getRatio,r={group:{renderChild:function(e){r[e._renderer.type].render.call(e,this)},render:function(e){this._update();var t=this._matrix.elements;return e.save(),e.transform(t[0],t[3],t[1],t[4],t[2],t[5]),_.each(this.children,r.group.renderChild,e),e.restore(),this.flagReset()}},polygon:{render:function(t){var r,n,i,o,a,s,l,c,h,u,f,d,p,m,g,v,E,y,T,x,w,b,R,H,M,S,C,A;return this._update(),r=this._matrix.elements,n=this.stroke,i=this.linewidth,o=this.fill,a=this.opacity,s=this.visible,l=this.cap,c=this.join,h=this.miter,u=this.closed,f=this._vertices,d=f.length,p=d-1,s?(t.save(),r&&t.transform(r[0],r[3],r[1],r[4],r[2],r[5]),o&&(t.fillStyle=o),n&&(t.strokeStyle=n),i&&(t.lineWidth=i),h&&(t.miterLimit=h),c&&(t.lineJoin=c),l&&(t.lineCap=l),_.isNumber(a)&&(t.globalAlpha=a),t.beginPath(),f.forEach(function(r,n){switch(C=r.x.toFixed(3),A=r.y.toFixed(3),r._command){case Two.Commands.close:t.closePath();break;case Two.Commands.curve:g=u?e(n-1,d):Math.max(n-1,0),m=u?e(n+1,d):Math.min(n+1,p),v=f[g],E=f[m],R=v.controls&&v.controls.right||v,H=r.controls&&r.controls.left||r,v._relative?(w=(R.x+v.x).toFixed(3),b=(R.y+v.y).toFixed(3)):(w=R.x.toFixed(3),b=R.y.toFixed(3)),r._relative?(T=(H.x+r.x).toFixed(3),x=(H.y+r.y).toFixed(3)):(T=H.x.toFixed(3),x=H.y.toFixed(3)),t.bezierCurveTo(w,b,T,x,C,A),n>=p&&u&&(E=y,M=r.controls&&r.controls.right||r,S=E.controls&&E.controls.left||E,r._relative?(w=(M.x+r.x).toFixed(3),b=(M.y+r.y).toFixed(3)):(w=M.x.toFixed(3),b=M.y.toFixed(3)),E._relative?(T=(S.x+E.x).toFixed(3),x=(S.y+E.y).toFixed(3)):(T=S.x.toFixed(3),x=S.y.toFixed(3)),C=E.x.toFixed(3),A=E.y.toFixed(3),t.bezierCurveTo(w,b,T,x,C,A));break;case Two.Commands.line:t.lineTo(C,A);break;case Two.Commands.move:y=r,t.moveTo(C,A)}}),u&&t.closePath(),t.fill(),t.stroke(),t.restore(),this.flagReset()):this}}},n=Two[Two.Types.canvas]=function(e){this.domElement=e.domElement||document.createElement("canvas"),this.ctx=this.domElement.getContext("2d"),this.overdraw=e.overdraw||!1,this.scene=new Two.Group,this.scene.parent=this};_.extend(n,{Utils:r}),_.extend(n.prototype,Backbone.Events,{setSize:function(e,r,n){return this.width=e,this.height=r,this.ratio=_.isUndefined(n)?t(this.ctx):n,this.domElement.width=e*this.ratio,this.domElement.height=r*this.ratio,_.extend(this.domElement.style,{width:e+"px",height:r+"px"}),this},render:function(){var e=1===this.ratio;return e||(this.ctx.save(),this.ctx.scale(this.ratio,this.ratio)),this.overdraw||this.ctx.clearRect(0,0,this.width,this.height),r.group.render.call(this.scene,this.ctx),e||this.ctx.restore(),this}})}(),function(){var e=Two.Matrix.Multiply,t=Two.Utils.mod,r=[1,0,0,0,1,0,0,0,1],n=new Two.Array(9),i=Two.Utils.getRatio,o={canvas:document.createElement("canvas"),uv:new Two.Array([0,0,1,0,0,1,0,1,1,0,1,1]),group:{renderChild:function(e){o[e._renderer.type].render.call(e,this.gl,this.program)},render:function(t,r){this._update();var i=this.parent,a=i._matrix&&i._matrix.manual||i._flagMatrix,s=this._matrix.manual||this._flagMatrix;return(a||s)&&(this._renderer.matrix||(this._renderer.matrix=new Two.Array(9)),this._matrix.toArray(!0,n),e(n,i._renderer.matrix,this._renderer.matrix),this._renderer.scale=this._scale*i._renderer.scale,a&&(this._flagMatrix=!0)),_.each(this.children,o.group.renderChild,{gl:t,program:r}),this.flagReset()}},polygon:{render:function(t,r){if(!this._visible||!this._opacity)return this;var i=this.parent,a=i._matrix.manual||i._flagMatrix,s=this._matrix.manual||this._flagMatrix,l=this._flagVertices||this._flagFill||this._flagStroke||this._flagLinewidth||this._flagOpacity||this._flagVisible||this._flagCap||this._flagJoin||this._flagMiter||this._flagScale;return this._update(),(a||s)&&(this._renderer.matrix||(this._renderer.matrix=new Two.Array(9)),this._matrix.toArray(!0,n),e(n,i._renderer.matrix,this._renderer.matrix),this._renderer.scale=this._scale*i._renderer.scale),l&&(this._renderer.rect||(this._renderer.rect={}),this._renderer.triangles||(this._renderer.triangles=new Two.Array(12)),o.getBoundingClientRect(this._vertices,this._linewidth,this._renderer.rect),o.getTriangles(this._renderer.rect,this._renderer.triangles),o.updateBuffer(t,this,r),o.updateTexture(t,this)),t.bindBuffer(t.ARRAY_BUFFER,this._renderer.textureCoordsBuffer),t.vertexAttribPointer(r.textureCoords,2,t.FLOAT,!1,0,0),t.bindTexture(t.TEXTURE_2D,this._renderer.texture),t.uniformMatrix3fv(r.matrix,!1,this._renderer.matrix),t.bindBuffer(t.ARRAY_BUFFER,this._renderer.buffer),t.vertexAttribPointer(r.position,2,t.FLOAT,!1,0,0),t.drawArrays(t.TRIANGLES,0,6),this.flagReset()}},getBoundingClientRect:function(e,t,r){var n,i,o=1/0,a=-1/0,s=1/0,l=-1/0;e.forEach(function(e){var t,r,n,i,c,h,u=e.x,f=e.y,d=e.controls;s=Math.min(f,s),o=Math.min(u,o),a=Math.max(u,a),l=Math.max(f,l),e.controls&&(c=d.left,h=d.right,c&&h&&(t=e._relative?c.x+u:c.x,r=e._relative?c.y+f:c.y,n=e._relative?h.x+u:h.x,i=e._relative?h.y+f:h.y,t&&r&&n&&i&&(s=Math.min(r,i,s),o=Math.min(t,n,o),a=Math.max(t,n,a),l=Math.max(r,i,l))))}),_.isNumber(t)&&(s-=t,o-=t,a+=t,l+=t),n=a-o,i=l-s,r.top=s,r.left=o,r.right=a,r.bottom=l,r.width=n,r.height=i,r.centroid||(r.centroid={}),r.centroid.x=-o,r.centroid.y=-s},getTriangles:function(e,t){var r=e.top,n=e.left,i=e.right,o=e.bottom;t[0]=n,t[1]=r,t[2]=i,t[3]=r,t[4]=n,t[5]=o,t[6]=n,t[7]=o,t[8]=i,t[9]=r,t[10]=i,t[11]=o},updateCanvas:function(e){var r=e._vertices,n=this.canvas,i=this.ctx,o=e._renderer.scale,a=e._stroke,s=e._linewidth*o,l=e._fill,c=e._opacity,h=e._cap,u=e._join,f=e._miter,d=e._closed,p=r.length,m=p-1;n.width=Math.max(Math.ceil(e._renderer.rect.width*o),1),n.height=Math.max(Math.ceil(e._renderer.rect.height*o),1);var g=e._renderer.rect.centroid,v=g.x*o,E=g.y*o;i.clearRect(0,0,n.width,n.height),l&&(i.fillStyle=l),a&&(i.strokeStyle=a),s&&(i.lineWidth=s),f&&(i.miterLimit=f),u&&(i.lineJoin=u),h&&(i.lineCap=h),_.isNumber(c)&&(i.globalAlpha=c);var y;i.beginPath(),r.forEach(function(e,n){var a,s,l,c,h,u,f,g,T,x,w,b,R,_;switch(R=(e.x*o+v).toFixed(3),_=(e.y*o+E).toFixed(3),e._command){case Two.Commands.close:i.closePath();break;case Two.Commands.curve:s=d?t(n-1,p):Math.max(n-1,0),a=d?t(n+1,p):Math.min(n+1,m),l=r[s],c=r[a],T=l.controls&&l.controls.right||l,x=e.controls&&e.controls.left||e,l._relative?(f=((T.x+l.x)*o+v).toFixed(3),g=((T.y+l.y)*o+E).toFixed(3)):(f=(T.x*o+v).toFixed(3),g=(T.y*o+E).toFixed(3)),e._relative?(h=((x.x+e.x)*o+v).toFixed(3),u=((x.y+e.y)*o+E).toFixed(3)):(h=(x.x*o+v).toFixed(3),u=(x.y*o+E).toFixed(3)),i.bezierCurveTo(f,g,h,u,R,_),n>=m&&d&&(c=y,w=e.controls&&e.controls.right||e,b=c.controls&&c.controls.left||c,e._relative?(f=((w.x+e.x)*o+v).toFixed(3),g=((w.y+e.y)*o+E).toFixed(3)):(f=(w.x*o+v).toFixed(3),g=(w.y*o+E).toFixed(3)),c._relative?(h=((b.x+c.x)*o+v).toFixed(3),u=((b.y+c.y)*o+v).toFixed(3)):(h=(b.x*o+v).toFixed(3),u=(b.y*o+E).toFixed(3)),R=(c.x*o+v).toFixed(3),_=(c.y*o+E).toFixed(3),i.bezierCurveTo(f,g,h,u,R,_));break;case Two.Commands.line:i.lineTo(R,_);break;case Two.Commands.move:y=e,i.moveTo(R,_)}}),d&&i.closePath(),i.fill(),i.stroke()},updateTexture:function(e,t){this.updateCanvas(t),t._renderer.texture&&e.deleteTexture(t._renderer.texture),e.bindBuffer(e.ARRAY_BUFFER,t._renderer.textureCoordsBuffer),t._renderer.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,t._renderer.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),this.canvas.width<=0||this.canvas.height<=0||e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.canvas)},updateBuffer:function(e,t,r){_.isObject(t._renderer.buffer)&&e.deleteBuffer(t._renderer.buffer),t._renderer.buffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,t._renderer.buffer),e.enableVertexAttribArray(r.position),e.bufferData(e.ARRAY_BUFFER,t._renderer.triangles,e.STATIC_DRAW),_.isObject(t._renderer.textureCoordsBuffer)&&e.deleteBuffer(t._renderer.textureCoordsBuffer),t._renderer.textureCoordsBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,t._renderer.textureCoordsBuffer),e.enableVertexAttribArray(r.textureCoords),e.bufferData(e.ARRAY_BUFFER,this.uv,e.STATIC_DRAW)},program:{create:function(e,t){var r,n,i;if(r=e.createProgram(),_.each(t,function(t){e.attachShader(r,t)}),e.linkProgram(r),n=e.getProgramParameter(r,e.LINK_STATUS),!n)throw i=e.getProgramInfoLog(r),e.deleteProgram(r),new Two.Utils.Error("unable to link program: "+i);return r}},shaders:{create:function(e,t,r){var n,i,o;if(n=e.createShader(e[r]),e.shaderSource(n,t),e.compileShader(n),i=e.getShaderParameter(n,e.COMPILE_STATUS),!i)throw o=e.getShaderInfoLog(n),e.deleteShader(n),new Two.Utils.Error("unable to compile shader "+n+": "+o);return n},types:{vertex:"VERTEX_SHADER",fragment:"FRAGMENT_SHADER"},vertex:["attribute vec2 a_position;","attribute vec2 a_textureCoords;","","uniform mat3 u_matrix;","uniform vec2 u_resolution;","","varying vec2 v_textureCoords;","","void main() {","   vec2 projected = (u_matrix * vec3(a_position, 1.0)).xy;","   vec2 normal = projected / u_resolution;","   vec2 clipspace = (normal * 2.0) - 1.0;","","   gl_Position = vec4(clipspace * vec2(1.0, -1.0), 0.0, 1.0);","   v_textureCoords = a_textureCoords;","}"].join("\n"),fragment:["precision mediump float;","","uniform sampler2D u_image;","varying vec2 v_textureCoords;","","void main() {","  gl_FragColor = texture2D(u_image, v_textureCoords);","}"].join("\n")}};o.ctx=o.canvas.getContext("2d");var a=Two[Two.Types.webgl]=function(e){var t,n,i,a;if(this.domElement=e.domElement||document.createElement("canvas"),this.scene=new Two.Group,this.scene.parent=this,this._renderer={matrix:new Two.Array(r),scale:1},this._flagMatrix=!0,t=_.defaults(e||{},{antialias:!1,alpha:!0,premultipliedAlpha:!0,stencil:!0,preserveDrawingBuffer:!0,overdraw:!1}),this.overdraw=t.overdraw,n=this.ctx=this.domElement.getContext("webgl",t)||this.domElement.getContext("experimental-webgl",t),!this.ctx)throw new Two.Utils.Error("unable to create a webgl context. Try using another renderer.");i=o.shaders.create(n,o.shaders.vertex,o.shaders.types.vertex),a=o.shaders.create(n,o.shaders.fragment,o.shaders.types.fragment),this.program=o.program.create(n,[i,a]),n.useProgram(this.program),this.program.position=n.getAttribLocation(this.program,"a_position"),this.program.matrix=n.getUniformLocation(this.program,"u_matrix"),this.program.textureCoords=n.getAttribLocation(this.program,"a_textureCoords"),n.disable(n.DEPTH_TEST),n.enable(n.BLEND),n.blendEquationSeparate(n.FUNC_ADD,n.FUNC_ADD),n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA)};_.extend(a.prototype,Backbone.Events,{setSize:function(e,t,r){this.width=e,this.height=t,this.ratio=_.isUndefined(r)?i(this.ctx):r,this.domElement.width=e*this.ratio,this.domElement.height=t*this.ratio,_.extend(this.domElement.style,{width:e+"px",height:t+"px"}),e*=this.ratio,t*=this.ratio,this._renderer.matrix[0]=this._renderer.matrix[4]=this._renderer.scale=this.ratio,this._flagMatrix=!0,this.ctx.viewport(0,0,e,t);var n=this.ctx.getUniformLocation(this.program,"u_resolution");return this.ctx.uniform2f(n,e,t),this},render:function(){var e=this.ctx;return this.overdraw||e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),o.group.render.call(this.scene,e,this.program),this._flagMatrix=!1,this}})}(),function(){var e=Two.Shape=function(){this._renderer={},this.id=Two.Identifier+Two.uniqueId(),this.classList=[],this._matrix=new Two.Matrix,this.translation=new Two.Vector,this.translation.bind(Two.Events.change,_.bind(e.FlagMatrix,this)),this.rotation=0,this.scale=1};_.extend(e,Backbone.Events,{FlagMatrix:function(){this._flagMatrix=!0},MakeObservable:function(e){Object.defineProperty(e,"rotation",{get:function(){return this._rotation},set:function(e){this._rotation=e,this._flagMatrix=!0}}),Object.defineProperty(e,"scale",{get:function(){return this._scale},set:function(e){this._scale=e,this._flagMatrix=!0,this._flagScale=!0}})}}),_.extend(e.prototype,{_flagMatrix:!0,_rotation:0,_scale:1,addTo:function(e){return e.add(this),this},clone:function(){var t=new e;return t.translation.copy(this.translation),t.rotation=this.rotation,t.scale=this.scale,_.each(e.Properties,function(e){t[e]=this[e]},this),t._update()},replaceParent:function(e){var t,r=this.id;return this.parent&&(delete this.parent.children[r],t=_.indexOf(parent.additions,r),t>=0&&this.parent.additions.splice(t,1),this.parent.subtractions.push(r),this._flagSubtractions=!0),e?(e.children[r]=this,this.parent=e,e.additions.push(r),e._flagAdditions=!0):delete this.parent,this},_update:function(){return!this._matrix.manual&&this._flagMatrix&&this._matrix.identity().translate(this.translation.x,this.translation.y).scale(this.scale).rotate(this.rotation),this.parent&&this.parent._update&&this.parent._update(),this},flagReset:function(){return this._flagMatrix=!1,this._flagScale=!1,this}}),e.MakeObservable(e.prototype)}(),function(){function e(e,t,r){var n,i,o,a,s,l,c,h,u=t.controls&&t.controls.right,f=e.controls&&e.controls.left;return n=t.x,s=t.y,i=(u||t).x,l=(u||t).y,o=(f||e).x,c=(f||e).y,a=e.x,h=e.y,u&&t._relative&&(i+=t.x,l+=t.y),f&&e._relative&&(o+=e.x,c+=e.y),Two.Utils.getCurveLength(n,s,i,l,o,c,a,h,r)}function t(e,t,r){var n,i,o,a,s,l,c,h,u=t.controls&&t.controls.right,f=e.controls&&e.controls.left;return n=t.x,s=t.y,i=(u||t).x,l=(u||t).y,o=(f||e).x,c=(f||e).y,a=e.x,h=e.y,u&&t._relative&&(i+=t.x,l+=t.y),f&&e._relative&&(o+=e.x,c+=e.y),Two.Utils.subdivide(n,s,i,l,o,c,a,h,r)}var r=Math.min,n=Math.max,i=Math.round,o=Two.Utils.getComputedMatrix,a={};_.each(Two.Commands,function(e,t){a[t]=new RegExp(e)});var s=Two.Polygon=function(e,t,r,n){Two.Shape.call(this),this._renderer.type="polygon",this._closed=!!t,this._curved=!!r,this.beginning=0,this.ending=1,this.fill="#fff",this.stroke="#000",this.linewidth=1,this.opacity=1,this.visible=!0,this.cap="butt",this.join="miter",this.miter=4,this._vertices=[],this.vertices=e,this.automatic=!n};_.extend(s,{Properties:["fill","stroke","linewidth","opacity","visible","cap","join","miter","closed","curved","automatic","beginning","ending"],FlagVertices:function(){this._flagVertices=!0,this._flagLength=!0},MakeObservable:function(e){Two.Shape.MakeObservable(e),_.each(s.Properties.slice(0,8),function(t){var r="_"+t,n="_flag"+t.charAt(0).toUpperCase()+t.slice(1);Object.defineProperty(e,t,{get:function(){return this[r]},set:function(e){this[r]=e,this[n]=!0}})}),Object.defineProperty(e,"length",{get:function(){return this._flagLength&&this._updateLength(),this._length}}),Object.defineProperty(e,"closed",{get:function(){return this._closed},set:function(e){this._closed=!!e,this._flagVertices=!0}}),Object.defineProperty(e,"curved",{get:function(){return this._curved},set:function(e){this._curved=!!e,this._flagVertices=!0}}),Object.defineProperty(s.prototype,"automatic",{get:function(){return this._automatic},set:function(e){if(e!==this._automatic){this._automatic=!!e;var t=this._automatic?"ignore":"listen";_.each(this.vertices,function(e){e[t]()})}}}),Object.defineProperty(e,"beginning",{get:function(){return this._beginning},set:function(e){this._beginning=r(n(e,0),this._ending),this._flagVertices=!0}}),Object.defineProperty(e,"ending",{get:function(){return this._ending},set:function(e){this._ending=r(n(e,this._beginning),1),this._flagVertices=!0}}),Object.defineProperty(e,"vertices",{get:function(){return this._collection},set:function(e){var t=_.bind(s.FlagVertices,this),r=_.bind(function(e){_.each(e,function(e){e.bind(Two.Events.change,t)},this),t()},this),n=_.bind(function(e){_.each(e,function(e){e.unbind(Two.Events.change,t)},this),t()},this);this._collection&&this._collection.unbind(),this._collection=new Two.Utils.Collection(e.slice(0)),this._collection.bind(Two.Events.insert,r),this._collection.bind(Two.Events.remove,n),r(this._collection)}})}}),_.extend(s.prototype,Two.Shape.prototype,{_flagVertices:!0,_flagLength:!0,_flagFill:!0,_flagStroke:!0,_flagLinewidth:!0,_flagOpacity:!0,_flagVisible:!0,_flagCap:!0,_flagJoin:!0,_flagMiter:!0,_length:0,_fill:"#fff",_stroke:"#000",_linewidth:1,_opacity:1,_visible:!0,_cap:"round",_join:"round",_miter:4,_closed:!0,_curved:!1,_automatic:!0,_beginning:0,_ending:1,clone:function(e){e=e||this.parent;var t=_.map(this.vertices,function(e){return e.clone()}),r=new s(t,this.closed,this.curved,!this.automatic);return _.each(Two.Shape.Properties,function(e){r[e]=this[e]},this),r.translation.copy(this.translation),r.rotation=this.rotation,r.scale=this.scale,e.add(r),r},toObject:function(){var e={vertices:_.map(this.vertices,function(e){return e.toObject()})};return _.each(Two.Shape.Properties,function(t){e[t]=this[t]},this),e.translation=this.translation.toObject,e.rotation=this.rotation,e.scale=this.scale,e},noFill:function(){return this.fill="transparent",this},noStroke:function(){return this.stroke="transparent",this},corner:function(){var e=this.getBoundingClientRect(!0);return e.centroid={x:e.left+e.width/2,y:e.top+e.height/2},_.each(this.vertices,function(t){t.addSelf(e.centroid)}),this},center:function(){var e=this.getBoundingClientRect(!0);return e.centroid={x:e.left+e.width/2,y:e.top+e.height/2},_.each(this.vertices,function(t){t.subSelf(e.centroid)}),this},remove:function(){return this.parent?(this.parent.remove(this),this):this},getBoundingClientRect:function(e){this._update();var t,i,a=e?this._matrix:o(this),s=this.linewidth/2,l=1/0,c=-1/0,h=1/0,u=-1/0;return _.each(this._vertices,function(e){t=e.x,i=e.y,e=a.multiply(t,i,1),h=r(e.y-s,h),l=r(e.x-s,l),c=n(e.x+s,c),u=n(e.y+s,u)}),{top:h,left:l,right:c,bottom:u,width:c-l,height:u-h}},getPointAt:function(e,t){for(var r,n,i,o,a,s,l,c,h,u,f,d,p=this.length*Math.min(Math.max(e,0),1),m=this.vertices.length,g=m-1,v=null,E=null,y=0,T=this._lengths.length,x=0;T>y;y++){if(x+this._lengths[y]>p){v=this.vertices[this.closed?Two.Utils.mod(y,m):y],E=this.vertices[Math.min(Math.max(y-1,0),g)],p-=x,e=p/this._lengths[y];break}x+=this._lengths[y]}return _.isNull(v)||_.isNull(E)?null:(d=E.controls&&E.controls.right,f=v.controls&&v.controls.left,n=E.x,l=E.y,i=(d||E).x,c=(d||E).y,o=(f||v).x,h=(f||v).y,a=v.x,u=v.y,d&&E._relative&&(i+=E.x,c+=E.y),f&&v._relative&&(o+=v.x,h+=v.y),r=Two.Utils.getPointOnCubicBezier(e,n,i,o,a),s=Two.Utils.getPointOnCubicBezier(e,l,c,h,u),_.isObject(t)?(t.x=r,t.y=s,t):new Two.Vector(r,s))},plot:function(){return this.curved?(Two.Utils.getCurveFromPoints(this._vertices,this.closed),this):(_.each(this._vertices,function(e,t){e._command=0===t?Two.Commands.move:Two.Commands.line},this),this)},subdivide:function(e){this._update();var r=this.vertices.length-1,n=this.vertices[r],i=this._closed||this.vertices[r]._command===Two.Commands.close,o=[];return _.each(this.vertices,function(a,s){if(0>=s&&!i)return void(n=a);if(a.command===Two.Commands.move)return o.push(new Two.Anchor(n.x,n.y)),s>0&&(o[o.length-1].command=Two.Commands.line),void(n=a);var l=t(a,n,e);o=o.concat(l),_.each(l,function(e,t){e.command=0>=t&&n.command===Two.Commands.move?Two.Commands.move:Two.Commands.line}),s>=r&&(this._closed&&this._automatic?(n=a,l=t(a,n,e),o=o.concat(l),_.each(l,function(e,t){e.command=0>=t&&n.command===Two.Commands.move?Two.Commands.move:Two.Commands.line})):i&&o.push(new Two.Anchor(a.x,a.y)),o[o.length-1].command=i?Two.Commands.close:Two.Commands.line),n=a},this),this._automatic=!1,this._curved=!1,this.vertices=o,this},_updateLength:function(t){this._update();var r=this.vertices.length-1,n=this.vertices[r],i=this._closed||this.vertices[r]._command===Two.Commands.close,o=0;return _.isUndefined(this._lengths)&&(this._lengths=[]),_.each(this.vertices,function(a,s){return 0>=s&&!i||a.command===Two.Commands.move?(n=a,void(this._lengths[s]=0)):(this._lengths[s]=e(a,n,t),o+=this._lengths[s],s>=r&&i&&(n=a,this._lengths[s+1]=e(a,n,t),o+=this._lengths[s+1]),void(n=a))},this),this._length=o,this},_update:function(){if(this._flagVertices){var e,t=this.vertices.length,r=t-1,n=i(this._beginning*r),o=i(this._ending*r);this._vertices.length=0;for(var a=n;o+1>a;a++)e=this.vertices[a],this._vertices.push(e);this._automatic&&this.plot()}return Two.Shape.prototype._update.call(this),this},flagReset:function(){return this._flagVertices=this._flagFill=this._flagStroke=this._flagLinewidth=this._flagOpacity=this._flagVisible=this._flagCap=this._flagJoin=this._flagMiter=!1,Two.Shape.prototype.flagReset.call(this),this}}),s.MakeObservable(s.prototype)}(),function(){var e=Math.min,t=Math.max,r=Two.Group=function(){Two.Shape.call(this,!0),this._renderer.type="group",this.additions=[],this.subtractions=[],this.children={}};_.extend(r,{MakeObservable:function(e){Two.Shape.MakeObservable(e),r.MakeGetterSetters(e,Two.Polygon.Properties)},MakeGetterSetters:function(e,t){_.isArray(t)||(t=[t]),_.each(t,function(t){r.MakeGetterSetter(e,t)})},MakeGetterSetter:function(e,t){var r="_"+t;Object.defineProperty(e,t,{get:function(){return this[r]},set:function(e){this[r]=e}})}}),_.extend(r.prototype,Two.Shape.prototype,{_flagAdditions:!1,_flagSubtractions:!1,_fill:"#fff",_stroke:"#000",_linewidth:1,_opacity:1,_visible:!0,_cap:"round",_join:"round",_miter:4,_closed:!0,_curved:!1,_automatic:!0,_beginning:0,_ending:1,clone:function(e){e=e||this.parent;var t=new r;e.add(t);_.map(this.children,function(e){return e.clone(t)});return t.translation.copy(this.translation),t.rotation=this.rotation,t.scale=this.scale,t},toObject:function(){var e={children:{},translation:this.translation.toObject(),rotation:this.rotation,scale:this.scale};return _.each(this.children,function(t,r){e.children[r]=t.toObject()},this),e},corner:function(){var e=this.getBoundingClientRect(!0),t={x:e.left,y:e.top};return _.each(this.children,function(e){e.translation.subSelf(t)}),this},center:function(){var e=this.getBoundingClientRect(!0);return e.centroid={x:e.left+e.width/2,y:e.top+e.height/2},_.each(this.children,function(t){t.translation.subSelf(e.centroid)}),this},getById:function(e){var t,r=function(e,n){if(e.id==n)return t=e,e;for(var i in e.children){if(t)return t;r(e.children[i],n)}};return r(this,e)||null},getByClassName:function(e){var t=[],r=function(e,n){-1!=e.classList.indexOf(n)&&t.push(e);for(var i in e.children)r(e.children[i],n);return t};return r(this,e)},getByType:function(e){var t=[],r=function(e,n){for(var i in e.children)e.children[i]instanceof n?t.push(e.children[i]):e.children[i]instanceof Two.Group&&r(e.children[i],n);return t};return r(this,e)},add:function(e){var t,r,n,i=(arguments.length,this.children),o=(this.parent,this.additions);return _.isArray(e)||(e=_.toArray(arguments)),_.each(e,function(e){e&&(t=e.id,r=e.parent,_.isUndefined(i[t])&&(r&&(delete r.children[t],n=_.indexOf(r.additions,t),n>=0&&r.additions.splice(n,1)),i[t]=e,e.parent=this,o.push(t),this._flagAdditions=!0))},this),this},remove:function(e){var t,r,n,i,o=arguments.length,a=this.children,s=this.parent,l=this.subtractions;return 0>=o&&s?(s.remove(this),this):(_.isArray(e)||(e=_.toArray(arguments)),_.each(e,function(e){t=e.id,i=e.children,r=e.parent,t in a&&(delete a[t],delete e.parent,n=_.indexOf(r.additions,t),n>=0&&r.additions.splice(n,1),l.push(t),this._flagSubtractions=!0)},this),this)},getBoundingClientRect:function(){var r;this._update();var n=1/0,i=-1/0,o=1/0,a=-1/0;return _.each(this.children,function(s){r=s.getBoundingClientRect(),_.isNumber(r.top)&&_.isNumber(r.left)&&_.isNumber(r.right)&&_.isNumber(r.bottom)&&(o=e(r.top,o),n=e(r.left,n),i=t(r.right,i),a=t(r.bottom,a))},this),{top:o,left:n,right:i,bottom:a,width:i-n,height:a-o}},noFill:function(){return _.each(this.children,function(e){e.noFill()}),this},noStroke:function(){return _.each(this.children,function(e){e.noStroke()}),this},subdivide:function(){var e=arguments;return _.each(this.children,function(t){t.subdivide.apply(t,e)}),this},flagReset:function(){return this._flagAdditions&&(this.additions.length=0,this._flagAdditions=!1),this._flagSubtractions&&(this.subtractions.length=0,this._flagSubtractions=!1),Two.Shape.prototype.flagReset.call(this),this}}),r.MakeObservable(r.prototype)}(),window.Modernizr=function(e,t,r){function n(e){p.cssText=e}function i(e,t){return typeof e===t}var o,a,s,l="2.8.3",c={},h=!0,u=t.documentElement,f="modernizr",d=t.createElement(f),p=d.style,m=({}.toString," -webkit- -moz- -o- -ms- ".split(" ")),g="Webkit Moz O ms",v=g.split(" "),E=g.toLowerCase().split(" "),y={},T=[],x=T.slice,w=function(e,r,n,i){var o,a,s,l,c=t.createElement("div"),h=t.body,d=h||t.createElement("body");if(parseInt(n,10))for(;n--;)s=t.createElement("div"),s.id=i?i[n]:f+(n+1),c.appendChild(s);return o=["&#173;",'<style id="s',f,'">',e,"</style>"].join(""),c.id=f,(h?c:d).innerHTML+=o,d.appendChild(c),h||(d.style.background="",d.style.overflow="hidden",l=u.style.overflow,u.style.overflow="hidden",u.appendChild(d)),a=r(c,e),h?c.parentNode.removeChild(c):(d.parentNode.removeChild(d),u.style.overflow=l),!!a},b={}.hasOwnProperty;s=i(b,"undefined")||i(b.call,"undefined")?function(e,t){return t in e&&i(e.constructor.prototype[t],"undefined")}:function(e,t){return b.call(e,t)},Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;if("function"!=typeof t)throw new TypeError;var r=x.call(arguments,1),n=function(){if(this instanceof n){var i=function(){};i.prototype=t.prototype;var o=new i,a=t.apply(o,r.concat(x.call(arguments)));return Object(a)===a?a:o}return t.apply(e,r.concat(x.call(arguments)))};return n}),y.canvas=function(){var e=t.createElement("canvas");return!!e.getContext&&!!e.getContext("2d")},y.webgl=function(){return!!e.WebGLRenderingContext},y.touch=function(){var r;return"ontouchstart"in e||e.DocumentTouch&&t instanceof DocumentTouch?r=!0:w(["@media (",m.join("touch-enabled),("),f,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(e){r=9===e.offsetTop}),r},y.postmessage=function(){return!!e.postMessage},y.history=function(){return!!e.history&&!!history.pushState},y.video=function(){var e=t.createElement("video"),r=!1;try{(r=!!e.canPlayType)&&(r=new Boolean(r),r.ogg=e.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),r.h264=e.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),r.webm=e.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,""))}catch(n){}return r},y.localstorage=function(){try{return localStorage.setItem(f,f),localStorage.removeItem(f),!0}catch(e){return!1}};for(var R in y)s(y,R)&&(a=R.toLowerCase(),c[a]=y[R](),T.push((c[a]?"":"no-")+a));return c.addTest=function(e,t){if("object"==typeof e)for(var n in e)s(e,n)&&c.addTest(n,e[n]);else{if(e=e.toLowerCase(),c[e]!==r)return c;t="function"==typeof t?t():t,"undefined"!=typeof h&&h&&(u.className+=" "+(t?"":"no-")+e),c[e]=t}return c},n(""),d=o=null,function(e,t){function r(e,t){var r=e.createElement("p"),n=e.getElementsByTagName("head")[0]||e.documentElement;return r.innerHTML="x<style>"+t+"</style>",n.insertBefore(r.lastChild,n.firstChild)}function n(){var e=E.elements;return"string"==typeof e?e.split(" "):e}function i(e){var t=v[e[m]];return t||(t={},g++,e[m]=g,v[g]=t),t}function o(e,r,n){if(r||(r=t),h)return r.createElement(e);n||(n=i(r));var o;return o=n.cache[e]?n.cache[e].cloneNode():p.test(e)?(n.cache[e]=n.createElem(e)).cloneNode():n.createElem(e),!o.canHaveChildren||d.test(e)||o.tagUrn?o:n.frag.appendChild(o)}function a(e,r){if(e||(e=t),h)return e.createDocumentFragment();r=r||i(e);for(var o=r.frag.cloneNode(),a=0,s=n(),l=s.length;l>a;a++)o.createElement(s[a]);return o}function s(e,t){t.cache||(t.cache={},t.createElem=e.createElement,t.createFrag=e.createDocumentFragment,t.frag=t.createFrag()),e.createElement=function(r){return E.shivMethods?o(r,e,t):t.createElem(r)},e.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+n().join().replace(/[\w\-]+/g,function(e){return t.createElem(e),t.frag.createElement(e),'c("'+e+'")'})+");return n}")(E,t.frag)}function l(e){e||(e=t);var n=i(e);return E.shivCSS&&!c&&!n.hasCSS&&(n.hasCSS=!!r(e,"article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}template{display:none}")),h||s(e,n),e}var c,h,u="3.7.0",f=e.html5||{},d=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,p=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,m="_html5shiv",g=0,v={};!function(){try{var e=t.createElement("a");e.innerHTML="<xyz></xyz>",c="hidden"in e,h=1==e.childNodes.length||function(){t.createElement("a");var e=t.createDocumentFragment();return"undefined"==typeof e.cloneNode||"undefined"==typeof e.createDocumentFragment||"undefined"==typeof e.createElement}()}catch(r){c=!0,h=!0}}();var E={elements:f.elements||"abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video",version:u,shivCSS:f.shivCSS!==!1,supportsUnknownElements:h,shivMethods:f.shivMethods!==!1,type:"default",shivDocument:l,createElement:o,createDocumentFragment:a};e.html5=E,l(t)}(this,t),c._version=l,c._prefixes=m,c._domPrefixes=E,c._cssomPrefixes=v,c.testStyles=w,u.className=u.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(h?" js "+T.join(" "):""),c}(this,this.document),Modernizr.addTest("fullscreen",function(){for(var e=0;e<Modernizr._domPrefixes.length;e++)if(document[Modernizr._domPrefixes[e].toLowerCase()+"CancelFullScreen"])return!0;return!!document.cancelFullScreen||!1}),Modernizr.addTest("webaudio",!!window.webkitAudioContext||!!window.AudioContext),Modernizr.addTest("devicemotion","DeviceMotionEvent"in window),Modernizr.addTest("deviceorientation","DeviceOrientationEvent"in window),function(){var e=this,t=e.has||{},r=e.navigator.userAgent,n={Android:!!r.match(/Android/gi),Blackberry:!!r.match(/BlackBerry/gi),iOS:!!r.match(/iPhone|iPad|iPod/gi),OperaMini:!!r.match(/Opera Mini/gi),Windows:!!r.match(/IEMobile/gi),WebOS:!!r.match(/webOS/gi),Arora:!!r.match(/Arora/gi),Chrome:!!r.match(/Chrome/gi),Epiphany:!!r.match(/Epiphany/gi),Firefox:!!r.match(/Firefox/gi),InternetExplorer:!!r.match(/MSIE/gi),Midori:!!r.match(/Midori/gi),Opera:!!r.match(/Opera/gi),Safari:!!r.match(/Safari/gi),webgl:function(){try{return!(!window.WebGLRenderingContext||!document.createElement("canvas").getContext("webgl")&&!document.createElement("canvas").getContext("experimental-webgl"))}catch(e){return!1
}}(),noConflict:function(){return t},localStorage:!!e.localStorage};n.mobile=n.Android||n.Blackberry||n.iOS||n.OperaMini||n.Windows||n.WebOS,e.has=n}(),function(){function e(e){n=e}function t(){switch(window.screen.orientation||window.screen.mozOrientation){case"landscape-primary":return 90;case"landscape-secondary":return-90;case"portrait-secondary":return 180;case"portrait-primary":return 0}return window.orientation||0}function r(){i=t()}var n={},i=window.orientation||0;window.addEventListener("deviceorientation",e,!1),window.addEventListener("orientationchange",r,!1),THREE.DeviceOrientationControls=function(e){this.object=e,this.object.rotation.reorder("YXZ"),this.freeze=!0,this.movementSpeed=1,this.rollSpeed=.005,this.autoAlign=!0,this.autoForward=!1,this.alpha=0,this.beta=0,this.gamma=0,this.orient=0,this.alignQuaternion=new THREE.Quaternion,this.orientationQuaternion=new THREE.Quaternion;var t=new THREE.Quaternion,r=new THREE.Quaternion,o=new THREE.Vector3,a=new THREE.Matrix4,s=new THREE.Euler(0,0,0,"YXZ"),l=new THREE.Quaternion,c=new THREE.Vector3(0,0,1),h=new THREE.Vector3(0,1,0),u=new THREE.Vector3(0,0,0),f=new THREE.Euler,d=new THREE.Quaternion,p=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5));this.update=function(){return function(){this.freeze||(this.alpha=n.gamma?THREE.Math.degToRad(n.alpha):0,this.beta=n.beta?THREE.Math.degToRad(n.beta):0,this.gamma=n.gamma?THREE.Math.degToRad(n.gamma):0,this.orient=i?THREE.Math.degToRad(i):0,f.set(this.beta,this.alpha,-this.gamma,"YXZ"),t.setFromEuler(f),r.slerp(t,.5),this.orientationQuaternion.copy(this.autoAlign?t:r),this.orientationQuaternion.multiply(p),this.orientationQuaternion.multiply(d.setFromAxisAngle(c,-this.orient)),this.object.quaternion.copy(this.alignQuaternion),this.object.quaternion.multiply(this.orientationQuaternion),this.autoForward&&(o.set(0,0,-1).applyQuaternion(this.object.quaternion,"ZXY").setLength(this.movementSpeed/50),this.object.position.add(o)),this.autoAlign&&0!==this.alpha&&(this.autoAlign=!1,this.align()))}}(),this.align=function(){o.set(0,0,-1).applyQuaternion(l.copy(this.orientationQuaternion).inverse(),"ZXY"),s.setFromQuaternion(l.setFromRotationMatrix(a.lookAt(o,u,h))),s.set(0,s.y,0),this.alignQuaternion.setFromEuler(s)},this.connect=function(){this.freeze=!1},this.disconnect=function(){this.freze=!0}}}(),THREE.OrbitControls=function(e,t){function r(){return 2*Math.PI/60/60*f.autoRotateSpeed}function n(){return Math.pow(.95,f.zoomSpeed)}function i(e){if(f.enabled!==!1){if(e.preventDefault(),0===e.button){if(f.noRotate===!0)return;k=A.ROTATE,p.set(e.clientX,e.clientY)}else if(1===e.button){if(f.noZoom===!0)return;k=A.DOLLY,w.set(e.clientX,e.clientY)}else if(2===e.button){if(f.noPan===!0)return;k=A.PAN,v.set(e.clientX,e.clientY)}f.domElement.addEventListener("mousemove",o,!1),f.domElement.addEventListener("mouseup",a,!1),f.dispatchEvent(N)}}function o(e){if(f.enabled!==!1){e.preventDefault();var t=f.domElement===document?f.domElement.body:f.domElement;if(k===A.ROTATE){if(f.noRotate===!0)return;m.set(e.clientX,e.clientY),g.subVectors(m,p),f.rotateLeft(2*Math.PI*g.x/t.clientWidth*f.rotateSpeed),f.rotateUp(2*Math.PI*g.y/t.clientHeight*f.rotateSpeed),p.copy(m)}else if(k===A.DOLLY){if(f.noZoom===!0)return;b.set(e.clientX,e.clientY),R.subVectors(b,w),R.y>0?f.dollyIn():f.dollyOut(),w.copy(b)}else if(k===A.PAN){if(f.noPan===!0)return;E.set(e.clientX,e.clientY),y.subVectors(E,v),f.pan(y.x,y.y),v.copy(E)}f.update()}}function a(){f.enabled!==!1&&(f.domElement.removeEventListener("mousemove",o,!1),f.domElement.removeEventListener("mouseup",a,!1),f.dispatchEvent(D),k=A.NONE)}function s(e){if(f.enabled!==!1&&f.noZoom!==!0){e.preventDefault(),e.stopPropagation();var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail),t>0?f.dollyOut():f.dollyIn(),f.update(),f.dispatchEvent(N),f.dispatchEvent(D)}}function l(e){if(f.enabled!==!1&&f.noKeys!==!0&&f.noPan!==!0)switch(e.keyCode){case f.keys.UP:f.pan(0,f.keyPanSpeed),f.update();break;case f.keys.BOTTOM:f.pan(0,-f.keyPanSpeed),f.update();break;case f.keys.LEFT:f.pan(f.keyPanSpeed,0),f.update();break;case f.keys.RIGHT:f.pan(-f.keyPanSpeed,0),f.update()}}function c(e){if(f.enabled!==!1){switch(e.touches.length){case 1:if(f.noRotate===!0)return;k=A.TOUCH_ROTATE,p.set(e.touches[0].pageX,e.touches[0].pageY);break;case 2:if(f.noZoom===!0)return;k=A.TOUCH_DOLLY;var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+r*r);w.set(0,n);break;case 3:if(f.noPan===!0)return;k=A.TOUCH_PAN,v.set(e.touches[0].pageX,e.touches[0].pageY);break;default:k=A.NONE}f.dispatchEvent(N)}}function h(e){if(f.enabled!==!1){e.preventDefault(),e.stopPropagation();var t=f.domElement===document?f.domElement.body:f.domElement;switch(e.touches.length){case 1:if(f.noRotate===!0)return;if(k!==A.TOUCH_ROTATE)return;m.set(e.touches[0].pageX,e.touches[0].pageY),g.subVectors(m,p),f.rotateLeft(2*Math.PI*g.x/t.clientWidth*f.rotateSpeed),f.rotateUp(2*Math.PI*g.y/t.clientHeight*f.rotateSpeed),p.copy(m),f.update();break;case 2:if(f.noZoom===!0)return;if(k!==A.TOUCH_DOLLY)return;var r=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(r*r+n*n);b.set(0,i),R.subVectors(b,w),R.y>0?f.dollyOut():f.dollyIn(),w.copy(b),f.update();break;case 3:if(f.noPan===!0)return;if(k!==A.TOUCH_PAN)return;E.set(e.touches[0].pageX,e.touches[0].pageY),y.subVectors(E,v),f.pan(y.x,y.y),v.copy(E),f.update();break;default:k=A.NONE}}}function u(){f.enabled!==!1&&(f.dispatchEvent(D),k=A.NONE)}this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.center=this.target,this.noZoom=!1,this.zoomSpeed=1,this.minDistance=0,this.maxDistance=1/0,this.noRotate=!1,this.rotateSpeed=1,this.noPan=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.noKeys=!1,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};var f=this,d=1e-6,p=new THREE.Vector2,m=new THREE.Vector2,g=new THREE.Vector2,v=new THREE.Vector2,E=new THREE.Vector2,y=new THREE.Vector2,T=new THREE.Vector3,x=new THREE.Vector3,w=new THREE.Vector2,b=new THREE.Vector2,R=new THREE.Vector2,_=0,H=0,M=1,S=new THREE.Vector3,C=new THREE.Vector3,A={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},k=A.NONE;this.target0=this.target.clone(),this.position0=this.object.position.clone();var L=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),P=L.clone().inverse(),F={type:"change"},N={type:"start"},D={type:"end"};this.rotateLeft=function(e){void 0===e&&(e=r()),H-=e},this.rotateUp=function(e){void 0===e&&(e=r()),_-=e},this.panLeft=function(e){var t=this.object.matrix.elements;T.set(t[0],t[1],t[2]),T.multiplyScalar(-e),S.add(T)},this.panUp=function(e){var t=this.object.matrix.elements;T.set(t[4],t[5],t[6]),T.multiplyScalar(e),S.add(T)},this.pan=function(e,t){var r=f.domElement===document?f.domElement.body:f.domElement;if(void 0!==f.object.fov){var n=f.object.position,i=n.clone().sub(f.target),o=i.length();o*=Math.tan(f.object.fov/2*Math.PI/180),f.panLeft(2*e*o/r.clientHeight),f.panUp(2*t*o/r.clientHeight)}else void 0!==f.object.top?(f.panLeft(e*(f.object.right-f.object.left)/r.clientWidth),f.panUp(t*(f.object.top-f.object.bottom)/r.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")},this.dollyIn=function(e){void 0===e&&(e=n()),M/=e},this.dollyOut=function(e){void 0===e&&(e=n()),M*=e},this.update=function(){var e=this.object.position;x.copy(e).sub(this.target),x.applyQuaternion(L);var t=Math.atan2(x.x,x.z),n=Math.atan2(Math.sqrt(x.x*x.x+x.z*x.z),x.y);this.autoRotate&&this.rotateLeft(r()),t+=H,n+=_,n=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,n)),n=Math.max(d,Math.min(Math.PI-d,n));var i=x.length()*M;i=Math.max(this.minDistance,Math.min(this.maxDistance,i)),this.target.add(S),x.x=i*Math.sin(n)*Math.sin(t),x.y=i*Math.cos(n),x.z=i*Math.sin(n)*Math.cos(t),x.applyQuaternion(P),e.copy(this.target).add(x),this.object.lookAt(this.target),H=0,_=0,M=1,S.set(0,0,0),C.distanceToSquared(this.object.position)>d&&(this.dispatchEvent(F),C.copy(this.object.position))},this.reset=function(){k=A.NONE,this.target.copy(this.target0),this.object.position.copy(this.position0),this.update()},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousedown",i,!1),this.domElement.addEventListener("mousewheel",s,!1),this.domElement.addEventListener("DOMMouseScroll",s,!1),this.domElement.addEventListener("touchstart",c,!1),this.domElement.addEventListener("touchend",u,!1),this.domElement.addEventListener("touchmove",h,!1),window.addEventListener("keydown",l,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.StereoEffect=function(e){this.separation=3,this.focalLength=15;var t,r,n,i,o,a,s,l,c,h,u,f,d=new THREE.Vector3,p=new THREE.Quaternion,m=new THREE.Vector3,g=new THREE.PerspectiveCamera,v=new THREE.PerspectiveCamera;e.autoClear=!1,this.setSize=function(n,i){t=n/2,r=i,e.setSize(n,i)},this.render=function(E,y){E.updateMatrixWorld(),void 0===y.parent&&y.updateMatrixWorld(),y.matrixWorld.decompose(d,p,m),n=THREE.Math.radToDeg(2*Math.atan(Math.tan(.5*THREE.Math.degToRad(y.fov)))),l=y.near/this.focalLength,h=Math.tan(.5*THREE.Math.degToRad(n))*this.focalLength,c=.5*h*y.aspect,a=h*l,s=-a,u=(c+this.separation/2)/(2*c),f=1-u,i=2*c*l*f,o=2*c*l*u,g.projectionMatrix.makeFrustum(-i,o,s,a,y.near,y.far),g.position.copy(d),g.quaternion.copy(p),g.translateX(-this.separation/2),v.projectionMatrix.makeFrustum(-o,i,s,a,y.near,y.far),v.position.copy(d),v.quaternion.copy(p),v.translateX(this.separation/2),e.setViewport(0,0,2*t,r),e.clear(),e.setViewport(0,0,t,r),e.render(E,g),e.setViewport(t,0,t,r),e.render(E,v)}},function(e){"use strict";var t={};"undefined"==typeof exports?"function"==typeof define&&"object"==typeof define.amd&&define.amd?(t.exports={},define(function(){return t.exports})):t.exports="undefined"!=typeof window?window:e:t.exports=exports,function(e){if(!t)var t=1e-6;if(!r)var r="undefined"!=typeof Float32Array?Float32Array:Array;if(!n)var n=Math.random;var i={};i.setMatrixArrayType=function(e){r=e},"undefined"!=typeof e&&(e.glMatrix=i);var o={};o.create=function(){var e=new r(2);return e[0]=0,e[1]=0,e},o.clone=function(e){var t=new r(2);return t[0]=e[0],t[1]=e[1],t},o.fromValues=function(e,t){var n=new r(2);return n[0]=e,n[1]=t,n},o.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},o.set=function(e,t,r){return e[0]=t,e[1]=r,e},o.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e},o.subtract=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e},o.sub=o.subtract,o.multiply=function(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e},o.mul=o.multiply,o.divide=function(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e},o.div=o.divide,o.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e},o.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e},o.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e},o.scaleAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e},o.distance=function(e,t){var r=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(r*r+n*n)},o.dist=o.distance,o.squaredDistance=function(e,t){var r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n},o.sqrDist=o.squaredDistance,o.length=function(e){var t=e[0],r=e[1];return Math.sqrt(t*t+r*r)},o.len=o.length,o.squaredLength=function(e){var t=e[0],r=e[1];return t*t+r*r},o.sqrLen=o.squaredLength,o.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},o.normalize=function(e,t){var r=t[0],n=t[1],i=r*r+n*n;return i>0&&(i=1/Math.sqrt(i),e[0]=t[0]*i,e[1]=t[1]*i),e},o.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},o.cross=function(e,t,r){var n=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=n,e},o.lerp=function(e,t,r,n){var i=t[0],o=t[1];return e[0]=i+n*(r[0]-i),e[1]=o+n*(r[1]-o),e},o.random=function(e,t){t=t||1;var r=2*n()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e},o.transformMat2=function(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i,e[1]=r[1]*n+r[3]*i,e},o.transformMat2d=function(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i+r[4],e[1]=r[1]*n+r[3]*i+r[5],e},o.transformMat3=function(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[3]*i+r[6],e[1]=r[1]*n+r[4]*i+r[7],e},o.transformMat4=function(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[4]*i+r[12],e[1]=r[1]*n+r[5]*i+r[13],e},o.forEach=function(){var e=o.create();return function(t,r,n,i,o,a){var s,l;for(r||(r=2),n||(n=0),l=i?Math.min(i*r+n,t.length):t.length,s=n;l>s;s+=r)e[0]=t[s],e[1]=t[s+1],o(e,e,a),t[s]=e[0],t[s+1]=e[1];return t}}(),o.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},"undefined"!=typeof e&&(e.vec2=o);var a={};a.create=function(){var e=new r(3);return e[0]=0,e[1]=0,e[2]=0,e},a.clone=function(e){var t=new r(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},a.fromValues=function(e,t,n){var i=new r(3);return i[0]=e,i[1]=t,i[2]=n,i},a.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},a.set=function(e,t,r,n){return e[0]=t,e[1]=r,e[2]=n,e},a.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},a.subtract=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e},a.sub=a.subtract,a.multiply=function(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e},a.mul=a.multiply,a.divide=function(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e},a.div=a.divide,a.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e},a.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e},a.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},a.scaleAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e},a.distance=function(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(r*r+n*n+i*i)},a.dist=a.distance,a.squaredDistance=function(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return r*r+n*n+i*i},a.sqrDist=a.squaredDistance,a.length=function(e){var t=e[0],r=e[1],n=e[2];return Math.sqrt(t*t+r*r+n*n)},a.len=a.length,a.squaredLength=function(e){var t=e[0],r=e[1],n=e[2];return t*t+r*r+n*n},a.sqrLen=a.squaredLength,a.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},a.normalize=function(e,t){var r=t[0],n=t[1],i=t[2],o=r*r+n*n+i*i;return o>0&&(o=1/Math.sqrt(o),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o),e},a.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},a.cross=function(e,t,r){var n=t[0],i=t[1],o=t[2],a=r[0],s=r[1],l=r[2];return e[0]=i*l-o*s,e[1]=o*a-n*l,e[2]=n*s-i*a,e},a.lerp=function(e,t,r,n){var i=t[0],o=t[1],a=t[2];return e[0]=i+n*(r[0]-i),e[1]=o+n*(r[1]-o),e[2]=a+n*(r[2]-a),e},a.random=function(e,t){t=t||1;var r=2*n()*Math.PI,i=2*n()-1,o=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(r)*o,e[1]=Math.sin(r)*o,e[2]=i*t,e},a.transformMat4=function(e,t,r){var n=t[0],i=t[1],o=t[2];return e[0]=r[0]*n+r[4]*i+r[8]*o+r[12],e[1]=r[1]*n+r[5]*i+r[9]*o+r[13],e[2]=r[2]*n+r[6]*i+r[10]*o+r[14],e},a.transformMat3=function(e,t,r){var n=t[0],i=t[1],o=t[2];return e[0]=n*r[0]+i*r[3]+o*r[6],e[1]=n*r[1]+i*r[4]+o*r[7],e[2]=n*r[2]+i*r[5]+o*r[8],e},a.transformQuat=function(e,t,r){var n=t[0],i=t[1],o=t[2],a=r[0],s=r[1],l=r[2],c=r[3],h=c*n+s*o-l*i,u=c*i+l*n-a*o,f=c*o+a*i-s*n,d=-a*n-s*i-l*o;return e[0]=h*c+d*-a+u*-l-f*-s,e[1]=u*c+d*-s+f*-a-h*-l,e[2]=f*c+d*-l+h*-s-u*-a,e},a.forEach=function(){var e=a.create();return function(t,r,n,i,o,a){var s,l;for(r||(r=3),n||(n=0),l=i?Math.min(i*r+n,t.length):t.length,s=n;l>s;s+=r)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],o(e,e,a),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2];return t}}(),a.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},"undefined"!=typeof e&&(e.vec3=a);var s={};s.create=function(){var e=new r(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},s.clone=function(e){var t=new r(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},s.fromValues=function(e,t,n,i){var o=new r(4);return o[0]=e,o[1]=t,o[2]=n,o[3]=i,o},s.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},s.set=function(e,t,r,n,i){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e},s.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},s.subtract=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e},s.sub=s.subtract,s.multiply=function(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e},s.mul=s.multiply,s.divide=function(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e},s.div=s.divide,s.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e},s.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e},s.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},s.scaleAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e},s.distance=function(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2],o=t[3]-e[3];return Math.sqrt(r*r+n*n+i*i+o*o)},s.dist=s.distance,s.squaredDistance=function(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2],o=t[3]-e[3];return r*r+n*n+i*i+o*o},s.sqrDist=s.squaredDistance,s.length=function(e){var t=e[0],r=e[1],n=e[2],i=e[3];return Math.sqrt(t*t+r*r+n*n+i*i)},s.len=s.length,s.squaredLength=function(e){var t=e[0],r=e[1],n=e[2],i=e[3];return t*t+r*r+n*n+i*i},s.sqrLen=s.squaredLength,s.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},s.normalize=function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=r*r+n*n+i*i+o*o;return a>0&&(a=1/Math.sqrt(a),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e[3]=t[3]*a),e},s.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},s.lerp=function(e,t,r,n){var i=t[0],o=t[1],a=t[2],s=t[3];return e[0]=i+n*(r[0]-i),e[1]=o+n*(r[1]-o),e[2]=a+n*(r[2]-a),e[3]=s+n*(r[3]-s),e},s.random=function(e,t){return t=t||1,e[0]=n(),e[1]=n(),e[2]=n(),e[3]=n(),s.normalize(e,e),s.scale(e,e,t),e},s.transformMat4=function(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3];return e[0]=r[0]*n+r[4]*i+r[8]*o+r[12]*a,e[1]=r[1]*n+r[5]*i+r[9]*o+r[13]*a,e[2]=r[2]*n+r[6]*i+r[10]*o+r[14]*a,e[3]=r[3]*n+r[7]*i+r[11]*o+r[15]*a,e},s.transformQuat=function(e,t,r){var n=t[0],i=t[1],o=t[2],a=r[0],s=r[1],l=r[2],c=r[3],h=c*n+s*o-l*i,u=c*i+l*n-a*o,f=c*o+a*i-s*n,d=-a*n-s*i-l*o;return e[0]=h*c+d*-a+u*-l-f*-s,e[1]=u*c+d*-s+f*-a-h*-l,e[2]=f*c+d*-l+h*-s-u*-a,e},s.forEach=function(){var e=s.create();return function(t,r,n,i,o,a){var s,l;for(r||(r=4),n||(n=0),l=i?Math.min(i*r+n,t.length):t.length,s=n;l>s;s+=r)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],e[3]=t[s+3],o(e,e,a),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2],t[s+3]=e[3];return t}}(),s.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},"undefined"!=typeof e&&(e.vec4=s);var l={};l.create=function(){var e=new r(4);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},l.clone=function(e){var t=new r(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},l.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},l.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},l.transpose=function(e,t){if(e===t){var r=t[1];e[1]=t[2],e[2]=r}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},l.invert=function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=r*o-i*n;return a?(a=1/a,e[0]=o*a,e[1]=-n*a,e[2]=-i*a,e[3]=r*a,e):null},l.adjoint=function(e,t){var r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e},l.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},l.multiply=function(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=r[0],l=r[1],c=r[2],h=r[3];return e[0]=n*s+i*c,e[1]=n*l+i*h,e[2]=o*s+a*c,e[3]=o*l+a*h,e},l.mul=l.multiply,l.rotate=function(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=n*l+i*s,e[1]=n*-s+i*l,e[2]=o*l+a*s,e[3]=o*-s+a*l,e},l.scale=function(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=r[0],l=r[1];return e[0]=n*s,e[1]=i*l,e[2]=o*s,e[3]=a*l,e},l.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},"undefined"!=typeof e&&(e.mat2=l);var c={};c.create=function(){var e=new r(6);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},c.clone=function(e){var t=new r(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},c.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},c.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},c.invert=function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],l=r*o-n*i;return l?(l=1/l,e[0]=o*l,e[1]=-n*l,e[2]=-i*l,e[3]=r*l,e[4]=(i*s-o*a)*l,e[5]=(n*a-r*s)*l,e):null},c.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},c.multiply=function(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=r[0],h=r[1],u=r[2],f=r[3],d=r[4],p=r[5];return e[0]=n*c+i*u,e[1]=n*h+i*f,e[2]=o*c+a*u,e[3]=o*h+a*f,e[4]=c*s+u*l+d,e[5]=h*s+f*l+p,e},c.mul=c.multiply,c.rotate=function(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=Math.sin(r),h=Math.cos(r);return e[0]=n*h+i*c,e[1]=-n*c+i*h,e[2]=o*h+a*c,e[3]=-o*c+h*a,e[4]=h*s+c*l,e[5]=h*l-c*s,e},c.scale=function(e,t,r){var n=r[0],i=r[1];return e[0]=t[0]*n,e[1]=t[1]*i,e[2]=t[2]*n,e[3]=t[3]*i,e[4]=t[4]*n,e[5]=t[5]*i,e},c.translate=function(e,t,r){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4]+r[0],e[5]=t[5]+r[1],e},c.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},"undefined"!=typeof e&&(e.mat2d=c);var h={};h.create=function(){var e=new r(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},h.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},h.clone=function(e){var t=new r(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},h.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},h.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},h.transpose=function(e,t){if(e===t){var r=t[1],n=t[2],i=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=n,e[7]=i}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},h.invert=function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],l=t[6],c=t[7],h=t[8],u=h*a-s*c,f=-h*o+s*l,d=c*o-a*l,p=r*u+n*f+i*d;return p?(p=1/p,e[0]=u*p,e[1]=(-h*n+i*c)*p,e[2]=(s*n-i*a)*p,e[3]=f*p,e[4]=(h*r-i*l)*p,e[5]=(-s*r+i*o)*p,e[6]=d*p,e[7]=(-c*r+n*l)*p,e[8]=(a*r-n*o)*p,e):null},h.adjoint=function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],l=t[6],c=t[7],h=t[8];return e[0]=a*h-s*c,e[1]=i*c-n*h,e[2]=n*s-i*a,e[3]=s*l-o*h,e[4]=r*h-i*l,e[5]=i*o-r*s,e[6]=o*c-a*l,e[7]=n*l-r*c,e[8]=r*a-n*o,e},h.determinant=function(e){var t=e[0],r=e[1],n=e[2],i=e[3],o=e[4],a=e[5],s=e[6],l=e[7],c=e[8];return t*(c*o-a*l)+r*(-c*i+a*s)+n*(l*i-o*s)},h.multiply=function(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],h=t[7],u=t[8],f=r[0],d=r[1],p=r[2],m=r[3],g=r[4],v=r[5],E=r[6],y=r[7],T=r[8];return e[0]=f*n+d*a+p*c,e[1]=f*i+d*s+p*h,e[2]=f*o+d*l+p*u,e[3]=m*n+g*a+v*c,e[4]=m*i+g*s+v*h,e[5]=m*o+g*l+v*u,e[6]=E*n+y*a+T*c,e[7]=E*i+y*s+T*h,e[8]=E*o+y*l+T*u,e},h.mul=h.multiply,h.translate=function(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],h=t[7],u=t[8],f=r[0],d=r[1];return e[0]=n,e[1]=i,e[2]=o,e[3]=a,e[4]=s,e[5]=l,e[6]=f*n+d*a+c,e[7]=f*i+d*s+h,e[8]=f*o+d*l+u,e},h.rotate=function(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],h=t[7],u=t[8],f=Math.sin(r),d=Math.cos(r);return e[0]=d*n+f*a,e[1]=d*i+f*s,e[2]=d*o+f*l,e[3]=d*a-f*n,e[4]=d*s-f*i,e[5]=d*l-f*o,e[6]=c,e[7]=h,e[8]=u,e},h.scale=function(e,t,r){var n=r[0],i=r[1];return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=i*t[3],e[4]=i*t[4],e[5]=i*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},h.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},h.fromQuat=function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=r+r,s=n+n,l=i+i,c=r*a,h=r*s,u=r*l,f=n*s,d=n*l,p=i*l,m=o*a,g=o*s,v=o*l;return e[0]=1-(f+p),e[3]=h+v,e[6]=u-g,e[1]=h-v,e[4]=1-(c+p),e[7]=d+m,e[2]=u+g,e[5]=d-m,e[8]=1-(c+f),e},h.normalFromMat4=function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],l=t[6],c=t[7],h=t[8],u=t[9],f=t[10],d=t[11],p=t[12],m=t[13],g=t[14],v=t[15],E=r*s-n*a,y=r*l-i*a,T=r*c-o*a,x=n*l-i*s,w=n*c-o*s,b=i*c-o*l,R=h*m-u*p,_=h*g-f*p,H=h*v-d*p,M=u*g-f*m,S=u*v-d*m,C=f*v-d*g,A=E*C-y*S+T*M+x*H-w*_+b*R;return A?(A=1/A,e[0]=(s*C-l*S+c*M)*A,e[1]=(l*H-a*C-c*_)*A,e[2]=(a*S-s*H+c*R)*A,e[3]=(i*S-n*C-o*M)*A,e[4]=(r*C-i*H+o*_)*A,e[5]=(n*H-r*S-o*R)*A,e[6]=(m*b-g*w+v*x)*A,e[7]=(g*T-p*b-v*y)*A,e[8]=(p*w-m*T+v*E)*A,e):null},h.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},"undefined"!=typeof e&&(e.mat3=h);var u={};u.create=function(){var e=new r(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},u.clone=function(e){var t=new r(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},u.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},u.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},u.transpose=function(e,t){if(e===t){var r=t[1],n=t[2],i=t[3],o=t[6],a=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=o,e[11]=t[14],e[12]=i,e[13]=a,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},u.invert=function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],l=t[6],c=t[7],h=t[8],u=t[9],f=t[10],d=t[11],p=t[12],m=t[13],g=t[14],v=t[15],E=r*s-n*a,y=r*l-i*a,T=r*c-o*a,x=n*l-i*s,w=n*c-o*s,b=i*c-o*l,R=h*m-u*p,_=h*g-f*p,H=h*v-d*p,M=u*g-f*m,S=u*v-d*m,C=f*v-d*g,A=E*C-y*S+T*M+x*H-w*_+b*R;return A?(A=1/A,e[0]=(s*C-l*S+c*M)*A,e[1]=(i*S-n*C-o*M)*A,e[2]=(m*b-g*w+v*x)*A,e[3]=(f*w-u*b-d*x)*A,e[4]=(l*H-a*C-c*_)*A,e[5]=(r*C-i*H+o*_)*A,e[6]=(g*T-p*b-v*y)*A,e[7]=(h*b-f*T+d*y)*A,e[8]=(a*S-s*H+c*R)*A,e[9]=(n*H-r*S-o*R)*A,e[10]=(p*w-m*T+v*E)*A,e[11]=(u*T-h*w-d*E)*A,e[12]=(s*_-a*M-l*R)*A,e[13]=(r*M-n*_+i*R)*A,e[14]=(m*y-p*x-g*E)*A,e[15]=(h*x-u*y+f*E)*A,e):null},u.adjoint=function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],l=t[6],c=t[7],h=t[8],u=t[9],f=t[10],d=t[11],p=t[12],m=t[13],g=t[14],v=t[15];return e[0]=s*(f*v-d*g)-u*(l*v-c*g)+m*(l*d-c*f),e[1]=-(n*(f*v-d*g)-u*(i*v-o*g)+m*(i*d-o*f)),e[2]=n*(l*v-c*g)-s*(i*v-o*g)+m*(i*c-o*l),e[3]=-(n*(l*d-c*f)-s*(i*d-o*f)+u*(i*c-o*l)),e[4]=-(a*(f*v-d*g)-h*(l*v-c*g)+p*(l*d-c*f)),e[5]=r*(f*v-d*g)-h*(i*v-o*g)+p*(i*d-o*f),e[6]=-(r*(l*v-c*g)-a*(i*v-o*g)+p*(i*c-o*l)),e[7]=r*(l*d-c*f)-a*(i*d-o*f)+h*(i*c-o*l),e[8]=a*(u*v-d*m)-h*(s*v-c*m)+p*(s*d-c*u),e[9]=-(r*(u*v-d*m)-h*(n*v-o*m)+p*(n*d-o*u)),e[10]=r*(s*v-c*m)-a*(n*v-o*m)+p*(n*c-o*s),e[11]=-(r*(s*d-c*u)-a*(n*d-o*u)+h*(n*c-o*s)),e[12]=-(a*(u*g-f*m)-h*(s*g-l*m)+p*(s*f-l*u)),e[13]=r*(u*g-f*m)-h*(n*g-i*m)+p*(n*f-i*u),e[14]=-(r*(s*g-l*m)-a*(n*g-i*m)+p*(n*l-i*s)),e[15]=r*(s*f-l*u)-a*(n*f-i*u)+h*(n*l-i*s),e},u.determinant=function(e){var t=e[0],r=e[1],n=e[2],i=e[3],o=e[4],a=e[5],s=e[6],l=e[7],c=e[8],h=e[9],u=e[10],f=e[11],d=e[12],p=e[13],m=e[14],g=e[15],v=t*a-r*o,E=t*s-n*o,y=t*l-i*o,T=r*s-n*a,x=r*l-i*a,w=n*l-i*s,b=c*p-h*d,R=c*m-u*d,_=c*g-f*d,H=h*m-u*p,M=h*g-f*p,S=u*g-f*m;return v*S-E*M+y*H+T*_-x*R+w*b},u.multiply=function(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],h=t[7],u=t[8],f=t[9],d=t[10],p=t[11],m=t[12],g=t[13],v=t[14],E=t[15],y=r[0],T=r[1],x=r[2],w=r[3];return e[0]=y*n+T*s+x*u+w*m,e[1]=y*i+T*l+x*f+w*g,e[2]=y*o+T*c+x*d+w*v,e[3]=y*a+T*h+x*p+w*E,y=r[4],T=r[5],x=r[6],w=r[7],e[4]=y*n+T*s+x*u+w*m,e[5]=y*i+T*l+x*f+w*g,e[6]=y*o+T*c+x*d+w*v,e[7]=y*a+T*h+x*p+w*E,y=r[8],T=r[9],x=r[10],w=r[11],e[8]=y*n+T*s+x*u+w*m,e[9]=y*i+T*l+x*f+w*g,e[10]=y*o+T*c+x*d+w*v,e[11]=y*a+T*h+x*p+w*E,y=r[12],T=r[13],x=r[14],w=r[15],e[12]=y*n+T*s+x*u+w*m,e[13]=y*i+T*l+x*f+w*g,e[14]=y*o+T*c+x*d+w*v,e[15]=y*a+T*h+x*p+w*E,e},u.mul=u.multiply,u.translate=function(e,t,r){var n,i,o,a,s,l,c,h,u,f,d,p,m=r[0],g=r[1],v=r[2];return t===e?(e[12]=t[0]*m+t[4]*g+t[8]*v+t[12],e[13]=t[1]*m+t[5]*g+t[9]*v+t[13],e[14]=t[2]*m+t[6]*g+t[10]*v+t[14],e[15]=t[3]*m+t[7]*g+t[11]*v+t[15]):(n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],h=t[7],u=t[8],f=t[9],d=t[10],p=t[11],e[0]=n,e[1]=i,e[2]=o,e[3]=a,e[4]=s,e[5]=l,e[6]=c,e[7]=h,e[8]=u,e[9]=f,e[10]=d,e[11]=p,e[12]=n*m+s*g+u*v+t[12],e[13]=i*m+l*g+f*v+t[13],e[14]=o*m+c*g+d*v+t[14],e[15]=a*m+h*g+p*v+t[15]),e},u.scale=function(e,t,r){var n=r[0],i=r[1],o=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},u.rotate=function(e,r,n,i){var o,a,s,l,c,h,u,f,d,p,m,g,v,E,y,T,x,w,b,R,_,H,M,S,C=i[0],A=i[1],k=i[2],L=Math.sqrt(C*C+A*A+k*k);return Math.abs(L)<t?null:(L=1/L,C*=L,A*=L,k*=L,o=Math.sin(n),a=Math.cos(n),s=1-a,l=r[0],c=r[1],h=r[2],u=r[3],f=r[4],d=r[5],p=r[6],m=r[7],g=r[8],v=r[9],E=r[10],y=r[11],T=C*C*s+a,x=A*C*s+k*o,w=k*C*s-A*o,b=C*A*s-k*o,R=A*A*s+a,_=k*A*s+C*o,H=C*k*s+A*o,M=A*k*s-C*o,S=k*k*s+a,e[0]=l*T+f*x+g*w,e[1]=c*T+d*x+v*w,e[2]=h*T+p*x+E*w,e[3]=u*T+m*x+y*w,e[4]=l*b+f*R+g*_,e[5]=c*b+d*R+v*_,e[6]=h*b+p*R+E*_,e[7]=u*b+m*R+y*_,e[8]=l*H+f*M+g*S,e[9]=c*H+d*M+v*S,e[10]=h*H+p*M+E*S,e[11]=u*H+m*M+y*S,r!==e&&(e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e)},u.rotateX=function(e,t,r){var n=Math.sin(r),i=Math.cos(r),o=t[4],a=t[5],s=t[6],l=t[7],c=t[8],h=t[9],u=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*i+c*n,e[5]=a*i+h*n,e[6]=s*i+u*n,e[7]=l*i+f*n,e[8]=c*i-o*n,e[9]=h*i-a*n,e[10]=u*i-s*n,e[11]=f*i-l*n,e},u.rotateY=function(e,t,r){var n=Math.sin(r),i=Math.cos(r),o=t[0],a=t[1],s=t[2],l=t[3],c=t[8],h=t[9],u=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i-c*n,e[1]=a*i-h*n,e[2]=s*i-u*n,e[3]=l*i-f*n,e[8]=o*n+c*i,e[9]=a*n+h*i,e[10]=s*n+u*i,e[11]=l*n+f*i,e},u.rotateZ=function(e,t,r){var n=Math.sin(r),i=Math.cos(r),o=t[0],a=t[1],s=t[2],l=t[3],c=t[4],h=t[5],u=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i+c*n,e[1]=a*i+h*n,e[2]=s*i+u*n,e[3]=l*i+f*n,e[4]=c*i-o*n,e[5]=h*i-a*n,e[6]=u*i-s*n,e[7]=f*i-l*n,e},u.fromRotationTranslation=function(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=n+n,l=i+i,c=o+o,h=n*s,u=n*l,f=n*c,d=i*l,p=i*c,m=o*c,g=a*s,v=a*l,E=a*c;return e[0]=1-(d+m),e[1]=u+E,e[2]=f-v,e[3]=0,e[4]=u-E,e[5]=1-(h+m),e[6]=p+g,e[7]=0,e[8]=f+v,e[9]=p-g,e[10]=1-(h+d),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},u.fromQuat=function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=r+r,s=n+n,l=i+i,c=r*a,h=r*s,u=r*l,f=n*s,d=n*l,p=i*l,m=o*a,g=o*s,v=o*l;return e[0]=1-(f+p),e[1]=h+v,e[2]=u-g,e[3]=0,e[4]=h-v,e[5]=1-(c+p),e[6]=d+m,e[7]=0,e[8]=u+g,e[9]=d-m,e[10]=1-(c+f),e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},u.frustum=function(e,t,r,n,i,o,a){var s=1/(r-t),l=1/(i-n),c=1/(o-a);return e[0]=2*o*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*l,e[6]=0,e[7]=0,e[8]=(r+t)*s,e[9]=(i+n)*l,e[10]=(a+o)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*o*2*c,e[15]=0,e},u.perspective=function(e,t,r,n,i){var o=1/Math.tan(t/2),a=1/(n-i);return e[0]=o/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(i+n)*a,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*i*n*a,e[15]=0,e},u.ortho=function(e,t,r,n,i,o,a){var s=1/(t-r),l=1/(n-i),c=1/(o-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+r)*s,e[13]=(i+n)*l,e[14]=(a+o)*c,e[15]=1,e
},u.lookAt=function(e,r,n,i){var o,a,s,l,c,h,f,d,p,m,g=r[0],v=r[1],E=r[2],y=i[0],T=i[1],x=i[2],w=n[0],b=n[1],R=n[2];return Math.abs(g-w)<t&&Math.abs(v-b)<t&&Math.abs(E-R)<t?u.identity(e):(f=g-w,d=v-b,p=E-R,m=1/Math.sqrt(f*f+d*d+p*p),f*=m,d*=m,p*=m,o=T*p-x*d,a=x*f-y*p,s=y*d-T*f,m=Math.sqrt(o*o+a*a+s*s),m?(m=1/m,o*=m,a*=m,s*=m):(o=0,a=0,s=0),l=d*s-p*a,c=p*o-f*s,h=f*a-d*o,m=Math.sqrt(l*l+c*c+h*h),m?(m=1/m,l*=m,c*=m,h*=m):(l=0,c=0,h=0),e[0]=o,e[1]=l,e[2]=f,e[3]=0,e[4]=a,e[5]=c,e[6]=d,e[7]=0,e[8]=s,e[9]=h,e[10]=p,e[11]=0,e[12]=-(o*g+a*v+s*E),e[13]=-(l*g+c*v+h*E),e[14]=-(f*g+d*v+p*E),e[15]=1,e)},u.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},"undefined"!=typeof e&&(e.mat4=u);var f={};f.create=function(){var e=new r(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},f.rotationTo=function(){var e=a.create(),t=a.fromValues(1,0,0),r=a.fromValues(0,1,0);return function(n,i,o){var s=a.dot(i,o);return-.999999>s?(a.cross(e,t,i),a.length(e)<1e-6&&a.cross(e,r,i),a.normalize(e,e),f.setAxisAngle(n,e,Math.PI),n):s>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(a.cross(e,i,o),n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=1+s,f.normalize(n,n))}}(),f.setAxes=function(){var e=h.create();return function(t,r,n,i){return e[0]=n[0],e[3]=n[1],e[6]=n[2],e[1]=i[0],e[4]=i[1],e[7]=i[2],e[2]=r[0],e[5]=r[1],e[8]=r[2],f.normalize(t,f.fromMat3(t,e))}}(),f.clone=s.clone,f.fromValues=s.fromValues,f.copy=s.copy,f.set=s.set,f.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},f.setAxisAngle=function(e,t,r){r=.5*r;var n=Math.sin(r);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(r),e},f.add=s.add,f.multiply=function(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=r[0],l=r[1],c=r[2],h=r[3];return e[0]=n*h+a*s+i*c-o*l,e[1]=i*h+a*l+o*s-n*c,e[2]=o*h+a*c+n*l-i*s,e[3]=a*h-n*s-i*l-o*c,e},f.mul=f.multiply,f.scale=s.scale,f.rotateX=function(e,t,r){r*=.5;var n=t[0],i=t[1],o=t[2],a=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=n*l+a*s,e[1]=i*l+o*s,e[2]=o*l-i*s,e[3]=a*l-n*s,e},f.rotateY=function(e,t,r){r*=.5;var n=t[0],i=t[1],o=t[2],a=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=n*l-o*s,e[1]=i*l+a*s,e[2]=o*l+n*s,e[3]=a*l-i*s,e},f.rotateZ=function(e,t,r){r*=.5;var n=t[0],i=t[1],o=t[2],a=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=n*l+i*s,e[1]=i*l-n*s,e[2]=o*l+a*s,e[3]=a*l-o*s,e},f.calculateW=function(e,t){var r=t[0],n=t[1],i=t[2];return e[0]=r,e[1]=n,e[2]=i,e[3]=-Math.sqrt(Math.abs(1-r*r-n*n-i*i)),e},f.dot=s.dot,f.lerp=s.lerp,f.slerp=function(e,t,r,n){var i,o,a,s,l,c=t[0],h=t[1],u=t[2],f=t[3],d=r[0],p=r[1],m=r[2],g=r[3];return o=c*d+h*p+u*m+f*g,0>o&&(o=-o,d=-d,p=-p,m=-m,g=-g),1-o>1e-6?(i=Math.acos(o),a=Math.sin(i),s=Math.sin((1-n)*i)/a,l=Math.sin(n*i)/a):(s=1-n,l=n),e[0]=s*c+l*d,e[1]=s*h+l*p,e[2]=s*u+l*m,e[3]=s*f+l*g,e},f.invert=function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=r*r+n*n+i*i+o*o,s=a?1/a:0;return e[0]=-r*s,e[1]=-n*s,e[2]=-i*s,e[3]=o*s,e},f.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},f.length=s.length,f.len=f.length,f.squaredLength=s.squaredLength,f.sqrLen=f.squaredLength,f.normalize=s.normalize,f.fromMat3=function(){var e="undefined"!=typeof Int8Array?new Int8Array([1,2,0]):[1,2,0];return function(t,r){var n,i=r[0]+r[4]+r[8];if(i>0)n=Math.sqrt(i+1),t[3]=.5*n,n=.5/n,t[0]=(r[7]-r[5])*n,t[1]=(r[2]-r[6])*n,t[2]=(r[3]-r[1])*n;else{var o=0;r[4]>r[0]&&(o=1),r[8]>r[3*o+o]&&(o=2);var a=e[o],s=e[a];n=Math.sqrt(r[3*o+o]-r[3*a+a]-r[3*s+s]+1),t[o]=.5*n,n=.5/n,t[3]=(r[3*s+a]-r[3*a+s])*n,t[a]=(r[3*a+o]+r[3*o+a])*n,t[s]=(r[3*s+o]+r[3*o+s])*n}return t}}(),f.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},"undefined"!=typeof e&&(e.quat=f)}(t.exports)}(this),function(e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else{if("function"==typeof define&&define.amd)return define([],e);this.CodeMirror=e()}}(function(){"use strict";function e(r,n){if(!(this instanceof e))return new e(r,n);this.options=n=n||{},oo(ya,n,!1),p(n);var i=n.value;"string"==typeof i&&(i=new Ga(i,n.mode)),this.doc=i;var o=this.display=new t(r,i);o.wrapper.CodeMirror=this,h(this),l(this),n.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),n.autofocus&&!$o&&pr(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,cutIncoming:!1,draggingText:!1,highlight:new $i},Vo&&11>Bo&&setTimeout(ao(dr,this,!0),20),vr(this),xo();var a=this;Zt(this,function(){a.curOp.forceUpdate=!0,yi(a,i),n.autofocus&&!$o||mo()==o.input?setTimeout(ao(Ir,a),20):Vr(a);for(var e in Ta)Ta.hasOwnProperty(e)&&Ta[e](a,n[e],xa);for(var t=0;t<_a.length;++t)_a[t](a)})}function t(e,t){var r=this,n=r.input=ho("textarea",null,null,"position: absolute; padding: 0; width: 1px; height: 1em; outline: none");Go?n.style.width="1000px":n.setAttribute("wrap","off"),Zo&&(n.style.border="1px solid black"),n.setAttribute("autocorrect","off"),n.setAttribute("autocapitalize","off"),n.setAttribute("spellcheck","false"),r.inputDiv=ho("div",[n],null,"overflow: hidden; position: relative; width: 3px; height: 0px;"),r.scrollbarH=ho("div",[ho("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar"),r.scrollbarV=ho("div",[ho("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),r.scrollbarFiller=ho("div",null,"CodeMirror-scrollbar-filler"),r.gutterFiller=ho("div",null,"CodeMirror-gutter-filler"),r.lineDiv=ho("div",null,"CodeMirror-code"),r.selectionDiv=ho("div",null,null,"position: relative; z-index: 1"),r.cursorDiv=ho("div",null,"CodeMirror-cursors"),r.measure=ho("div",null,"CodeMirror-measure"),r.lineMeasure=ho("div",null,"CodeMirror-measure"),r.lineSpace=ho("div",[r.measure,r.lineMeasure,r.selectionDiv,r.cursorDiv,r.lineDiv],null,"position: relative; outline: none"),r.mover=ho("div",[ho("div",[r.lineSpace],"CodeMirror-lines")],null,"position: relative"),r.sizer=ho("div",[r.mover],"CodeMirror-sizer"),r.heightForcer=ho("div",null,null,"position: absolute; height: "+es+"px; width: 1px;"),r.gutters=ho("div",null,"CodeMirror-gutters"),r.lineGutter=null,r.scroller=ho("div",[r.sizer,r.heightForcer,r.gutters],"CodeMirror-scroll"),r.scroller.setAttribute("tabIndex","-1"),r.wrapper=ho("div",[r.inputDiv,r.scrollbarH,r.scrollbarV,r.scrollbarFiller,r.gutterFiller,r.scroller],"CodeMirror"),Vo&&8>Bo&&(r.gutters.style.zIndex=-1,r.scroller.style.paddingRight=0),Zo&&(n.style.width="0px"),Go||(r.scroller.draggable=!0),Yo&&(r.inputDiv.style.height="1px",r.inputDiv.style.position="absolute"),Vo&&8>Bo&&(r.scrollbarH.style.minHeight=r.scrollbarV.style.minWidth="18px"),e.appendChild?e.appendChild(r.wrapper):e(r.wrapper),r.viewFrom=r.viewTo=t.first,r.view=[],r.externalMeasured=null,r.viewOffset=0,r.lastSizeC=0,r.updateLineNumbers=null,r.lineNumWidth=r.lineNumInnerWidth=r.lineNumChars=null,r.prevInput="",r.alignWidgets=!1,r.pollingFast=!1,r.poll=new $i,r.cachedCharWidth=r.cachedTextHeight=r.cachedPaddingH=null,r.inaccurateSelection=!1,r.maxLine=null,r.maxLineLength=0,r.maxLineChanged=!1,r.wheelDX=r.wheelDY=r.wheelStartX=r.wheelStartY=null,r.shift=!1,r.selForContextMenu=null}function r(t){t.doc.mode=e.getMode(t.options,t.doc.modeOption),n(t)}function n(e){e.doc.iter(function(e){e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null)}),e.doc.frontier=e.doc.first,yt(e,100),e.state.modeGen++,e.curOp&&nr(e)}function i(e){e.options.lineWrapping?(Eo(e.display.wrapper,"CodeMirror-wrap"),e.display.sizer.style.minWidth=""):(vo(e.display.wrapper,"CodeMirror-wrap"),d(e)),a(e),nr(e),Dt(e),setTimeout(function(){v(e)},100)}function o(e){var t=qt(e.display),r=e.options.lineWrapping,n=r&&Math.max(5,e.display.scroller.clientWidth/Yt(e.display)-3);return function(i){if(Xn(e.doc,i))return 0;var o=0;if(i.widgets)for(var a=0;a<i.widgets.length;a++)i.widgets[a].height&&(o+=i.widgets[a].height);return r?o+(Math.ceil(i.text.length/n)||1)*t:o+t}}function a(e){var t=e.doc,r=o(e);t.iter(function(e){var t=r(e);t!=e.height&&bi(e,t)})}function s(e){var t=Aa[e.options.keyMap],r=t.style;e.display.wrapper.className=e.display.wrapper.className.replace(/\s*cm-keymap-\S+/g,"")+(r?" cm-keymap-"+r:"")}function l(e){e.display.wrapper.className=e.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+e.options.theme.replace(/(^|\s)\s*/g," cm-s-"),Dt(e)}function c(e){h(e),nr(e),setTimeout(function(){y(e)},20)}function h(e){var t=e.display.gutters,r=e.options.gutters;uo(t);for(var n=0;n<r.length;++n){var i=r[n],o=t.appendChild(ho("div",null,"CodeMirror-gutter "+i));"CodeMirror-linenumbers"==i&&(e.display.lineGutter=o,o.style.width=(e.display.lineNumWidth||1)+"px")}t.style.display=n?"":"none",u(e)}function u(e){var t=e.display.gutters.offsetWidth;e.display.sizer.style.marginLeft=t+"px",e.display.scrollbarH.style.left=e.options.fixedGutter?t+"px":0}function f(e){if(0==e.height)return 0;for(var t,r=e.text.length,n=e;t=zn(n);){var i=t.find(0,!0);n=i.from.line,r+=i.from.ch-i.to.ch}for(n=e;t=In(n);){var i=t.find(0,!0);r-=n.text.length-i.from.ch,n=i.to.line,r+=n.text.length-i.to.ch}return r}function d(e){var t=e.display,r=e.doc;t.maxLine=Ti(r,r.first),t.maxLineLength=f(t.maxLine),t.maxLineChanged=!0,r.iter(function(e){var r=f(e);r>t.maxLineLength&&(t.maxLineLength=r,t.maxLine=e)})}function p(e){var t=ro(e.gutters,"CodeMirror-linenumbers");-1==t&&e.lineNumbers?e.gutters=e.gutters.concat(["CodeMirror-linenumbers"]):t>-1&&!e.lineNumbers&&(e.gutters=e.gutters.slice(0),e.gutters.splice(t,1))}function m(e){return e.display.scroller.clientHeight-e.display.wrapper.clientHeight<es-3}function g(e){var t=e.display.scroller;return{clientHeight:t.clientHeight,barHeight:e.display.scrollbarV.clientHeight,scrollWidth:t.scrollWidth,clientWidth:t.clientWidth,hScrollbarTakesSpace:m(e),barWidth:e.display.scrollbarH.clientWidth,docHeight:Math.round(e.doc.height+Rt(e.display))}}function v(e,t){t||(t=g(e));var r=e.display,n=bo(r.measure),i=t.docHeight+es,o=t.scrollWidth>t.clientWidth;o&&t.scrollWidth<=t.clientWidth+1&&n>0&&!t.hScrollbarTakesSpace&&(o=!1);var a=i>t.clientHeight;if(a?(r.scrollbarV.style.display="block",r.scrollbarV.style.bottom=o?n+"px":"0",r.scrollbarV.firstChild.style.height=Math.max(0,i-t.clientHeight+(t.barHeight||r.scrollbarV.clientHeight))+"px"):(r.scrollbarV.style.display="",r.scrollbarV.firstChild.style.height="0"),o?(r.scrollbarH.style.display="block",r.scrollbarH.style.right=a?n+"px":"0",r.scrollbarH.firstChild.style.width=t.scrollWidth-t.clientWidth+(t.barWidth||r.scrollbarH.clientWidth)+"px"):(r.scrollbarH.style.display="",r.scrollbarH.firstChild.style.width="0"),o&&a?(r.scrollbarFiller.style.display="block",r.scrollbarFiller.style.height=r.scrollbarFiller.style.width=n+"px"):r.scrollbarFiller.style.display="",o&&e.options.coverGutterNextToScrollbar&&e.options.fixedGutter?(r.gutterFiller.style.display="block",r.gutterFiller.style.height=n+"px",r.gutterFiller.style.width=r.gutters.offsetWidth+"px"):r.gutterFiller.style.display="",!e.state.checkedOverlayScrollbar&&t.clientHeight>0){if(0===n){var s=Jo&&!Ko?"12px":"18px";r.scrollbarV.style.minWidth=r.scrollbarH.style.minHeight=s;var l=function(t){ji(t)!=r.scrollbarV&&ji(t)!=r.scrollbarH&&$t(e,xr)(t)};Qa(r.scrollbarV,"mousedown",l),Qa(r.scrollbarH,"mousedown",l)}e.state.checkedOverlayScrollbar=!0}}function E(e,t,r){var n=r&&null!=r.top?Math.max(0,r.top):e.scroller.scrollTop;n=Math.floor(n-bt(e));var i=r&&null!=r.bottom?r.bottom:n+e.wrapper.clientHeight,o=_i(t,n),a=_i(t,i);if(r&&r.ensure){var s=r.ensure.from.line,l=r.ensure.to.line;if(o>s)return{from:s,to:_i(t,Hi(Ti(t,s))+e.wrapper.clientHeight)};if(Math.min(l,t.lastLine())>=a)return{from:_i(t,Hi(Ti(t,l))-e.wrapper.clientHeight),to:l}}return{from:o,to:Math.max(a,o+1)}}function y(e){var t=e.display,r=t.view;if(t.alignWidgets||t.gutters.firstChild&&e.options.fixedGutter){for(var n=w(t)-t.scroller.scrollLeft+e.doc.scrollLeft,i=t.gutters.offsetWidth,o=n+"px",a=0;a<r.length;a++)if(!r[a].hidden){e.options.fixedGutter&&r[a].gutter&&(r[a].gutter.style.left=o);var s=r[a].alignable;if(s)for(var l=0;l<s.length;l++)s[l].style.left=o}e.options.fixedGutter&&(t.gutters.style.left=n+i+"px")}}function T(e){if(!e.options.lineNumbers)return!1;var t=e.doc,r=x(e.options,t.first+t.size-1),n=e.display;if(r.length!=n.lineNumChars){var i=n.measure.appendChild(ho("div",[ho("div",r)],"CodeMirror-linenumber CodeMirror-gutter-elt")),o=i.firstChild.offsetWidth,a=i.offsetWidth-o;return n.lineGutter.style.width="",n.lineNumInnerWidth=Math.max(o,n.lineGutter.offsetWidth-a),n.lineNumWidth=n.lineNumInnerWidth+a,n.lineNumChars=n.lineNumInnerWidth?r.length:-1,n.lineGutter.style.width=n.lineNumWidth+"px",u(e),!0}return!1}function x(e,t){return String(e.lineNumberFormatter(t+e.firstLineNumber))}function w(e){return e.scroller.getBoundingClientRect().left-e.sizer.getBoundingClientRect().left}function b(e,t,r){for(var n,i=e.display.viewFrom,o=e.display.viewTo,a=E(e.display,e.doc,t),s=!0;;s=!1){var l=e.display.scroller.clientWidth;if(!R(e,a,r))break;n=!0,e.display.maxLineChanged&&!e.options.lineWrapping&&_(e);var c=g(e);if(mt(e),H(e,c),v(e,c),Go&&e.options.lineWrapping&&M(e,c),Go&&c.scrollWidth>c.clientWidth&&c.scrollWidth<c.clientWidth+1&&!m(e)&&v(e),s&&e.options.lineWrapping&&l!=e.display.scroller.clientWidth)r=!0;else if(r=!1,t&&null!=t.top&&(t={top:Math.min(c.docHeight-es-c.clientHeight,t.top)}),a=E(e.display,e.doc,t),a.from>=e.display.viewFrom&&a.to<=e.display.viewTo)break}return e.display.updateLineNumbers=null,n&&(Xi(e,"update",e),(e.display.viewFrom!=i||e.display.viewTo!=o)&&Xi(e,"viewportChange",e,e.display.viewFrom,e.display.viewTo)),n}function R(e,t,r){var n=e.display,i=e.doc;if(!n.wrapper.offsetWidth)return void or(e);if(!(!r&&t.from>=n.viewFrom&&t.to<=n.viewTo&&(null==n.updateLineNumbers||n.updateLineNumbers>=n.viewTo)&&0==cr(e))){T(e)&&or(e);var o=A(e),a=i.first+i.size,s=Math.max(t.from-e.options.viewportMargin,i.first),l=Math.min(a,t.to+e.options.viewportMargin);n.viewFrom<s&&s-n.viewFrom<20&&(s=Math.max(i.first,n.viewFrom)),n.viewTo>l&&n.viewTo-l<20&&(l=Math.min(a,n.viewTo)),oa&&(s=jn(e.doc,s),l=Wn(e.doc,l));var c=s!=n.viewFrom||l!=n.viewTo||n.lastSizeC!=n.wrapper.clientHeight;lr(e,s,l),n.viewOffset=Hi(Ti(e.doc,n.viewFrom)),e.display.mover.style.top=n.viewOffset+"px";var h=cr(e);if(c||0!=h||r){var u=mo();return h>4&&(n.lineDiv.style.display="none"),k(e,n.updateLineNumbers,o),h>4&&(n.lineDiv.style.display=""),u&&mo()!=u&&u.offsetHeight&&u.focus(),uo(n.cursorDiv),uo(n.selectionDiv),c&&(n.lastSizeC=n.wrapper.clientHeight,yt(e,400)),S(e),!0}}}function _(e){var t=e.display,r=Ct(e,t.maxLine,t.maxLine.text.length).left;t.maxLineChanged=!1;var n=Math.max(0,r+3),i=Math.max(0,t.sizer.offsetLeft+n+es-t.scroller.clientWidth);t.sizer.style.minWidth=n+"px",i<e.doc.scrollLeft&&Ar(e,Math.min(t.scroller.scrollLeft,i),!0)}function H(e,t){e.display.sizer.style.minHeight=e.display.heightForcer.style.top=t.docHeight+"px",e.display.gutters.style.height=Math.max(t.docHeight,t.clientHeight-es)+"px"}function M(e,t){e.display.sizer.offsetWidth+e.display.gutters.offsetWidth<e.display.scroller.clientWidth-1&&(e.display.sizer.style.minHeight=e.display.heightForcer.style.top="0px",e.display.gutters.style.height=t.docHeight+"px")}function S(e){for(var t=e.display,r=t.lineDiv.offsetTop,n=0;n<t.view.length;n++){var i,o=t.view[n];if(!o.hidden){if(Vo&&8>Bo){var a=o.node.offsetTop+o.node.offsetHeight;i=a-r,r=a}else{var s=o.node.getBoundingClientRect();i=s.bottom-s.top}var l=o.line.height-i;if(2>i&&(i=qt(t)),(l>.001||-.001>l)&&(bi(o.line,i),C(o.line),o.rest))for(var c=0;c<o.rest.length;c++)C(o.rest[c])}}}function C(e){if(e.widgets)for(var t=0;t<e.widgets.length;++t)e.widgets[t].height=e.widgets[t].node.offsetHeight}function A(e){for(var t=e.display,r={},n={},i=t.gutters.firstChild,o=0;i;i=i.nextSibling,++o)r[e.options.gutters[o]]=i.offsetLeft,n[e.options.gutters[o]]=i.offsetWidth;return{fixedPos:w(t),gutterTotalWidth:t.gutters.offsetWidth,gutterLeft:r,gutterWidth:n,wrapperWidth:t.wrapper.clientWidth}}function k(e,t,r){function n(t){var r=t.nextSibling;return Go&&Jo&&e.display.currentWheelTarget==t?t.style.display="none":t.parentNode.removeChild(t),r}for(var i=e.display,o=e.options.lineNumbers,a=i.lineDiv,s=a.firstChild,l=i.view,c=i.viewFrom,h=0;h<l.length;h++){var u=l[h];if(u.hidden);else if(u.node){for(;s!=u.node;)s=n(s);var f=o&&null!=t&&c>=t&&u.lineNumber;u.changes&&(ro(u.changes,"gutter")>-1&&(f=!1),L(e,u,c,r)),f&&(uo(u.lineNumber),u.lineNumber.appendChild(document.createTextNode(x(e.options,c)))),s=u.node.nextSibling}else{var d=I(e,u,c,r);a.insertBefore(d,s)}c+=u.size}for(;s;)s=n(s)}function L(e,t,r,n){for(var i=0;i<t.changes.length;i++){var o=t.changes[i];"text"==o?D(e,t):"gutter"==o?O(e,t,r,n):"class"==o?U(t):"widget"==o&&z(t,n)}t.changes=null}function P(e){return e.node==e.text&&(e.node=ho("div",null,null,"position: relative"),e.text.parentNode&&e.text.parentNode.replaceChild(e.node,e.text),e.node.appendChild(e.text),Vo&&8>Bo&&(e.node.style.zIndex=2)),e.node}function F(e){var t=e.bgClass?e.bgClass+" "+(e.line.bgClass||""):e.line.bgClass;if(t&&(t+=" CodeMirror-linebackground"),e.background)t?e.background.className=t:(e.background.parentNode.removeChild(e.background),e.background=null);else if(t){var r=P(e);e.background=r.insertBefore(ho("div",null,t),r.firstChild)}}function N(e,t){var r=e.display.externalMeasured;return r&&r.line==t.line?(e.display.externalMeasured=null,t.measure=r.measure,r.built):si(e,t)}function D(e,t){var r=t.text.className,n=N(e,t);t.text==t.node&&(t.node=n.pre),t.text.parentNode.replaceChild(n.pre,t.text),t.text=n.pre,n.bgClass!=t.bgClass||n.textClass!=t.textClass?(t.bgClass=n.bgClass,t.textClass=n.textClass,U(t)):r&&(t.text.className=r)}function U(e){F(e),e.line.wrapClass?P(e).className=e.line.wrapClass:e.node!=e.text&&(e.node.className="");var t=e.textClass?e.textClass+" "+(e.line.textClass||""):e.line.textClass;e.text.className=t||""}function O(e,t,r,n){t.gutter&&(t.node.removeChild(t.gutter),t.gutter=null);var i=t.line.gutterMarkers;if(e.options.lineNumbers||i){var o=P(t),a=t.gutter=o.insertBefore(ho("div",null,"CodeMirror-gutter-wrapper","position: absolute; left: "+(e.options.fixedGutter?n.fixedPos:-n.gutterTotalWidth)+"px"),t.text);if(!e.options.lineNumbers||i&&i["CodeMirror-linenumbers"]||(t.lineNumber=a.appendChild(ho("div",x(e.options,r),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+n.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+e.display.lineNumInnerWidth+"px"))),i)for(var s=0;s<e.options.gutters.length;++s){var l=e.options.gutters[s],c=i.hasOwnProperty(l)&&i[l];c&&a.appendChild(ho("div",[c],"CodeMirror-gutter-elt","left: "+n.gutterLeft[l]+"px; width: "+n.gutterWidth[l]+"px"))}}}function z(e,t){e.alignable&&(e.alignable=null);for(var r,n=e.node.firstChild;n;n=r){var r=n.nextSibling;"CodeMirror-linewidget"==n.className&&e.node.removeChild(n)}V(e,t)}function I(e,t,r,n){var i=N(e,t);return t.text=t.node=i.pre,i.bgClass&&(t.bgClass=i.bgClass),i.textClass&&(t.textClass=i.textClass),U(t),O(e,t,r,n),V(t,n),t.node}function V(e,t){if(B(e.line,e,t,!0),e.rest)for(var r=0;r<e.rest.length;r++)B(e.rest[r],e,t,!1)}function B(e,t,r,n){if(e.widgets)for(var i=P(t),o=0,a=e.widgets;o<a.length;++o){var s=a[o],l=ho("div",[s.node],"CodeMirror-linewidget");s.handleMouseEvents||(l.ignoreEvents=!0),G(s,l,t,r),n&&s.above?i.insertBefore(l,t.gutter||t.text):i.appendChild(l),Xi(s,"redraw")}}function G(e,t,r,n){if(e.noHScroll){(r.alignable||(r.alignable=[])).push(t);var i=n.wrapperWidth;t.style.left=n.fixedPos+"px",e.coverGutter||(i-=n.gutterTotalWidth,t.style.paddingLeft=n.gutterTotalWidth+"px"),t.style.width=i+"px"}e.coverGutter&&(t.style.zIndex=5,t.style.position="relative",e.noHScroll||(t.style.marginLeft=-n.gutterTotalWidth+"px"))}function j(e){return aa(e.line,e.ch)}function W(e,t){return sa(e,t)<0?t:e}function X(e,t){return sa(e,t)<0?e:t}function q(e,t){this.ranges=e,this.primIndex=t}function Y(e,t){this.anchor=e,this.head=t}function K(e,t){var r=e[t];e.sort(function(e,t){return sa(e.from(),t.from())}),t=ro(e,r);for(var n=1;n<e.length;n++){var i=e[n],o=e[n-1];if(sa(o.to(),i.from())>=0){var a=X(o.from(),i.from()),s=W(o.to(),i.to()),l=o.empty()?i.from()==i.head:o.from()==o.head;t>=n&&--t,e.splice(--n,2,new Y(l?s:a,l?a:s))}}return new q(e,t)}function Q(e,t){return new q([new Y(e,t||e)],0)}function Z(e,t){return Math.max(e.first,Math.min(t,e.first+e.size-1))}function $(e,t){if(t.line<e.first)return aa(e.first,0);var r=e.first+e.size-1;return t.line>r?aa(r,Ti(e,r).text.length):J(t,Ti(e,t.line).text.length)}function J(e,t){var r=e.ch;return null==r||r>t?aa(e.line,t):0>r?aa(e.line,0):e}function et(e,t){return t>=e.first&&t<e.first+e.size}function tt(e,t){for(var r=[],n=0;n<t.length;n++)r[n]=$(e,t[n]);return r}function rt(e,t,r,n){if(e.cm&&e.cm.display.shift||e.extend){var i=t.anchor;if(n){var o=sa(r,i)<0;o!=sa(n,i)<0?(i=r,r=n):o!=sa(r,n)<0&&(r=n)}return new Y(i,r)}return new Y(n||r,r)}function nt(e,t,r,n){ct(e,new q([rt(e,e.sel.primary(),t,r)],0),n)}function it(e,t,r){for(var n=[],i=0;i<e.sel.ranges.length;i++)n[i]=rt(e,e.sel.ranges[i],t[i],null);var o=K(n,e.sel.primIndex);ct(e,o,r)}function ot(e,t,r,n){var i=e.sel.ranges.slice(0);i[t]=r,ct(e,K(i,e.sel.primIndex),n)}function at(e,t,r,n){ct(e,Q(t,r),n)}function st(e,t){var r={ranges:t.ranges,update:function(t){this.ranges=[];for(var r=0;r<t.length;r++)this.ranges[r]=new Y($(e,t[r].anchor),$(e,t[r].head))}};return $a(e,"beforeSelectionChange",e,r),e.cm&&$a(e.cm,"beforeSelectionChange",e.cm,r),r.ranges!=t.ranges?K(r.ranges,r.ranges.length-1):t}function lt(e,t,r){var n=e.history.done,i=to(n);i&&i.ranges?(n[n.length-1]=t,ht(e,t,r)):ct(e,t,r)}function ct(e,t,r){ht(e,t,r),Fi(e,e.sel,e.cm?e.cm.curOp.id:0/0,r)}function ht(e,t,r){(Qi(e,"beforeSelectionChange")||e.cm&&Qi(e.cm,"beforeSelectionChange"))&&(t=st(e,t));var n=r&&r.bias||(sa(t.primary().head,e.sel.primary().head)<0?-1:1);ut(e,dt(e,t,n,!0)),r&&r.scroll===!1||!e.cm||ln(e.cm)}function ut(e,t){t.equals(e.sel)||(e.sel=t,e.cm&&(e.cm.curOp.updateInput=e.cm.curOp.selectionChanged=!0,Ki(e.cm)),Xi(e,"cursorActivity",e))}function ft(e){ut(e,dt(e,e.sel,null,!1),rs)}function dt(e,t,r,n){for(var i,o=0;o<t.ranges.length;o++){var a=t.ranges[o],s=pt(e,a.anchor,r,n),l=pt(e,a.head,r,n);(i||s!=a.anchor||l!=a.head)&&(i||(i=t.ranges.slice(0,o)),i[o]=new Y(s,l))}return i?K(i,t.primIndex):t}function pt(e,t,r,n){var i=!1,o=t,a=r||1;e.cantEdit=!1;e:for(;;){var s=Ti(e,o.line);if(s.markedSpans)for(var l=0;l<s.markedSpans.length;++l){var c=s.markedSpans[l],h=c.marker;if((null==c.from||(h.inclusiveLeft?c.from<=o.ch:c.from<o.ch))&&(null==c.to||(h.inclusiveRight?c.to>=o.ch:c.to>o.ch))){if(n&&($a(h,"beforeCursorEnter"),h.explicitlyCleared)){if(s.markedSpans){--l;continue}break}if(!h.atomic)continue;var u=h.find(0>a?-1:1);if(0==sa(u,o)&&(u.ch+=a,u.ch<0?u=u.line>e.first?$(e,aa(u.line-1)):null:u.ch>s.text.length&&(u=u.line<e.first+e.size-1?aa(u.line+1,0):null),!u)){if(i)return n?(e.cantEdit=!0,aa(e.first,0)):pt(e,t,r,!0);i=!0,u=t,a=-a}o=u;continue e}}return o}}function mt(e){for(var t=e.display,r=e.doc,n=document.createDocumentFragment(),i=document.createDocumentFragment(),o=0;o<r.sel.ranges.length;o++){var a=r.sel.ranges[o],s=a.empty();(s||e.options.showCursorWhenSelecting)&&gt(e,a,n),s||vt(e,a,i)}if(e.options.moveInputWithCursor){var l=Bt(e,r.sel.primary().head,"div"),c=t.wrapper.getBoundingClientRect(),h=t.lineDiv.getBoundingClientRect(),u=Math.max(0,Math.min(t.wrapper.clientHeight-10,l.top+h.top-c.top)),f=Math.max(0,Math.min(t.wrapper.clientWidth-10,l.left+h.left-c.left));t.inputDiv.style.top=u+"px",t.inputDiv.style.left=f+"px"}fo(t.cursorDiv,n),fo(t.selectionDiv,i)}function gt(e,t,r){var n=Bt(e,t.head,"div",null,null,!e.options.singleCursorHeightPerLine),i=r.appendChild(ho("div","","CodeMirror-cursor"));if(i.style.left=n.left+"px",i.style.top=n.top+"px",i.style.height=Math.max(0,n.bottom-n.top)*e.options.cursorHeight+"px",n.other){var o=r.appendChild(ho("div","","CodeMirror-cursor CodeMirror-secondarycursor"));o.style.display="",o.style.left=n.other.left+"px",o.style.top=n.other.top+"px",o.style.height=.85*(n.other.bottom-n.other.top)+"px"}}function vt(e,t,r){function n(e,t,r,n){0>t&&(t=0),t=Math.round(t),n=Math.round(n),s.appendChild(ho("div",null,"CodeMirror-selected","position: absolute; left: "+e+"px; top: "+t+"px; width: "+(null==r?h-e:r)+"px; height: "+(n-t)+"px"))}function i(t,r,i){function o(r,n){return Vt(e,aa(t,r),"div",u,n)}var s,l,u=Ti(a,t),f=u.text.length;return Ho(Mi(u),r||0,null==i?f:i,function(e,t,a){var u,d,p,m=o(e,"left");if(e==t)u=m,d=p=m.left;else{if(u=o(t-1,"right"),"rtl"==a){var g=m;m=u,u=g}d=m.left,p=u.right}null==r&&0==e&&(d=c),u.top-m.top>3&&(n(d,m.top,null,m.bottom),d=c,m.bottom<u.top&&n(d,m.bottom,null,u.top)),null==i&&t==f&&(p=h),(!s||m.top<s.top||m.top==s.top&&m.left<s.left)&&(s=m),(!l||u.bottom>l.bottom||u.bottom==l.bottom&&u.right>l.right)&&(l=u),c+1>d&&(d=c),n(d,u.top,p-d,u.bottom)}),{start:s,end:l}}var o=e.display,a=e.doc,s=document.createDocumentFragment(),l=_t(e.display),c=l.left,h=o.lineSpace.offsetWidth-l.right,u=t.from(),f=t.to();if(u.line==f.line)i(u.line,u.ch,f.ch);else{var d=Ti(a,u.line),p=Ti(a,f.line),m=Bn(d)==Bn(p),g=i(u.line,u.ch,m?d.text.length+1:null).end,v=i(f.line,m?0:null,f.ch).start;m&&(g.top<v.top-2?(n(g.right,g.top,null,g.bottom),n(c,v.top,v.left,v.bottom)):n(g.right,g.top,v.left-g.right,g.bottom)),g.bottom<v.top&&n(c,g.bottom,null,v.top)}r.appendChild(s)}function Et(e){if(e.state.focused){var t=e.display;clearInterval(t.blinker);var r=!0;t.cursorDiv.style.visibility="",e.options.cursorBlinkRate>0?t.blinker=setInterval(function(){t.cursorDiv.style.visibility=(r=!r)?"":"hidden"},e.options.cursorBlinkRate):e.options.cursorBlinkRate<0&&(t.cursorDiv.style.visibility="hidden")}}function yt(e,t){e.doc.mode.startState&&e.doc.frontier<e.display.viewTo&&e.state.highlight.set(t,ao(Tt,e))}function Tt(e){var t=e.doc;if(t.frontier<t.first&&(t.frontier=t.first),!(t.frontier>=e.display.viewTo)){var r=+new Date+e.options.workTime,n=Ma(t.mode,wt(e,t.frontier));Zt(e,function(){t.iter(t.frontier,Math.min(t.first+t.size,e.display.viewTo+500),function(i){if(t.frontier>=e.display.viewFrom){var o=i.styles,a=ni(e,i,n,!0);i.styles=a.styles;var s=i.styleClasses,l=a.classes;l?i.styleClasses=l:s&&(i.styleClasses=null);for(var c=!o||o.length!=i.styles.length||s!=l&&(!s||!l||s.bgClass!=l.bgClass||s.textClass!=l.textClass),h=0;!c&&h<o.length;++h)c=o[h]!=i.styles[h];c&&ir(e,t.frontier,"text"),i.stateAfter=Ma(t.mode,n)}else oi(e,i.text,n),i.stateAfter=t.frontier%5==0?Ma(t.mode,n):null;return++t.frontier,+new Date>r?(yt(e,e.options.workDelay),!0):void 0})})}}function xt(e,t,r){for(var n,i,o=e.doc,a=r?-1:t-(e.doc.mode.innerMode?1e3:100),s=t;s>a;--s){if(s<=o.first)return o.first;var l=Ti(o,s-1);if(l.stateAfter&&(!r||s<=o.frontier))return s;var c=os(l.text,null,e.options.tabSize);(null==i||n>c)&&(i=s-1,n=c)}return i}function wt(e,t,r){var n=e.doc,i=e.display;if(!n.mode.startState)return!0;var o=xt(e,t,r),a=o>n.first&&Ti(n,o-1).stateAfter;return a=a?Ma(n.mode,a):Sa(n.mode),n.iter(o,t,function(r){oi(e,r.text,a);var s=o==t-1||o%5==0||o>=i.viewFrom&&o<i.viewTo;r.stateAfter=s?Ma(n.mode,a):null,++o}),r&&(n.frontier=o),a}function bt(e){return e.lineSpace.offsetTop}function Rt(e){return e.mover.offsetHeight-e.lineSpace.offsetHeight}function _t(e){if(e.cachedPaddingH)return e.cachedPaddingH;var t=fo(e.measure,ho("pre","x")),r=window.getComputedStyle?window.getComputedStyle(t):t.currentStyle,n={left:parseInt(r.paddingLeft),right:parseInt(r.paddingRight)};return isNaN(n.left)||isNaN(n.right)||(e.cachedPaddingH=n),n}function Ht(e,t,r){var n=e.options.lineWrapping,i=n&&e.display.scroller.clientWidth;if(!t.measure.heights||n&&t.measure.width!=i){var o=t.measure.heights=[];if(n){t.measure.width=i;for(var a=t.text.firstChild.getClientRects(),s=0;s<a.length-1;s++){var l=a[s],c=a[s+1];Math.abs(l.bottom-c.bottom)>2&&o.push((l.bottom+c.top)/2-r.top)}}o.push(r.bottom-r.top)}}function Mt(e,t,r){if(e.line==t)return{map:e.measure.map,cache:e.measure.cache};for(var n=0;n<e.rest.length;n++)if(e.rest[n]==t)return{map:e.measure.maps[n],cache:e.measure.caches[n]};for(var n=0;n<e.rest.length;n++)if(Ri(e.rest[n])>r)return{map:e.measure.maps[n],cache:e.measure.caches[n],before:!0}}function St(e,t){t=Bn(t);var r=Ri(t),n=e.display.externalMeasured=new tr(e.doc,t,r);n.lineN=r;var i=n.built=si(e,n);return n.text=i.pre,fo(e.display.lineMeasure,i.pre),n}function Ct(e,t,r,n){return Lt(e,kt(e,t),r,n)}function At(e,t){if(t>=e.display.viewFrom&&t<e.display.viewTo)return e.display.view[ar(e,t)];var r=e.display.externalMeasured;return r&&t>=r.lineN&&t<r.lineN+r.size?r:void 0}function kt(e,t){var r=Ri(t),n=At(e,r);n&&!n.text?n=null:n&&n.changes&&L(e,n,r,A(e)),n||(n=St(e,t));var i=Mt(n,t,r);return{line:t,view:n,rect:null,map:i.map,cache:i.cache,before:i.before,hasHeights:!1}}function Lt(e,t,r,n,i){t.before&&(r=-1);var o,a=r+(n||"");return t.cache.hasOwnProperty(a)?o=t.cache[a]:(t.rect||(t.rect=t.view.text.getBoundingClientRect()),t.hasHeights||(Ht(e,t.view,t.rect),t.hasHeights=!0),o=Pt(e,t,r,n),o.bogus||(t.cache[a]=o)),{left:o.left,right:o.right,top:i?o.rtop:o.top,bottom:i?o.rbottom:o.bottom}}function Pt(e,t,r,n){for(var i,o,a,s,l=t.map,c=0;c<l.length;c+=3){var h=l[c],u=l[c+1];if(h>r?(o=0,a=1,s="left"):u>r?(o=r-h,a=o+1):(c==l.length-3||r==u&&l[c+3]>r)&&(a=u-h,o=a-1,r>=u&&(s="right")),null!=o){if(i=l[c+2],h==u&&n==(i.insertLeft?"left":"right")&&(s=n),"left"==n&&0==o)for(;c&&l[c-2]==l[c-3]&&l[c-1].insertLeft;)i=l[(c-=3)+2],s="left";if("right"==n&&o==u-h)for(;c<l.length-3&&l[c+3]==l[c+4]&&!l[c+5].insertLeft;)i=l[(c+=3)+2],s="right";break}}var f;if(3==i.nodeType){for(;o&&co(t.line.text.charAt(h+o));)--o;for(;u>h+a&&co(t.line.text.charAt(h+a));)++a;if(Vo&&9>Bo&&0==o&&a==u-h)f=i.parentNode.getBoundingClientRect();else if(Vo&&e.options.lineWrapping){var d=ls(i,o,a).getClientRects();f=d.length?d["right"==n?d.length-1:0]:ua}else f=ls(i,o,a).getBoundingClientRect()||ua}else{o>0&&(s=n="right");var d;f=e.options.lineWrapping&&(d=i.getClientRects()).length>1?d["right"==n?d.length-1:0]:i.getBoundingClientRect()}if(Vo&&9>Bo&&!o&&(!f||!f.left&&!f.right)){var p=i.parentNode.getClientRects()[0];f=p?{left:p.left,right:p.left+Yt(e.display),top:p.top,bottom:p.bottom}:ua}for(var m=f.top-t.rect.top,g=f.bottom-t.rect.top,v=(m+g)/2,E=t.view.measure.heights,c=0;c<E.length-1&&!(v<E[c]);c++);var y=c?E[c-1]:0,T=E[c],x={left:("right"==s?f.right:f.left)-t.rect.left,right:("left"==s?f.left:f.right)-t.rect.left,top:y,bottom:T};return f.left||f.right||(x.bogus=!0),e.options.singleCursorHeightPerLine||(x.rtop=m,x.rbottom=g),x}function Ft(e){if(e.measure&&(e.measure.cache={},e.measure.heights=null,e.rest))for(var t=0;t<e.rest.length;t++)e.measure.caches[t]={}}function Nt(e){e.display.externalMeasure=null,uo(e.display.lineMeasure);for(var t=0;t<e.display.view.length;t++)Ft(e.display.view[t])}function Dt(e){Nt(e),e.display.cachedCharWidth=e.display.cachedTextHeight=e.display.cachedPaddingH=null,e.options.lineWrapping||(e.display.maxLineChanged=!0),e.display.lineNumChars=null}function Ut(){return window.pageXOffset||(document.documentElement||document.body).scrollLeft}function Ot(){return window.pageYOffset||(document.documentElement||document.body).scrollTop}function zt(e,t,r,n){if(t.widgets)for(var i=0;i<t.widgets.length;++i)if(t.widgets[i].above){var o=Kn(t.widgets[i]);r.top+=o,r.bottom+=o}if("line"==n)return r;n||(n="local");var a=Hi(t);if("local"==n?a+=bt(e.display):a-=e.display.viewOffset,"page"==n||"window"==n){var s=e.display.lineSpace.getBoundingClientRect();a+=s.top+("window"==n?0:Ot());var l=s.left+("window"==n?0:Ut());r.left+=l,r.right+=l}return r.top+=a,r.bottom+=a,r}function It(e,t,r){if("div"==r)return t;var n=t.left,i=t.top;if("page"==r)n-=Ut(),i-=Ot();else if("local"==r||!r){var o=e.display.sizer.getBoundingClientRect();n+=o.left,i+=o.top}var a=e.display.lineSpace.getBoundingClientRect();return{left:n-a.left,top:i-a.top}}function Vt(e,t,r,n,i){return n||(n=Ti(e.doc,t.line)),zt(e,n,Ct(e,n,t.ch,i),r)}function Bt(e,t,r,n,i,o){function a(t,a){var s=Lt(e,i,t,a?"right":"left",o);return a?s.left=s.right:s.right=s.left,zt(e,n,s,r)
}function s(e,t){var r=l[t],n=r.level%2;return e==Mo(r)&&t&&r.level<l[t-1].level?(r=l[--t],e=So(r)-(r.level%2?0:1),n=!0):e==So(r)&&t<l.length-1&&r.level<l[t+1].level&&(r=l[++t],e=Mo(r)-r.level%2,n=!1),n&&e==r.to&&e>r.from?a(e-1):a(e,n)}n=n||Ti(e.doc,t.line),i||(i=kt(e,n));var l=Mi(n),c=t.ch;if(!l)return a(c);var h=Fo(l,c),u=s(c,h);return null!=xs&&(u.other=s(c,xs)),u}function Gt(e,t){var r=0,t=$(e.doc,t);e.options.lineWrapping||(r=Yt(e.display)*t.ch);var n=Ti(e.doc,t.line),i=Hi(n)+bt(e.display);return{left:r,right:r,top:i,bottom:i+n.height}}function jt(e,t,r,n){var i=aa(e,t);return i.xRel=n,r&&(i.outside=!0),i}function Wt(e,t,r){var n=e.doc;if(r+=e.display.viewOffset,0>r)return jt(n.first,0,!0,-1);var i=_i(n,r),o=n.first+n.size-1;if(i>o)return jt(n.first+n.size-1,Ti(n,o).text.length,!0,1);0>t&&(t=0);for(var a=Ti(n,i);;){var s=Xt(e,a,i,t,r),l=In(a),c=l&&l.find(0,!0);if(!l||!(s.ch>c.from.ch||s.ch==c.from.ch&&s.xRel>0))return s;i=Ri(a=c.to.line)}}function Xt(e,t,r,n,i){function o(n){var i=Bt(e,aa(r,n),"line",t,c);return s=!0,a>i.bottom?i.left-l:a<i.top?i.left+l:(s=!1,i.left)}var a=i-Hi(t),s=!1,l=2*e.display.wrapper.clientWidth,c=kt(e,t),h=Mi(t),u=t.text.length,f=Co(t),d=Ao(t),p=o(f),m=s,g=o(d),v=s;if(n>g)return jt(r,d,v,1);for(;;){if(h?d==f||d==Do(t,f,1):1>=d-f){for(var E=p>n||g-n>=n-p?f:d,y=n-(E==f?p:g);co(t.text.charAt(E));)++E;var T=jt(r,E,E==f?m:v,-1>y?-1:y>1?1:0);return T}var x=Math.ceil(u/2),w=f+x;if(h){w=f;for(var b=0;x>b;++b)w=Do(t,w,1)}var R=o(w);R>n?(d=w,g=R,(v=s)&&(g+=1e3),u=x):(f=w,p=R,m=s,u-=x)}}function qt(e){if(null!=e.cachedTextHeight)return e.cachedTextHeight;if(null==la){la=ho("pre");for(var t=0;49>t;++t)la.appendChild(document.createTextNode("x")),la.appendChild(ho("br"));la.appendChild(document.createTextNode("x"))}fo(e.measure,la);var r=la.offsetHeight/50;return r>3&&(e.cachedTextHeight=r),uo(e.measure),r||1}function Yt(e){if(null!=e.cachedCharWidth)return e.cachedCharWidth;var t=ho("span","xxxxxxxxxx"),r=ho("pre",[t]);fo(e.measure,r);var n=t.getBoundingClientRect(),i=(n.right-n.left)/10;return i>2&&(e.cachedCharWidth=i),i||10}function Kt(e){e.curOp={viewChanged:!1,startHeight:e.doc.height,forceUpdate:!1,updateInput:null,typing:!1,changeObjs:null,cursorActivityHandlers:null,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,id:++fa},Ja++||(Xa=[])}function Qt(e){var t=e.curOp,r=e.doc,n=e.display;if(e.curOp=null,t.updateMaxLine&&d(e),t.viewChanged||t.forceUpdate||null!=t.scrollTop||t.scrollToPos&&(t.scrollToPos.from.line<n.viewFrom||t.scrollToPos.to.line>=n.viewTo)||n.maxLineChanged&&e.options.lineWrapping){var i=b(e,{top:t.scrollTop,ensure:t.scrollToPos},t.forceUpdate);e.display.scroller.offsetHeight&&(e.doc.scrollTop=e.display.scroller.scrollTop)}if(!i&&t.selectionChanged&&mt(e),i||t.startHeight==e.doc.height||v(e),null==n.wheelStartX||null==t.scrollTop&&null==t.scrollLeft&&!t.scrollToPos||(n.wheelStartX=n.wheelStartY=null),null!=t.scrollTop&&n.scroller.scrollTop!=t.scrollTop){var o=Math.max(0,Math.min(n.scroller.scrollHeight-n.scroller.clientHeight,t.scrollTop));n.scroller.scrollTop=n.scrollbarV.scrollTop=r.scrollTop=o}if(null!=t.scrollLeft&&n.scroller.scrollLeft!=t.scrollLeft){var a=Math.max(0,Math.min(n.scroller.scrollWidth-n.scroller.clientWidth,t.scrollLeft));n.scroller.scrollLeft=n.scrollbarH.scrollLeft=r.scrollLeft=a,y(e)}if(t.scrollToPos){var s=nn(e,$(e.doc,t.scrollToPos.from),$(e.doc,t.scrollToPos.to),t.scrollToPos.margin);t.scrollToPos.isCursor&&e.state.focused&&rn(e,s)}t.selectionChanged&&Et(e),e.state.focused&&t.updateInput&&dr(e,t.typing);var l=t.maybeHiddenMarkers,c=t.maybeUnhiddenMarkers;if(l)for(var h=0;h<l.length;++h)l[h].lines.length||$a(l[h],"hide");if(c)for(var h=0;h<c.length;++h)c[h].lines.length&&$a(c[h],"unhide");var u;if(--Ja||(u=Xa,Xa=null),t.changeObjs&&$a(e,"changes",e,t.changeObjs),u)for(var h=0;h<u.length;++h)u[h]();if(t.cursorActivityHandlers)for(var h=0;h<t.cursorActivityHandlers.length;h++)t.cursorActivityHandlers[h](e)}function Zt(e,t){if(e.curOp)return t();Kt(e);try{return t()}finally{Qt(e)}}function $t(e,t){return function(){if(e.curOp)return t.apply(e,arguments);Kt(e);try{return t.apply(e,arguments)}finally{Qt(e)}}}function Jt(e){return function(){if(this.curOp)return e.apply(this,arguments);Kt(this);try{return e.apply(this,arguments)}finally{Qt(this)}}}function er(e){return function(){var t=this.cm;if(!t||t.curOp)return e.apply(this,arguments);Kt(t);try{return e.apply(this,arguments)}finally{Qt(t)}}}function tr(e,t,r){this.line=t,this.rest=Gn(t),this.size=this.rest?Ri(to(this.rest))-r+1:1,this.node=this.text=null,this.hidden=Xn(e,t)}function rr(e,t,r){for(var n,i=[],o=t;r>o;o=n){var a=new tr(e.doc,Ti(e.doc,o),o);n=o+a.size,i.push(a)}return i}function nr(e,t,r,n){null==t&&(t=e.doc.first),null==r&&(r=e.doc.first+e.doc.size),n||(n=0);var i=e.display;if(n&&r<i.viewTo&&(null==i.updateLineNumbers||i.updateLineNumbers>t)&&(i.updateLineNumbers=t),e.curOp.viewChanged=!0,t>=i.viewTo)oa&&jn(e.doc,t)<i.viewTo&&or(e);else if(r<=i.viewFrom)oa&&Wn(e.doc,r+n)>i.viewFrom?or(e):(i.viewFrom+=n,i.viewTo+=n);else if(t<=i.viewFrom&&r>=i.viewTo)or(e);else if(t<=i.viewFrom){var o=sr(e,r,r+n,1);o?(i.view=i.view.slice(o.index),i.viewFrom=o.lineN,i.viewTo+=n):or(e)}else if(r>=i.viewTo){var o=sr(e,t,t,-1);o?(i.view=i.view.slice(0,o.index),i.viewTo=o.lineN):or(e)}else{var a=sr(e,t,t,-1),s=sr(e,r,r+n,1);a&&s?(i.view=i.view.slice(0,a.index).concat(rr(e,a.lineN,s.lineN)).concat(i.view.slice(s.index)),i.viewTo+=n):or(e)}var l=i.externalMeasured;l&&(r<l.lineN?l.lineN+=n:t<l.lineN+l.size&&(i.externalMeasured=null))}function ir(e,t,r){e.curOp.viewChanged=!0;var n=e.display,i=e.display.externalMeasured;if(i&&t>=i.lineN&&t<i.lineN+i.size&&(n.externalMeasured=null),!(t<n.viewFrom||t>=n.viewTo)){var o=n.view[ar(e,t)];if(null!=o.node){var a=o.changes||(o.changes=[]);-1==ro(a,r)&&a.push(r)}}}function or(e){e.display.viewFrom=e.display.viewTo=e.doc.first,e.display.view=[],e.display.viewOffset=0}function ar(e,t){if(t>=e.display.viewTo)return null;if(t-=e.display.viewFrom,0>t)return null;for(var r=e.display.view,n=0;n<r.length;n++)if(t-=r[n].size,0>t)return n}function sr(e,t,r,n){var i,o=ar(e,t),a=e.display.view;if(!oa||r==e.doc.first+e.doc.size)return{index:o,lineN:r};for(var s=0,l=e.display.viewFrom;o>s;s++)l+=a[s].size;if(l!=t){if(n>0){if(o==a.length-1)return null;i=l+a[o].size-t,o++}else i=l-t;t+=i,r+=i}for(;jn(e.doc,r)!=r;){if(o==(0>n?0:a.length-1))return null;r+=n*a[o-(0>n?1:0)].size,o+=n}return{index:o,lineN:r}}function lr(e,t,r){var n=e.display,i=n.view;0==i.length||t>=n.viewTo||r<=n.viewFrom?(n.view=rr(e,t,r),n.viewFrom=t):(n.viewFrom>t?n.view=rr(e,t,n.viewFrom).concat(n.view):n.viewFrom<t&&(n.view=n.view.slice(ar(e,t))),n.viewFrom=t,n.viewTo<r?n.view=n.view.concat(rr(e,n.viewTo,r)):n.viewTo>r&&(n.view=n.view.slice(0,ar(e,r)))),n.viewTo=r}function cr(e){for(var t=e.display.view,r=0,n=0;n<t.length;n++){var i=t[n];i.hidden||i.node&&!i.changes||++r}return r}function hr(e){e.display.pollingFast||e.display.poll.set(e.options.pollInterval,function(){fr(e),e.state.focused&&hr(e)})}function ur(e){function t(){var n=fr(e);n||r?(e.display.pollingFast=!1,hr(e)):(r=!0,e.display.poll.set(60,t))}var r=!1;e.display.pollingFast=!0,e.display.poll.set(20,t)}function fr(e){var t=e.display.input,r=e.display.prevInput,n=e.doc;if(!e.state.focused||Es(t)&&!r||gr(e)||e.options.disableInput)return!1;e.state.pasteIncoming&&e.state.fakedLastChar&&(t.value=t.value.substring(0,t.value.length-1),e.state.fakedLastChar=!1);var i=t.value;if(i==r&&!e.somethingSelected())return!1;if(Vo&&Bo>=9&&e.display.inputHasSelection===i)return dr(e),!1;var o=!e.curOp;o&&Kt(e),e.display.shift=!1,8203!=i.charCodeAt(0)||n.sel!=e.display.selForContextMenu||r||(r="");for(var a=0,s=Math.min(r.length,i.length);s>a&&r.charCodeAt(a)==i.charCodeAt(a);)++a;for(var l=i.slice(a),c=vs(l),h=e.state.pasteIncoming&&c.length>1&&n.sel.ranges.length==c.length,u=n.sel.ranges.length-1;u>=0;u--){var f=n.sel.ranges[u],d=f.from(),p=f.to();a<r.length?d=aa(d.line,d.ch-(r.length-a)):e.state.overwrite&&f.empty()&&!e.state.pasteIncoming&&(p=aa(p.line,Math.min(Ti(n,p.line).text.length,p.ch+to(c).length)));var m=e.curOp.updateInput,g={from:d,to:p,text:h?[c[u]]:c,origin:e.state.pasteIncoming?"paste":e.state.cutIncoming?"cut":"+input"};if(Kr(e.doc,g),Xi(e,"inputRead",e,g),l&&!e.state.pasteIncoming&&e.options.electricChars&&e.options.smartIndent&&f.head.ch<100&&(!u||n.sel.ranges[u-1].head.line!=f.head.line)){var v=e.getModeAt(f.head);if(v.electricChars){for(var E=0;E<v.electricChars.length;E++)if(l.indexOf(v.electricChars.charAt(E))>-1){hn(e,f.head.line,"smart");break}}else if(v.electricInput){var y=Ea(g);v.electricInput.test(Ti(n,y.line).text.slice(0,y.ch))&&hn(e,f.head.line,"smart")}}}return ln(e),e.curOp.updateInput=m,e.curOp.typing=!0,i.length>1e3||i.indexOf("\n")>-1?t.value=e.display.prevInput="":e.display.prevInput=i,o&&Qt(e),e.state.pasteIncoming=e.state.cutIncoming=!1,!0}function dr(e,t){var r,n,i=e.doc;if(e.somethingSelected()){e.display.prevInput="";var o=i.sel.primary();r=ys&&(o.to().line-o.from().line>100||(n=e.getSelection()).length>1e3);var a=r?"-":n||e.getSelection();e.display.input.value=a,e.state.focused&&ss(e.display.input),Vo&&Bo>=9&&(e.display.inputHasSelection=a)}else t||(e.display.prevInput=e.display.input.value="",Vo&&Bo>=9&&(e.display.inputHasSelection=null));e.display.inaccurateSelection=r}function pr(e){"nocursor"==e.options.readOnly||$o&&mo()==e.display.input||e.display.input.focus()}function mr(e){e.state.focused||(pr(e),Ir(e))}function gr(e){return e.options.readOnly||e.doc.cantEdit}function vr(e){function t(){e.state.focused&&setTimeout(ao(pr,e),0)}function r(t){Yi(e,t)||Ka(t)}function n(t){if(e.somethingSelected())i.inaccurateSelection&&(i.prevInput="",i.inaccurateSelection=!1,i.input.value=e.getSelection(),ss(i.input));else{for(var r="",n=[],o=0;o<e.doc.sel.ranges.length;o++){var a=e.doc.sel.ranges[o].head.line,s={anchor:aa(a,0),head:aa(a+1,0)};n.push(s),r+=e.getRange(s.anchor,s.head)}"cut"==t.type?e.setSelections(n,null,rs):(i.prevInput="",i.input.value=r,ss(i.input))}"cut"==t.type&&(e.state.cutIncoming=!0)}var i=e.display;Qa(i.scroller,"mousedown",$t(e,xr)),Vo&&11>Bo?Qa(i.scroller,"dblclick",$t(e,function(t){if(!Yi(e,t)){var r=Tr(e,t);if(r&&!Hr(e,t)&&!yr(e.display,t)){qa(t);var n=mn(e,r);nt(e.doc,n.anchor,n.head)}}})):Qa(i.scroller,"dblclick",function(t){Yi(e,t)||qa(t)}),Qa(i.lineSpace,"selectstart",function(e){yr(i,e)||qa(e)}),na||Qa(i.scroller,"contextmenu",function(t){Br(e,t)}),Qa(i.scroller,"scroll",function(){i.scroller.clientHeight&&(Cr(e,i.scroller.scrollTop),Ar(e,i.scroller.scrollLeft,!0),$a(e,"scroll",e))}),Qa(i.scrollbarV,"scroll",function(){i.scroller.clientHeight&&Cr(e,i.scrollbarV.scrollTop)}),Qa(i.scrollbarH,"scroll",function(){i.scroller.clientHeight&&Ar(e,i.scrollbarH.scrollLeft)}),Qa(i.scroller,"mousewheel",function(t){kr(e,t)}),Qa(i.scroller,"DOMMouseScroll",function(t){kr(e,t)}),Qa(i.scrollbarH,"mousedown",t),Qa(i.scrollbarV,"mousedown",t),Qa(i.wrapper,"scroll",function(){i.wrapper.scrollTop=i.wrapper.scrollLeft=0}),Qa(i.input,"keyup",$t(e,Or)),Qa(i.input,"input",function(){Vo&&Bo>=9&&e.display.inputHasSelection&&(e.display.inputHasSelection=null),ur(e)}),Qa(i.input,"keydown",$t(e,Dr)),Qa(i.input,"keypress",$t(e,zr)),Qa(i.input,"focus",ao(Ir,e)),Qa(i.input,"blur",ao(Vr,e)),e.options.dragDrop&&(Qa(i.scroller,"dragstart",function(t){Sr(e,t)}),Qa(i.scroller,"dragenter",r),Qa(i.scroller,"dragover",r),Qa(i.scroller,"drop",$t(e,Mr))),Qa(i.scroller,"paste",function(t){yr(i,t)||(e.state.pasteIncoming=!0,pr(e),ur(e))}),Qa(i.input,"paste",function(){if(Go&&!e.state.fakedLastChar&&!(new Date-e.state.lastMiddleDown<200)){var t=i.input.selectionStart,r=i.input.selectionEnd;i.input.value+="$",i.input.selectionEnd=r,i.input.selectionStart=t,e.state.fakedLastChar=!0}e.state.pasteIncoming=!0,ur(e)}),Qa(i.input,"cut",n),Qa(i.input,"copy",n),Yo&&Qa(i.sizer,"mouseup",function(){mo()==i.input&&i.input.blur(),pr(e)})}function Er(e){var t=e.display;t.cachedCharWidth=t.cachedTextHeight=t.cachedPaddingH=null,e.setSize()}function yr(e,t){for(var r=ji(t);r!=e.wrapper;r=r.parentNode)if(!r||r.ignoreEvents||r.parentNode==e.sizer&&r!=e.mover)return!0}function Tr(e,t,r,n){var i=e.display;if(!r){var o=ji(t);if(o==i.scrollbarH||o==i.scrollbarV||o==i.scrollbarFiller||o==i.gutterFiller)return null}var a,s,l=i.lineSpace.getBoundingClientRect();try{a=t.clientX-l.left,s=t.clientY-l.top}catch(t){return null}var c,h=Wt(e,a,s);if(n&&1==h.xRel&&(c=Ti(e.doc,h.line).text).length==h.ch){var u=os(c,c.length,e.options.tabSize)-c.length;h=aa(h.line,Math.max(0,Math.round((a-_t(e.display).left)/Yt(e.display))-u))}return h}function xr(e){if(!Yi(this,e)){var t=this,r=t.display;if(r.shift=e.shiftKey,yr(r,e))return void(Go||(r.scroller.draggable=!1,setTimeout(function(){r.scroller.draggable=!0},100)));if(!Hr(t,e)){var n=Tr(t,e);switch(window.focus(),Wi(e)){case 1:n?wr(t,e,n):ji(e)==r.scroller&&qa(e);break;case 2:Go&&(t.state.lastMiddleDown=+new Date),n&&nt(t.doc,n),setTimeout(ao(pr,t),20),qa(e);break;case 3:na&&Br(t,e)}}}}function wr(e,t,r){setTimeout(ao(mr,e),0);var n,i=+new Date;ha&&ha.time>i-400&&0==sa(ha.pos,r)?n="triple":ca&&ca.time>i-400&&0==sa(ca.pos,r)?(n="double",ha={time:i,pos:r}):(n="single",ca={time:i,pos:r});var o=e.doc.sel,a=Jo?t.metaKey:t.ctrlKey;e.options.dragDrop&&gs&&!gr(e)&&"single"==n&&o.contains(r)>-1&&o.somethingSelected()?br(e,t,r,a):Rr(e,t,r,n,a)}function br(e,t,r,n){var i=e.display,o=$t(e,function(a){Go&&(i.scroller.draggable=!1),e.state.draggingText=!1,Za(document,"mouseup",o),Za(i.scroller,"drop",o),Math.abs(t.clientX-a.clientX)+Math.abs(t.clientY-a.clientY)<10&&(qa(a),n||nt(e.doc,r),pr(e),Vo&&9==Bo&&setTimeout(function(){document.body.focus(),pr(e)},20))});Go&&(i.scroller.draggable=!0),e.state.draggingText=o,i.scroller.dragDrop&&i.scroller.dragDrop(),Qa(document,"mouseup",o),Qa(i.scroller,"drop",o)}function Rr(e,t,r,n,i){function o(t){if(0!=sa(m,t))if(m=t,"rect"==n){for(var i=[],o=e.options.tabSize,a=os(Ti(c,r.line).text,r.ch,o),s=os(Ti(c,t.line).text,t.ch,o),l=Math.min(a,s),d=Math.max(a,s),p=Math.min(r.line,t.line),g=Math.min(e.lastLine(),Math.max(r.line,t.line));g>=p;p++){var v=Ti(c,p).text,E=Ji(v,l,o);l==d?i.push(new Y(aa(p,E),aa(p,E))):v.length>E&&i.push(new Y(aa(p,E),aa(p,Ji(v,d,o))))}i.length||i.push(new Y(r,r)),ct(c,K(f.ranges.slice(0,u).concat(i),u),{origin:"*mouse",scroll:!1}),e.scrollIntoView(t)}else{var y=h,T=y.anchor,x=t;if("single"!=n){if("double"==n)var w=mn(e,t);else var w=new Y(aa(t.line,0),$(c,aa(t.line+1,0)));sa(w.anchor,T)>0?(x=w.head,T=X(y.from(),w.anchor)):(x=w.anchor,T=W(y.to(),w.head))}var i=f.ranges.slice(0);i[u]=new Y($(c,T),x),ct(c,K(i,u),ns)}}function a(t){var r=++v,i=Tr(e,t,!0,"rect"==n);if(i)if(0!=sa(i,m)){mr(e),o(i);var s=E(l,c);(i.line>=s.to||i.line<s.from)&&setTimeout($t(e,function(){v==r&&a(t)}),150)}else{var h=t.clientY<g.top?-20:t.clientY>g.bottom?20:0;h&&setTimeout($t(e,function(){v==r&&(l.scroller.scrollTop+=h,a(t))}),50)}}function s(t){v=1/0,qa(t),pr(e),Za(document,"mousemove",y),Za(document,"mouseup",T),c.history.lastSelOrigin=null}var l=e.display,c=e.doc;qa(t);var h,u,f=c.sel;if(i&&!t.shiftKey?(u=c.sel.contains(r),h=u>-1?c.sel.ranges[u]:new Y(r,r)):h=c.sel.primary(),t.altKey)n="rect",i||(h=new Y(r,r)),r=Tr(e,t,!0,!0),u=-1;else if("double"==n){var d=mn(e,r);h=e.display.shift||c.extend?rt(c,h,d.anchor,d.head):d}else if("triple"==n){var p=new Y(aa(r.line,0),$(c,aa(r.line+1,0)));h=e.display.shift||c.extend?rt(c,h,p.anchor,p.head):p}else h=rt(c,h,r);i?u>-1?ot(c,u,h,ns):(u=c.sel.ranges.length,ct(c,K(c.sel.ranges.concat([h]),u),{scroll:!1,origin:"*mouse"})):(u=0,ct(c,new q([h],0),ns),f=c.sel);var m=r,g=l.wrapper.getBoundingClientRect(),v=0,y=$t(e,function(e){Wi(e)?a(e):s(e)}),T=$t(e,s);Qa(document,"mousemove",y),Qa(document,"mouseup",T)}function _r(e,t,r,n,i){try{var o=t.clientX,a=t.clientY}catch(t){return!1}if(o>=Math.floor(e.display.gutters.getBoundingClientRect().right))return!1;n&&qa(t);var s=e.display,l=s.lineDiv.getBoundingClientRect();if(a>l.bottom||!Qi(e,r))return Gi(t);a-=l.top-s.viewOffset;for(var c=0;c<e.options.gutters.length;++c){var h=s.gutters.childNodes[c];if(h&&h.getBoundingClientRect().right>=o){var u=_i(e.doc,a),f=e.options.gutters[c];return i(e,r,e,u,f,t),Gi(t)}}}function Hr(e,t){return _r(e,t,"gutterClick",!0,Xi)}function Mr(e){var t=this;if(!Yi(t,e)&&!yr(t.display,e)){qa(e),Vo&&(da=+new Date);var r=Tr(t,e,!0),n=e.dataTransfer.files;if(r&&!gr(t))if(n&&n.length&&window.FileReader&&window.File)for(var i=n.length,o=Array(i),a=0,s=function(e,n){var s=new FileReader;s.onload=$t(t,function(){if(o[n]=s.result,++a==i){r=$(t.doc,r);var e={from:r,to:r,text:vs(o.join("\n")),origin:"paste"};Kr(t.doc,e),lt(t.doc,Q(r,Ea(e)))}}),s.readAsText(e)},l=0;i>l;++l)s(n[l],l);else{if(t.state.draggingText&&t.doc.sel.contains(r)>-1)return t.state.draggingText(e),void setTimeout(ao(pr,t),20);try{var o=e.dataTransfer.getData("Text");if(o){if(t.state.draggingText&&!(Jo?e.metaKey:e.ctrlKey))var c=t.listSelections();if(ht(t.doc,Q(r,r)),c)for(var l=0;l<c.length;++l)tn(t.doc,"",c[l].anchor,c[l].head,"drag");t.replaceSelection(o,"around","paste"),pr(t)}}catch(e){}}}}function Sr(e,t){if(Vo&&(!e.state.draggingText||+new Date-da<100))return void Ka(t);if(!Yi(e,t)&&!yr(e.display,t)&&(t.dataTransfer.setData("Text",e.getSelection()),t.dataTransfer.setDragImage&&!qo)){var r=ho("img",null,null,"position: fixed; left: 0; top: 0;");r.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",Xo&&(r.width=r.height=1,e.display.wrapper.appendChild(r),r._top=r.offsetTop),t.dataTransfer.setDragImage(r,0,0),Xo&&r.parentNode.removeChild(r)}}function Cr(e,t){Math.abs(e.doc.scrollTop-t)<2||(e.doc.scrollTop=t,Oo||b(e,{top:t}),e.display.scroller.scrollTop!=t&&(e.display.scroller.scrollTop=t),e.display.scrollbarV.scrollTop!=t&&(e.display.scrollbarV.scrollTop=t),Oo&&b(e),yt(e,100))}function Ar(e,t,r){(r?t==e.doc.scrollLeft:Math.abs(e.doc.scrollLeft-t)<2)||(t=Math.min(t,e.display.scroller.scrollWidth-e.display.scroller.clientWidth),e.doc.scrollLeft=t,y(e),e.display.scroller.scrollLeft!=t&&(e.display.scroller.scrollLeft=t),e.display.scrollbarH.scrollLeft!=t&&(e.display.scrollbarH.scrollLeft=t))}function kr(e,t){var r=t.wheelDeltaX,n=t.wheelDeltaY;null==r&&t.detail&&t.axis==t.HORIZONTAL_AXIS&&(r=t.detail),null==n&&t.detail&&t.axis==t.VERTICAL_AXIS?n=t.detail:null==n&&(n=t.wheelDelta);var i=e.display,o=i.scroller;if(r&&o.scrollWidth>o.clientWidth||n&&o.scrollHeight>o.clientHeight){if(n&&Jo&&Go)e:for(var a=t.target,s=i.view;a!=o;a=a.parentNode)for(var l=0;l<s.length;l++)if(s[l].node==a){e.display.currentWheelTarget=a;break e}if(r&&!Oo&&!Xo&&null!=ma)return n&&Cr(e,Math.max(0,Math.min(o.scrollTop+n*ma,o.scrollHeight-o.clientHeight))),Ar(e,Math.max(0,Math.min(o.scrollLeft+r*ma,o.scrollWidth-o.clientWidth))),qa(t),void(i.wheelStartX=null);if(n&&null!=ma){var c=n*ma,h=e.doc.scrollTop,u=h+i.wrapper.clientHeight;0>c?h=Math.max(0,h+c-50):u=Math.min(e.doc.height,u+c+50),b(e,{top:h,bottom:u})}20>pa&&(null==i.wheelStartX?(i.wheelStartX=o.scrollLeft,i.wheelStartY=o.scrollTop,i.wheelDX=r,i.wheelDY=n,setTimeout(function(){if(null!=i.wheelStartX){var e=o.scrollLeft-i.wheelStartX,t=o.scrollTop-i.wheelStartY,r=t&&i.wheelDY&&t/i.wheelDY||e&&i.wheelDX&&e/i.wheelDX;i.wheelStartX=i.wheelStartY=null,r&&(ma=(ma*pa+r)/(pa+1),++pa)}},200)):(i.wheelDX+=r,i.wheelDY+=n))}}function Lr(e,t,r){if("string"==typeof t&&(t=Ca[t],!t))return!1;e.display.pollingFast&&fr(e)&&(e.display.pollingFast=!1);var n=e.display.shift,i=!1;try{gr(e)&&(e.state.suppressEdits=!0),r&&(e.display.shift=!1),i=t(e)!=ts}finally{e.display.shift=n,e.state.suppressEdits=!1}return i}function Pr(e){var t=e.state.keyMaps.slice(0);return e.options.extraKeys&&t.push(e.options.extraKeys),t.push(e.options.keyMap),t}function Fr(e,t){var r=vn(e.options.keyMap),n=r.auto;clearTimeout(ga),n&&!La(t)&&(ga=setTimeout(function(){vn(e.options.keyMap)==r&&(e.options.keyMap=n.call?n.call(null,e):n,s(e))},50));var i=Pa(t,!0),o=!1;if(!i)return!1;var a=Pr(e);return o=t.shiftKey?ka("Shift-"+i,a,function(t){return Lr(e,t,!0)})||ka(i,a,function(t){return("string"==typeof t?/^go[A-Z]/.test(t):t.motion)?Lr(e,t):void 0}):ka(i,a,function(t){return Lr(e,t)}),o&&(qa(t),Et(e),Xi(e,"keyHandled",e,i,t)),o}function Nr(e,t,r){var n=ka("'"+r+"'",Pr(e),function(t){return Lr(e,t,!0)});return n&&(qa(t),Et(e),Xi(e,"keyHandled",e,"'"+r+"'",t)),n}function Dr(e){var t=this;if(mr(t),!Yi(t,e)){Vo&&11>Bo&&27==e.keyCode&&(e.returnValue=!1);var r=e.keyCode;t.display.shift=16==r||e.shiftKey;var n=Fr(t,e);Xo&&(va=n?r:null,!n&&88==r&&!ys&&(Jo?e.metaKey:e.ctrlKey)&&t.replaceSelection("",null,"cut")),18!=r||/\bCodeMirror-crosshair\b/.test(t.display.lineDiv.className)||Ur(t)}}function Ur(e){function t(e){18!=e.keyCode&&e.altKey||(vo(r,"CodeMirror-crosshair"),Za(document,"keyup",t),Za(document,"mouseover",t))}var r=e.display.lineDiv;Eo(r,"CodeMirror-crosshair"),Qa(document,"keyup",t),Qa(document,"mouseover",t)}function Or(e){Yi(this,e)||16==e.keyCode&&(this.doc.sel.shift=!1)}function zr(e){var t=this;if(!(Yi(t,e)||e.ctrlKey||Jo&&e.metaKey)){var r=e.keyCode,n=e.charCode;if(Xo&&r==va)return va=null,void qa(e);if(!(Xo&&(!e.which||e.which<10)||Yo)||!Fr(t,e)){var i=String.fromCharCode(null==n?r:n);Nr(t,e,i)||(Vo&&Bo>=9&&(t.display.inputHasSelection=null),ur(t))}}}function Ir(e){"nocursor"!=e.options.readOnly&&(e.state.focused||($a(e,"focus",e),e.state.focused=!0,Eo(e.display.wrapper,"CodeMirror-focused"),e.curOp||e.display.selForContextMenu==e.doc.sel||(dr(e),Go&&setTimeout(ao(dr,e,!0),0))),hr(e),Et(e))}function Vr(e){e.state.focused&&($a(e,"blur",e),e.state.focused=!1,vo(e.display.wrapper,"CodeMirror-focused")),clearInterval(e.display.blinker),setTimeout(function(){e.state.focused||(e.display.shift=!1)},150)}function Br(e,t){function r(){if(null!=i.input.selectionStart){var t=e.somethingSelected(),r=i.input.value=""+(t?i.input.value:"");i.prevInput=t?"":"",i.input.selectionStart=1,i.input.selectionEnd=r.length,i.selForContextMenu=e.doc.sel}}function n(){if(i.inputDiv.style.position="relative",i.input.style.cssText=l,Vo&&9>Bo&&(i.scrollbarV.scrollTop=i.scroller.scrollTop=a),hr(e),null!=i.input.selectionStart){(!Vo||Vo&&9>Bo)&&r();var t=0,n=function(){i.selForContextMenu==e.doc.sel&&0==i.input.selectionStart?$t(e,Ca.selectAll)(e):t++<10?i.detectingSelectAll=setTimeout(n,500):dr(e)};i.detectingSelectAll=setTimeout(n,200)}}if(!Yi(e,t,"contextmenu")){var i=e.display;if(!yr(i,t)&&!Gr(e,t)){var o=Tr(e,t),a=i.scroller.scrollTop;if(o&&!Xo){var s=e.options.resetSelectionOnContextMenu;s&&-1==e.doc.sel.contains(o)&&$t(e,ct)(e.doc,Q(o),rs);var l=i.input.style.cssText;if(i.inputDiv.style.position="absolute",i.input.style.cssText="position: fixed; width: 30px; height: 30px; top: "+(t.clientY-5)+"px; left: "+(t.clientX-5)+"px; z-index: 1000; background: "+(Vo?"rgba(255, 255, 255, .05)":"transparent")+"; outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);",pr(e),dr(e),e.somethingSelected()||(i.input.value=i.prevInput=" "),i.selForContextMenu=e.doc.sel,clearTimeout(i.detectingSelectAll),Vo&&Bo>=9&&r(),na){Ka(t);var c=function(){Za(window,"mouseup",c),setTimeout(n,20)};Qa(window,"mouseup",c)}else setTimeout(n,50)}}}}function Gr(e,t){return Qi(e,"gutterContextMenu")?_r(e,t,"gutterContextMenu",!1,$a):!1}function jr(e,t){if(sa(e,t.from)<0)return e;if(sa(e,t.to)<=0)return Ea(t);var r=e.line+t.text.length-(t.to.line-t.from.line)-1,n=e.ch;return e.line==t.to.line&&(n+=Ea(t).ch-t.to.ch),aa(r,n)}function Wr(e,t){for(var r=[],n=0;n<e.sel.ranges.length;n++){var i=e.sel.ranges[n];r.push(new Y(jr(i.anchor,t),jr(i.head,t)))}return K(r,e.sel.primIndex)}function Xr(e,t,r){return e.line==t.line?aa(r.line,e.ch-t.ch+r.ch):aa(r.line+(e.line-t.line),e.ch)}function qr(e,t,r){for(var n=[],i=aa(e.first,0),o=i,a=0;a<t.length;a++){var s=t[a],l=Xr(s.from,i,o),c=Xr(Ea(s),i,o);if(i=s.to,o=c,"around"==r){var h=e.sel.ranges[a],u=sa(h.head,h.anchor)<0;n[a]=new Y(u?c:l,u?l:c)}else n[a]=new Y(l,l)}return new q(n,e.sel.primIndex)}function Yr(e,t,r){var n={canceled:!1,from:t.from,to:t.to,text:t.text,origin:t.origin,cancel:function(){this.canceled=!0}};return r&&(n.update=function(t,r,n,i){t&&(this.from=$(e,t)),r&&(this.to=$(e,r)),n&&(this.text=n),void 0!==i&&(this.origin=i)}),$a(e,"beforeChange",e,n),e.cm&&$a(e.cm,"beforeChange",e.cm,n),n.canceled?null:{from:n.from,to:n.to,text:n.text,origin:n.origin}}function Kr(e,t,r){if(e.cm){if(!e.cm.curOp)return $t(e.cm,Kr)(e,t,r);if(e.cm.state.suppressEdits)return}if(!(Qi(e,"beforeChange")||e.cm&&Qi(e.cm,"beforeChange"))||(t=Yr(e,t,!0))){var n=ia&&!r&&Ln(e,t.from,t.to);if(n)for(var i=n.length-1;i>=0;--i)Qr(e,{from:n[i].from,to:n[i].to,text:i?[""]:t.text});else Qr(e,t)}}function Qr(e,t){if(1!=t.text.length||""!=t.text[0]||0!=sa(t.from,t.to)){var r=Wr(e,t);Li(e,t,r,e.cm?e.cm.curOp.id:0/0),Jr(e,t,r,Cn(e,t));var n=[];Ei(e,function(e,r){r||-1!=ro(n,e.history)||(Bi(e.history,t),n.push(e.history)),Jr(e,t,null,Cn(e,t))})}}function Zr(e,t,r){if(!e.cm||!e.cm.state.suppressEdits){for(var n,i=e.history,o=e.sel,a="undo"==t?i.done:i.undone,s="undo"==t?i.undone:i.done,l=0;l<a.length&&(n=a[l],r?!n.ranges||n.equals(e.sel):n.ranges);l++);if(l!=a.length){for(i.lastOrigin=i.lastSelOrigin=null;n=a.pop(),n.ranges;){if(Ni(n,s),r&&!n.equals(e.sel))return void ct(e,n,{clearRedo:!1});o=n}var c=[];Ni(o,s),s.push({changes:c,generation:i.generation}),i.generation=n.generation||++i.maxGeneration;for(var h=Qi(e,"beforeChange")||e.cm&&Qi(e.cm,"beforeChange"),l=n.changes.length-1;l>=0;--l){var u=n.changes[l];if(u.origin=t,h&&!Yr(e,u,!1))return void(a.length=0);c.push(Ci(e,u));var f=l?Wr(e,u,null):to(a);Jr(e,u,f,kn(e,u)),!l&&e.cm&&e.cm.scrollIntoView(u);var d=[];Ei(e,function(e,t){t||-1!=ro(d,e.history)||(Bi(e.history,u),d.push(e.history)),Jr(e,u,null,kn(e,u))})}}}}function $r(e,t){if(0!=t&&(e.first+=t,e.sel=new q(no(e.sel.ranges,function(e){return new Y(aa(e.anchor.line+t,e.anchor.ch),aa(e.head.line+t,e.head.ch))}),e.sel.primIndex),e.cm)){nr(e.cm,e.first,e.first-t,t);for(var r=e.cm.display,n=r.viewFrom;n<r.viewTo;n++)ir(e.cm,n,"gutter")}}function Jr(e,t,r,n){if(e.cm&&!e.cm.curOp)return $t(e.cm,Jr)(e,t,r,n);if(t.to.line<e.first)return void $r(e,t.text.length-1-(t.to.line-t.from.line));if(!(t.from.line>e.lastLine())){if(t.from.line<e.first){var i=t.text.length-1-(e.first-t.from.line);$r(e,i),t={from:aa(e.first,0),to:aa(t.to.line+i,t.to.ch),text:[to(t.text)],origin:t.origin}}var o=e.lastLine();t.to.line>o&&(t={from:t.from,to:aa(o,Ti(e,o).text.length),text:[t.text[0]],origin:t.origin}),t.removed=xi(e,t.from,t.to),r||(r=Wr(e,t,null)),e.cm?en(e.cm,t,n):mi(e,t,n),ht(e,r,rs)}}function en(e,t,r){var n=e.doc,i=e.display,a=t.from,s=t.to,l=!1,c=a.line;e.options.lineWrapping||(c=Ri(Bn(Ti(n,a.line))),n.iter(c,s.line+1,function(e){return e==i.maxLine?(l=!0,!0):void 0})),n.sel.contains(t.from,t.to)>-1&&Ki(e),mi(n,t,r,o(e)),e.options.lineWrapping||(n.iter(c,a.line+t.text.length,function(e){var t=f(e);t>i.maxLineLength&&(i.maxLine=e,i.maxLineLength=t,i.maxLineChanged=!0,l=!1)}),l&&(e.curOp.updateMaxLine=!0)),n.frontier=Math.min(n.frontier,a.line),yt(e,400);var h=t.text.length-(s.line-a.line)-1;a.line!=s.line||1!=t.text.length||pi(e.doc,t)?nr(e,a.line,s.line+1,h):ir(e,a.line,"text");var u=Qi(e,"changes"),d=Qi(e,"change");if(d||u){var p={from:a,to:s,text:t.text,removed:t.removed,origin:t.origin};d&&Xi(e,"change",e,p),u&&(e.curOp.changeObjs||(e.curOp.changeObjs=[])).push(p)}e.display.selForContextMenu=null}function tn(e,t,r,n,i){if(n||(n=r),sa(n,r)<0){var o=n;n=r,r=o}"string"==typeof t&&(t=vs(t)),Kr(e,{from:r,to:n,text:t,origin:i})}function rn(e,t){var r=e.display,n=r.sizer.getBoundingClientRect(),i=null;if(t.top+n.top<0?i=!0:t.bottom+n.top>(window.innerHeight||document.documentElement.clientHeight)&&(i=!1),null!=i&&!Qo){var o=ho("div","",null,"position: absolute; top: "+(t.top-r.viewOffset-bt(e.display))+"px; height: "+(t.bottom-t.top+es)+"px; left: "+t.left+"px; width: 2px;");e.display.lineSpace.appendChild(o),o.scrollIntoView(i),e.display.lineSpace.removeChild(o)}}function nn(e,t,r,n){for(null==n&&(n=0);;){var i=!1,o=Bt(e,t),a=r&&r!=t?Bt(e,r):o,s=an(e,Math.min(o.left,a.left),Math.min(o.top,a.top)-n,Math.max(o.left,a.left),Math.max(o.bottom,a.bottom)+n),l=e.doc.scrollTop,c=e.doc.scrollLeft;if(null!=s.scrollTop&&(Cr(e,s.scrollTop),Math.abs(e.doc.scrollTop-l)>1&&(i=!0)),null!=s.scrollLeft&&(Ar(e,s.scrollLeft),Math.abs(e.doc.scrollLeft-c)>1&&(i=!0)),!i)return o}}function on(e,t,r,n,i){var o=an(e,t,r,n,i);null!=o.scrollTop&&Cr(e,o.scrollTop),null!=o.scrollLeft&&Ar(e,o.scrollLeft)}function an(e,t,r,n,i){var o=e.display,a=qt(e.display);0>r&&(r=0);var s=e.curOp&&null!=e.curOp.scrollTop?e.curOp.scrollTop:o.scroller.scrollTop,l=o.scroller.clientHeight-es,c={},h=e.doc.height+Rt(o),u=a>r,f=i>h-a;if(s>r)c.scrollTop=u?0:r;else if(i>s+l){var d=Math.min(r,(f?h:i)-l);d!=s&&(c.scrollTop=d)}var p=e.curOp&&null!=e.curOp.scrollLeft?e.curOp.scrollLeft:o.scroller.scrollLeft,m=o.scroller.clientWidth-es;t+=o.gutters.offsetWidth,n+=o.gutters.offsetWidth;var g=o.gutters.offsetWidth,v=g+10>t;return p+g>t||v?(v&&(t=0),c.scrollLeft=Math.max(0,t-10-g)):n>m+p-3&&(c.scrollLeft=n+10-m),c}function sn(e,t,r){(null!=t||null!=r)&&cn(e),null!=t&&(e.curOp.scrollLeft=(null==e.curOp.scrollLeft?e.doc.scrollLeft:e.curOp.scrollLeft)+t),null!=r&&(e.curOp.scrollTop=(null==e.curOp.scrollTop?e.doc.scrollTop:e.curOp.scrollTop)+r)}function ln(e){cn(e);var t=e.getCursor(),r=t,n=t;e.options.lineWrapping||(r=t.ch?aa(t.line,t.ch-1):t,n=aa(t.line,t.ch+1)),e.curOp.scrollToPos={from:r,to:n,margin:e.options.cursorScrollMargin,isCursor:!0}}function cn(e){var t=e.curOp.scrollToPos;if(t){e.curOp.scrollToPos=null;var r=Gt(e,t.from),n=Gt(e,t.to),i=an(e,Math.min(r.left,n.left),Math.min(r.top,n.top)-t.margin,Math.max(r.right,n.right),Math.max(r.bottom,n.bottom)+t.margin);e.scrollTo(i.scrollLeft,i.scrollTop)}}function hn(e,t,r,n){var i,o=e.doc;null==r&&(r="add"),"smart"==r&&(e.doc.mode.indent?i=wt(e,t):r="prev");var a=e.options.tabSize,s=Ti(o,t),l=os(s.text,null,a);s.stateAfter&&(s.stateAfter=null);var c,h=s.text.match(/^\s*/)[0];if(n||/\S/.test(s.text)){if("smart"==r&&(c=e.doc.mode.indent(i,s.text.slice(h.length),s.text),c==ts)){if(!n)return;r="prev"}}else c=0,r="not";"prev"==r?c=t>o.first?os(Ti(o,t-1).text,null,a):0:"add"==r?c=l+e.options.indentUnit:"subtract"==r?c=l-e.options.indentUnit:"number"==typeof r&&(c=l+r),c=Math.max(0,c);var u="",f=0;if(e.options.indentWithTabs)for(var d=Math.floor(c/a);d;--d)f+=a,u+="	";if(c>f&&(u+=eo(c-f)),u!=h)tn(e.doc,u,aa(t,0),aa(t,h.length),"+input");else for(var d=0;d<o.sel.ranges.length;d++){var p=o.sel.ranges[d];if(p.head.line==t&&p.head.ch<h.length){var f=aa(t,h.length);ot(o,d,new Y(f,f));break}}s.stateAfter=null}function un(e,t,r,n){var i=t,o=t;return"number"==typeof t?o=Ti(e,Z(e,t)):i=Ri(t),null==i?null:(n(o,i)&&e.cm&&ir(e.cm,i,r),o)}function fn(e,t){for(var r=e.doc.sel.ranges,n=[],i=0;i<r.length;i++){for(var o=t(r[i]);n.length&&sa(o.from,to(n).to)<=0;){var a=n.pop();if(sa(a.from,o.from)<0){o.from=a.from;break}}n.push(o)}Zt(e,function(){for(var t=n.length-1;t>=0;t--)tn(e.doc,"",n[t].from,n[t].to,"+delete");ln(e)})}function dn(e,t,r,n,i){function o(){var t=s+r;return t<e.first||t>=e.first+e.size?u=!1:(s=t,h=Ti(e,t))}function a(e){var t=(i?Do:Uo)(h,l,r,!0);if(null==t){if(e||!o())return u=!1;l=i?(0>r?Ao:Co)(h):0>r?h.text.length:0}else l=t;return!0}var s=t.line,l=t.ch,c=r,h=Ti(e,s),u=!0;if("char"==n)a();else if("column"==n)a(!0);else if("word"==n||"group"==n)for(var f=null,d="group"==n,p=e.cm&&e.cm.getHelper(t,"wordChars"),m=!0;!(0>r)||a(!m);m=!1){var g=h.text.charAt(l)||"\n",v=so(g,p)?"w":d&&"\n"==g?"n":!d||/\s/.test(g)?null:"p";if(!d||m||v||(v="s"),f&&f!=v){0>r&&(r=1,a());break}if(v&&(f=v),r>0&&!a(!m))break}var E=pt(e,aa(s,l),c,!0);return u||(E.hitSide=!0),E}function pn(e,t,r,n){var i,o=e.doc,a=t.left;if("page"==n){var s=Math.min(e.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight);i=t.top+r*(s-(0>r?1.5:.5)*qt(e.display))}else"line"==n&&(i=r>0?t.bottom+3:t.top-3);for(;;){var l=Wt(e,a,i);
if(!l.outside)break;if(0>r?0>=i:i>=o.height){l.hitSide=!0;break}i+=5*r}return l}function mn(e,t){var r=e.doc,n=Ti(r,t.line).text,i=t.ch,o=t.ch;if(n){var a=e.getHelper(t,"wordChars");(t.xRel<0||o==n.length)&&i?--i:++o;for(var s=n.charAt(i),l=so(s,a)?function(e){return so(e,a)}:/\s/.test(s)?function(e){return/\s/.test(e)}:function(e){return!/\s/.test(e)&&!so(e)};i>0&&l(n.charAt(i-1));)--i;for(;o<n.length&&l(n.charAt(o));)++o}return new Y(aa(t.line,i),aa(t.line,o))}function gn(t,r,n,i){e.defaults[t]=r,n&&(Ta[t]=i?function(e,t,r){r!=xa&&n(e,t,r)}:n)}function vn(e){return"string"==typeof e?Aa[e]:e}function En(e,t,r,n,i){if(n&&n.shared)return yn(e,t,r,n,i);if(e.cm&&!e.cm.curOp)return $t(e.cm,En)(e,t,r,n,i);var o=new Na(e,i),a=sa(t,r);if(n&&oo(n,o,!1),a>0||0==a&&o.clearWhenEmpty!==!1)return o;if(o.replacedWith&&(o.collapsed=!0,o.widgetNode=ho("span",[o.replacedWith],"CodeMirror-widget"),n.handleMouseEvents||(o.widgetNode.ignoreEvents=!0),n.insertLeft&&(o.widgetNode.insertLeft=!0)),o.collapsed){if(Vn(e,t.line,t,r,o)||t.line!=r.line&&Vn(e,r.line,t,r,o))throw new Error("Inserting collapsed marker partially overlapping an existing one");oa=!0}o.addToHistory&&Li(e,{from:t,to:r,origin:"markText"},e.sel,0/0);var s,l=t.line,c=e.cm;if(e.iter(l,r.line+1,function(e){c&&o.collapsed&&!c.options.lineWrapping&&Bn(e)==c.display.maxLine&&(s=!0),o.collapsed&&l!=t.line&&bi(e,0),Hn(e,new bn(o,l==t.line?t.ch:null,l==r.line?r.ch:null)),++l}),o.collapsed&&e.iter(t.line,r.line+1,function(t){Xn(e,t)&&bi(t,0)}),o.clearOnEnter&&Qa(o,"beforeCursorEnter",function(){o.clear()}),o.readOnly&&(ia=!0,(e.history.done.length||e.history.undone.length)&&e.clearHistory()),o.collapsed&&(o.id=++Da,o.atomic=!0),c){if(s&&(c.curOp.updateMaxLine=!0),o.collapsed)nr(c,t.line,r.line+1);else if(o.className||o.title||o.startStyle||o.endStyle)for(var h=t.line;h<=r.line;h++)ir(c,h,"text");o.atomic&&ft(c.doc),Xi(c,"markerAdded",c,o)}return o}function yn(e,t,r,n,i){n=oo(n),n.shared=!1;var o=[En(e,t,r,n,i)],a=o[0],s=n.widgetNode;return Ei(e,function(e){s&&(n.widgetNode=s.cloneNode(!0)),o.push(En(e,$(e,t),$(e,r),n,i));for(var l=0;l<e.linked.length;++l)if(e.linked[l].isParent)return;a=to(o)}),new Ua(o,a)}function Tn(e){return e.findMarks(aa(e.first,0),e.clipPos(aa(e.lastLine())),function(e){return e.parent})}function xn(e,t){for(var r=0;r<t.length;r++){var n=t[r],i=n.find(),o=e.clipPos(i.from),a=e.clipPos(i.to);if(sa(o,a)){var s=En(e,o,a,n.primary,n.primary.type);n.markers.push(s),s.parent=n}}}function wn(e){for(var t=0;t<e.length;t++){var r=e[t],n=[r.primary.doc];Ei(r.primary.doc,function(e){n.push(e)});for(var i=0;i<r.markers.length;i++){var o=r.markers[i];-1==ro(n,o.doc)&&(o.parent=null,r.markers.splice(i--,1))}}}function bn(e,t,r){this.marker=e,this.from=t,this.to=r}function Rn(e,t){if(e)for(var r=0;r<e.length;++r){var n=e[r];if(n.marker==t)return n}}function _n(e,t){for(var r,n=0;n<e.length;++n)e[n]!=t&&(r||(r=[])).push(e[n]);return r}function Hn(e,t){e.markedSpans=e.markedSpans?e.markedSpans.concat([t]):[t],t.marker.attachLine(e)}function Mn(e,t,r){if(e)for(var n,i=0;i<e.length;++i){var o=e[i],a=o.marker,s=null==o.from||(a.inclusiveLeft?o.from<=t:o.from<t);if(s||o.from==t&&"bookmark"==a.type&&(!r||!o.marker.insertLeft)){var l=null==o.to||(a.inclusiveRight?o.to>=t:o.to>t);(n||(n=[])).push(new bn(a,o.from,l?null:o.to))}}return n}function Sn(e,t,r){if(e)for(var n,i=0;i<e.length;++i){var o=e[i],a=o.marker,s=null==o.to||(a.inclusiveRight?o.to>=t:o.to>t);if(s||o.from==t&&"bookmark"==a.type&&(!r||o.marker.insertLeft)){var l=null==o.from||(a.inclusiveLeft?o.from<=t:o.from<t);(n||(n=[])).push(new bn(a,l?null:o.from-t,null==o.to?null:o.to-t))}}return n}function Cn(e,t){var r=et(e,t.from.line)&&Ti(e,t.from.line).markedSpans,n=et(e,t.to.line)&&Ti(e,t.to.line).markedSpans;if(!r&&!n)return null;var i=t.from.ch,o=t.to.ch,a=0==sa(t.from,t.to),s=Mn(r,i,a),l=Sn(n,o,a),c=1==t.text.length,h=to(t.text).length+(c?i:0);if(s)for(var u=0;u<s.length;++u){var f=s[u];if(null==f.to){var d=Rn(l,f.marker);d?c&&(f.to=null==d.to?null:d.to+h):f.to=i}}if(l)for(var u=0;u<l.length;++u){var f=l[u];if(null!=f.to&&(f.to+=h),null==f.from){var d=Rn(s,f.marker);d||(f.from=h,c&&(s||(s=[])).push(f))}else f.from+=h,c&&(s||(s=[])).push(f)}s&&(s=An(s)),l&&l!=s&&(l=An(l));var p=[s];if(!c){var m,g=t.text.length-2;if(g>0&&s)for(var u=0;u<s.length;++u)null==s[u].to&&(m||(m=[])).push(new bn(s[u].marker,null,null));for(var u=0;g>u;++u)p.push(m);p.push(l)}return p}function An(e){for(var t=0;t<e.length;++t){var r=e[t];null!=r.from&&r.from==r.to&&r.marker.clearWhenEmpty!==!1&&e.splice(t--,1)}return e.length?e:null}function kn(e,t){var r=Oi(e,t),n=Cn(e,t);if(!r)return n;if(!n)return r;for(var i=0;i<r.length;++i){var o=r[i],a=n[i];if(o&&a)e:for(var s=0;s<a.length;++s){for(var l=a[s],c=0;c<o.length;++c)if(o[c].marker==l.marker)continue e;o.push(l)}else a&&(r[i]=a)}return r}function Ln(e,t,r){var n=null;if(e.iter(t.line,r.line+1,function(e){if(e.markedSpans)for(var t=0;t<e.markedSpans.length;++t){var r=e.markedSpans[t].marker;!r.readOnly||n&&-1!=ro(n,r)||(n||(n=[])).push(r)}}),!n)return null;for(var i=[{from:t,to:r}],o=0;o<n.length;++o)for(var a=n[o],s=a.find(0),l=0;l<i.length;++l){var c=i[l];if(!(sa(c.to,s.from)<0||sa(c.from,s.to)>0)){var h=[l,1],u=sa(c.from,s.from),f=sa(c.to,s.to);(0>u||!a.inclusiveLeft&&!u)&&h.push({from:c.from,to:s.from}),(f>0||!a.inclusiveRight&&!f)&&h.push({from:s.to,to:c.to}),i.splice.apply(i,h),l+=h.length-1}}return i}function Pn(e){var t=e.markedSpans;if(t){for(var r=0;r<t.length;++r)t[r].marker.detachLine(e);e.markedSpans=null}}function Fn(e,t){if(t){for(var r=0;r<t.length;++r)t[r].marker.attachLine(e);e.markedSpans=t}}function Nn(e){return e.inclusiveLeft?-1:0}function Dn(e){return e.inclusiveRight?1:0}function Un(e,t){var r=e.lines.length-t.lines.length;if(0!=r)return r;var n=e.find(),i=t.find(),o=sa(n.from,i.from)||Nn(e)-Nn(t);if(o)return-o;var a=sa(n.to,i.to)||Dn(e)-Dn(t);return a?a:t.id-e.id}function On(e,t){var r,n=oa&&e.markedSpans;if(n)for(var i,o=0;o<n.length;++o)i=n[o],i.marker.collapsed&&null==(t?i.from:i.to)&&(!r||Un(r,i.marker)<0)&&(r=i.marker);return r}function zn(e){return On(e,!0)}function In(e){return On(e,!1)}function Vn(e,t,r,n,i){var o=Ti(e,t),a=oa&&o.markedSpans;if(a)for(var s=0;s<a.length;++s){var l=a[s];if(l.marker.collapsed){var c=l.marker.find(0),h=sa(c.from,r)||Nn(l.marker)-Nn(i),u=sa(c.to,n)||Dn(l.marker)-Dn(i);if(!(h>=0&&0>=u||0>=h&&u>=0)&&(0>=h&&(sa(c.to,r)>0||l.marker.inclusiveRight&&i.inclusiveLeft)||h>=0&&(sa(c.from,n)<0||l.marker.inclusiveLeft&&i.inclusiveRight)))return!0}}}function Bn(e){for(var t;t=zn(e);)e=t.find(-1,!0).line;return e}function Gn(e){for(var t,r;t=In(e);)e=t.find(1,!0).line,(r||(r=[])).push(e);return r}function jn(e,t){var r=Ti(e,t),n=Bn(r);return r==n?t:Ri(n)}function Wn(e,t){if(t>e.lastLine())return t;var r,n=Ti(e,t);if(!Xn(e,n))return t;for(;r=In(n);)n=r.find(1,!0).line;return Ri(n)+1}function Xn(e,t){var r=oa&&t.markedSpans;if(r)for(var n,i=0;i<r.length;++i)if(n=r[i],n.marker.collapsed){if(null==n.from)return!0;if(!n.marker.widgetNode&&0==n.from&&n.marker.inclusiveLeft&&qn(e,t,n))return!0}}function qn(e,t,r){if(null==r.to){var n=r.marker.find(1,!0);return qn(e,n.line,Rn(n.line.markedSpans,r.marker))}if(r.marker.inclusiveRight&&r.to==t.text.length)return!0;for(var i,o=0;o<t.markedSpans.length;++o)if(i=t.markedSpans[o],i.marker.collapsed&&!i.marker.widgetNode&&i.from==r.to&&(null==i.to||i.to!=r.from)&&(i.marker.inclusiveLeft||r.marker.inclusiveRight)&&qn(e,t,i))return!0}function Yn(e,t,r){Hi(t)<(e.curOp&&e.curOp.scrollTop||e.doc.scrollTop)&&sn(e,null,r)}function Kn(e){if(null!=e.height)return e.height;if(!po(document.body,e.node)){var t="position: relative;";e.coverGutter&&(t+="margin-left: -"+e.cm.getGutterElement().offsetWidth+"px;"),fo(e.cm.display.measure,ho("div",[e.node],null,t))}return e.height=e.node.offsetHeight}function Qn(e,t,r,n){var i=new Oa(e,r,n);return i.noHScroll&&(e.display.alignWidgets=!0),un(e.doc,t,"widget",function(t){var r=t.widgets||(t.widgets=[]);if(null==i.insertAt?r.push(i):r.splice(Math.min(r.length-1,Math.max(0,i.insertAt)),0,i),i.line=t,!Xn(e.doc,t)){var n=Hi(t)<e.doc.scrollTop;bi(t,t.height+Kn(i)),n&&sn(e,null,i.height),e.curOp.forceUpdate=!0}return!0}),i}function Zn(e,t,r,n){e.text=t,e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null),null!=e.order&&(e.order=null),Pn(e),Fn(e,r);var i=n?n(e):1;i!=e.height&&bi(e,i)}function $n(e){e.parent=null,Pn(e)}function Jn(e,t){if(e)for(;;){var r=e.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!r)break;e=e.slice(0,r.index)+e.slice(r.index+r[0].length);var n=r[1]?"bgClass":"textClass";null==t[n]?t[n]=r[2]:new RegExp("(?:^|s)"+r[2]+"(?:$|s)").test(t[n])||(t[n]+=" "+r[2])}return e}function ei(t,r){if(t.blankLine)return t.blankLine(r);if(t.innerMode){var n=e.innerMode(t,r);return n.mode.blankLine?n.mode.blankLine(n.state):void 0}}function ti(e,t,r){for(var n=0;10>n;n++){var i=e.token(t,r);if(t.pos>t.start)return i}throw new Error("Mode "+e.name+" failed to advance stream.")}function ri(t,r,n,i,o,a,s){var l=n.flattenSpans;null==l&&(l=t.options.flattenSpans);var c,h=0,u=null,f=new Fa(r,t.options.tabSize);for(""==r&&Jn(ei(n,i),a);!f.eol();){if(f.pos>t.options.maxHighlightLength?(l=!1,s&&oi(t,r,i,f.pos),f.pos=r.length,c=null):c=Jn(ti(n,f,i),a),t.options.addModeClass){var d=e.innerMode(n,i).mode.name;d&&(c="m-"+(c?d+" "+c:d))}l&&u==c||(h<f.start&&o(f.start,u),h=f.start,u=c),f.start=f.pos}for(;h<f.pos;){var p=Math.min(f.pos,h+5e4);o(p,u),h=p}}function ni(e,t,r,n){var i=[e.state.modeGen],o={};ri(e,t.text,e.doc.mode,r,function(e,t){i.push(e,t)},o,n);for(var a=0;a<e.state.overlays.length;++a){var s=e.state.overlays[a],l=1,c=0;ri(e,t.text,s.mode,!0,function(e,t){for(var r=l;e>c;){var n=i[l];n>e&&i.splice(l,1,e,i[l+1],n),l+=2,c=Math.min(e,n)}if(t)if(s.opaque)i.splice(r,l-r,e,"cm-overlay "+t),l=r+2;else for(;l>r;r+=2){var o=i[r+1];i[r+1]=(o?o+" ":"")+"cm-overlay "+t}},o)}return{styles:i,classes:o.bgClass||o.textClass?o:null}}function ii(e,t){if(!t.styles||t.styles[0]!=e.state.modeGen){var r=ni(e,t,t.stateAfter=wt(e,Ri(t)));t.styles=r.styles,r.classes?t.styleClasses=r.classes:t.styleClasses&&(t.styleClasses=null)}return t.styles}function oi(e,t,r,n){var i=e.doc.mode,o=new Fa(t,e.options.tabSize);for(o.start=o.pos=n||0,""==t&&ei(i,r);!o.eol()&&o.pos<=e.options.maxHighlightLength;)ti(i,o,r),o.start=o.pos}function ai(e,t){if(!e||/^\s*$/.test(e))return null;var r=t.addModeClass?Va:Ia;return r[e]||(r[e]=e.replace(/\S+/g,"cm-$&"))}function si(e,t){var r=ho("span",null,null,Go?"padding-right: .1px":null),n={pre:ho("pre",[r]),content:r,col:0,pos:0,cm:e};t.measure={};for(var i=0;i<=(t.rest?t.rest.length:0);i++){var o,a=i?t.rest[i-1]:t.line;n.pos=0,n.addToken=ci,(Vo||Go)&&e.getOption("lineWrapping")&&(n.addToken=hi(n.addToken)),_o(e.display.measure)&&(o=Mi(a))&&(n.addToken=ui(n.addToken,o)),n.map=[],di(a,n,ii(e,a)),a.styleClasses&&(a.styleClasses.bgClass&&(n.bgClass=yo(a.styleClasses.bgClass,n.bgClass||"")),a.styleClasses.textClass&&(n.textClass=yo(a.styleClasses.textClass,n.textClass||""))),0==n.map.length&&n.map.push(0,0,n.content.appendChild(Ro(e.display.measure))),0==i?(t.measure.map=n.map,t.measure.cache={}):((t.measure.maps||(t.measure.maps=[])).push(n.map),(t.measure.caches||(t.measure.caches=[])).push({}))}return $a(e,"renderLine",e,t.line,n.pre),n.pre.className&&(n.textClass=yo(n.pre.className,n.textClass||"")),n}function li(e){var t=ho("span","","cm-invalidchar");return t.title="\\u"+e.charCodeAt(0).toString(16),t}function ci(e,t,r,n,i,o){if(t){var a=e.cm.options.specialChars,s=!1;if(a.test(t))for(var l=document.createDocumentFragment(),c=0;;){a.lastIndex=c;var h=a.exec(t),u=h?h.index-c:t.length-c;if(u){var f=document.createTextNode(t.slice(c,c+u));l.appendChild(Vo&&9>Bo?ho("span",[f]):f),e.map.push(e.pos,e.pos+u,f),e.col+=u,e.pos+=u}if(!h)break;if(c+=u+1,"	"==h[0]){var d=e.cm.options.tabSize,p=d-e.col%d,f=l.appendChild(ho("span",eo(p),"cm-tab"));e.col+=p}else{var f=e.cm.options.specialCharPlaceholder(h[0]);l.appendChild(Vo&&9>Bo?ho("span",[f]):f),e.col+=1}e.map.push(e.pos,e.pos+1,f),e.pos++}else{e.col+=t.length;var l=document.createTextNode(t);e.map.push(e.pos,e.pos+t.length,l),Vo&&9>Bo&&(s=!0),e.pos+=t.length}if(r||n||i||s){var m=r||"";n&&(m+=n),i&&(m+=i);var g=ho("span",[l],m);return o&&(g.title=o),e.content.appendChild(g)}e.content.appendChild(l)}}function hi(e){function t(e){for(var t=" ",r=0;r<e.length-2;++r)t+=r%2?" ":"";return t+=" "}return function(r,n,i,o,a,s){e(r,n.replace(/ {3,}/g,t),i,o,a,s)}}function ui(e,t){return function(r,n,i,o,a,s){i=i?i+" cm-force-border":"cm-force-border";for(var l=r.pos,c=l+n.length;;){for(var h=0;h<t.length;h++){var u=t[h];if(u.to>l&&u.from<=l)break}if(u.to>=c)return e(r,n,i,o,a,s);e(r,n.slice(0,u.to-l),i,o,null,s),o=null,n=n.slice(u.to-l),l=u.to}}}function fi(e,t,r,n){var i=!n&&r.widgetNode;i&&(e.map.push(e.pos,e.pos+t,i),e.content.appendChild(i)),e.pos+=t}function di(e,t,r){var n=e.markedSpans,i=e.text,o=0;if(n)for(var a,s,l,c,h,u,f=i.length,d=0,p=1,m="",g=0;;){if(g==d){s=l=c=h="",u=null,g=1/0;for(var v=[],E=0;E<n.length;++E){var y=n[E],T=y.marker;y.from<=d&&(null==y.to||y.to>d)?(null!=y.to&&g>y.to&&(g=y.to,l=""),T.className&&(s+=" "+T.className),T.startStyle&&y.from==d&&(c+=" "+T.startStyle),T.endStyle&&y.to==g&&(l+=" "+T.endStyle),T.title&&!h&&(h=T.title),T.collapsed&&(!u||Un(u.marker,T)<0)&&(u=y)):y.from>d&&g>y.from&&(g=y.from),"bookmark"==T.type&&y.from==d&&T.widgetNode&&v.push(T)}if(u&&(u.from||0)==d&&(fi(t,(null==u.to?f+1:u.to)-d,u.marker,null==u.from),null==u.to))return;if(!u&&v.length)for(var E=0;E<v.length;++E)fi(t,0,v[E])}if(d>=f)break;for(var x=Math.min(f,g);;){if(m){var w=d+m.length;if(!u){var b=w>x?m.slice(0,x-d):m;t.addToken(t,b,a?a+s:s,c,d+b.length==g?l:"",h)}if(w>=x){m=m.slice(x-d),d=x;break}d=w,c=""}m=i.slice(o,o=r[p++]),a=ai(r[p++],t.cm.options)}}else for(var p=1;p<r.length;p+=2)t.addToken(t,i.slice(o,o=r[p]),ai(r[p+1],t.cm.options))}function pi(e,t){return 0==t.from.ch&&0==t.to.ch&&""==to(t.text)&&(!e.cm||e.cm.options.wholeLineUpdateBefore)}function mi(e,t,r,n){function i(e){return r?r[e]:null}function o(e,r,i){Zn(e,r,i,n),Xi(e,"change",e,t)}var a=t.from,s=t.to,l=t.text,c=Ti(e,a.line),h=Ti(e,s.line),u=to(l),f=i(l.length-1),d=s.line-a.line;if(pi(e,t)){for(var p=0,m=[];p<l.length-1;++p)m.push(new za(l[p],i(p),n));o(h,h.text,f),d&&e.remove(a.line,d),m.length&&e.insert(a.line,m)}else if(c==h)if(1==l.length)o(c,c.text.slice(0,a.ch)+u+c.text.slice(s.ch),f);else{for(var m=[],p=1;p<l.length-1;++p)m.push(new za(l[p],i(p),n));m.push(new za(u+c.text.slice(s.ch),f,n)),o(c,c.text.slice(0,a.ch)+l[0],i(0)),e.insert(a.line+1,m)}else if(1==l.length)o(c,c.text.slice(0,a.ch)+l[0]+h.text.slice(s.ch),i(0)),e.remove(a.line+1,d);else{o(c,c.text.slice(0,a.ch)+l[0],i(0)),o(h,u+h.text.slice(s.ch),f);for(var p=1,m=[];p<l.length-1;++p)m.push(new za(l[p],i(p),n));d>1&&e.remove(a.line+1,d-1),e.insert(a.line+1,m)}Xi(e,"change",e,t)}function gi(e){this.lines=e,this.parent=null;for(var t=0,r=0;t<e.length;++t)e[t].parent=this,r+=e[t].height;this.height=r}function vi(e){this.children=e;for(var t=0,r=0,n=0;n<e.length;++n){var i=e[n];t+=i.chunkSize(),r+=i.height,i.parent=this}this.size=t,this.height=r,this.parent=null}function Ei(e,t,r){function n(e,i,o){if(e.linked)for(var a=0;a<e.linked.length;++a){var s=e.linked[a];if(s.doc!=i){var l=o&&s.sharedHist;(!r||l)&&(t(s.doc,l),n(s.doc,e,l))}}}n(e,null,!0)}function yi(e,t){if(t.cm)throw new Error("This document is already in use.");e.doc=t,t.cm=e,a(e),r(e),e.options.lineWrapping||d(e),e.options.mode=t.modeOption,nr(e)}function Ti(e,t){if(t-=e.first,0>t||t>=e.size)throw new Error("There is no line "+(t+e.first)+" in the document.");for(var r=e;!r.lines;)for(var n=0;;++n){var i=r.children[n],o=i.chunkSize();if(o>t){r=i;break}t-=o}return r.lines[t]}function xi(e,t,r){var n=[],i=t.line;return e.iter(t.line,r.line+1,function(e){var o=e.text;i==r.line&&(o=o.slice(0,r.ch)),i==t.line&&(o=o.slice(t.ch)),n.push(o),++i}),n}function wi(e,t,r){var n=[];return e.iter(t,r,function(e){n.push(e.text)}),n}function bi(e,t){var r=t-e.height;if(r)for(var n=e;n;n=n.parent)n.height+=r}function Ri(e){if(null==e.parent)return null;for(var t=e.parent,r=ro(t.lines,e),n=t.parent;n;t=n,n=n.parent)for(var i=0;n.children[i]!=t;++i)r+=n.children[i].chunkSize();return r+t.first}function _i(e,t){var r=e.first;e:do{for(var n=0;n<e.children.length;++n){var i=e.children[n],o=i.height;if(o>t){e=i;continue e}t-=o,r+=i.chunkSize()}return r}while(!e.lines);for(var n=0;n<e.lines.length;++n){var a=e.lines[n],s=a.height;if(s>t)break;t-=s}return r+n}function Hi(e){e=Bn(e);for(var t=0,r=e.parent,n=0;n<r.lines.length;++n){var i=r.lines[n];if(i==e)break;t+=i.height}for(var o=r.parent;o;r=o,o=r.parent)for(var n=0;n<o.children.length;++n){var a=o.children[n];if(a==r)break;t+=a.height}return t}function Mi(e){var t=e.order;return null==t&&(t=e.order=ws(e.text)),t}function Si(e){this.done=[],this.undone=[],this.undoDepth=1/0,this.lastModTime=this.lastSelTime=0,this.lastOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=e||1}function Ci(e,t){var r={from:j(t.from),to:Ea(t),text:xi(e,t.from,t.to)};return Di(e,r,t.from.line,t.to.line+1),Ei(e,function(e){Di(e,r,t.from.line,t.to.line+1)},!0),r}function Ai(e){for(;e.length;){var t=to(e);if(!t.ranges)break;e.pop()}}function ki(e,t){return t?(Ai(e.done),to(e.done)):e.done.length&&!to(e.done).ranges?to(e.done):e.done.length>1&&!e.done[e.done.length-2].ranges?(e.done.pop(),to(e.done)):void 0}function Li(e,t,r,n){var i=e.history;i.undone.length=0;var o,a=+new Date;if((i.lastOp==n||i.lastOrigin==t.origin&&t.origin&&("+"==t.origin.charAt(0)&&e.cm&&i.lastModTime>a-e.cm.options.historyEventDelay||"*"==t.origin.charAt(0)))&&(o=ki(i,i.lastOp==n))){var s=to(o.changes);0==sa(t.from,t.to)&&0==sa(t.from,s.to)?s.to=Ea(t):o.changes.push(Ci(e,t))}else{var l=to(i.done);for(l&&l.ranges||Ni(e.sel,i.done),o={changes:[Ci(e,t)],generation:i.generation},i.done.push(o);i.done.length>i.undoDepth;)i.done.shift(),i.done[0].ranges||i.done.shift()}i.done.push(r),i.generation=++i.maxGeneration,i.lastModTime=i.lastSelTime=a,i.lastOp=n,i.lastOrigin=i.lastSelOrigin=t.origin,s||$a(e,"historyAdded")}function Pi(e,t,r,n){var i=t.charAt(0);return"*"==i||"+"==i&&r.ranges.length==n.ranges.length&&r.somethingSelected()==n.somethingSelected()&&new Date-e.history.lastSelTime<=(e.cm?e.cm.options.historyEventDelay:500)}function Fi(e,t,r,n){var i=e.history,o=n&&n.origin;r==i.lastOp||o&&i.lastSelOrigin==o&&(i.lastModTime==i.lastSelTime&&i.lastOrigin==o||Pi(e,o,to(i.done),t))?i.done[i.done.length-1]=t:Ni(t,i.done),i.lastSelTime=+new Date,i.lastSelOrigin=o,i.lastOp=r,n&&n.clearRedo!==!1&&Ai(i.undone)}function Ni(e,t){var r=to(t);r&&r.ranges&&r.equals(e)||t.push(e)}function Di(e,t,r,n){var i=t["spans_"+e.id],o=0;e.iter(Math.max(e.first,r),Math.min(e.first+e.size,n),function(r){r.markedSpans&&((i||(i=t["spans_"+e.id]={}))[o]=r.markedSpans),++o})}function Ui(e){if(!e)return null;for(var t,r=0;r<e.length;++r)e[r].marker.explicitlyCleared?t||(t=e.slice(0,r)):t&&t.push(e[r]);return t?t.length?t:null:e}function Oi(e,t){var r=t["spans_"+e.id];if(!r)return null;for(var n=0,i=[];n<t.text.length;++n)i.push(Ui(r[n]));return i}function zi(e,t,r){for(var n=0,i=[];n<e.length;++n){var o=e[n];if(o.ranges)i.push(r?q.prototype.deepCopy.call(o):o);else{var a=o.changes,s=[];i.push({changes:s});for(var l=0;l<a.length;++l){var c,h=a[l];if(s.push({from:h.from,to:h.to,text:h.text}),t)for(var u in h)(c=u.match(/^spans_(\d+)$/))&&ro(t,Number(c[1]))>-1&&(to(s)[u]=h[u],delete h[u])}}}return i}function Ii(e,t,r,n){r<e.line?e.line+=n:t<e.line&&(e.line=t,e.ch=0)}function Vi(e,t,r,n){for(var i=0;i<e.length;++i){var o=e[i],a=!0;if(o.ranges){o.copied||(o=e[i]=o.deepCopy(),o.copied=!0);for(var s=0;s<o.ranges.length;s++)Ii(o.ranges[s].anchor,t,r,n),Ii(o.ranges[s].head,t,r,n)}else{for(var s=0;s<o.changes.length;++s){var l=o.changes[s];if(r<l.from.line)l.from=aa(l.from.line+n,l.from.ch),l.to=aa(l.to.line+n,l.to.ch);else if(t<=l.to.line){a=!1;break}}a||(e.splice(0,i+1),i=0)}}}function Bi(e,t){var r=t.from.line,n=t.to.line,i=t.text.length-(n-r)-1;Vi(e.done,r,n,i),Vi(e.undone,r,n,i)}function Gi(e){return null!=e.defaultPrevented?e.defaultPrevented:0==e.returnValue}function ji(e){return e.target||e.srcElement}function Wi(e){var t=e.which;return null==t&&(1&e.button?t=1:2&e.button?t=3:4&e.button&&(t=2)),Jo&&e.ctrlKey&&1==t&&(t=3),t}function Xi(e,t){function r(e){return function(){e.apply(null,i)}}var n=e._handlers&&e._handlers[t];if(n){var i=Array.prototype.slice.call(arguments,2);Xa||(++Ja,Xa=[],setTimeout(qi,0));for(var o=0;o<n.length;++o)Xa.push(r(n[o]))}}function qi(){--Ja;var e=Xa;Xa=null;for(var t=0;t<e.length;++t)e[t]()}function Yi(e,t,r){return $a(e,r||t.type,e,t),Gi(t)||t.codemirrorIgnore}function Ki(e){var t=e._handlers&&e._handlers.cursorActivity;if(t)for(var r=e.curOp.cursorActivityHandlers||(e.curOp.cursorActivityHandlers=[]),n=0;n<t.length;++n)-1==ro(r,t[n])&&r.push(t[n])}function Qi(e,t){var r=e._handlers&&e._handlers[t];return r&&r.length>0}function Zi(e){e.prototype.on=function(e,t){Qa(this,e,t)},e.prototype.off=function(e,t){Za(this,e,t)}}function $i(){this.id=null}function Ji(e,t,r){for(var n=0,i=0;;){var o=e.indexOf("	",n);-1==o&&(o=e.length);var a=o-n;if(o==e.length||i+a>=t)return n+Math.min(a,t-i);if(i+=o-n,i+=r-i%r,n=o+1,i>=t)return n}}function eo(e){for(;as.length<=e;)as.push(to(as)+" ");return as[e]}function to(e){return e[e.length-1]}function ro(e,t){for(var r=0;r<e.length;++r)if(e[r]==t)return r;return-1}function no(e,t){for(var r=[],n=0;n<e.length;n++)r[n]=t(e[n],n);return r}function io(e,t){var r;if(Object.create)r=Object.create(e);else{var n=function(){};n.prototype=e,r=new n}return t&&oo(t,r),r}function oo(e,t,r){t||(t={});for(var n in e)!e.hasOwnProperty(n)||r===!1&&t.hasOwnProperty(n)||(t[n]=e[n]);return t}function ao(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t)}}function so(e,t){return t?t.source.indexOf("\\w")>-1&&hs(e)?!0:t.test(e):hs(e)}function lo(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t])return!1;return!0}function co(e){return e.charCodeAt(0)>=768&&us.test(e)}function ho(e,t,r,n){var i=document.createElement(e);if(r&&(i.className=r),n&&(i.style.cssText=n),"string"==typeof t)i.appendChild(document.createTextNode(t));else if(t)for(var o=0;o<t.length;++o)i.appendChild(t[o]);return i}function uo(e){for(var t=e.childNodes.length;t>0;--t)e.removeChild(e.firstChild);return e}function fo(e,t){return uo(e).appendChild(t)}function po(e,t){if(e.contains)return e.contains(t);for(;t=t.parentNode;)if(t==e)return!0}function mo(){return document.activeElement}function go(e){return new RegExp("\\b"+e+"\\b\\s*")}function vo(e,t){var r=go(t);r.test(e.className)&&(e.className=e.className.replace(r,""))}function Eo(e,t){go(t).test(e.className)||(e.className+=" "+t)}function yo(e,t){for(var r=e.split(" "),n=0;n<r.length;n++)r[n]&&!go(r[n]).test(t)&&(t+=" "+r[n]);return t}function To(e){if(document.body.getElementsByClassName)for(var t=document.body.getElementsByClassName("CodeMirror"),r=0;r<t.length;r++){var n=t[r].CodeMirror;n&&e(n)}}function xo(){ms||(wo(),ms=!0)}function wo(){var e;Qa(window,"resize",function(){null==e&&(e=setTimeout(function(){e=null,fs=null,To(Er)},100))}),Qa(window,"blur",function(){To(Vr)})}function bo(e){if(null!=fs)return fs;var t=ho("div",null,null,"width: 50px; height: 50px; overflow-x: scroll");return fo(e,t),t.offsetWidth&&(fs=t.offsetHeight-t.clientHeight),fs||0}function Ro(e){if(null==ds){var t=ho("span","");fo(e,ho("span",[t,document.createTextNode("x")])),0!=e.firstChild.offsetHeight&&(ds=t.offsetWidth<=1&&t.offsetHeight>2&&!(Vo&&8>Bo))}return ds?ho("span",""):ho("span","",null,"display: inline-block; width: 1px; margin-right: -1px")}function _o(e){if(null!=ps)return ps;var t=fo(e,document.createTextNode("AA")),r=ls(t,0,1).getBoundingClientRect();if(r.left==r.right)return!1;var n=ls(t,1,2).getBoundingClientRect();return ps=n.right-r.right<3}function Ho(e,t,r,n){if(!e)return n(t,r,"ltr");for(var i=!1,o=0;o<e.length;++o){var a=e[o];(a.from<r&&a.to>t||t==r&&a.to==t)&&(n(Math.max(a.from,t),Math.min(a.to,r),1==a.level?"rtl":"ltr"),i=!0)}i||n(t,r,"ltr")}function Mo(e){return e.level%2?e.to:e.from}function So(e){return e.level%2?e.from:e.to}function Co(e){var t=Mi(e);return t?Mo(t[0]):0}function Ao(e){var t=Mi(e);return t?So(to(t)):e.text.length}function ko(e,t){var r=Ti(e.doc,t),n=Bn(r);n!=r&&(t=Ri(n));var i=Mi(n),o=i?i[0].level%2?Ao(n):Co(n):0;return aa(t,o)}function Lo(e,t){for(var r,n=Ti(e.doc,t);r=In(n);)n=r.find(1,!0).line,t=null;var i=Mi(n),o=i?i[0].level%2?Co(n):Ao(n):n.text.length;return aa(null==t?Ri(n):t,o)}function Po(e,t,r){var n=e[0].level;return t==n?!0:r==n?!1:r>t}function Fo(e,t){xs=null;for(var r,n=0;n<e.length;++n){var i=e[n];if(i.from<t&&i.to>t)return n;if(i.from==t||i.to==t){if(null!=r)return Po(e,i.level,e[r].level)?(i.from!=i.to&&(xs=r),n):(i.from!=i.to&&(xs=n),r);r=n}}return r}function No(e,t,r,n){if(!n)return t+r;do t+=r;while(t>0&&co(e.text.charAt(t)));return t}function Do(e,t,r,n){var i=Mi(e);if(!i)return Uo(e,t,r,n);for(var o=Fo(i,t),a=i[o],s=No(e,t,a.level%2?-r:r,n);;){if(s>a.from&&s<a.to)return s;if(s==a.from||s==a.to)return Fo(i,s)==o?s:(a=i[o+=r],r>0==a.level%2?a.to:a.from);if(a=i[o+=r],!a)return null;s=r>0==a.level%2?No(e,a.to,-1,n):No(e,a.from,1,n)}}function Uo(e,t,r,n){var i=t+r;if(n)for(;i>0&&co(e.text.charAt(i));)i+=r;return 0>i||i>e.text.length?null:i}var Oo=/gecko\/\d/i.test(navigator.userAgent),zo=/MSIE \d/.test(navigator.userAgent),Io=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),Vo=zo||Io,Bo=Vo&&(zo?document.documentMode||6:Io[1]),Go=/WebKit\//.test(navigator.userAgent),jo=Go&&/Qt\/\d+\.\d+/.test(navigator.userAgent),Wo=/Chrome\//.test(navigator.userAgent),Xo=/Opera\//.test(navigator.userAgent),qo=/Apple Computer/.test(navigator.vendor),Yo=/KHTML\//.test(navigator.userAgent),Ko=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(navigator.userAgent),Qo=/PhantomJS/.test(navigator.userAgent),Zo=/AppleWebKit/.test(navigator.userAgent)&&/Mobile\/\w+/.test(navigator.userAgent),$o=Zo||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(navigator.userAgent),Jo=Zo||/Mac/.test(navigator.platform),ea=/win/i.test(navigator.platform),ta=Xo&&navigator.userAgent.match(/Version\/(\d*\.\d*)/);ta&&(ta=Number(ta[1])),ta&&ta>=15&&(Xo=!1,Go=!0);var ra=Jo&&(jo||Xo&&(null==ta||12.11>ta)),na=Oo||Vo&&Bo>=9,ia=!1,oa=!1,aa=e.Pos=function(e,t){return this instanceof aa?(this.line=e,void(this.ch=t)):new aa(e,t)},sa=e.cmpPos=function(e,t){return e.line-t.line||e.ch-t.ch};q.prototype={primary:function(){return this.ranges[this.primIndex]},equals:function(e){if(e==this)return!0;if(e.primIndex!=this.primIndex||e.ranges.length!=this.ranges.length)return!1;for(var t=0;t<this.ranges.length;t++){var r=this.ranges[t],n=e.ranges[t];if(0!=sa(r.anchor,n.anchor)||0!=sa(r.head,n.head))return!1}return!0},deepCopy:function(){for(var e=[],t=0;t<this.ranges.length;t++)e[t]=new Y(j(this.ranges[t].anchor),j(this.ranges[t].head));return new q(e,this.primIndex)},somethingSelected:function(){for(var e=0;e<this.ranges.length;e++)if(!this.ranges[e].empty())return!0;return!1},contains:function(e,t){t||(t=e);for(var r=0;r<this.ranges.length;r++){var n=this.ranges[r];if(sa(t,n.from())>=0&&sa(e,n.to())<=0)return r}return-1}},Y.prototype={from:function(){return X(this.anchor,this.head)},to:function(){return W(this.anchor,this.head)},empty:function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch}};var la,ca,ha,ua={left:0,right:0,top:0,bottom:0},fa=0,da=0,pa=0,ma=null;Vo?ma=-.53:Oo?ma=15:Wo?ma=-.7:qo&&(ma=-1/3);var ga,va=null,Ea=e.changeEnd=function(e){return e.text?aa(e.from.line+e.text.length-1,to(e.text).length+(1==e.text.length?e.from.ch:0)):e.to};e.prototype={constructor:e,focus:function(){window.focus(),pr(this),ur(this)},setOption:function(e,t){var r=this.options,n=r[e];(r[e]!=t||"mode"==e)&&(r[e]=t,Ta.hasOwnProperty(e)&&$t(this,Ta[e])(this,t,n))},getOption:function(e){return this.options[e]},getDoc:function(){return this.doc},addKeyMap:function(e,t){this.state.keyMaps[t?"push":"unshift"](e)},removeKeyMap:function(e){for(var t=this.state.keyMaps,r=0;r<t.length;++r)if(t[r]==e||"string"!=typeof t[r]&&t[r].name==e)return t.splice(r,1),!0},addOverlay:Jt(function(t,r){var n=t.token?t:e.getMode(this.options,t);if(n.startState)throw new Error("Overlays may not be stateful.");this.state.overlays.push({mode:n,modeSpec:t,opaque:r&&r.opaque}),this.state.modeGen++,nr(this)}),removeOverlay:Jt(function(e){for(var t=this.state.overlays,r=0;r<t.length;++r){var n=t[r].modeSpec;if(n==e||"string"==typeof e&&n.name==e)return t.splice(r,1),this.state.modeGen++,void nr(this)}}),indentLine:Jt(function(e,t,r){"string"!=typeof t&&"number"!=typeof t&&(t=null==t?this.options.smartIndent?"smart":"prev":t?"add":"subtract"),et(this.doc,e)&&hn(this,e,t,r)}),indentSelection:Jt(function(e){for(var t=this.doc.sel.ranges,r=-1,n=0;n<t.length;n++){var i=t[n];if(i.empty())i.head.line>r&&(hn(this,i.head.line,e,!0),r=i.head.line,n==this.doc.sel.primIndex&&ln(this));else{var o=Math.max(r,i.from().line),a=i.to();r=Math.min(this.lastLine(),a.line-(a.ch?0:1))+1;for(var s=o;r>s;++s)hn(this,s,e)}}}),getTokenAt:function(e,t){var r=this.doc;e=$(r,e);for(var n=wt(this,e.line,t),i=this.doc.mode,o=Ti(r,e.line),a=new Fa(o.text,this.options.tabSize);a.pos<e.ch&&!a.eol();){a.start=a.pos;var s=ti(i,a,n)}return{start:a.start,end:a.pos,string:a.current(),type:s||null,state:n}},getTokenTypeAt:function(e){e=$(this.doc,e);var t,r=ii(this,Ti(this.doc,e.line)),n=0,i=(r.length-1)/2,o=e.ch;if(0==o)t=r[2];else for(;;){var a=n+i>>1;if((a?r[2*a-1]:0)>=o)i=a;else{if(!(r[2*a+1]<o)){t=r[2*a+2];break}n=a+1}}var s=t?t.indexOf("cm-overlay "):-1;return 0>s?t:0==s?null:t.slice(0,s-1)},getModeAt:function(t){var r=this.doc.mode;return r.innerMode?e.innerMode(r,this.getTokenAt(t).state).mode:r},getHelper:function(e,t){return this.getHelpers(e,t)[0]},getHelpers:function(e,t){var r=[];if(!Ha.hasOwnProperty(t))return Ha;var n=Ha[t],i=this.getModeAt(e);if("string"==typeof i[t])n[i[t]]&&r.push(n[i[t]]);else if(i[t])for(var o=0;o<i[t].length;o++){var a=n[i[t][o]];a&&r.push(a)}else i.helperType&&n[i.helperType]?r.push(n[i.helperType]):n[i.name]&&r.push(n[i.name]);for(var o=0;o<n._global.length;o++){var s=n._global[o];s.pred(i,this)&&-1==ro(r,s.val)&&r.push(s.val)}return r},getStateAfter:function(e,t){var r=this.doc;return e=Z(r,null==e?r.first+r.size-1:e),wt(this,e+1,t)},cursorCoords:function(e,t){var r,n=this.doc.sel.primary();return r=null==e?n.head:"object"==typeof e?$(this.doc,e):e?n.from():n.to(),Bt(this,r,t||"page")},charCoords:function(e,t){return Vt(this,$(this.doc,e),t||"page")},coordsChar:function(e,t){return e=It(this,e,t||"page"),Wt(this,e.left,e.top)},lineAtHeight:function(e,t){return e=It(this,{top:e,left:0},t||"page").top,_i(this.doc,e+this.display.viewOffset)},heightAtLine:function(e,t){var r=!1,n=this.doc.first+this.doc.size-1;e<this.doc.first?e=this.doc.first:e>n&&(e=n,r=!0);var i=Ti(this.doc,e);return zt(this,i,{top:0,left:0},t||"page").top+(r?this.doc.height-Hi(i):0)},defaultTextHeight:function(){return qt(this.display)},defaultCharWidth:function(){return Yt(this.display)},setGutterMarker:Jt(function(e,t,r){return un(this.doc,e,"gutter",function(e){var n=e.gutterMarkers||(e.gutterMarkers={});return n[t]=r,!r&&lo(n)&&(e.gutterMarkers=null),!0})}),clearGutter:Jt(function(e){var t=this,r=t.doc,n=r.first;r.iter(function(r){r.gutterMarkers&&r.gutterMarkers[e]&&(r.gutterMarkers[e]=null,ir(t,n,"gutter"),lo(r.gutterMarkers)&&(r.gutterMarkers=null)),++n})}),addLineWidget:Jt(function(e,t,r){return Qn(this,e,t,r)}),removeLineWidget:function(e){e.clear()},lineInfo:function(e){if("number"==typeof e){if(!et(this.doc,e))return null;var t=e;if(e=Ti(this.doc,e),!e)return null}else{var t=Ri(e);if(null==t)return null}return{line:t,handle:e,text:e.text,gutterMarkers:e.gutterMarkers,textClass:e.textClass,bgClass:e.bgClass,wrapClass:e.wrapClass,widgets:e.widgets}},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}
},addWidget:function(e,t,r,n,i){var o=this.display;e=Bt(this,$(this.doc,e));var a=e.bottom,s=e.left;if(t.style.position="absolute",o.sizer.appendChild(t),"over"==n)a=e.top;else if("above"==n||"near"==n){var l=Math.max(o.wrapper.clientHeight,this.doc.height),c=Math.max(o.sizer.clientWidth,o.lineSpace.clientWidth);("above"==n||e.bottom+t.offsetHeight>l)&&e.top>t.offsetHeight?a=e.top-t.offsetHeight:e.bottom+t.offsetHeight<=l&&(a=e.bottom),s+t.offsetWidth>c&&(s=c-t.offsetWidth)}t.style.top=a+"px",t.style.left=t.style.right="","right"==i?(s=o.sizer.clientWidth-t.offsetWidth,t.style.right="0px"):("left"==i?s=0:"middle"==i&&(s=(o.sizer.clientWidth-t.offsetWidth)/2),t.style.left=s+"px"),r&&on(this,s,a,s+t.offsetWidth,a+t.offsetHeight)},triggerOnKeyDown:Jt(Dr),triggerOnKeyPress:Jt(zr),triggerOnKeyUp:Jt(Or),execCommand:function(e){return Ca.hasOwnProperty(e)?Ca[e](this):void 0},findPosH:function(e,t,r,n){var i=1;0>t&&(i=-1,t=-t);for(var o=0,a=$(this.doc,e);t>o&&(a=dn(this.doc,a,i,r,n),!a.hitSide);++o);return a},moveH:Jt(function(e,t){var r=this;r.extendSelectionsBy(function(n){return r.display.shift||r.doc.extend||n.empty()?dn(r.doc,n.head,e,t,r.options.rtlMoveVisually):0>e?n.from():n.to()},is)}),deleteH:Jt(function(e,t){var r=this.doc.sel,n=this.doc;r.somethingSelected()?n.replaceSelection("",null,"+delete"):fn(this,function(r){var i=dn(n,r.head,e,t,!1);return 0>e?{from:i,to:r.head}:{from:r.head,to:i}})}),findPosV:function(e,t,r,n){var i=1,o=n;0>t&&(i=-1,t=-t);for(var a=0,s=$(this.doc,e);t>a;++a){var l=Bt(this,s,"div");if(null==o?o=l.left:l.left=o,s=pn(this,l,i,r),s.hitSide)break}return s},moveV:Jt(function(e,t){var r=this,n=this.doc,i=[],o=!r.display.shift&&!n.extend&&n.sel.somethingSelected();if(n.extendSelectionsBy(function(a){if(o)return 0>e?a.from():a.to();var s=Bt(r,a.head,"div");null!=a.goalColumn&&(s.left=a.goalColumn),i.push(s.left);var l=pn(r,s,e,t);return"page"==t&&a==n.sel.primary()&&sn(r,null,Vt(r,l,"div").top-s.top),l},is),i.length)for(var a=0;a<n.sel.ranges.length;a++)n.sel.ranges[a].goalColumn=i[a]}),toggleOverwrite:function(e){(null==e||e!=this.state.overwrite)&&((this.state.overwrite=!this.state.overwrite)?Eo(this.display.cursorDiv,"CodeMirror-overwrite"):vo(this.display.cursorDiv,"CodeMirror-overwrite"),$a(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return mo()==this.display.input},scrollTo:Jt(function(e,t){(null!=e||null!=t)&&cn(this),null!=e&&(this.curOp.scrollLeft=e),null!=t&&(this.curOp.scrollTop=t)}),getScrollInfo:function(){var e=this.display.scroller,t=es;return{left:e.scrollLeft,top:e.scrollTop,height:e.scrollHeight-t,width:e.scrollWidth-t,clientHeight:e.clientHeight-t,clientWidth:e.clientWidth-t}},scrollIntoView:Jt(function(e,t){if(null==e?(e={from:this.doc.sel.primary().head,to:null},null==t&&(t=this.options.cursorScrollMargin)):"number"==typeof e?e={from:aa(e,0),to:null}:null==e.from&&(e={from:e,to:null}),e.to||(e.to=e.from),e.margin=t||0,null!=e.from.line)cn(this),this.curOp.scrollToPos=e;else{var r=an(this,Math.min(e.from.left,e.to.left),Math.min(e.from.top,e.to.top)-e.margin,Math.max(e.from.right,e.to.right),Math.max(e.from.bottom,e.to.bottom)+e.margin);this.scrollTo(r.scrollLeft,r.scrollTop)}}),setSize:Jt(function(e,t){function r(e){return"number"==typeof e||/^\d+$/.test(String(e))?e+"px":e}var n=this;null!=e&&(n.display.wrapper.style.width=r(e)),null!=t&&(n.display.wrapper.style.height=r(t)),n.options.lineWrapping&&Nt(this);var i=n.display.viewFrom;n.doc.iter(i,n.display.viewTo,function(e){if(e.widgets)for(var t=0;t<e.widgets.length;t++)if(e.widgets[t].noHScroll){ir(n,i,"widget");break}++i}),n.curOp.forceUpdate=!0,$a(n,"refresh",this)}),operation:function(e){return Zt(this,e)},refresh:Jt(function(){var e=this.display.cachedTextHeight;nr(this),this.curOp.forceUpdate=!0,Dt(this),this.scrollTo(this.doc.scrollLeft,this.doc.scrollTop),u(this),(null==e||Math.abs(e-qt(this.display))>.5)&&a(this),$a(this,"refresh",this)}),swapDoc:Jt(function(e){var t=this.doc;return t.cm=null,yi(this,e),Dt(this),dr(this),this.scrollTo(e.scrollLeft,e.scrollTop),Xi(this,"swapDoc",this,t),t}),getInputField:function(){return this.display.input},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},Zi(e);var ya=e.defaults={},Ta=e.optionHandlers={},xa=e.Init={toString:function(){return"CodeMirror.Init"}};gn("value","",function(e,t){e.setValue(t)},!0),gn("mode",null,function(e,t){e.doc.modeOption=t,r(e)},!0),gn("indentUnit",2,r,!0),gn("indentWithTabs",!1),gn("smartIndent",!0),gn("tabSize",4,function(e){n(e),Dt(e),nr(e)},!0),gn("specialChars",/[\t\u0000-\u0019\u00ad\u200b\u2028\u2029\ufeff]/g,function(e,t){e.options.specialChars=new RegExp(t.source+(t.test("	")?"":"|	"),"g"),e.refresh()},!0),gn("specialCharPlaceholder",li,function(e){e.refresh()},!0),gn("electricChars",!0),gn("rtlMoveVisually",!ea),gn("wholeLineUpdateBefore",!0),gn("theme","default",function(e){l(e),c(e)},!0),gn("keyMap","default",s),gn("extraKeys",null),gn("lineWrapping",!1,i,!0),gn("gutters",[],function(e){p(e.options),c(e)},!0),gn("fixedGutter",!0,function(e,t){e.display.gutters.style.left=t?w(e.display)+"px":"0",e.refresh()},!0),gn("coverGutterNextToScrollbar",!1,v,!0),gn("lineNumbers",!1,function(e){p(e.options),c(e)},!0),gn("firstLineNumber",1,c,!0),gn("lineNumberFormatter",function(e){return e},c,!0),gn("showCursorWhenSelecting",!1,mt,!0),gn("resetSelectionOnContextMenu",!0),gn("readOnly",!1,function(e,t){"nocursor"==t?(Vr(e),e.display.input.blur(),e.display.disabled=!0):(e.display.disabled=!1,t||dr(e))}),gn("disableInput",!1,function(e,t){t||dr(e)},!0),gn("dragDrop",!0),gn("cursorBlinkRate",530),gn("cursorScrollMargin",0),gn("cursorHeight",1,mt,!0),gn("singleCursorHeightPerLine",!0,mt,!0),gn("workTime",100),gn("workDelay",100),gn("flattenSpans",!0,n,!0),gn("addModeClass",!1,n,!0),gn("pollInterval",100),gn("undoDepth",200,function(e,t){e.doc.history.undoDepth=t}),gn("historyEventDelay",1250),gn("viewportMargin",10,function(e){e.refresh()},!0),gn("maxHighlightLength",1e4,n,!0),gn("moveInputWithCursor",!0,function(e,t){t||(e.display.inputDiv.style.top=e.display.inputDiv.style.left=0)}),gn("tabindex",null,function(e,t){e.display.input.tabIndex=t||""}),gn("autofocus",null);var wa=e.modes={},ba=e.mimeModes={};e.defineMode=function(t,r){if(e.defaults.mode||"null"==t||(e.defaults.mode=t),arguments.length>2){r.dependencies=[];for(var n=2;n<arguments.length;++n)r.dependencies.push(arguments[n])}wa[t]=r},e.defineMIME=function(e,t){ba[e]=t},e.resolveMode=function(t){if("string"==typeof t&&ba.hasOwnProperty(t))t=ba[t];else if(t&&"string"==typeof t.name&&ba.hasOwnProperty(t.name)){var r=ba[t.name];"string"==typeof r&&(r={name:r}),t=io(r,t),t.name=r.name}else if("string"==typeof t&&/^[\w\-]+\/[\w\-]+\+xml$/.test(t))return e.resolveMode("application/xml");return"string"==typeof t?{name:t}:t||{name:"null"}},e.getMode=function(t,r){var r=e.resolveMode(r),n=wa[r.name];if(!n)return e.getMode(t,"text/plain");var i=n(t,r);if(Ra.hasOwnProperty(r.name)){var o=Ra[r.name];for(var a in o)o.hasOwnProperty(a)&&(i.hasOwnProperty(a)&&(i["_"+a]=i[a]),i[a]=o[a])}if(i.name=r.name,r.helperType&&(i.helperType=r.helperType),r.modeProps)for(var a in r.modeProps)i[a]=r.modeProps[a];return i},e.defineMode("null",function(){return{token:function(e){e.skipToEnd()}}}),e.defineMIME("text/plain","null");var Ra=e.modeExtensions={};e.extendMode=function(e,t){var r=Ra.hasOwnProperty(e)?Ra[e]:Ra[e]={};oo(t,r)},e.defineExtension=function(t,r){e.prototype[t]=r},e.defineDocExtension=function(e,t){Ga.prototype[e]=t},e.defineOption=gn;var _a=[];e.defineInitHook=function(e){_a.push(e)};var Ha=e.helpers={};e.registerHelper=function(t,r,n){Ha.hasOwnProperty(t)||(Ha[t]=e[t]={_global:[]}),Ha[t][r]=n},e.registerGlobalHelper=function(t,r,n,i){e.registerHelper(t,r,i),Ha[t]._global.push({pred:n,val:i})};var Ma=e.copyState=function(e,t){if(t===!0)return t;if(e.copyState)return e.copyState(t);var r={};for(var n in t){var i=t[n];i instanceof Array&&(i=i.concat([])),r[n]=i}return r},Sa=e.startState=function(e,t,r){return e.startState?e.startState(t,r):!0};e.innerMode=function(e,t){for(;e.innerMode;){var r=e.innerMode(t);if(!r||r.mode==e)break;t=r.state,e=r.mode}return r||{mode:e,state:t}};var Ca=e.commands={selectAll:function(e){e.setSelection(aa(e.firstLine(),0),aa(e.lastLine()),rs)},singleSelection:function(e){e.setSelection(e.getCursor("anchor"),e.getCursor("head"),rs)},killLine:function(e){fn(e,function(t){if(t.empty()){var r=Ti(e.doc,t.head.line).text.length;return t.head.ch==r&&t.head.line<e.lastLine()?{from:t.head,to:aa(t.head.line+1,0)}:{from:t.head,to:aa(t.head.line,r)}}return{from:t.from(),to:t.to()}})},deleteLine:function(e){fn(e,function(t){return{from:aa(t.from().line,0),to:$(e.doc,aa(t.to().line+1,0))}})},delLineLeft:function(e){fn(e,function(e){return{from:aa(e.from().line,0),to:e.from()}})},undo:function(e){e.undo()},redo:function(e){e.redo()},undoSelection:function(e){e.undoSelection()},redoSelection:function(e){e.redoSelection()},goDocStart:function(e){e.extendSelection(aa(e.firstLine(),0))},goDocEnd:function(e){e.extendSelection(aa(e.lastLine()))},goLineStart:function(e){e.extendSelectionsBy(function(t){return ko(e,t.head.line)},{origin:"+move",bias:1})},goLineStartSmart:function(e){e.extendSelectionsBy(function(t){var r=ko(e,t.head.line),n=e.getLineHandle(r.line),i=Mi(n);if(!i||0==i[0].level){var o=Math.max(0,n.text.search(/\S/)),a=t.head.line==r.line&&t.head.ch<=o&&t.head.ch;return aa(r.line,a?0:o)}return r},{origin:"+move",bias:1})},goLineEnd:function(e){e.extendSelectionsBy(function(t){return Lo(e,t.head.line)},{origin:"+move",bias:-1})},goLineRight:function(e){e.extendSelectionsBy(function(t){var r=e.charCoords(t.head,"div").top+5;return e.coordsChar({left:e.display.lineDiv.offsetWidth+100,top:r},"div")},is)},goLineLeft:function(e){e.extendSelectionsBy(function(t){var r=e.charCoords(t.head,"div").top+5;return e.coordsChar({left:0,top:r},"div")},is)},goLineUp:function(e){e.moveV(-1,"line")},goLineDown:function(e){e.moveV(1,"line")},goPageUp:function(e){e.moveV(-1,"page")},goPageDown:function(e){e.moveV(1,"page")},goCharLeft:function(e){e.moveH(-1,"char")},goCharRight:function(e){e.moveH(1,"char")},goColumnLeft:function(e){e.moveH(-1,"column")},goColumnRight:function(e){e.moveH(1,"column")},goWordLeft:function(e){e.moveH(-1,"word")},goGroupRight:function(e){e.moveH(1,"group")},goGroupLeft:function(e){e.moveH(-1,"group")},goWordRight:function(e){e.moveH(1,"word")},delCharBefore:function(e){e.deleteH(-1,"char")},delCharAfter:function(e){e.deleteH(1,"char")},delWordBefore:function(e){e.deleteH(-1,"word")},delWordAfter:function(e){e.deleteH(1,"word")},delGroupBefore:function(e){e.deleteH(-1,"group")},delGroupAfter:function(e){e.deleteH(1,"group")},indentAuto:function(e){e.indentSelection("smart")},indentMore:function(e){e.indentSelection("add")},indentLess:function(e){e.indentSelection("subtract")},insertTab:function(e){e.replaceSelection("	")},insertSoftTab:function(e){for(var t=[],r=e.listSelections(),n=e.options.tabSize,i=0;i<r.length;i++){var o=r[i].from(),a=os(e.getLine(o.line),o.ch,n);t.push(new Array(n-a%n+1).join(" "))}e.replaceSelections(t)},defaultTab:function(e){e.somethingSelected()?e.indentSelection("add"):e.execCommand("insertTab")},transposeChars:function(e){Zt(e,function(){for(var t=e.listSelections(),r=[],n=0;n<t.length;n++){var i=t[n].head,o=Ti(e.doc,i.line).text;if(o)if(i.ch==o.length&&(i=new aa(i.line,i.ch-1)),i.ch>0)i=new aa(i.line,i.ch+1),e.replaceRange(o.charAt(i.ch-1)+o.charAt(i.ch-2),aa(i.line,i.ch-2),i,"+transpose");else if(i.line>e.doc.first){var a=Ti(e.doc,i.line-1).text;a&&e.replaceRange(o.charAt(0)+"\n"+a.charAt(a.length-1),aa(i.line-1,a.length-1),aa(i.line,1),"+transpose")}r.push(new Y(i,i))}e.setSelections(r)})},newlineAndIndent:function(e){Zt(e,function(){for(var t=e.listSelections().length,r=0;t>r;r++){var n=e.listSelections()[r];e.replaceRange("\n",n.anchor,n.head,"+input"),e.indentLine(n.from().line+1,null,!0),ln(e)}})},toggleOverwrite:function(e){e.toggleOverwrite()}},Aa=e.keyMap={};Aa.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},Aa.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-Up":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Down":"goDocEnd","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},Aa.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineStart","Cmd-Right":"goLineEnd","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delLineLeft","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection",fallthrough:["basic","emacsy"]},Aa.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars"},Aa["default"]=Jo?Aa.macDefault:Aa.pcDefault;var ka=e.lookupKey=function(e,t,r){function n(t){t=vn(t);var i=t[e];if(i===!1)return"stop";if(null!=i&&r(i))return!0;if(t.nofallthrough)return"stop";var o=t.fallthrough;if(null==o)return!1;if("[object Array]"!=Object.prototype.toString.call(o))return n(o);for(var a=0;a<o.length;++a){var s=n(o[a]);if(s)return s}return!1}for(var i=0;i<t.length;++i){var o=n(t[i]);if(o)return"stop"!=o}},La=e.isModifierKey=function(e){var t=Ts[e.keyCode];return"Ctrl"==t||"Alt"==t||"Shift"==t||"Mod"==t},Pa=e.keyName=function(e,t){if(Xo&&34==e.keyCode&&e["char"])return!1;var r=Ts[e.keyCode];return null==r||e.altGraphKey?!1:(e.altKey&&(r="Alt-"+r),(ra?e.metaKey:e.ctrlKey)&&(r="Ctrl-"+r),(ra?e.ctrlKey:e.metaKey)&&(r="Cmd-"+r),!t&&e.shiftKey&&(r="Shift-"+r),r)};e.fromTextArea=function(t,r){function n(){t.value=c.getValue()}if(r||(r={}),r.value=t.value,!r.tabindex&&t.tabindex&&(r.tabindex=t.tabindex),!r.placeholder&&t.placeholder&&(r.placeholder=t.placeholder),null==r.autofocus){var i=mo();r.autofocus=i==t||null!=t.getAttribute("autofocus")&&i==document.body}if(t.form&&(Qa(t.form,"submit",n),!r.leaveSubmitMethodAlone)){var o=t.form,a=o.submit;try{var s=o.submit=function(){n(),o.submit=a,o.submit(),o.submit=s}}catch(l){}}t.style.display="none";var c=e(function(e){t.parentNode.insertBefore(e,t.nextSibling)},r);return c.save=n,c.getTextArea=function(){return t},c.toTextArea=function(){n(),t.parentNode.removeChild(c.getWrapperElement()),t.style.display="",t.form&&(Za(t.form,"submit",n),"function"==typeof t.form.submit&&(t.form.submit=a))},c};var Fa=e.StringStream=function(e,t){this.pos=this.start=0,this.string=e,this.tabSize=t||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0};Fa.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos==this.lineStart},peek:function(){return this.string.charAt(this.pos)||void 0},next:function(){return this.pos<this.string.length?this.string.charAt(this.pos++):void 0},eat:function(e){var t=this.string.charAt(this.pos);if("string"==typeof e)var r=t==e;else var r=t&&(e.test?e.test(t):e(t));return r?(++this.pos,t):void 0},eatWhile:function(e){for(var t=this.pos;this.eat(e););return this.pos>t},eatSpace:function(){for(var e=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>e},skipToEnd:function(){this.pos=this.string.length},skipTo:function(e){var t=this.string.indexOf(e,this.pos);return t>-1?(this.pos=t,!0):void 0},backUp:function(e){this.pos-=e},column:function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=os(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?os(this.string,this.lineStart,this.tabSize):0)},indentation:function(){return os(this.string,null,this.tabSize)-(this.lineStart?os(this.string,this.lineStart,this.tabSize):0)},match:function(e,t,r){if("string"!=typeof e){var n=this.string.slice(this.pos).match(e);return n&&n.index>0?null:(n&&t!==!1&&(this.pos+=n[0].length),n)}var i=function(e){return r?e.toLowerCase():e},o=this.string.substr(this.pos,e.length);return i(o)==i(e)?(t!==!1&&(this.pos+=e.length),!0):void 0},current:function(){return this.string.slice(this.start,this.pos)},hideFirstChars:function(e,t){this.lineStart+=e;try{return t()}finally{this.lineStart-=e}}};var Na=e.TextMarker=function(e,t){this.lines=[],this.type=t,this.doc=e};Zi(Na),Na.prototype.clear=function(){if(!this.explicitlyCleared){var e=this.doc.cm,t=e&&!e.curOp;if(t&&Kt(e),Qi(this,"clear")){var r=this.find();r&&Xi(this,"clear",r.from,r.to)}for(var n=null,i=null,o=0;o<this.lines.length;++o){var a=this.lines[o],s=Rn(a.markedSpans,this);e&&!this.collapsed?ir(e,Ri(a),"text"):e&&(null!=s.to&&(i=Ri(a)),null!=s.from&&(n=Ri(a))),a.markedSpans=_n(a.markedSpans,s),null==s.from&&this.collapsed&&!Xn(this.doc,a)&&e&&bi(a,qt(e.display))}if(e&&this.collapsed&&!e.options.lineWrapping)for(var o=0;o<this.lines.length;++o){var l=Bn(this.lines[o]),c=f(l);c>e.display.maxLineLength&&(e.display.maxLine=l,e.display.maxLineLength=c,e.display.maxLineChanged=!0)}null!=n&&e&&this.collapsed&&nr(e,n,i+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,e&&ft(e.doc)),e&&Xi(e,"markerCleared",e,this),t&&Qt(e),this.parent&&this.parent.clear()}},Na.prototype.find=function(e,t){null==e&&"bookmark"==this.type&&(e=1);for(var r,n,i=0;i<this.lines.length;++i){var o=this.lines[i],a=Rn(o.markedSpans,this);if(null!=a.from&&(r=aa(t?o:Ri(o),a.from),-1==e))return r;if(null!=a.to&&(n=aa(t?o:Ri(o),a.to),1==e))return n}return r&&{from:r,to:n}},Na.prototype.changed=function(){var e=this.find(-1,!0),t=this,r=this.doc.cm;e&&r&&Zt(r,function(){var n=e.line,i=Ri(e.line),o=At(r,i);if(o&&(Ft(o),r.curOp.selectionChanged=r.curOp.forceUpdate=!0),r.curOp.updateMaxLine=!0,!Xn(t.doc,n)&&null!=t.height){var a=t.height;t.height=null;var s=Kn(t)-a;s&&bi(n,n.height+s)}})},Na.prototype.attachLine=function(e){if(!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;t.maybeHiddenMarkers&&-1!=ro(t.maybeHiddenMarkers,this)||(t.maybeUnhiddenMarkers||(t.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(e)},Na.prototype.detachLine=function(e){if(this.lines.splice(ro(this.lines,e),1),!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;(t.maybeHiddenMarkers||(t.maybeHiddenMarkers=[])).push(this)}};var Da=0,Ua=e.SharedTextMarker=function(e,t){this.markers=e,this.primary=t;for(var r=0;r<e.length;++r)e[r].parent=this};Zi(Ua),Ua.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var e=0;e<this.markers.length;++e)this.markers[e].clear();Xi(this,"clear")}},Ua.prototype.find=function(e,t){return this.primary.find(e,t)};var Oa=e.LineWidget=function(e,t,r){if(r)for(var n in r)r.hasOwnProperty(n)&&(this[n]=r[n]);this.cm=e,this.node=t};Zi(Oa),Oa.prototype.clear=function(){var e=this.cm,t=this.line.widgets,r=this.line,n=Ri(r);if(null!=n&&t){for(var i=0;i<t.length;++i)t[i]==this&&t.splice(i--,1);t.length||(r.widgets=null);var o=Kn(this);Zt(e,function(){Yn(e,r,-o),ir(e,n,"widget"),bi(r,Math.max(0,r.height-o))})}},Oa.prototype.changed=function(){var e=this.height,t=this.cm,r=this.line;this.height=null;var n=Kn(this)-e;n&&Zt(t,function(){t.curOp.forceUpdate=!0,Yn(t,r,n),bi(r,r.height+n)})};var za=e.Line=function(e,t,r){this.text=e,Fn(this,t),this.height=r?r(this):1};Zi(za),za.prototype.lineNo=function(){return Ri(this)};var Ia={},Va={};gi.prototype={chunkSize:function(){return this.lines.length},removeInner:function(e,t){for(var r=e,n=e+t;n>r;++r){var i=this.lines[r];this.height-=i.height,$n(i),Xi(i,"delete")}this.lines.splice(e,t)},collapse:function(e){e.push.apply(e,this.lines)},insertInner:function(e,t,r){this.height+=r,this.lines=this.lines.slice(0,e).concat(t).concat(this.lines.slice(e));for(var n=0;n<t.length;++n)t[n].parent=this},iterN:function(e,t,r){for(var n=e+t;n>e;++e)if(r(this.lines[e]))return!0}},vi.prototype={chunkSize:function(){return this.size},removeInner:function(e,t){this.size-=t;for(var r=0;r<this.children.length;++r){var n=this.children[r],i=n.chunkSize();if(i>e){var o=Math.min(t,i-e),a=n.height;if(n.removeInner(e,o),this.height-=a-n.height,i==o&&(this.children.splice(r--,1),n.parent=null),0==(t-=o))break;e=0}else e-=i}if(this.size-t<25&&(this.children.length>1||!(this.children[0]instanceof gi))){var s=[];this.collapse(s),this.children=[new gi(s)],this.children[0].parent=this}},collapse:function(e){for(var t=0;t<this.children.length;++t)this.children[t].collapse(e)},insertInner:function(e,t,r){this.size+=t.length,this.height+=r;for(var n=0;n<this.children.length;++n){var i=this.children[n],o=i.chunkSize();if(o>=e){if(i.insertInner(e,t,r),i.lines&&i.lines.length>50){for(;i.lines.length>50;){var a=i.lines.splice(i.lines.length-25,25),s=new gi(a);i.height-=s.height,this.children.splice(n+1,0,s),s.parent=this}this.maybeSpill()}break}e-=o}},maybeSpill:function(){if(!(this.children.length<=10)){var e=this;do{var t=e.children.splice(e.children.length-5,5),r=new vi(t);if(e.parent){e.size-=r.size,e.height-=r.height;var n=ro(e.parent.children,e);e.parent.children.splice(n+1,0,r)}else{var i=new vi(e.children);i.parent=e,e.children=[i,r],e=i}r.parent=e.parent}while(e.children.length>10);e.parent.maybeSpill()}},iterN:function(e,t,r){for(var n=0;n<this.children.length;++n){var i=this.children[n],o=i.chunkSize();if(o>e){var a=Math.min(t,o-e);if(i.iterN(e,a,r))return!0;if(0==(t-=a))break;e=0}else e-=o}}};var Ba=0,Ga=e.Doc=function(e,t,r){if(!(this instanceof Ga))return new Ga(e,t,r);null==r&&(r=0),vi.call(this,[new gi([new za("",null)])]),this.first=r,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1,this.frontier=r;var n=aa(r,0);this.sel=Q(n),this.history=new Si(null),this.id=++Ba,this.modeOption=t,"string"==typeof e&&(e=vs(e)),mi(this,{from:n,to:n,text:e}),ct(this,Q(n),rs)};Ga.prototype=io(vi.prototype,{constructor:Ga,iter:function(e,t,r){r?this.iterN(e-this.first,t-e,r):this.iterN(this.first,this.first+this.size,e)},insert:function(e,t){for(var r=0,n=0;n<t.length;++n)r+=t[n].height;this.insertInner(e-this.first,t,r)},remove:function(e,t){this.removeInner(e-this.first,t)},getValue:function(e){var t=wi(this,this.first,this.first+this.size);return e===!1?t:t.join(e||"\n")},setValue:er(function(e){var t=aa(this.first,0),r=this.first+this.size-1;Kr(this,{from:t,to:aa(r,Ti(this,r).text.length),text:vs(e),origin:"setValue"},!0),ct(this,Q(t))}),replaceRange:function(e,t,r,n){t=$(this,t),r=r?$(this,r):t,tn(this,e,t,r,n)},getRange:function(e,t,r){var n=xi(this,$(this,e),$(this,t));return r===!1?n:n.join(r||"\n")},getLine:function(e){var t=this.getLineHandle(e);return t&&t.text},getLineHandle:function(e){return et(this,e)?Ti(this,e):void 0},getLineNumber:function(e){return Ri(e)},getLineHandleVisualStart:function(e){return"number"==typeof e&&(e=Ti(this,e)),Bn(e)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(e){return $(this,e)},getCursor:function(e){var t,r=this.sel.primary();return t=null==e||"head"==e?r.head:"anchor"==e?r.anchor:"end"==e||"to"==e||e===!1?r.to():r.from()},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:er(function(e,t,r){at(this,$(this,"number"==typeof e?aa(e,t||0):e),null,r)}),setSelection:er(function(e,t,r){at(this,$(this,e),$(this,t||e),r)}),extendSelection:er(function(e,t,r){nt(this,$(this,e),t&&$(this,t),r)}),extendSelections:er(function(e,t){it(this,tt(this,e,t))}),extendSelectionsBy:er(function(e,t){it(this,no(this.sel.ranges,e),t)}),setSelections:er(function(e,t,r){if(e.length){for(var n=0,i=[];n<e.length;n++)i[n]=new Y($(this,e[n].anchor),$(this,e[n].head));null==t&&(t=Math.min(e.length-1,this.sel.primIndex)),ct(this,K(i,t),r)}}),addSelection:er(function(e,t,r){var n=this.sel.ranges.slice(0);n.push(new Y($(this,e),$(this,t||e))),ct(this,K(n,n.length-1),r)}),getSelection:function(e){for(var t,r=this.sel.ranges,n=0;n<r.length;n++){var i=xi(this,r[n].from(),r[n].to());t=t?t.concat(i):i}return e===!1?t:t.join(e||"\n")},getSelections:function(e){for(var t=[],r=this.sel.ranges,n=0;n<r.length;n++){var i=xi(this,r[n].from(),r[n].to());e!==!1&&(i=i.join(e||"\n")),t[n]=i}return t},replaceSelection:function(e,t,r){for(var n=[],i=0;i<this.sel.ranges.length;i++)n[i]=e;this.replaceSelections(n,t,r||"+input")},replaceSelections:er(function(e,t,r){for(var n=[],i=this.sel,o=0;o<i.ranges.length;o++){var a=i.ranges[o];n[o]={from:a.from(),to:a.to(),text:vs(e[o]),origin:r}}for(var s=t&&"end"!=t&&qr(this,n,t),o=n.length-1;o>=0;o--)Kr(this,n[o]);s?lt(this,s):this.cm&&ln(this.cm)}),undo:er(function(){Zr(this,"undo")}),redo:er(function(){Zr(this,"redo")}),undoSelection:er(function(){Zr(this,"undo",!0)}),redoSelection:er(function(){Zr(this,"redo",!0)}),setExtending:function(e){this.extend=e},getExtending:function(){return this.extend},historySize:function(){for(var e=this.history,t=0,r=0,n=0;n<e.done.length;n++)e.done[n].ranges||++t;for(var n=0;n<e.undone.length;n++)e.undone[n].ranges||++r;return{undo:t,redo:r}},clearHistory:function(){this.history=new Si(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(e){return e&&(this.history.lastOp=this.history.lastOrigin=null),this.history.generation},isClean:function(e){return this.history.generation==(e||this.cleanGeneration)},getHistory:function(){return{done:zi(this.history.done),undone:zi(this.history.undone)}},setHistory:function(e){var t=this.history=new Si(this.history.maxGeneration);t.done=zi(e.done.slice(0),null,!0),t.undone=zi(e.undone.slice(0),null,!0)},addLineClass:er(function(e,t,r){return un(this,e,"class",function(e){var n="text"==t?"textClass":"background"==t?"bgClass":"wrapClass";if(e[n]){if(new RegExp("(?:^|\\s)"+r+"(?:$|\\s)").test(e[n]))return!1;e[n]+=" "+r}else e[n]=r;return!0})}),removeLineClass:er(function(e,t,r){return un(this,e,"class",function(e){var n="text"==t?"textClass":"background"==t?"bgClass":"wrapClass",i=e[n];if(!i)return!1;if(null==r)e[n]=null;else{var o=i.match(new RegExp("(?:^|\\s+)"+r+"(?:$|\\s+)"));if(!o)return!1;var a=o.index+o[0].length;e[n]=i.slice(0,o.index)+(o.index&&a!=i.length?" ":"")+i.slice(a)||null}return!0})}),markText:function(e,t,r){return En(this,$(this,e),$(this,t),r,"range")},setBookmark:function(e,t){var r={replacedWith:t&&(null==t.nodeType?t.widget:t),insertLeft:t&&t.insertLeft,clearWhenEmpty:!1,shared:t&&t.shared};return e=$(this,e),En(this,e,e,r,"bookmark")},findMarksAt:function(e){e=$(this,e);var t=[],r=Ti(this,e.line).markedSpans;if(r)for(var n=0;n<r.length;++n){var i=r[n];(null==i.from||i.from<=e.ch)&&(null==i.to||i.to>=e.ch)&&t.push(i.marker.parent||i.marker)}return t},findMarks:function(e,t,r){e=$(this,e),t=$(this,t);var n=[],i=e.line;return this.iter(e.line,t.line+1,function(o){var a=o.markedSpans;if(a)for(var s=0;s<a.length;s++){var l=a[s];i==e.line&&e.ch>l.to||null==l.from&&i!=e.line||i==t.line&&l.from>t.ch||r&&!r(l.marker)||n.push(l.marker.parent||l.marker)}++i}),n},getAllMarks:function(){var e=[];return this.iter(function(t){var r=t.markedSpans;if(r)for(var n=0;n<r.length;++n)null!=r[n].from&&e.push(r[n].marker)}),e},posFromIndex:function(e){var t,r=this.first;return this.iter(function(n){var i=n.text.length+1;return i>e?(t=e,!0):(e-=i,void++r)}),$(this,aa(r,t))},indexFromPos:function(e){e=$(this,e);var t=e.ch;return e.line<this.first||e.ch<0?0:(this.iter(this.first,e.line,function(e){t+=e.text.length+1}),t)},copy:function(e){var t=new Ga(wi(this,this.first,this.first+this.size),this.modeOption,this.first);return t.scrollTop=this.scrollTop,t.scrollLeft=this.scrollLeft,t.sel=this.sel,t.extend=!1,e&&(t.history.undoDepth=this.history.undoDepth,t.setHistory(this.getHistory())),t},linkedDoc:function(e){e||(e={});var t=this.first,r=this.first+this.size;null!=e.from&&e.from>t&&(t=e.from),null!=e.to&&e.to<r&&(r=e.to);var n=new Ga(wi(this,t,r),e.mode||this.modeOption,t);return e.sharedHist&&(n.history=this.history),(this.linked||(this.linked=[])).push({doc:n,sharedHist:e.sharedHist}),n.linked=[{doc:this,isParent:!0,sharedHist:e.sharedHist}],xn(n,Tn(this)),n},unlinkDoc:function(t){if(t instanceof e&&(t=t.doc),this.linked)for(var r=0;r<this.linked.length;++r){var n=this.linked[r];if(n.doc==t){this.linked.splice(r,1),t.unlinkDoc(this),wn(Tn(this));break}}if(t.history==this.history){var i=[t.id];Ei(t,function(e){i.push(e.id)},!0),t.history=new Si(null),t.history.done=zi(this.history.done,i),t.history.undone=zi(this.history.undone,i)}},iterLinkedDocs:function(e){Ei(this,e)},getMode:function(){return this.mode},getEditor:function(){return this.cm}}),Ga.prototype.eachLine=Ga.prototype.iter;var ja="iter insert remove copy getEditor".split(" ");for(var Wa in Ga.prototype)Ga.prototype.hasOwnProperty(Wa)&&ro(ja,Wa)<0&&(e.prototype[Wa]=function(e){return function(){return e.apply(this.doc,arguments)}}(Ga.prototype[Wa]));Zi(Ga);var Xa,qa=e.e_preventDefault=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},Ya=e.e_stopPropagation=function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},Ka=e.e_stop=function(e){qa(e),Ya(e)},Qa=e.on=function(e,t,r){if(e.addEventListener)e.addEventListener(t,r,!1);else if(e.attachEvent)e.attachEvent("on"+t,r);else{var n=e._handlers||(e._handlers={}),i=n[t]||(n[t]=[]);i.push(r)}},Za=e.off=function(e,t,r){if(e.removeEventListener)e.removeEventListener(t,r,!1);else if(e.detachEvent)e.detachEvent("on"+t,r);else{var n=e._handlers&&e._handlers[t];if(!n)return;for(var i=0;i<n.length;++i)if(n[i]==r){n.splice(i,1);break}}},$a=e.signal=function(e,t){var r=e._handlers&&e._handlers[t];if(r)for(var n=Array.prototype.slice.call(arguments,2),i=0;i<r.length;++i)r[i].apply(null,n)},Ja=0,es=30,ts=e.Pass={toString:function(){return"CodeMirror.Pass"}},rs={scroll:!1},ns={origin:"*mouse"},is={origin:"+move"};$i.prototype.set=function(e,t){clearTimeout(this.id),this.id=setTimeout(t,e)};var os=e.countColumn=function(e,t,r,n,i){null==t&&(t=e.search(/[^\s\u00a0]/),-1==t&&(t=e.length));for(var o=n||0,a=i||0;;){var s=e.indexOf("	",o);if(0>s||s>=t)return a+(t-o);a+=s-o,a+=r-a%r,o=s+1}},as=[""],ss=function(e){e.select()};Zo?ss=function(e){e.selectionStart=0,e.selectionEnd=e.value.length}:Vo&&(ss=function(e){try{e.select()}catch(t){}}),[].indexOf&&(ro=function(e,t){return e.indexOf(t)}),[].map&&(no=function(e,t){return e.map(t)});var ls,cs=/[\u00df\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,hs=e.isWordChar=function(e){return/\w/.test(e)||e>""&&(e.toUpperCase()!=e.toLowerCase()||cs.test(e))},us=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;
ls=document.createRange?function(e,t,r){var n=document.createRange();return n.setEnd(e,r),n.setStart(e,t),n}:function(e,t,r){var n=document.body.createTextRange();return n.moveToElementText(e.parentNode),n.collapse(!0),n.moveEnd("character",r),n.moveStart("character",t),n},Vo&&11>Bo&&(mo=function(){try{return document.activeElement}catch(e){return document.body}});var fs,ds,ps,ms=!1,gs=function(){if(Vo&&9>Bo)return!1;var e=ho("div");return"draggable"in e||"dragDrop"in e}(),vs=e.splitLines=3!="\n\nb".split(/\n/).length?function(e){for(var t=0,r=[],n=e.length;n>=t;){var i=e.indexOf("\n",t);-1==i&&(i=e.length);var o=e.slice(t,"\r"==e.charAt(i-1)?i-1:i),a=o.indexOf("\r");-1!=a?(r.push(o.slice(0,a)),t+=a+1):(r.push(o),t=i+1)}return r}:function(e){return e.split(/\r\n?|\n/)},Es=window.getSelection?function(e){try{return e.selectionStart!=e.selectionEnd}catch(t){return!1}}:function(e){try{var t=e.ownerDocument.selection.createRange()}catch(r){}return t&&t.parentElement()==e?0!=t.compareEndPoints("StartToEnd",t):!1},ys=function(){var e=ho("div");return"oncopy"in e?!0:(e.setAttribute("oncopy","return;"),"function"==typeof e.oncopy)}(),Ts={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",107:"=",109:"-",127:"Delete",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"};e.keyNames=Ts,function(){for(var e=0;10>e;e++)Ts[e+48]=Ts[e+96]=String(e);for(var e=65;90>=e;e++)Ts[e]=String.fromCharCode(e);for(var e=1;12>=e;e++)Ts[e+111]=Ts[e+63235]="F"+e}();var xs,ws=function(){function e(e){return 247>=e?r.charAt(e):e>=1424&&1524>=e?"R":e>=1536&&1773>=e?n.charAt(e-1536):e>=1774&&2220>=e?"r":e>=8192&&8203>=e?"w":8204==e?"b":"L"}function t(e,t,r){this.level=e,this.from=t,this.to=r}var r="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN",n="rrrrrrrrrrrr,rNNmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmrrrrrrrnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmNmmmm",i=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,o=/[stwN]/,a=/[LRr]/,s=/[Lb1n]/,l=/[1n]/,c="L";return function(r){if(!i.test(r))return!1;for(var n,h=r.length,u=[],f=0;h>f;++f)u.push(n=e(r.charCodeAt(f)));for(var f=0,d=c;h>f;++f){var n=u[f];"m"==n?u[f]=d:d=n}for(var f=0,p=c;h>f;++f){var n=u[f];"1"==n&&"r"==p?u[f]="n":a.test(n)&&(p=n,"r"==n&&(u[f]="R"))}for(var f=1,d=u[0];h-1>f;++f){var n=u[f];"+"==n&&"1"==d&&"1"==u[f+1]?u[f]="1":","!=n||d!=u[f+1]||"1"!=d&&"n"!=d||(u[f]=d),d=n}for(var f=0;h>f;++f){var n=u[f];if(","==n)u[f]="N";else if("%"==n){for(var m=f+1;h>m&&"%"==u[m];++m);for(var g=f&&"!"==u[f-1]||h>m&&"1"==u[m]?"1":"N",v=f;m>v;++v)u[v]=g;f=m-1}}for(var f=0,p=c;h>f;++f){var n=u[f];"L"==p&&"1"==n?u[f]="L":a.test(n)&&(p=n)}for(var f=0;h>f;++f)if(o.test(u[f])){for(var m=f+1;h>m&&o.test(u[m]);++m);for(var E="L"==(f?u[f-1]:c),y="L"==(h>m?u[m]:c),g=E||y?"L":"R",v=f;m>v;++v)u[v]=g;f=m-1}for(var T,x=[],f=0;h>f;)if(s.test(u[f])){var w=f;for(++f;h>f&&s.test(u[f]);++f);x.push(new t(0,w,f))}else{var b=f,R=x.length;for(++f;h>f&&"L"!=u[f];++f);for(var v=b;f>v;)if(l.test(u[v])){v>b&&x.splice(R,0,new t(1,b,v));var _=v;for(++v;f>v&&l.test(u[v]);++v);x.splice(R,0,new t(2,_,v)),b=v}else++v;f>b&&x.splice(R,0,new t(1,b,f))}return 1==x[0].level&&(T=r.match(/^\s+/))&&(x[0].from=T[0].length,x.unshift(new t(0,0,T[0].length))),1==to(x).level&&(T=r.match(/\s+$/))&&(to(x).to-=T[0].length,x.push(new t(0,h-T[0].length,h))),x[0].level!=to(x).level&&x.push(new t(x[0].level,h,h)),x}}();return e.version="4.3.0",e}),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";e.defineMode("xml",function(t,r){function n(e,t){function r(r){return t.tokenize=r,r(e,t)}var n=e.next();if("<"==n)return e.eat("!")?e.eat("[")?e.match("CDATA[")?r(a("atom","]]>")):null:e.match("--")?r(a("comment","-->")):e.match("DOCTYPE",!0,!0)?(e.eatWhile(/[\w\._\-]/),r(s(1))):null:e.eat("?")?(e.eatWhile(/[\w\._\-]/),t.tokenize=a("meta","?>"),"meta"):(b=e.eat("/")?"closeTag":"openTag",t.tokenize=i,"tag bracket");if("&"==n){var o;return o=e.eat("#")?e.eat("x")?e.eatWhile(/[a-fA-F\d]/)&&e.eat(";"):e.eatWhile(/[\d]/)&&e.eat(";"):e.eatWhile(/[\w\.\-:]/)&&e.eat(";"),o?"atom":"error"}return e.eatWhile(/[^&<]/),null}function i(e,t){var r=e.next();if(">"==r||"/"==r&&e.eat(">"))return t.tokenize=n,b=">"==r?"endTag":"selfcloseTag","tag bracket";if("="==r)return b="equals",null;if("<"==r){t.tokenize=n,t.state=u,t.tagName=t.tagStart=null;var i=t.tokenize(e,t);return i?i+" tag error":"tag error"}return/[\'\"]/.test(r)?(t.tokenize=o(r),t.stringStartCol=e.column(),t.tokenize(e,t)):(e.match(/^[^\s\u00a0=<>\"\']*[^\s\u00a0=<>\"\'\/]/),"word")}function o(e){var t=function(t,r){for(;!t.eol();)if(t.next()==e){r.tokenize=i;break}return"string"};return t.isInAttribute=!0,t}function a(e,t){return function(r,i){for(;!r.eol();){if(r.match(t)){i.tokenize=n;break}r.next()}return e}}function s(e){return function(t,r){for(var i;null!=(i=t.next());){if("<"==i)return r.tokenize=s(e+1),r.tokenize(t,r);if(">"==i){if(1==e){r.tokenize=n;break}return r.tokenize=s(e-1),r.tokenize(t,r)}}return"meta"}}function l(e,t,r){this.prev=e.context,this.tagName=t,this.indent=e.indented,this.startOfLine=r,(_.doNotIndent.hasOwnProperty(t)||e.context&&e.context.noIndent)&&(this.noIndent=!0)}function c(e){e.context&&(e.context=e.context.prev)}function h(e,t){for(var r;;){if(!e.context)return;if(r=e.context.tagName,!_.contextGrabbers.hasOwnProperty(r)||!_.contextGrabbers[r].hasOwnProperty(t))return;c(e)}}function u(e,t,r){return"openTag"==e?(r.tagStart=t.column(),f):"closeTag"==e?d:u}function f(e,t,r){return"word"==e?(r.tagName=t.current(),R="tag",g):(R="error",f)}function d(e,t,r){if("word"==e){var n=t.current();return r.context&&r.context.tagName!=n&&_.implicitlyClosed.hasOwnProperty(r.context.tagName)&&c(r),r.context&&r.context.tagName==n?(R="tag",p):(R="tag error",m)}return R="error",m}function p(e,t,r){return"endTag"!=e?(R="error",p):(c(r),u)}function m(e,t,r){return R="error",p(e,t,r)}function g(e,t,r){if("word"==e)return R="attribute",v;if("endTag"==e||"selfcloseTag"==e){var n=r.tagName,i=r.tagStart;return r.tagName=r.tagStart=null,"selfcloseTag"==e||_.autoSelfClosers.hasOwnProperty(n)?h(r,n):(h(r,n),r.context=new l(r,n,i==r.indented)),u}return R="error",g}function v(e,t,r){return"equals"==e?E:(_.allowMissing||(R="error"),g(e,t,r))}function E(e,t,r){return"string"==e?y:"word"==e&&_.allowUnquoted?(R="string",g):(R="error",g(e,t,r))}function y(e,t,r){return"string"==e?y:g(e,t,r)}var T=t.indentUnit,x=r.multilineTagIndentFactor||1,w=r.multilineTagIndentPastTag;null==w&&(w=!0);var b,R,_=r.htmlMode?{autoSelfClosers:{area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},implicitlyClosed:{dd:!0,li:!0,optgroup:!0,option:!0,p:!0,rp:!0,rt:!0,tbody:!0,td:!0,tfoot:!0,th:!0,tr:!0},contextGrabbers:{dd:{dd:!0,dt:!0},dt:{dd:!0,dt:!0},li:{li:!0},option:{option:!0,optgroup:!0},optgroup:{optgroup:!0},p:{address:!0,article:!0,aside:!0,blockquote:!0,dir:!0,div:!0,dl:!0,fieldset:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,menu:!0,nav:!0,ol:!0,p:!0,pre:!0,section:!0,table:!0,ul:!0},rp:{rp:!0,rt:!0},rt:{rp:!0,rt:!0},tbody:{tbody:!0,tfoot:!0},td:{td:!0,th:!0},tfoot:{tbody:!0},th:{td:!0,th:!0},thead:{tbody:!0,tfoot:!0},tr:{tr:!0}},doNotIndent:{pre:!0},allowUnquoted:!0,allowMissing:!0,caseFold:!0}:{autoSelfClosers:{},implicitlyClosed:{},contextGrabbers:{},doNotIndent:{},allowUnquoted:!1,allowMissing:!1,caseFold:!1},H=r.alignCDATA;return{startState:function(){return{tokenize:n,state:u,indented:0,tagName:null,tagStart:null,context:null}},token:function(e,t){if(!t.tagName&&e.sol()&&(t.indented=e.indentation()),e.eatSpace())return null;b=null;var r=t.tokenize(e,t);return(r||b)&&"comment"!=r&&(R=null,t.state=t.state(b||r,e,t),R&&(r="error"==R?r+" error":R)),r},indent:function(t,r,o){var a=t.context;if(t.tokenize.isInAttribute)return t.tagStart==t.indented?t.stringStartCol+1:t.indented+T;if(a&&a.noIndent)return e.Pass;if(t.tokenize!=i&&t.tokenize!=n)return o?o.match(/^(\s*)/)[0].length:0;if(t.tagName)return w?t.tagStart+t.tagName.length+2:t.tagStart+T*x;if(H&&/<!\[CDATA\[/.test(r))return 0;var s=r&&/^<(\/)?([\w_:\.-]*)/.exec(r);if(s&&s[1])for(;a;){if(a.tagName==s[2]){a=a.prev;break}if(!_.implicitlyClosed.hasOwnProperty(a.tagName))break;a=a.prev}else if(s)for(;a;){var l=_.contextGrabbers[a.tagName];if(!l||!l.hasOwnProperty(s[2]))break;a=a.prev}for(;a&&!a.startOfLine;)a=a.prev;return a?a.indent+T:0},electricInput:/<\/[\s\w:]+>$/,blockCommentStart:"<!--",blockCommentEnd:"-->",configuration:r.htmlMode?"html":"xml",helperType:r.htmlMode?"html":"xml"}}),e.defineMIME("text/xml","xml"),e.defineMIME("application/xml","xml"),e.mimeModes.hasOwnProperty("text/html")||e.defineMIME("text/html",{name:"xml",htmlMode:!0})}),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";e.defineMode("javascript",function(t,r){function n(e){for(var t,r=!1,n=!1;null!=(t=e.next());){if(!r){if("/"==t&&!n)return;"["==t?n=!0:n&&"]"==t&&(n=!1)}r=!r&&"\\"==t}}function i(e,t,r){return pt=e,mt=r,t}function o(e,t){var r=e.next();if('"'==r||"'"==r)return t.tokenize=a(r),t.tokenize(e,t);if("."==r&&e.match(/^\d+(?:[eE][+\-]?\d+)?/))return i("number","number");if("."==r&&e.match(".."))return i("spread","meta");if(/[\[\]{}\(\),;\:\.]/.test(r))return i(r);if("="==r&&e.eat(">"))return i("=>","operator");if("0"==r&&e.eat(/x/i))return e.eatWhile(/[\da-f]/i),i("number","number");if(/\d/.test(r))return e.match(/^\d*(?:\.\d*)?(?:[eE][+\-]?\d+)?/),i("number","number");if("/"==r)return e.eat("*")?(t.tokenize=s,s(e,t)):e.eat("/")?(e.skipToEnd(),i("comment","comment")):"operator"==t.lastType||"keyword c"==t.lastType||"sof"==t.lastType||/^[\[{}\(,;:]$/.test(t.lastType)?(n(e),e.eatWhile(/[gimy]/),i("regexp","string-2")):(e.eatWhile(wt),i("operator","operator",e.current()));if("`"==r)return t.tokenize=l,l(e,t);if("#"==r)return e.skipToEnd(),i("error","error");if(wt.test(r))return e.eatWhile(wt),i("operator","operator",e.current());e.eatWhile(/[\w\$_]/);var o=e.current(),c=xt.propertyIsEnumerable(o)&&xt[o];return c&&"."!=t.lastType?i(c.type,c.style,o):i("variable","variable",o)}function a(e){return function(t,r){var n,a=!1;if(Et&&"@"==t.peek()&&t.match(bt))return r.tokenize=o,i("jsonld-keyword","meta");for(;null!=(n=t.next())&&(n!=e||a);)a=!a&&"\\"==n;return a||(r.tokenize=o),i("string","string")}}function s(e,t){for(var r,n=!1;r=e.next();){if("/"==r&&n){t.tokenize=o;break}n="*"==r}return i("comment","comment")}function l(e,t){for(var r,n=!1;null!=(r=e.next());){if(!n&&("`"==r||"$"==r&&e.eat("{"))){t.tokenize=o;break}n=!n&&"\\"==r}return i("quasi","string-2",e.current())}function c(e,t){t.fatArrowAt&&(t.fatArrowAt=null);var r=e.string.indexOf("=>",e.start);if(!(0>r)){for(var n=0,i=!1,o=r-1;o>=0;--o){var a=e.string.charAt(o),s=Rt.indexOf(a);if(s>=0&&3>s){if(!n){++o;break}if(0==--n)break}else if(s>=3&&6>s)++n;else if(/[$\w]/.test(a))i=!0;else if(i&&!n){++o;break}}i&&!n&&(t.fatArrowAt=o)}}function h(e,t,r,n,i,o){this.indented=e,this.column=t,this.type=r,this.prev=i,this.info=o,null!=n&&(this.align=n)}function u(e,t){for(var r=e.localVars;r;r=r.next)if(r.name==t)return!0;for(var n=e.context;n;n=n.prev)for(var r=n.vars;r;r=r.next)if(r.name==t)return!0}function f(e,t,r,n,i){var o=e.cc;for(Ht.state=e,Ht.stream=i,Ht.marked=null,Ht.cc=o,Ht.style=t,e.lexical.hasOwnProperty("align")||(e.lexical.align=!0);;){var a=o.length?o.pop():yt?w:x;if(a(r,n)){for(;o.length&&o[o.length-1].lex;)o.pop()();return Ht.marked?Ht.marked:"variable"==r&&u(e,n)?"variable-2":t}}}function d(){for(var e=arguments.length-1;e>=0;e--)Ht.cc.push(arguments[e])}function p(){return d.apply(null,arguments),!0}function m(e){function t(t){for(var r=t;r;r=r.next)if(r.name==e)return!0;return!1}var n=Ht.state;if(n.context){if(Ht.marked="def",t(n.localVars))return;n.localVars={name:e,next:n.localVars}}else{if(t(n.globalVars))return;r.globalVars&&(n.globalVars={name:e,next:n.globalVars})}}function g(){Ht.state.context={prev:Ht.state.context,vars:Ht.state.localVars},Ht.state.localVars=Mt}function v(){Ht.state.localVars=Ht.state.context.vars,Ht.state.context=Ht.state.context.prev}function E(e,t){var r=function(){var r=Ht.state,n=r.indented;"stat"==r.lexical.type&&(n=r.lexical.indented),r.lexical=new h(n,Ht.stream.column(),e,null,r.lexical,t)};return r.lex=!0,r}function y(){var e=Ht.state;e.lexical.prev&&(")"==e.lexical.type&&(e.indented=e.lexical.indented),e.lexical=e.lexical.prev)}function T(e){function t(r){return r==e?p():";"==e?d():p(t)}return t}function x(e,t){return"var"==e?p(E("vardef",t.length),G,T(";"),y):"keyword a"==e?p(E("form"),w,x,y):"keyword b"==e?p(E("form"),x,y):"{"==e?p(E("}"),I,y):";"==e?p():"if"==e?("else"==Ht.state.lexical.info&&Ht.state.cc[Ht.state.cc.length-1]==y&&Ht.state.cc.pop()(),p(E("form"),w,x,y,Y)):"function"==e?p(et):"for"==e?p(E("form"),K,x,y):"variable"==e?p(E("stat"),P):"switch"==e?p(E("form"),w,E("}","switch"),T("{"),I,y,y):"case"==e?p(w,T(":")):"default"==e?p(T(":")):"catch"==e?p(E("form"),g,T("("),tt,T(")"),x,y,v):"module"==e?p(E("form"),g,at,v,y):"class"==e?p(E("form"),rt,y):"export"==e?p(E("form"),st,y):"import"==e?p(E("form"),lt,y):d(E("stat"),w,T(";"),y)}function w(e){return R(e,!1)}function b(e){return R(e,!0)}function R(e,t){if(Ht.state.fatArrowAt==Ht.stream.start){var r=t?L:k;if("("==e)return p(g,E(")"),O(j,")"),y,T("=>"),r,v);if("variable"==e)return d(g,j,T("=>"),r,v)}var n=t?S:M;return _t.hasOwnProperty(e)?p(n):"function"==e?p(et,n):"keyword c"==e?p(t?H:_):"("==e?p(E(")"),_,dt,T(")"),y,n):"operator"==e||"spread"==e?p(t?b:w):"["==e?p(E("]"),ut,y,n):"{"==e?z(N,"}",null,n):"quasi"==e?d(C,n):p()}function _(e){return e.match(/[;\}\)\],]/)?d():d(w)}function H(e){return e.match(/[;\}\)\],]/)?d():d(b)}function M(e,t){return","==e?p(w):S(e,t,!1)}function S(e,t,r){var n=0==r?M:S,i=0==r?w:b;return"=>"==t?p(g,r?L:k,v):"operator"==e?/\+\+|--/.test(t)?p(n):"?"==t?p(w,T(":"),i):p(i):"quasi"==e?d(C,n):";"!=e?"("==e?z(b,")","call",n):"."==e?p(F,n):"["==e?p(E("]"),_,T("]"),y,n):void 0:void 0}function C(e,t){return"quasi"!=e?d():"${"!=t.slice(t.length-2)?p(C):p(w,A)}function A(e){return"}"==e?(Ht.marked="string-2",Ht.state.tokenize=l,p(C)):void 0}function k(e){return c(Ht.stream,Ht.state),d("{"==e?x:w)}function L(e){return c(Ht.stream,Ht.state),d("{"==e?x:b)}function P(e){return":"==e?p(y,x):d(M,T(";"),y)}function F(e){return"variable"==e?(Ht.marked="property",p()):void 0}function N(e,t){return"variable"==e||"keyword"==Ht.style?(Ht.marked="property",p("get"==t||"set"==t?D:U)):"number"==e||"string"==e?(Ht.marked=Et?"property":Ht.style+" property",p(U)):"jsonld-keyword"==e?p(U):"["==e?p(w,T("]"),U):void 0}function D(e){return"variable"!=e?d(U):(Ht.marked="property",p(et))}function U(e){return":"==e?p(b):"("==e?d(et):void 0}function O(e,t){function r(n){if(","==n){var i=Ht.state.lexical;return"call"==i.info&&(i.pos=(i.pos||0)+1),p(e,r)}return n==t?p():p(T(t))}return function(n){return n==t?p():d(e,r)}}function z(e,t,r){for(var n=3;n<arguments.length;n++)Ht.cc.push(arguments[n]);return p(E(t,r),O(e,t),y)}function I(e){return"}"==e?p():d(x,I)}function V(e){return Tt&&":"==e?p(B):void 0}function B(e){return"variable"==e?(Ht.marked="variable-3",p()):void 0}function G(){return d(j,V,X,q)}function j(e,t){return"variable"==e?(m(t),p()):"["==e?z(j,"]"):"{"==e?z(W,"}"):void 0}function W(e,t){return"variable"!=e||Ht.stream.match(/^\s*:/,!1)?("variable"==e&&(Ht.marked="property"),p(T(":"),j,X)):(m(t),p(X))}function X(e,t){return"="==t?p(b):void 0}function q(e){return","==e?p(G):void 0}function Y(e,t){return"keyword b"==e&&"else"==t?p(E("form","else"),x,y):void 0}function K(e){return"("==e?p(E(")"),Q,T(")"),y):void 0}function Q(e){return"var"==e?p(G,T(";"),$):";"==e?p($):"variable"==e?p(Z):d(w,T(";"),$)}function Z(e,t){return"in"==t||"of"==t?(Ht.marked="keyword",p(w)):p(M,$)}function $(e,t){return";"==e?p(J):"in"==t||"of"==t?(Ht.marked="keyword",p(w)):d(w,T(";"),J)}function J(e){")"!=e&&p(w)}function et(e,t){return"*"==t?(Ht.marked="keyword",p(et)):"variable"==e?(m(t),p(et)):"("==e?p(g,E(")"),O(tt,")"),y,x,v):void 0}function tt(e){return"spread"==e?p(tt):d(j,V)}function rt(e,t){return"variable"==e?(m(t),p(nt)):void 0}function nt(e,t){return"extends"==t?p(w,nt):"{"==e?p(E("}"),it,y):void 0}function it(e,t){return"variable"==e||"keyword"==Ht.style?(Ht.marked="property","get"==t||"set"==t?p(ot,et,it):p(et,it)):"*"==t?(Ht.marked="keyword",p(it)):";"==e?p(it):"}"==e?p():void 0}function ot(e){return"variable"!=e?d():(Ht.marked="property",p())}function at(e,t){return"string"==e?p(x):"variable"==e?(m(t),p(ht)):void 0}function st(e,t){return"*"==t?(Ht.marked="keyword",p(ht,T(";"))):"default"==t?(Ht.marked="keyword",p(w,T(";"))):d(x)}function lt(e){return"string"==e?p():d(ct,ht)}function ct(e,t){return"{"==e?z(ct,"}"):("variable"==e&&m(t),p())}function ht(e,t){return"from"==t?(Ht.marked="keyword",p(w)):void 0}function ut(e){return"]"==e?p():d(b,ft)}function ft(e){return"for"==e?d(dt,T("]")):","==e?p(O(b,"]")):d(O(b,"]"))}function dt(e){return"for"==e?p(K,dt):"if"==e?p(w,dt):void 0}var pt,mt,gt=t.indentUnit,vt=r.statementIndent,Et=r.jsonld,yt=r.json||Et,Tt=r.typescript,xt=function(){function e(e){return{type:e,style:"keyword"}}var t=e("keyword a"),r=e("keyword b"),n=e("keyword c"),i=e("operator"),o={type:"atom",style:"atom"},a={"if":e("if"),"while":t,"with":t,"else":r,"do":r,"try":r,"finally":r,"return":n,"break":n,"continue":n,"new":n,"delete":n,"throw":n,"debugger":n,"var":e("var"),"const":e("var"),let:e("var"),"function":e("function"),"catch":e("catch"),"for":e("for"),"switch":e("switch"),"case":e("case"),"default":e("default"),"in":i,"typeof":i,"instanceof":i,"true":o,"false":o,"null":o,undefined:o,NaN:o,Infinity:o,"this":e("this"),module:e("module"),"class":e("class"),"super":e("atom"),"yield":n,"export":e("export"),"import":e("import"),"extends":n};if(Tt){var s={type:"variable",style:"variable-3"},l={"interface":e("interface"),"extends":e("extends"),constructor:e("constructor"),"public":e("public"),"private":e("private"),"protected":e("protected"),"static":e("static"),string:s,number:s,bool:s,any:s};for(var c in l)a[c]=l[c]}return a}(),wt=/[+\-*&%=<>!?|~^]/,bt=/^@(context|id|value|language|type|container|list|set|reverse|index|base|vocab|graph)"/,Rt="([{}])",_t={atom:!0,number:!0,variable:!0,string:!0,regexp:!0,"this":!0,"jsonld-keyword":!0},Ht={state:null,column:null,marked:null,cc:null},Mt={name:"this",next:{name:"arguments"}};return y.lex=!0,{startState:function(e){var t={tokenize:o,lastType:"sof",cc:[],lexical:new h((e||0)-gt,0,"block",!1),localVars:r.localVars,context:r.localVars&&{vars:r.localVars},indented:0};return r.globalVars&&"object"==typeof r.globalVars&&(t.globalVars=r.globalVars),t},token:function(e,t){if(e.sol()&&(t.lexical.hasOwnProperty("align")||(t.lexical.align=!1),t.indented=e.indentation(),c(e,t)),t.tokenize!=s&&e.eatSpace())return null;var r=t.tokenize(e,t);return"comment"==pt?r:(t.lastType="operator"!=pt||"++"!=mt&&"--"!=mt?pt:"incdec",f(t,r,pt,mt,e))},indent:function(t,n){if(t.tokenize==s)return e.Pass;if(t.tokenize!=o)return 0;var i=n&&n.charAt(0),a=t.lexical;if(!/^\s*else\b/.test(n))for(var l=t.cc.length-1;l>=0;--l){var c=t.cc[l];if(c==y)a=a.prev;else if(c!=Y)break}"stat"==a.type&&"}"==i&&(a=a.prev),vt&&")"==a.type&&"stat"==a.prev.type&&(a=a.prev);var h=a.type,u=i==h;return"vardef"==h?a.indented+("operator"==t.lastType||","==t.lastType?a.info+1:0):"form"==h&&"{"==i?a.indented:"form"==h?a.indented+gt:"stat"==h?a.indented+("operator"==t.lastType||","==t.lastType?vt||gt:0):"switch"!=a.info||u||0==r.doubleIndentSwitch?a.align?a.column+(u?0:1):a.indented+(u?0:gt):a.indented+(/^(?:case|default)\b/.test(n)?gt:2*gt)},electricChars:":{}",blockCommentStart:yt?null:"/*",blockCommentEnd:yt?null:"*/",lineComment:yt?null:"//",fold:"brace",helperType:yt?"json":"javascript",jsonldMode:Et,jsonMode:yt}}),e.registerHelper("wordChars","javascript",/[\\w$]/),e.defineMIME("text/javascript","javascript"),e.defineMIME("text/ecmascript","javascript"),e.defineMIME("application/javascript","javascript"),e.defineMIME("application/x-javascript","javascript"),e.defineMIME("application/ecmascript","javascript"),e.defineMIME("application/json",{name:"javascript",json:!0}),e.defineMIME("application/x-json",{name:"javascript",json:!0}),e.defineMIME("application/ld+json",{name:"javascript",jsonld:!0}),e.defineMIME("text/typescript",{name:"javascript",typescript:!0}),e.defineMIME("application/typescript",{name:"javascript",typescript:!0})}),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";function t(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=!0;return t}function r(e,t){for(var r,n=!1;null!=(r=e.next());){if(n&&"/"==r){t.tokenize=null;break}n="*"==r}return["comment","comment"]}function n(e,t){return e.skipTo("-->")?(e.match("-->"),t.tokenize=null):e.skipToEnd(),["comment","comment"]}e.defineMode("css",function(t,r){function n(e,t){return d=t,e}function i(e,t){var r=e.next();if(g[r]){var i=g[r](e,t);if(i!==!1)return i}return"@"==r?(e.eatWhile(/[\w\\\-]/),n("def",e.current())):"="==r||("~"==r||"|"==r)&&e.eat("=")?n(null,"compare"):'"'==r||"'"==r?(t.tokenize=o(r),t.tokenize(e,t)):"#"==r?(e.eatWhile(/[\w\\\-]/),n("atom","hash")):"!"==r?(e.match(/^\s*\w*/),n("keyword","important")):/\d/.test(r)||"."==r&&e.eat(/\d/)?(e.eatWhile(/[\w.%]/),n("number","unit")):"-"!==r?/[,+>*\/]/.test(r)?n(null,"select-op"):"."==r&&e.match(/^-?[_a-z][_a-z0-9-]*/i)?n("qualifier","qualifier"):/[:;{}\[\]\(\)]/.test(r)?n(null,r):"u"==r&&e.match("rl(")?(e.backUp(1),t.tokenize=a,n("property","word")):/[\w\\\-]/.test(r)?(e.eatWhile(/[\w\\\-]/),n("property","word")):n(null,null):/[\d.]/.test(e.peek())?(e.eatWhile(/[\w.%]/),n("number","unit")):e.match(/^\w+-/)?n("meta","meta"):void 0}function o(e){return function(t,r){for(var i,o=!1;null!=(i=t.next());){if(i==e&&!o){")"==e&&t.backUp(1);break}o=!o&&"\\"==i}return(i==e||!o&&")"!=e)&&(r.tokenize=null),n("string","string")}}function a(e,t){return e.next(),t.tokenize=e.match(/\s*[\"\')]/,!1)?null:o(")"),n(null,"(")}function s(e,t,r){this.type=e,this.indent=t,this.prev=r}function l(e,t,r){return e.context=new s(r,t.indentation()+m,e.context),r}function c(e){return e.context=e.context.prev,e.context.type}function h(e,t,r){return _[r.context.type](e,t,r)}function u(e,t,r,n){for(var i=n||1;i>0;i--)r.context=r.context.prev;return h(e,t,r)}function f(e){var t=e.current().toLowerCase();p=w.hasOwnProperty(t)?"atom":x.hasOwnProperty(t)?"keyword":"variable"}r.propertyKeywords||(r=e.resolveMode("text/css"));var d,p,m=t.indentUnit,g=r.tokenHooks,v=r.mediaTypes||{},E=r.mediaFeatures||{},y=r.propertyKeywords||{},T=r.nonStandardPropertyKeywords||{},x=r.colorKeywords||{},w=r.valueKeywords||{},b=r.fontProperties||{},R=r.allowNested,_={};return _.top=function(e,t,r){if("{"==e)return l(r,t,"block");if("}"==e&&r.context.prev)return c(r);if("@media"==e)return l(r,t,"media");if("@font-face"==e)return"font_face_before";if(/^@(-(moz|ms|o|webkit)-)?keyframes$/.test(e))return"keyframes";if(e&&"@"==e.charAt(0))return l(r,t,"at");if("hash"==e)p="builtin";else if("word"==e)p="tag";else{if("variable-definition"==e)return"maybeprop";if("interpolation"==e)return l(r,t,"interpolation");if(":"==e)return"pseudo";if(R&&"("==e)return l(r,t,"parens")}return r.context.type},_.block=function(e,t,r){if("word"==e){var n=t.current().toLowerCase();return y.hasOwnProperty(n)?(p="property","maybeprop"):T.hasOwnProperty(n)?(p="string-2","maybeprop"):R?(p=t.match(/^\s*:/,!1)?"property":"tag","block"):(p+=" error","maybeprop")}return"meta"==e?"block":R||"hash"!=e&&"qualifier"!=e?_.top(e,t,r):(p="error","block")},_.maybeprop=function(e,t,r){return":"==e?l(r,t,"prop"):h(e,t,r)},_.prop=function(e,t,r){if(";"==e)return c(r);if("{"==e&&R)return l(r,t,"propBlock");if("}"==e||"{"==e)return u(e,t,r);if("("==e)return l(r,t,"parens");if("hash"!=e||/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(t.current())){if("word"==e)f(t);else if("interpolation"==e)return l(r,t,"interpolation")}else p+=" error";return"prop"},_.propBlock=function(e,t,r){return"}"==e?c(r):"word"==e?(p="property","maybeprop"):r.context.type},_.parens=function(e,t,r){return"{"==e||"}"==e?u(e,t,r):")"==e?c(r):"("==e?l(r,t,"parens"):("word"==e&&f(t),"parens")},_.pseudo=function(e,t,r){return"word"==e?(p="variable-3",r.context.type):h(e,t,r)},_.media=function(e,t,r){if("("==e)return l(r,t,"media_parens");if("}"==e)return u(e,t,r);if("{"==e)return c(r)&&l(r,t,R?"block":"top");if("word"==e){var n=t.current().toLowerCase();p="only"==n||"not"==n||"and"==n?"keyword":v.hasOwnProperty(n)?"attribute":E.hasOwnProperty(n)?"property":"error"}return r.context.type},_.media_parens=function(e,t,r){return")"==e?c(r):"{"==e||"}"==e?u(e,t,r,2):_.media(e,t,r)},_.font_face_before=function(e,t,r){return"{"==e?l(r,t,"font_face"):h(e,t,r)},_.font_face=function(e,t,r){return"}"==e?c(r):"word"==e?(p=b.hasOwnProperty(t.current().toLowerCase())?"property":"error","maybeprop"):"font_face"},_.keyframes=function(e,t,r){return"word"==e?(p="variable","keyframes"):"{"==e?l(r,t,"top"):h(e,t,r)},_.at=function(e,t,r){return";"==e?c(r):"{"==e||"}"==e?u(e,t,r):("word"==e?p="tag":"hash"==e&&(p="builtin"),"at")},_.interpolation=function(e,t,r){return"}"==e?c(r):"{"==e||";"==e?u(e,t,r):("variable"!=e&&(p="error"),"interpolation")},{startState:function(e){return{tokenize:null,state:"top",context:new s("top",e||0,null)}},token:function(e,t){if(!t.tokenize&&e.eatSpace())return null;var r=(t.tokenize||i)(e,t);return r&&"object"==typeof r&&(d=r[1],r=r[0]),p=r,t.state=_[t.state](d,e,t),p},indent:function(e,t){var r=e.context,n=t&&t.charAt(0),i=r.indent;return"prop"!=r.type||"}"!=n&&")"!=n||(r=r.prev),!r.prev||("}"!=n||"block"!=r.type&&"top"!=r.type&&"interpolation"!=r.type&&"font_face"!=r.type)&&(")"!=n||"parens"!=r.type&&"media_parens"!=r.type)&&("{"!=n||"at"!=r.type&&"media"!=r.type)||(i=r.indent-m,r=r.prev),i},electricChars:"}",blockCommentStart:"/*",blockCommentEnd:"*/",fold:"brace"}});var i=["all","aural","braille","handheld","print","projection","screen","tty","tv","embossed"],o=t(i),a=["width","min-width","max-width","height","min-height","max-height","device-width","min-device-width","max-device-width","device-height","min-device-height","max-device-height","aspect-ratio","min-aspect-ratio","max-aspect-ratio","device-aspect-ratio","min-device-aspect-ratio","max-device-aspect-ratio","color","min-color","max-color","color-index","min-color-index","max-color-index","monochrome","min-monochrome","max-monochrome","resolution","min-resolution","max-resolution","scan","grid"],s=t(a),l=["align-content","align-items","align-self","alignment-adjust","alignment-baseline","anchor-point","animation","animation-delay","animation-direction","animation-duration","animation-fill-mode","animation-iteration-count","animation-name","animation-play-state","animation-timing-function","appearance","azimuth","backface-visibility","background","background-attachment","background-clip","background-color","background-image","background-origin","background-position","background-repeat","background-size","baseline-shift","binding","bleed","bookmark-label","bookmark-level","bookmark-state","bookmark-target","border","border-bottom","border-bottom-color","border-bottom-left-radius","border-bottom-right-radius","border-bottom-style","border-bottom-width","border-collapse","border-color","border-image","border-image-outset","border-image-repeat","border-image-slice","border-image-source","border-image-width","border-left","border-left-color","border-left-style","border-left-width","border-radius","border-right","border-right-color","border-right-style","border-right-width","border-spacing","border-style","border-top","border-top-color","border-top-left-radius","border-top-right-radius","border-top-style","border-top-width","border-width","bottom","box-decoration-break","box-shadow","box-sizing","break-after","break-before","break-inside","caption-side","clear","clip","color","color-profile","column-count","column-fill","column-gap","column-rule","column-rule-color","column-rule-style","column-rule-width","column-span","column-width","columns","content","counter-increment","counter-reset","crop","cue","cue-after","cue-before","cursor","direction","display","dominant-baseline","drop-initial-after-adjust","drop-initial-after-align","drop-initial-before-adjust","drop-initial-before-align","drop-initial-size","drop-initial-value","elevation","empty-cells","fit","fit-position","flex","flex-basis","flex-direction","flex-flow","flex-grow","flex-shrink","flex-wrap","float","float-offset","flow-from","flow-into","font","font-feature-settings","font-family","font-kerning","font-language-override","font-size","font-size-adjust","font-stretch","font-style","font-synthesis","font-variant","font-variant-alternates","font-variant-caps","font-variant-east-asian","font-variant-ligatures","font-variant-numeric","font-variant-position","font-weight","grid","grid-area","grid-auto-columns","grid-auto-flow","grid-auto-position","grid-auto-rows","grid-column","grid-column-end","grid-column-start","grid-row","grid-row-end","grid-row-start","grid-template","grid-template-areas","grid-template-columns","grid-template-rows","hanging-punctuation","height","hyphens","icon","image-orientation","image-rendering","image-resolution","inline-box-align","justify-content","left","letter-spacing","line-break","line-height","line-stacking","line-stacking-ruby","line-stacking-shift","line-stacking-strategy","list-style","list-style-image","list-style-position","list-style-type","margin","margin-bottom","margin-left","margin-right","margin-top","marker-offset","marks","marquee-direction","marquee-loop","marquee-play-count","marquee-speed","marquee-style","max-height","max-width","min-height","min-width","move-to","nav-down","nav-index","nav-left","nav-right","nav-up","object-fit","object-position","opacity","order","orphans","outline","outline-color","outline-offset","outline-style","outline-width","overflow","overflow-style","overflow-wrap","overflow-x","overflow-y","padding","padding-bottom","padding-left","padding-right","padding-top","page","page-break-after","page-break-before","page-break-inside","page-policy","pause","pause-after","pause-before","perspective","perspective-origin","pitch","pitch-range","play-during","position","presentation-level","punctuation-trim","quotes","region-break-after","region-break-before","region-break-inside","region-fragment","rendering-intent","resize","rest","rest-after","rest-before","richness","right","rotation","rotation-point","ruby-align","ruby-overhang","ruby-position","ruby-span","shape-image-threshold","shape-inside","shape-margin","shape-outside","size","speak","speak-as","speak-header","speak-numeral","speak-punctuation","speech-rate","stress","string-set","tab-size","table-layout","target","target-name","target-new","target-position","text-align","text-align-last","text-decoration","text-decoration-color","text-decoration-line","text-decoration-skip","text-decoration-style","text-emphasis","text-emphasis-color","text-emphasis-position","text-emphasis-style","text-height","text-indent","text-justify","text-outline","text-overflow","text-shadow","text-size-adjust","text-space-collapse","text-transform","text-underline-position","text-wrap","top","transform","transform-origin","transform-style","transition","transition-delay","transition-duration","transition-property","transition-timing-function","unicode-bidi","vertical-align","visibility","voice-balance","voice-duration","voice-family","voice-pitch","voice-range","voice-rate","voice-stress","voice-volume","volume","white-space","widows","width","word-break","word-spacing","word-wrap","z-index","clip-path","clip-rule","mask","enable-background","filter","flood-color","flood-opacity","lighting-color","stop-color","stop-opacity","pointer-events","color-interpolation","color-interpolation-filters","color-rendering","fill","fill-opacity","fill-rule","image-rendering","marker","marker-end","marker-mid","marker-start","shape-rendering","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","text-rendering","baseline-shift","dominant-baseline","glyph-orientation-horizontal","glyph-orientation-vertical","text-anchor","writing-mode"],c=t(l),h=["scrollbar-arrow-color","scrollbar-base-color","scrollbar-dark-shadow-color","scrollbar-face-color","scrollbar-highlight-color","scrollbar-shadow-color","scrollbar-3d-light-color","scrollbar-track-color","shape-inside","searchfield-cancel-button","searchfield-decoration","searchfield-results-button","searchfield-results-decoration","zoom"],h=t(h),u=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","grey","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"],f=t(u),d=["above","absolute","activeborder","activecaption","afar","after-white-space","ahead","alias","all","all-scroll","alternate","always","amharic","amharic-abegede","antialiased","appworkspace","arabic-indic","armenian","asterisks","auto","avoid","avoid-column","avoid-page","avoid-region","background","backwards","baseline","below","bidi-override","binary","bengali","blink","block","block-axis","bold","bolder","border","border-box","both","bottom","break","break-all","break-word","button","button-bevel","buttonface","buttonhighlight","buttonshadow","buttontext","cambodian","capitalize","caps-lock-indicator","caption","captiontext","caret","cell","center","checkbox","circle","cjk-earthly-branch","cjk-heavenly-stem","cjk-ideographic","clear","clip","close-quote","col-resize","collapse","column","compact","condensed","contain","content","content-box","context-menu","continuous","copy","cover","crop","cross","crosshair","currentcolor","cursive","dashed","decimal","decimal-leading-zero","default","default-button","destination-atop","destination-in","destination-out","destination-over","devanagari","disc","discard","document","dot-dash","dot-dot-dash","dotted","double","down","e-resize","ease","ease-in","ease-in-out","ease-out","element","ellipse","ellipsis","embed","end","ethiopic","ethiopic-abegede","ethiopic-abegede-am-et","ethiopic-abegede-gez","ethiopic-abegede-ti-er","ethiopic-abegede-ti-et","ethiopic-halehame-aa-er","ethiopic-halehame-aa-et","ethiopic-halehame-am-et","ethiopic-halehame-gez","ethiopic-halehame-om-et","ethiopic-halehame-sid-et","ethiopic-halehame-so-et","ethiopic-halehame-ti-er","ethiopic-halehame-ti-et","ethiopic-halehame-tig","ew-resize","expanded","extra-condensed","extra-expanded","fantasy","fast","fill","fixed","flat","footnotes","forwards","from","geometricPrecision","georgian","graytext","groove","gujarati","gurmukhi","hand","hangul","hangul-consonant","hebrew","help","hidden","hide","higher","highlight","highlighttext","hiragana","hiragana-iroha","horizontal","hsl","hsla","icon","ignore","inactiveborder","inactivecaption","inactivecaptiontext","infinite","infobackground","infotext","inherit","initial","inline","inline-axis","inline-block","inline-table","inset","inside","intrinsic","invert","italic","justify","kannada","katakana","katakana-iroha","keep-all","khmer","landscape","lao","large","larger","left","level","lighter","line-through","linear","lines","list-item","listbox","listitem","local","logical","loud","lower","lower-alpha","lower-armenian","lower-greek","lower-hexadecimal","lower-latin","lower-norwegian","lower-roman","lowercase","ltr","malayalam","match","media-controls-background","media-current-time-display","media-fullscreen-button","media-mute-button","media-play-button","media-return-to-realtime-button","media-rewind-button","media-seek-back-button","media-seek-forward-button","media-slider","media-sliderthumb","media-time-remaining-display","media-volume-slider","media-volume-slider-container","media-volume-sliderthumb","medium","menu","menulist","menulist-button","menulist-text","menulist-textfield","menutext","message-box","middle","min-intrinsic","mix","mongolian","monospace","move","multiple","myanmar","n-resize","narrower","ne-resize","nesw-resize","no-close-quote","no-drop","no-open-quote","no-repeat","none","normal","not-allowed","nowrap","ns-resize","nw-resize","nwse-resize","oblique","octal","open-quote","optimizeLegibility","optimizeSpeed","oriya","oromo","outset","outside","outside-shape","overlay","overline","padding","padding-box","painted","page","paused","persian","plus-darker","plus-lighter","pointer","polygon","portrait","pre","pre-line","pre-wrap","preserve-3d","progress","push-button","radio","read-only","read-write","read-write-plaintext-only","rectangle","region","relative","repeat","repeat-x","repeat-y","reset","reverse","rgb","rgba","ridge","right","round","row-resize","rtl","run-in","running","s-resize","sans-serif","scroll","scrollbar","se-resize","searchfield","searchfield-cancel-button","searchfield-decoration","searchfield-results-button","searchfield-results-decoration","semi-condensed","semi-expanded","separate","serif","show","sidama","single","skip-white-space","slide","slider-horizontal","slider-vertical","sliderthumb-horizontal","sliderthumb-vertical","slow","small","small-caps","small-caption","smaller","solid","somali","source-atop","source-in","source-out","source-over","space","square","square-button","start","static","status-bar","stretch","stroke","sub","subpixel-antialiased","super","sw-resize","table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row","table-row-group","telugu","text","text-bottom","text-top","textarea","textfield","thai","thick","thin","threeddarkshadow","threedface","threedhighlight","threedlightshadow","threedshadow","tibetan","tigre","tigrinya-er","tigrinya-er-abegede","tigrinya-et","tigrinya-et-abegede","to","top","transparent","ultra-condensed","ultra-expanded","underline","up","upper-alpha","upper-armenian","upper-greek","upper-hexadecimal","upper-latin","upper-norwegian","upper-roman","uppercase","urdu","url","vertical","vertical-text","visible","visibleFill","visiblePainted","visibleStroke","visual","w-resize","wait","wave","wider","window","windowframe","windowtext","x-large","x-small","xor","xx-large","xx-small"],p=t(d),m=["font-family","src","unicode-range","font-variant","font-feature-settings","font-stretch","font-weight","font-style"],g=t(m),v=i.concat(a).concat(l).concat(h).concat(u).concat(d);
e.registerHelper("hintWords","css",v),e.defineMIME("text/css",{mediaTypes:o,mediaFeatures:s,propertyKeywords:c,nonStandardPropertyKeywords:h,colorKeywords:f,valueKeywords:p,fontProperties:g,tokenHooks:{"<":function(e,t){return e.match("!--")?(t.tokenize=n,n(e,t)):!1},"/":function(e,t){return e.eat("*")?(t.tokenize=r,r(e,t)):!1}},name:"css"}),e.defineMIME("text/x-scss",{mediaTypes:o,mediaFeatures:s,propertyKeywords:c,nonStandardPropertyKeywords:h,colorKeywords:f,valueKeywords:p,fontProperties:g,allowNested:!0,tokenHooks:{"/":function(e,t){return e.eat("/")?(e.skipToEnd(),["comment","comment"]):e.eat("*")?(t.tokenize=r,r(e,t)):["operator","operator"]},":":function(e){return e.match(/\s*\{/)?[null,"{"]:!1},$:function(e){return e.match(/^[\w-]+/),e.match(/^\s*:/,!1)?["variable-2","variable-definition"]:["variable-2","variable"]},"#":function(e){return e.eat("{")?[null,"interpolation"]:!1}},name:"css",helperType:"scss"}),e.defineMIME("text/x-less",{mediaTypes:o,mediaFeatures:s,propertyKeywords:c,nonStandardPropertyKeywords:h,colorKeywords:f,valueKeywords:p,fontProperties:g,allowNested:!0,tokenHooks:{"/":function(e,t){return e.eat("/")?(e.skipToEnd(),["comment","comment"]):e.eat("*")?(t.tokenize=r,r(e,t)):["operator","operator"]},"@":function(e){return e.match(/^(charset|document|font-face|import|(-(moz|ms|o|webkit)-)?keyframes|media|namespace|page|supports)\b/,!1)?!1:(e.eatWhile(/[\w\\\-]/),e.match(/^\s*:/,!1)?["variable-2","variable-definition"]:["variable-2","variable"])},"&":function(){return["atom","atom"]}},name:"css",helperType:"less"})}),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror"),require("../xml/xml"),require("../javascript/javascript"),require("../css/css")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../xml/xml","../javascript/javascript","../css/css"],e):e(CodeMirror)}(function(e){"use strict";e.defineMode("htmlmixed",function(t,r){function n(e,t){var r=t.htmlState.tagName,n=s.token(e,t.htmlState);if("script"==r&&/\btag\b/.test(n)&&">"==e.current()){var i=e.string.slice(Math.max(0,e.pos-100),e.pos).match(/\btype\s*=\s*("[^"]+"|'[^']+'|\S+)[^<]*$/i);i=i?i[1]:"",i&&/[\"\']/.test(i.charAt(0))&&(i=i.slice(1,i.length-1));for(var h=0;h<c.length;++h){var u=c[h];if("string"==typeof u.matches?i==u.matches:u.matches.test(i)){u.mode&&(t.token=o,t.localMode=u.mode,t.localState=u.mode.startState&&u.mode.startState(s.indent(t.htmlState,"")));break}}}else"style"==r&&/\btag\b/.test(n)&&">"==e.current()&&(t.token=a,t.localMode=l,t.localState=l.startState(s.indent(t.htmlState,"")));return n}function i(e,t,r){var n,i=e.current(),o=i.search(t);return o>-1?e.backUp(i.length-o):(n=i.match(/<\/?$/))&&(e.backUp(i.length),e.match(t,!1)||e.match(i)),r}function o(e,t){return e.match(/^<\/\s*script\s*>/i,!1)?(t.token=n,t.localState=t.localMode=null,n(e,t)):i(e,/<\/\s*script\s*>/,t.localMode.token(e,t.localState))}function a(e,t){return e.match(/^<\/\s*style\s*>/i,!1)?(t.token=n,t.localState=t.localMode=null,n(e,t)):i(e,/<\/\s*style\s*>/,l.token(e,t.localState))}var s=e.getMode(t,{name:"xml",htmlMode:!0,multilineTagIndentFactor:r.multilineTagIndentFactor,multilineTagIndentPastTag:r.multilineTagIndentPastTag}),l=e.getMode(t,"css"),c=[],h=r&&r.scriptTypes;if(c.push({matches:/^(?:text|application)\/(?:x-)?(?:java|ecma)script$|^$/i,mode:e.getMode(t,"javascript")}),h)for(var u=0;u<h.length;++u){var f=h[u];c.push({matches:f.matches,mode:f.mode&&e.getMode(t,f.mode)})}return c.push({matches:/./,mode:e.getMode(t,"text/plain")}),{startState:function(){var e=s.startState();return{token:n,localMode:null,localState:null,htmlState:e}},copyState:function(t){if(t.localState)var r=e.copyState(t.localMode,t.localState);return{token:t.token,localMode:t.localMode,localState:r,htmlState:e.copyState(s,t.htmlState)}},token:function(e,t){return t.token(e,t)},indent:function(t,r){return!t.localMode||/^\s*<\//.test(r)?s.indent(t.htmlState,r):t.localMode.indent?t.localMode.indent(t.localState,r):e.Pass},innerMode:function(e){return{state:e.localState||e.htmlState,mode:e.localMode||s}}}},"xml","javascript","css"),e.defineMIME("text/html","htmlmixed")}),window.FpsOptimizer=function(e){var t,r,n=0,i=0,o=Date.now(),a=o;return e.target=e.target||60,e.maxIterations=e.maxIterations||10,e.delay=e.delay||1e3,e.interval=e.interval||100,e.padding=e.padding||5,{_iterations:0,complete:!1,begin:function(){this.complete||(o=Date.now())},end:function(){if(!this.complete){if(r=Date.now(),t=r-this.startTime,i++,r>a+e.delay){if(e.delay=e.interval,a=r,i=0,this._iterations++,this.rounds>=e.maxIterations)return this.complete=!0,r;if(n=Math.round(100*i/(r-a)),n<e.target+e.padding||n>e.target-e.padding)return this.complete=!0,r;n<e.target?e.bad():n>e.target&&e.good()}return r}},update:function(){o=this.end()},reset:function(){this.complete=!1,i=this.rounds=0,o=a=Date.now()}}},this.Demos=function(e){function t(){}function r(e){w&&(D.begin(),window.stats&&window.stats.begin(),w.app.render(e,e-P)===!1&&history.go(-1),D.end(),window.stats&&window.stats.end()),P=e,r.stop||requestAnimationFrame(r)}function n(){var e=window.AudioContext||window.webkitAudioContext;x=new e;var t=x.createBuffer(1,1,22050),r=x.createBufferSource();r.buffer=t,r.connect(x.destination),r.start(0)}function i(){y=document.createElement("canvas"),y.style.position="fixed",y.style.top="0",y.style.left="0",y.style.right="0",y.style.bottom="0",y.style.width="100%",y.style.height="100%",y.style.display="block",m(),document.body.appendChild(y);for(var e={alpha:!1,depth:!0,stencil:!1,antialias:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!1},t=["webgl","experimental-webgl"],r=0;r<t.length&&!(T=y.getContext(t[r],e));r++);T.clearColor(0,0,0,1),T.enable(T.DEPTH_TEST),T.depthFunc(T.LEQUAL),T.clear(T.COLOR_BUFFER_BIT)}function o(){return!!(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement)}function a(){document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.msRequestFullscreen?document.documentElement.msRequestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}function s(){o()||e.close()}function l(){function t(e){return e.factory(T,x,L).then(function(t){return{app:t,slug:e.slug,preview:e.preview}})}n(),i();var r=C;_.isFunction(e._filter)&&(r=_.filter(r,e._filter)),has.iOS&&(r=_.filter(r,function(e){return e.iOS!==!1}));var o=_.findWhere(r,{slug:"gallery"});r=_.filter(r,function(e){return"gallery"!==e.slug});var a;a=o?t(o):Promise.resolve();for(var s=0;s<r.length;s++){var l=r[s];l.touchstart&&l.touchstart()}var h=null;return GalleryLoader.create("/images/loader_sm.gif").then(function(e){document.body.appendChild(e.container),h=e,h.show()}).then(function(){return a}).then(function(e){e&&(b=e,A=[b],m(),O(b));var n=r.map(t),i=0;return n=n.map(function(e){return e.then(function(e){return i++,h.setProgress(i,r.length),e})}),Promise.all(n).then(function(e){A=A.concat(e),R=e,b&&b.app.addDemos(R),m(),f(),H=!0,has.mobile&&c()})}).then(function(){h.hide()},function(e){console.error(e.stack||e),h.setMessage("Uh oh, looks like there was an error. Please reload to retry.")})}function c(e){has.iOS?(h(),M=setInterval(function(){window.location=window.location,setTimeout(window.stop,0)},e||3e4)):has.Android&&(S.src="/videos/no-sleep.webm",S.play())}function h(){has.iOS?M&&(clearInterval(M),M=null):has.Android&&(S.pause(),S.src="")}function u(){switch(window.screen.orientation||window.screen.mozOrientation){case"landscape-primary":return 90;case"landscape-secondary":return-90;case"portrait-secondary":return 180;case"portrait-primary":return 0}return window.orientation}function f(){var e=u();A.forEach(function(t){_.isFunction(t.app.orientationchange)&&t.app.orientationchange(e)})}function d(){var e=u();switch(e){case-90:case 90:navigator.vibrate(50);break;case 0:case 180:w&&w!==b&&history.go(-1),navigator.vibrate(50)}f()}function p(){event.alpha&&(window.removeEventListener("deviceorientation",p,!1),L.deviceOrientation=!0)}function m(){if(void 0!==y){var e=N,t=window.innerWidth,r=window.innerHeight;w&&w.app.resize(t,r,e),D.complete&&D.reset()}}function g(t){if(!t.state||!t.state.slug)return void e.onBack();var r=_.findWhere(A,{slug:t.state.slug});E(r)}function v(e){e&&(e.enableVertexAttribArray(0),e.disable(e.CULL_FACE))}function E(e){w&&w.app.leave(),T&&v(T),w=e,m(),w&&w.app.enter()}t.prototype.factory=function(){},t.prototype.touchstart=function(){},t.prototype.preview="",t.prototype.slug="",t.prototype.iOS=!0;var y,T,x,w,b,R,H,M,S,C=[],A=[];if(has.Android){S=document.createElement("video"),S.addEventListener("ended",function(){S.play()});var k=function(){c(),window.removeEventListener("touchstart",k,!1)};window.addEventListener("touchstart",k,!1)}var L={deviceOrientation:!1},P=Date.now(),F=window.devicePixelRatio=window.devicePixelRatio||Math.round(window.screen.availWidth/document.documentElement.clientWidth),N=F,D=new FpsOptimizer({target:60,good:function(){var e=1+.1*(1-D._iterations/10);return N*=e,N>=F?(N=F,m(),void(D.complete=!0)):void m()},bad:function(){var e=1-.1*(1-D._iterations/10);return N*=e,.5>=N?(N=.5,m(),void(D.complete=!0)):void m()},maxIterations:10});window.optimizer=D;var U=["webkitfullscreenchange","mozfullscreenchange","fullscreenchange","MSFullscreenChange"];U.forEach(function(e){document.addEventListener(e,s,!1)}),function(){navigator&&navigator.vibrate||(window.navigator=window.navigator||{},window.navigator.vibrate=function(){})}(),window.addEventListener("orientationchange",d,!1),window.addEventListener("deviceorientation",p,!1),has.mobile&&(L.deviceOrientation=!0),window.addEventListener("resize",m,!1),window.addEventListener("popstate",g,!1),e.open=function(){return has.mobile&&(o()||a()),r.stop=!1,r(),y&&(y.style.display="block"),H?(O(b),Promise.resolve()):l()},e.close=function(){r.stop=!0,y.style.display="none",E(null)},e.loadByTitle=function(e){var t=_.findWhere(A,{slug:e});t&&O(t)};var O=e.load=function(e){e&&history.pushState({slug:e.slug},"",""),E(e)};return e.registry=function(){return C},e.register=function(e){C.push(e)},e._filter=null,e.onBack=e.close,e}(this.Demos||{});var AudioPlayer=function(){function e(e,t){this.play=function(r){r=r||0;var n=e.createBufferSource();n.buffer=t,n.connect(e.destination),n.start(r)}}function t(e){return new Promise(function(t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){if(200!==n.status){var i=e+" failed: "+n.statusText;return void r(new Error(i))}t(n.response)},n.onerror=function(e){r(e)},n.send()})}return e.create=function(r,n){return t(n).then(function(e){return new Promise(function(t,i){r.decodeAudioData(e,t,function(){i("failed to load "+n)})})}).then(function(t){return new e(r,t)})},e}(),Stereoscope=function(e){function t(t,r,n,i){var o,a,s,l;this.options={backgroundColor:2566178,slideDuration:5e3,transitionDuration:500};for(o in i)this.options[o]=i[o];for(a=new e.WebGLRenderer({canvas:t}),a.setClearColor(this.options.backgroundColor),this.renderer=a,this.click=n,s=new e.Scene,this.scene=s,l=new e.OrthographicCamera(-.5,.5,-.5,.5,0,10),l.position.z=1,this.camera=l,this.slides=[],this.currentSlide=-1,o=0;o<r.length;o++)this._addSlide(r[o])}function r(e){return new Promise(function(t,r){var n=new Image;n.onload=function(){t(n)},n.onerror=function(){r("failed to load "+e)},n.src=e})}function n(e,t,r,n,i,o){return void 0===o&&(o=1.70158),(t/=i/2)<1?n/2*t*t*(((o*=1.525)+1)*t-o)+r:n/2*((t-=2)*t*(((o*=1.525)+1)*t+o)+2)+r}var i="audio/click.mp3",o=["images/reel/0.jpg","images/reel/1.jpg","images/reel/2.jpg","images/reel/3.jpg","images/reel/4.jpg","images/reel/5.jpg","images/reel/6.jpg","images/reel/7.jpg"];return t.create=function(e,n){for(var a=AudioPlayer.create(n,i),s=[],l=0;l<o.length;l++)s.push(r(o[l]));var c=Promise.all(s);return Promise.all([a,c]).then(function(r){var n=r[0],i=r[1];return new t(e.canvas,i,n)})},t.prototype.enter=function(){},t.prototype.leave=function(){},t.prototype.render=function(e){this._update(e),this.renderer.setClearColor(this.options.backgroundColor),this.renderer.clear(),this.renderer.render(this.scene,this.camera)},t.prototype.resize=function(e,t,r){r&&(this.renderer.devicePixelRatio=r),this.renderer.setSize(e,t),this.camera.top=t/e/2,this.camera.bottom=-t/e/2,this.camera.updateProjectionMatrix()},t.prototype._addSlide=function(t){var r=new e.Texture(t);r.needsUpdate=!0;var n=new e.SpriteMaterial({map:r,color:16777215}),i=new e.Sprite(n);i.scale.set(1,t.height/t.width,1),this.scene.add(i),this.slides.push(i),i.visible=!1},t.prototype._cameraPosition=function(e){var t=Math.floor(e/this._period()),r=e%this._period(),i=0;if(r>this.options.slideDuration){var o=(r-this.options.slideDuration)/this.options.transitionDuration;i=n(void 0,o,0,1,1,1)}return t+i},t.prototype._period=function(){return this.options.slideDuration+this.options.transitionDuration},t.prototype._positionVisibleSlides=function(e){for(var t=Math.floor(e-.5),r=Math.ceil(e+.5),n=this.slides.length,i=t;r>=i;i++){var o=(i+n)%n,a=Math.floor(i/n),s=this.slides[o];s.visible=!0;var l=o;l+=a*n,s.position.y=l}},t.prototype._update=function(e){var t=this.currentSlide,r=this._cameraPosition(e);this.currentSlide=Math.ceil(r-.5),this._positionVisibleSlides(r),this.camera.position.y=r,this.currentSlide>t&&this.click.play()},t}(THREE);Demos.register({factory:Stereoscope.create,slug:"reel",preview:"/images/preview/reel.jpg"}),Cardboard.prototype.initControls=function(e){e.alpha&&(window.removeEventListener("deviceorientation",this._initControls,!1),this.renderer.domElement.addEventListener("click",this.fullscreen.bind(this),!1),this.orbitControls.enabled=!1,this.controls.connect(),this.controls.update())},Cardboard.prototype.animate=function(){this._playing&&(requestAnimationFrame(this.animate),this.update(),this.render())},Cardboard.prototype.pause=function(){this._playing=!1},Cardboard.prototype.play=function(){this._playing||(this._playing=!0,this.animate())},Cardboard.prototype.update=function(){this.camera.updateProjectionMatrix(),this.controls.freeze===!1?this.controls.update():this.orbitControls.update()},Cardboard.prototype.render=function(){return this.currentRenderer?void this.currentRenderer.render(this.scene,this.camera):void this.effect.render(this.scene,this.camera)},Cardboard.prototype.fullscreen=function(){this.renderer.domElement.requestFullscreen?this.renderer.domElement.requestFullscreen():this.renderer.domElement.msRequestFullscreen?this.renderer.domElement.msRequestFullscreen():this.renderer.domElement.mozRequestFullScreen?this.renderer.domElement.mozRequestFullScreen():this.renderer.domElement.webkitRequestFullscreen&&this.renderer.domElement.webkitRequestFullscreen()},Cardboard.prototype.resize=function(e,t,r){this.width=e,this.height=t,this.camera.aspect=this.width/this.height,this.camera.updateProjectionMatrix(),r&&(this.renderer.devicePixelRatio=this.effect.devicePixelRatio=r),this.renderer.setSize(this.width,this.height),this.effect.setSize(this.width,this.height)};var detectScreenHeight=function(e){var t=[["HTC One 801e",59],["HTC One VX",57],["Motorola Electrify",54],["Motorola MOT-XT681",50],["Nexus 5",62],["Optimus_Madrid",57],["SAMSUNG EK-GN120",60],["SAMSUNG GT-B7810/B7810BUALG1",55],["SAMSUNG GT-I9070/I9070BULD1",53],["SAMSUNG GT-I9210/I9210XXLC2",59],["SAMSUNG GT-S5839i/S5839iBULC1",50],["SAMSUNG GT-S7500/S7500BULB1",52],["SAMSUNG GT-S7580",53],["SAMSUNG SCH-I545",63],["SAMSUNG-GT-B9388_TD/1.0",49],["SAMSUNG-SGH-I437",59],["SAMSUNG-SGH-I537",63],["SAMSUNG-SGH-I547",53],["SAMSUNG-SGH-I577",53],["SAMSUNG-SGH-I727",60],["SAMSUNG-SGH-I777",57],["SAMSUNG-SGH-I827",46],["SAMSUNG-SGH-I847",49],["SAMSUNG-SGH-I857",46],["SAMSUNG-SGH-I927",53],["SAMSUNG-SM-G730A",53],["SonyEricssonX10i",50]];return function(r){r=r||e.userAgent;for(var n=0;n<t.length;n++){var i=t[n][0],o=t[n][1];if(r.indexOf(i)>0)return o}return null}}(navigator),getOrientation=function(){switch(window.screen.orientation||window.screen.mozOrientation){case"landscape-primary":return 90;case"landscape-secondary":return-90;case"portrait-secondary":return 180;case"portrait-primary":return 0}return window.orientation||0};THREE.MoleculeNetworkShader={uniforms:{tFft:{type:"t",value:null},opacity:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","float rand(vec2 co){","  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);","}","void main() {","vUv = vec2(rand(uv), rand(uv.yx));","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tFft;","uniform float opacity;","varying vec2 vUv;","void main() {","float fft = texture2D(tFft, vUv).r / 3.0;","if (fft < 0.1) discard;","gl_FragColor = vec4( 1.,1.,1., fft * opacity );","}"].join("\n")},THREE.MoleculeSheildShader={uniforms:{tFft:{type:"t",value:null},opacity:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","float rand(vec2 co){","    return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);","}","void main() {","vUv = vec2(rand(uv), rand(uv.yx));","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tFft;","varying vec2 vUv;","void main() {","float fft = texture2D(tFft, vUv).r / 3.0;","if (fft < 0.25) discard;","gl_FragColor = vec4( 1.,1.,1., fft );","}"].join("\n")},THREE.AudioTexture=function(e,t,r){var n=this;this.size=16,this.smoothingTimeConstant=.9,this.fftSize=1024,this.fftMax=255;var i=[];this.fftBuffer=[],this.playing=!1,this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=this.size,this.ctx2D=this.canvas.getContext("2d");var o=this.ctx2D.createImageData(this.size,this.size);this.texture=new THREE.Texture(o),this.buffer=null,this.source=null,this.analyser=null,this.ctxAudio=t;var a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType="arraybuffer",a.send(null),this.onAudioUpdated=function(){};var s=function(){this.source=this.ctxAudio.createBufferSource(),this.source.buffer=this.buffer,this.source.loop=!0,this.source.connect(this.analyser),this.analyser.connect(n.ctxAudio.destination)}.bind(this);a.onload=function(){n.ctxAudio.decodeAudioData(a.response,function(e){return e?(n.analyser=n.ctxAudio.createAnalyser(),n.analyser.smoothingTimeConstant=n.smoothingTimeConstant,n.analyser.fftSize=n.fftSize,n.buffer=e,void(r&&"function"==typeof r&&r())):void console.error("Error decoding file data")},function(e){console.error("Decoding error:"+e)})},this.analyze=function(){i=new Uint8Array(this.analyser.frequencyBinCount),this.analyser.getByteFrequencyData(i),this.fftBuffer=i.subarray(0,this.fftMax);for(var e=0,t=0;t<o.data.length;t+=4)o.data[t]=this.fftBuffer[e],o.data[t+1]=0,o.data[t+2]=0,o.data[t+3]=this.fftMax,e++;this.texture.needsUpdate=!0,this.ctx2D.putImageData(o,0,0),this.onAudioUpdated(this),this.playing&&requestAnimationFrame(this.analyze.bind(this))},a.onerror=function(){console.error("buffer: XHR error")},this.play=function(){this.buffer&&(s(),this.playing||(this.playing=!0,this.source.start(0),this.analyze()))},this.stop=function(){this.playing=!1,this.source.stop(0)}},function(){function e(e){var t,r,n=e.vertices,i=e.faceVertexUvs[0],o=new THREE.Geometry,a=e.faces;for(t=0,r=a.length;r>t;t++)o.vertices.push(n[a[t].a].clone()),o.vertices.push(n[a[t].b].clone()),o.vertices.push(n[a[t].c].clone()),o.faces.push(a[t].clone()),o.faces[o.faces.length-1].a=o.vertices.length-3,o.faces[o.faces.length-1].b=o.vertices.length-2,o.faces[o.faces.length-1].c=o.vertices.length-1;for(i=e.faceVertexUvs[0],t=0,r=i.length;r>t;t++){for(var s=i[t],l=[],c=0,h=s.length;h>c;c++)l.push(new THREE.Vector2(s[0].x,s[0].y));o.faceVertexUvs[0].push(l)}return o.mergeVertices(),o}function t(e,t,n,i,o){return Math.round(r(e,t,n,i,o))}function r(e,t,r,n,i){return n+(i-n)*((e-t)/(r-t))}function n(){l.scene.visible=!0,s.audioTexture.play()}function i(){l.scene.visible=!1,s.audioTexture.stop()}function o(){l.update(),s.update(),l.render()}function a(){Cardboard.prototype.resize.apply(l,arguments)}var s,l,c=this,h=c.ShinySound||{},u=c.ShinySound=function(n,i){var o=0;THREE.Object3D.call(this);var a="forward_thinking96.mp3",s=_.after(2,function(){i&&"function"==typeof i&&(console.log("resolve shinysound"),i())}),c=this.audioTexture=new THREE.AudioTexture("audio/"+a,n,s);this.cameraRig=new THREE.Object3D,this.cameraRig.add(l.camera),l.scene.add(this.cameraRig);var h=window.skybox=THREE.ImageUtils.loadTextureCube(["textures/skybox/skybox_px.jpg","textures/skybox/skybox_nx.jpg","textures/skybox/skybox_py.jpg","textures/skybox/skybox_ny.jpg","textures/skybox/skybox_pz.jpg","textures/skybox/skybox_nz.jpg"],void 0,s),u=THREE.ShaderLib.cube;u.uniforms={tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},u.uniforms.tCube.value=h;var f=new THREE.ShaderMaterial({fragmentShader:u.fragmentShader,vertexShader:u.vertexShader,uniforms:u.uniforms,depthWrite:!1,side:THREE.BackSide}),d=new THREE.Mesh(new THREE.BoxGeometry(20,20,20),f);l.scene.add(d);var p=new THREE.AmbientLight(3355443),m=new THREE.DirectionalLight(16777215,.1);m.position.set(5,10,10);var g=new THREE.DirectionalLight(16777215,.1);g.position.set(-10,-22,10);var v=new THREE.DirectionalLight(16777215,.9);v.position.set(5,-5,-9),this.cameraRig.add(m),this.cameraRig.add(g),this.cameraRig.add(v),this.cameraRig.add(p);var E=.2,y=2.25*E,T=1.15*E;this.molecule=new THREE.Object3D,l.scene.add(this.molecule);var x=new THREE.ImageUtils.loadTexture("textures/shinysound/noise.jpg"),w=new THREE.ImageUtils.loadTexture("textures/shinysound/bump.jpg");this.nucleus=new THREE.Mesh(new THREE.SphereGeometry(E,32,32),new THREE.MeshPhongMaterial({shininess:20,specularMap:x,bumpMap:w,bumpScale:.1,ambient:29372,specular:16240639,shading:THREE.SmoothShading})),this.molecule.add(this.nucleus),this.bubble=new THREE.Mesh(new THREE.IcosahedronGeometry(T,4),new THREE.MeshPhongMaterial({shininess:60,ambient:0,color:0,specular:16777215,refractionRatio:.91,reflectivity:.3,envMap:h,combine:THREE.AddOperation,transparent:!0,opacity:.9,depthWrite:!1,blending:THREE.AdditiveBlending,shading:THREE.SmoothShading})),this.molecule.add(this.bubble);var b=new THREE.IcosahedronGeometry(y,1);b=this.icosahedron=e(b);var R=THREE.MoleculeSheildShader;R.uniforms=THREE.UniformsUtils.clone(THREE.MoleculeSheildShader.uniforms),R.uniforms.tFft.value=c.texture,this.shield=new THREE.Mesh(b,new THREE.ShaderMaterial({fragmentShader:R.fragmentShader,vertexShader:R.vertexShader,depthWrite:!1,transparent:!0,uniforms:R.uniforms,blending:THREE.AdditiveBlending})),this.molecule.add(this.shield);var H=THREE.MoleculeNetworkShader;H.uniforms=THREE.UniformsUtils.clone(THREE.MoleculeNetworkShader.uniforms),H.uniforms.tFft.value=c.texture;var M=new THREE.ShaderMaterial({fragmentShader:H.fragmentShader,vertexShader:H.vertexShader,depthWrite:!1,transparent:!0,wireframe:!0,uniforms:R.uniforms,blending:THREE.AdditiveBlending}),S=new THREE.Mesh(b,M);this.molecule.add(S);var C=new THREE.MeshBasicMaterial({color:16777215,envMap:h,transparent:!0,shading:THREE.FlatShading,opacity:0});this.satelites=[];var A=new THREE.IcosahedronGeometry(y/3,0);for(o=0;10>o;o++)this.satelites[o]=new THREE.Mesh(A,M),this.satelites[o].core=new THREE.Mesh(A,C),this.satelites[o].core.visible=!1,this.satelites[o].core.renderDepth=1e5,this.satelites[o].core.scale.multiplyScalar(.9),this.satelites[o].add(this.satelites[o].core),this.satelites[o].position.set(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1).multiplyScalar(1+2*Math.random()),this.satelites[o].scale.multiplyScalar(1+Math.random()),this.satelites[o].phase=Math.random()*Math.PI*2,this.satelites[o].dir=(new THREE.Quaternion).setFromEuler(new THREE.Euler(.025*(Math.random()-.5),.025*(Math.random()-.5),.025*(Math.random()-.5))),this.molecule.add(this.satelites[o]);var k=.33,L=new THREE.LineBasicMaterial({color:16777215,linewidth:1,transparent:!0,blending:THREE.AdditiveBlending,opacity:0}),P=new THREE.Geometry;for(o=0;20>o;o++){var F=(Math.random()-.5)*y*1e4,N=(Math.random()-.5)*y*1e4,D=(Math.random()-.5)*y*1e4;P.vertices.push(new THREE.Vector3),P.vertices.push(new THREE.Vector3(F,N,D))}var U=new THREE.Line(P,L);this.molecule.add(U);var O=new THREE.Geometry;for(o in b.vertices)O.vertices.push(new THREE.Vector3(b.vertices[o].x,b.vertices[o].y,b.vertices[o].z));var z=new THREE.PointCloudMaterial({color:16777215,sizeAttenuation:!1,size:3,blending:THREE.AdditiveBlending,transparent:!0,opacity:0}),I=new THREE.PointCloud(O,z);this.molecule.add(I),l.camera.position.z=2,l.controls.object=this.cameraRig,l.controls.object.rotation.reorder("YXZ");var V,B,G,j,W,X,q,Y,K,Q,Z,$,J=this,et=[42.4,63.5,71.8,80.2];c.onAudioUpdated=function(e){Q=e.fftBuffer,Z=b.vertices.length,$=Q.length,J.bubble.scale.set(1,1,1).multiplyScalar(1+Q[64]/500),J.nucleus.scale.set(1,1,1).multiplyScalar(1-Q[128]/1e3);for(var n=0;Z>n;n++){var i=t(n,0,Z,0,$),o=r(Q[i],0,255,0,y),a=.5*o+y;b.vertices[n].setLength(a),O.vertices[n].setLength(a)}if(b.verticesNeedUpdate=!0,O.verticesNeedUpdate=!0,V=c.source.context.currentTime%c.source.buffer.duration,B=Math.max(V-16.93,0)%.52/.52,G=Math.round(Math.max(V-16.93,0)/.52-B),j=Math.min(4*B,1-B)/4,W=Math.max(V+.52-16.93,0)%1.04/1.04,X=Math.round(Math.max(V+.52-16.93,0)/1.04-W),q=Math.min(20*W,1-W),V>8.6&&12>V?L.opacity=(400*L.opacity+k)/401:V>12&&15>G?(z.opacity=(100*z.opacity+k)/101,L.opacity*=.99):G>=15&&48>G?(U.lastBeat&&U.lastBeat!==X&&U.rotation.set(2*Math.random()*Math.PI,2*Math.random()*Math.PI,2*Math.random()*Math.PI),L.opacity=q*k/4,U.lastBeat=X):G>=48&&79>G?L.opacity=(50*L.opacity+k/2)/51:G>=80&&88>G?(J.nucleus.scale.multiplyScalar(1+j),J.bubble.scale.multiplyScalar(1+j),L.opacity*=.8):G>=89&&120>G?(L.opacity=(50*L.opacity+k/2)/51,U.lastBeat&&U.lastBeat!==X&&U.rotation.set(2*Math.random()*Math.PI,2*Math.random()*Math.PI,2*Math.random()*Math.PI),L.opacity=q*k/2,U.lastBeat=X,C.opacity=(1e3*C.opacity+1)/1001):G>135&&(z.opacity*=.97,L.opacity*=.97,C.opacity*=.97),0===B)for(n=0;n<J.satelites.length;n++)J.satelites[n].core.visible=!1;else if(87===G)for(n=0;n<J.satelites.length;n++)J.satelites[n].core.visible=!0;for(n=0;n<et.length;n++)Y=Math.max(V-et[n],0),K=Math.min(2*Y,2.5-Y)/4,Y>0&&2.5>Y&&J.nucleus.position.set((Math.random()-.5)*K*.05,(Math.random()-.5)*K*.05,(Math.random()-.5)*K*.05)},this.update=function(){var e=Date.now()/1e4;this.nucleus.rotation.x+=.002,this.nucleus.rotation.y+=.003,this.nucleus.rotation.z+=.005;for(var t=0;10>t;t++)this.satelites[t].quaternion.multiply(this.satelites[t].dir),this.satelites[t].position.normalize().multiplyScalar(2+Math.sin(e+this.satelites[t].phase))}};u.noConflict=function(){return c.ShinySound=h,u};var f=function(e,t,r){return new Promise(function(c){l=new Cardboard(e),l.effect.separation=.06,r.deviceOrientation&&(l.orbitControls.enabled=!1,l.controls.connect()),s=new u(t,function(){c({enter:n,leave:i,render:o,resize:a})})})};Demos.register({factory:f,slug:"shinysound",preview:"/images/preview/shinysound.jpg"})}(),THREE.Sky=function(){THREE.BufferGeometry.call(this);for(var e=[],t=0;100>t;t++){var r=8e3*Math.random()-4e3,n=500*Math.random()+500,i=8e3*Math.random()-4e3,o=400*Math.random()+200;e.push(r-o,n,i-o),e.push(r+o,n,i-o),e.push(r-o,n,i+o),e.push(r+o,n,i-o),e.push(r+o,n,i+o),e.push(r-o,n,i+o)}this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(e),3))},THREE.Sky.prototype=Object.create(THREE.BufferGeometry.prototype),THREE.Trees=function(e){THREE.BufferGeometry.call(this);var t=[],r=new THREE.Raycaster;r.ray.direction.set(0,-1,0);for(var n=0;2e3>n;n++){var i=5e3*Math.random()-2500,o=5e3*Math.random()-2500;r.ray.origin.set(i,500,o);var a=r.intersectObject(e);if(0!==a.length){var s=a[0].point.y,l=50*Math.random()+5,c=Math.random()*Math.PI*2;t.push(i+10*Math.sin(c),s,o+10*Math.cos(c)),t.push(i,s+l,o),t.push(i+10*Math.sin(c+Math.PI),s,o+10*Math.cos(c+Math.PI)),c+=Math.PI/2,t.push(i+10*Math.sin(c),s,o+10*Math.cos(c)),t.push(i,s+l,o),t.push(i+10*Math.sin(c+Math.PI),s,o+10*Math.cos(c+Math.PI))}}this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(t),3))},THREE.Trees.prototype=Object.create(THREE.BufferGeometry.prototype),THREE.RollerCoaster=function(e,t){THREE.BufferGeometry.call(this);var r=[],n=[],i=new THREE.Vector3(0,1,0),o=new THREE.Vector3,a=new THREE.Vector3,s=new THREE.Quaternion,l=new THREE.Quaternion;l.setFromAxisAngle(i,Math.PI/2);var c=new THREE.Vector3,h=new THREE.Vector3;h.copy(e.getPointAt(0));for(var u=[new THREE.Vector3(-2.25,0,0),new THREE.Vector3(0,-.5,0),new THREE.Vector3(0,-1.75,0),new THREE.Vector3(0,-.5,0),new THREE.Vector3(2.25,0,0),new THREE.Vector3(0,-1.75,0)],f=2*Math.PI,d=5,p=[],m=0;d>m;m++){var g=m/d*f;p.push(new THREE.Vector3(.6*Math.sin(g),.6*Math.cos(g),0))}for(var d=6,v=[],m=0;d>m;m++){var g=m/d*f;v.push(new THREE.Vector3(.25*Math.sin(g),.25*Math.cos(g),0))}for(var E=new THREE.Vector3,y=new THREE.Vector3,T=function(e){y.set(0,0,-1).applyQuaternion(s);for(var t=0;t<e.length;t++)E.copy(e[t]),E.applyQuaternion(s),E.add(c),r.push(E.x,E.y,E.z),n.push(y.x,y.y,y.z);y.set(0,0,1).applyQuaternion(s);for(var t=e.length-1;t>=0;t--)E.copy(e[t]),E.applyQuaternion(s),E.add(c),r.push(E.x,E.y,E.z),n.push(y.x,y.y,y.z)},x=new THREE.Vector3,w=new THREE.Vector3,b=new THREE.Vector3,R=new THREE.Vector3,_=new THREE.Vector3,H=new THREE.Vector3,M=new THREE.Vector3,S=new THREE.Vector3,C=function(e,t){for(var i=0,o=e.length;o>i;i++){var a=e[i],u=e[(i+1)%o];x.copy(a).add(t),x.applyQuaternion(s),x.add(c),w.copy(u).add(t),w.applyQuaternion(s),w.add(c),b.copy(u).add(t),b.applyQuaternion(l),b.add(h),R.copy(a).add(t),R.applyQuaternion(l),R.add(h),r.push(x.x,x.y,x.z),r.push(w.x,w.y,w.z),r.push(R.x,R.y,R.z),r.push(w.x,w.y,w.z),r.push(b.x,b.y,b.z),r.push(R.x,R.y,R.z),_.copy(a),_.applyQuaternion(s),_.normalize(),H.copy(u),H.applyQuaternion(s),H.normalize(),M.copy(u),M.applyQuaternion(l),M.normalize(),S.copy(a),S.applyQuaternion(l),S.normalize(),n.push(_.x,_.y,_.z),n.push(H.x,H.y,H.z),n.push(S.x,S.y,S.z),n.push(H.x,H.y,H.z),n.push(M.x,M.y,M.z),n.push(S.x,S.y,S.z)}},A=new THREE.Vector3,m=1;t>=m;m++){c.copy(e.getPointAt(m/t)),i.set(0,1,0),o.subVectors(c,h).normalize(),a.crossVectors(i,o).normalize(),i.crossVectors(o,a);var g=Math.atan2(o.x,o.z);s.setFromAxisAngle(i,g),m%2===0&&T(u),C(p,A.set(0,-1.25,0)),C(v,A.set(2,0,0)),C(v,A.set(-2,0,0)),h.copy(c),l.copy(s)}this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(r),3)),this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(n),3))},THREE.RollerCoaster.prototype=Object.create(THREE.BufferGeometry.prototype),THREE.RollerCoasterLifters=function(e,t){THREE.BufferGeometry.call(this);for(var r=[],n=[],i=new THREE.Quaternion,o=new THREE.Vector3(0,1,0),a=new THREE.Vector3,s=new THREE.Vector3,l=[new THREE.Vector3(0,.5,-.5),new THREE.Vector3(0,.5,.5),new THREE.Vector3(0,-.5,0)],c=[new THREE.Vector3(-.5,0,.5),new THREE.Vector3(-.5,0,-.5),new THREE.Vector3(.5,0,0)],h=[new THREE.Vector3(.5,0,-.5),new THREE.Vector3(.5,0,.5),new THREE.Vector3(-.5,0,0)],u=new THREE.Vector3,f=new THREE.Vector3,d=new THREE.Vector3,p=new THREE.Vector3,m=new THREE.Vector3,g=new THREE.Vector3,v=new THREE.Vector3,E=new THREE.Vector3,y=function(e,t,o){for(var a=0,s=e.length;s>a;a++){var l=e[a],c=e[(a+1)%s];u.copy(l),u.applyQuaternion(i),u.add(t),f.copy(c),f.applyQuaternion(i),f.add(t),d.copy(c),d.applyQuaternion(i),d.add(o),p.copy(l),p.applyQuaternion(i),p.add(o),r.push(u.x,u.y,u.z),r.push(f.x,f.y,f.z),r.push(p.x,p.y,p.z),r.push(f.x,f.y,f.z),r.push(d.x,d.y,d.z),r.push(p.x,p.y,p.z),m.copy(l),m.applyQuaternion(i),m.normalize(),g.copy(c),g.applyQuaternion(i),g.normalize(),v.copy(c),v.applyQuaternion(i),v.normalize(),E.copy(l),E.applyQuaternion(i),E.normalize(),n.push(m.x,m.y,m.z),n.push(g.x,g.y,g.z),n.push(E.x,E.y,E.z),n.push(g.x,g.y,g.z),n.push(v.x,v.y,v.z),n.push(E.x,E.y,E.z)}},T=new THREE.Vector3,x=new THREE.Vector3,w=(new THREE.Vector3,1);t>=w;w++){a.copy(e.getPointAt(w/t)),s.copy(e.getTangentAt(w/t));
var b=Math.atan2(s.x,s.z);i.setFromAxisAngle(o,b),a.y>100?(T.set(-7.5,-3.5,0),T.applyQuaternion(i),T.add(a),x.set(7.5,-3.5,0),x.applyQuaternion(i),x.add(a),y(l,T,x),T.set(-7,-3,0),T.applyQuaternion(i),T.add(a),x.set(-7,-a.y,0),x.applyQuaternion(i),x.add(a),y(c,T,x),T.set(7,-3,0),T.applyQuaternion(i),T.add(a),x.set(7,-a.y,0),x.applyQuaternion(i),x.add(a),y(h,T,x)):(T.set(0,-2,0),T.applyQuaternion(i),T.add(a),x.set(0,-a.y,0),x.applyQuaternion(i),x.add(a),y(h,T,x))}this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(r),3)),this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(n),3))},THREE.RollerCoasterLifters.prototype=Object.create(THREE.BufferGeometry.prototype),THREE.RollerCoasterShadow=function(e,t){THREE.BufferGeometry.call(this);var r=[],n=new THREE.Vector3(0,1,0),i=new THREE.Vector3,o=new THREE.Quaternion,a=new THREE.Quaternion;a.setFromAxisAngle(n,Math.PI/2);var s=new THREE.Vector3,l=new THREE.Vector3;l.copy(e.getPointAt(0)),l.y=0;for(var c=new THREE.Vector3,h=new THREE.Vector3,u=new THREE.Vector3,f=new THREE.Vector3,d=1;t>=d;d++){s.copy(e.getPointAt(d/t)),s.y=0,i.subVectors(s,l);var p=Math.atan2(i.x,i.z);o.setFromAxisAngle(n,p),c.set(-3,0,0),c.applyQuaternion(o),c.add(s),h.set(3,0,0),h.applyQuaternion(o),h.add(s),u.set(3,0,0),u.applyQuaternion(a),u.add(l),f.set(-3,0,0),f.applyQuaternion(a),f.add(l),r.push(c.x,c.y,c.z),r.push(h.x,h.y,h.z),r.push(f.x,f.y,f.z),r.push(h.x,h.y,h.z),r.push(u.x,u.y,u.z),r.push(f.x,f.y,f.z),l.copy(s),a.copy(o)}this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(r),3))},THREE.RollerCoasterShadow.prototype=Object.create(THREE.BufferGeometry.prototype),THREE.Sound=function(e,t,r){function n(){var t=e.createBufferSource();return t.buffer=i,t.playbackRate.value=o,t.loop=a,t}var i,o,a,s,l=e.createBufferSource(),c=e.createGain();c.connect(e.destination),this.load=function(n){var o=new XMLHttpRequest;return o.open("GET",n,!0),o.responseType="arraybuffer",o.onload=function(){e.decodeAudioData(this.response,function(e){i=l.buffer=e,t&&"function"==typeof t&&t()},function(e){r&&"function"==typeof r&&r("error decoding "+n+": "+e)})},o.onerror=function(e){r&&"function"==typeof r&&r(e)},o.send(),this},this.setPlayBackRate=function(e){return o=e,l?(l.playbackRate.value=e,this):this},this.setLoop=function(e){return a=e,l?(l.loop=e,this):this},this.setVolume=function(e){return c.gain.value=e,this},this.play=function(){return l||(l=n()),l.connect(c),l.start(e.currentTime),this},this.play3D=function(t){return l||(l=n()),s||(s=e.createPanner(),s.rolloffFactor=.01,s.setPosition(t.x,t.y,t.z),s.connect(c)),l.connect(s),l.start(e.currentTime),this},this.stop=function(){return l.disconnect(s||c),l.stop(e.currentTime),l=null,this}},function(){function e(){var e,t,r;e=new THREE.PlaneGeometry(5e3,5e3,15,15),e.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2)),t=new THREE.MeshLambertMaterial({color:4222976,shading:THREE.FlatShading});for(var n=0;n<e.vertices.length;n++){var i=e.vertices[n],o=i.distanceTo(u.position)/5-250;i.x+=100*Math.random()-50,i.y=Math.random()*Math.max(0,o),i.x+=100*Math.random()-50}e.computeFaceNormals(),r=new THREE.Mesh(e,t),u.add(r),e=new THREE.Trees(r),t=new THREE.MeshBasicMaterial({color:4222976,side:THREE.DoubleSide}),r=new THREE.Mesh(e,t),u.add(r),e=new THREE.Sky,t=new THREE.MeshBasicMaterial({color:16777215}),r=new THREE.Mesh(e,t),u.add(r)}function t(){var e,t,r;e=new THREE.RollerCoaster(w,1500),t=new THREE.MeshPhongMaterial({color:16776960,specular:131586,shininess:300}),r=new THREE.Mesh(e,t),u.add(r),e=new THREE.RollerCoasterLifters(w,100),t=new THREE.MeshPhongMaterial({color:16777215,specular:131586,shininess:300}),r=new THREE.Mesh(e,t),r.position.y=1,u.add(r),e=new THREE.RollerCoasterShadow(w,500),t=new THREE.MeshBasicMaterial({color:0,opacity:.1,depthWrite:!1,transparent:!0}),r=new THREE.Mesh(e,t),r.position.y=1,u.add(r)}function r(e,t,r){var n,i,o,a=_.after(4,function(){t&&"function"==typeof t&&t()});n=new THREE.CylinderGeometry(100,100,50,15),i=new THREE.MeshLambertMaterial({color:16744576,shading:THREE.FlatShading}),o=new THREE.Mesh(n,i),o.position.set(-800,100,-700),o.rotation.x=Math.PI/2,u.add(o),x.push(o),g=new THREE.Sound(e,a,r),g.load("audio/rollercoaster/funfair_a.mp3"),g.setLoop(!0),g.setVolume(1.5),n=new THREE.CylinderGeometry(50,60,40,10),i=new THREE.MeshLambertMaterial({color:8421631,shading:THREE.FlatShading}),o=new THREE.Mesh(n,i),o.position.set(500,20,300),u.add(o),x.push(o),v=new THREE.Sound(e,a,r),v.load("audio/rollercoaster/funfair_b.mp3"),v.setLoop(!0),v.setVolume(1.5),E=new THREE.Sound(e,a,r),E.load("audio/rollercoaster/slide.mp3"),E.setVolume(.5),E.setLoop(!0),y=new THREE.Sound(e,a,r),y.load("audio/rollercoaster/ambient.mp3"),y.setLoop(!0),y.setVolume(.1)}function n(n,g,v){return c=g,l=new THREE.WebGLRenderer({canvas:n.canvas,antialias:!0}),h=new THREE.StereoEffect(l),h.separation=.2,h.targetDistance=50,h.setSize(window.innerWidth,window.innerHeight),u=new THREE.Scene,u.autoUpdate=!1,f=new THREE.HemisphereLight(16773360,6316134),f.position.set(1,1,1),u.add(f),d=new THREE.Object3D,u.add(d),p=new THREE.PerspectiveCamera(40,window.innerWidth/window.innerHeight,1,5e3),p.rotation.y=Math.PI,d.add(p),v.deviceOrientation&&(m=new THREE.DeviceOrientationControls(p),m.freeze=!1),new Promise(function(n,l){e(),t(),r(g,function(){n({enter:i,leave:o,resize:a,render:s})},l)})}function i(){u.visible=!0,l.setClearColor(15790335),g.play3D(x[0].position),v.play3D(x[1].position),E.play(),y.play()}function o(){u.visible=!1,g.stop(x[0].position),v.stop(x[1].position),E.stop(),y.stop()}function a(e,t,r){p.aspect=e/t,p.updateProjectionMatrix(),r&&(l.devicePixelRatio=h.devicePixelRatio=r),h.setSize(e,t),l.setSize(e,t)}function s(e){for(var t=0;t<x.length;t++)x[t].rotation.y=2e-4*e;S+=M,S%=1,b.copy(w.getPointAt(S)),b.y+=3,d.position.copy(b),R.copy(w.getTangentAt(S)),M-=15e-7*R.y,M=Math.max(M,4e-5),d.lookAt(H.copy(b).add(R)),void 0!==m&&m.update(),E.setPlayBackRate(5e3*M+.2),p.matrixWorld.decompose(C,k,L),P.set(0,0,-1).applyQuaternion(k),F.subVectors(C,A),c.listener.setPosition(C.x,C.y,C.z),c.listener.setOrientation(P.x,P.y,P.z,p.up.x,p.up.y,p.up.z),c.listener.setVelocity(F.x,F.y,F.z),A.copy(C),h.render(u,p)}var l,c,h,u,f,d,p,m,g,v,E,y,T=2*Math.PI,x=[],w=function(){var e=new THREE.Vector3,t=new THREE.Vector3;return{getPointAt:function(t){t*=T;var r=Math.sin(3*t)*Math.cos(4*t)*50,n=4*Math.cos(8*t)+Math.cos(17*t)+5,i=Math.sin(t)*Math.sin(4*t)*50;return e.set(r,n,i).multiplyScalar(20)},getTangentAt:function(e){var r=1e-4,n=Math.max(0,e-r),i=Math.min(1,e+r);return t.copy(this.getPointAt(i)).sub(this.getPointAt(n)).normalize()}}}(),b=new THREE.Vector3,R=new THREE.Vector3,H=new THREE.Vector3,M=0,S=0,C=new THREE.Vector3,A=new THREE.Vector3,k=new THREE.Quaternion,L=new THREE.Vector3,P=new THREE.Vector3,F=new THREE.Vector3;Demos.register({factory:n,slug:"rollercoaster",preview:"/images/preview/rollercoaster.jpg"})}(),function(){var e=function(t,r){var n=t.nodeType;if(3==n)r.push(t.textContent.replace(/&/,"&amp;").replace(/</,"&lt;").replace(">","&gt;"));else if(1==n){if(r.push("<",t.tagName),t.hasAttributes())for(var i=t.attributes,o=0,a=i.length;a>o;++o){var s=i.item(o);r.push(" ",s.name,"='",s.value,"'")}if(t.hasChildNodes()){r.push(">");for(var l=t.childNodes,o=0,a=l.length;a>o;++o)e(l.item(o),r);r.push("</",t.tagName,">")}else r.push("/>")}else{if(8!=n)throw"Error serializing XML. Unhandled node of type: "+n;r.push("<!--",t.nodeValue,"-->")}};Object.defineProperty(SVGElement.prototype,"innerHTML",{get:function(){for(var t=[],r=this.firstChild;r;)e(r,t),r=r.nextSibling;return t.join("")},set:function(e){for(e=e.substring(e.indexOf("<svg"));this.firstChild;)this.removeChild(this.firstChild);try{var t=new DOMParser;t.async=!1,sXML="<svg xmlns='http://www.w3.org/2000/svg'>"+e+"</svg>";for(var r=t.parseFromString(sXML,"text/xml").documentElement,n=r.firstChild;n;)this.appendChild(this.ownerDocument.importNode(n,!0)),n=n.nextSibling}catch(i){throw new Error("Error parsing XML string")}}}),Object.defineProperty(SVGElement.prototype,"innerSVG",{get:function(){return this.innerHTML},set:function(e){this.innerHTML=e}})}(),function(){var e=this,t=e._,r={},n=Array.prototype,i=Object.prototype,o=Function.prototype,a=n.push,s=n.slice,l=n.concat,c=i.toString,h=i.hasOwnProperty,u=n.forEach,f=n.map,d=n.reduce,p=n.reduceRight,m=n.filter,g=n.every,v=n.some,E=n.indexOf,y=n.lastIndexOf,T=Array.isArray,x=Object.keys,w=o.bind,b=function(e){return e instanceof b?e:this instanceof b?void(this._wrapped=e):new b(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=b),exports._=b):e._=b,b.VERSION="1.6.0";var R=b.each=b.forEach=function(e,t,n){if(null==e)return e;if(u&&e.forEach===u)e.forEach(t,n);else if(e.length===+e.length){for(var i=0,o=e.length;o>i;i++)if(t.call(n,e[i],i,e)===r)return}else for(var a=b.keys(e),i=0,o=a.length;o>i;i++)if(t.call(n,e[a[i]],a[i],e)===r)return;return e};b.map=b.collect=function(e,t,r){var n=[];return null==e?n:f&&e.map===f?e.map(t,r):(R(e,function(e,i,o){n.push(t.call(r,e,i,o))}),n)};var _="Reduce of empty array with no initial value";b.reduce=b.foldl=b.inject=function(e,t,r,n){var i=arguments.length>2;if(null==e&&(e=[]),d&&e.reduce===d)return n&&(t=b.bind(t,n)),i?e.reduce(t,r):e.reduce(t);if(R(e,function(e,o,a){i?r=t.call(n,r,e,o,a):(r=e,i=!0)}),!i)throw new TypeError(_);return r},b.reduceRight=b.foldr=function(e,t,r,n){var i=arguments.length>2;if(null==e&&(e=[]),p&&e.reduceRight===p)return n&&(t=b.bind(t,n)),i?e.reduceRight(t,r):e.reduceRight(t);var o=e.length;if(o!==+o){var a=b.keys(e);o=a.length}if(R(e,function(s,l,c){l=a?a[--o]:--o,i?r=t.call(n,r,e[l],l,c):(r=e[l],i=!0)}),!i)throw new TypeError(_);return r},b.find=b.detect=function(e,t,r){var n;return H(e,function(e,i,o){return t.call(r,e,i,o)?(n=e,!0):void 0}),n},b.filter=b.select=function(e,t,r){var n=[];return null==e?n:m&&e.filter===m?e.filter(t,r):(R(e,function(e,i,o){t.call(r,e,i,o)&&n.push(e)}),n)},b.reject=function(e,t,r){return b.filter(e,function(e,n,i){return!t.call(r,e,n,i)},r)},b.every=b.all=function(e,t,n){t||(t=b.identity);var i=!0;return null==e?i:g&&e.every===g?e.every(t,n):(R(e,function(e,o,a){return(i=i&&t.call(n,e,o,a))?void 0:r}),!!i)};var H=b.some=b.any=function(e,t,n){t||(t=b.identity);var i=!1;return null==e?i:v&&e.some===v?e.some(t,n):(R(e,function(e,o,a){return i||(i=t.call(n,e,o,a))?r:void 0}),!!i)};b.contains=b.include=function(e,t){return null==e?!1:E&&e.indexOf===E?-1!=e.indexOf(t):H(e,function(e){return e===t})},b.invoke=function(e,t){var r=s.call(arguments,2),n=b.isFunction(t);return b.map(e,function(e){return(n?t:e[t]).apply(e,r)})},b.pluck=function(e,t){return b.map(e,b.property(t))},b.where=function(e,t){return b.filter(e,b.matches(t))},b.findWhere=function(e,t){return b.find(e,b.matches(t))},b.max=function(e,t,r){if(!t&&b.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);var n=-1/0,i=-1/0;return R(e,function(e,o,a){var s=t?t.call(r,e,o,a):e;s>i&&(n=e,i=s)}),n},b.min=function(e,t,r){if(!t&&b.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);var n=1/0,i=1/0;return R(e,function(e,o,a){var s=t?t.call(r,e,o,a):e;i>s&&(n=e,i=s)}),n},b.shuffle=function(e){var t,r=0,n=[];return R(e,function(e){t=b.random(r++),n[r-1]=n[t],n[t]=e}),n},b.sample=function(e,t,r){return null==t||r?(e.length!==+e.length&&(e=b.values(e)),e[b.random(e.length-1)]):b.shuffle(e).slice(0,Math.max(0,t))};var M=function(e){return null==e?b.identity:b.isFunction(e)?e:b.property(e)};b.sortBy=function(e,t,r){return t=M(t),b.pluck(b.map(e,function(e,n,i){return{value:e,index:n,criteria:t.call(r,e,n,i)}}).sort(function(e,t){var r=e.criteria,n=t.criteria;if(r!==n){if(r>n||void 0===r)return 1;if(n>r||void 0===n)return-1}return e.index-t.index}),"value")};var S=function(e){return function(t,r,n){var i={};return r=M(r),R(t,function(o,a){var s=r.call(n,o,a,t);e(i,s,o)}),i}};b.groupBy=S(function(e,t,r){b.has(e,t)?e[t].push(r):e[t]=[r]}),b.indexBy=S(function(e,t,r){e[t]=r}),b.countBy=S(function(e,t){b.has(e,t)?e[t]++:e[t]=1}),b.sortedIndex=function(e,t,r,n){r=M(r);for(var i=r.call(n,t),o=0,a=e.length;a>o;){var s=o+a>>>1;r.call(n,e[s])<i?o=s+1:a=s}return o},b.toArray=function(e){return e?b.isArray(e)?s.call(e):e.length===+e.length?b.map(e,b.identity):b.values(e):[]},b.size=function(e){return null==e?0:e.length===+e.length?e.length:b.keys(e).length},b.first=b.head=b.take=function(e,t,r){return null==e?void 0:null==t||r?e[0]:0>t?[]:s.call(e,0,t)},b.initial=function(e,t,r){return s.call(e,0,e.length-(null==t||r?1:t))},b.last=function(e,t,r){return null==e?void 0:null==t||r?e[e.length-1]:s.call(e,Math.max(e.length-t,0))},b.rest=b.tail=b.drop=function(e,t,r){return s.call(e,null==t||r?1:t)},b.compact=function(e){return b.filter(e,b.identity)};var C=function(e,t,r){return t&&b.every(e,b.isArray)?l.apply(r,e):(R(e,function(e){b.isArray(e)||b.isArguments(e)?t?a.apply(r,e):C(e,t,r):r.push(e)}),r)};b.flatten=function(e,t){return C(e,t,[])},b.without=function(e){return b.difference(e,s.call(arguments,1))},b.partition=function(e,t){var r=[],n=[];return R(e,function(e){(t(e)?r:n).push(e)}),[r,n]},b.uniq=b.unique=function(e,t,r,n){b.isFunction(t)&&(n=r,r=t,t=!1);var i=r?b.map(e,r,n):e,o=[],a=[];return R(i,function(r,n){(t?n&&a[a.length-1]===r:b.contains(a,r))||(a.push(r),o.push(e[n]))}),o},b.union=function(){return b.uniq(b.flatten(arguments,!0))},b.intersection=function(e){var t=s.call(arguments,1);return b.filter(b.uniq(e),function(e){return b.every(t,function(t){return b.contains(t,e)})})},b.difference=function(e){var t=l.apply(n,s.call(arguments,1));return b.filter(e,function(e){return!b.contains(t,e)})},b.zip=function(){for(var e=b.max(b.pluck(arguments,"length").concat(0)),t=new Array(e),r=0;e>r;r++)t[r]=b.pluck(arguments,""+r);return t},b.object=function(e,t){if(null==e)return{};for(var r={},n=0,i=e.length;i>n;n++)t?r[e[n]]=t[n]:r[e[n][0]]=e[n][1];return r},b.indexOf=function(e,t,r){if(null==e)return-1;var n=0,i=e.length;if(r){if("number"!=typeof r)return n=b.sortedIndex(e,t),e[n]===t?n:-1;n=0>r?Math.max(0,i+r):r}if(E&&e.indexOf===E)return e.indexOf(t,r);for(;i>n;n++)if(e[n]===t)return n;return-1},b.lastIndexOf=function(e,t,r){if(null==e)return-1;var n=null!=r;if(y&&e.lastIndexOf===y)return n?e.lastIndexOf(t,r):e.lastIndexOf(t);for(var i=n?r:e.length;i--;)if(e[i]===t)return i;return-1},b.range=function(e,t,r){arguments.length<=1&&(t=e||0,e=0),r=arguments[2]||1;for(var n=Math.max(Math.ceil((t-e)/r),0),i=0,o=new Array(n);n>i;)o[i++]=e,e+=r;return o};var A=function(){};b.bind=function(e,t){var r,n;if(w&&e.bind===w)return w.apply(e,s.call(arguments,1));if(!b.isFunction(e))throw new TypeError;return r=s.call(arguments,2),n=function(){if(!(this instanceof n))return e.apply(t,r.concat(s.call(arguments)));A.prototype=e.prototype;var i=new A;A.prototype=null;var o=e.apply(i,r.concat(s.call(arguments)));return Object(o)===o?o:i}},b.partial=function(e){var t=s.call(arguments,1);return function(){for(var r=0,n=t.slice(),i=0,o=n.length;o>i;i++)n[i]===b&&(n[i]=arguments[r++]);for(;r<arguments.length;)n.push(arguments[r++]);return e.apply(this,n)}},b.bindAll=function(e){var t=s.call(arguments,1);if(0===t.length)throw new Error("bindAll must be passed function names");return R(t,function(t){e[t]=b.bind(e[t],e)}),e},b.memoize=function(e,t){var r={};return t||(t=b.identity),function(){var n=t.apply(this,arguments);return b.has(r,n)?r[n]:r[n]=e.apply(this,arguments)}},b.delay=function(e,t){var r=s.call(arguments,2);return setTimeout(function(){return e.apply(null,r)},t)},b.defer=function(e){return b.delay.apply(b,[e,1].concat(s.call(arguments,1)))},b.throttle=function(e,t,r){var n,i,o,a=null,s=0;r||(r={});var l=function(){s=r.leading===!1?0:b.now(),a=null,o=e.apply(n,i),n=i=null};return function(){var c=b.now();s||r.leading!==!1||(s=c);var h=t-(c-s);return n=this,i=arguments,0>=h?(clearTimeout(a),a=null,s=c,o=e.apply(n,i),n=i=null):a||r.trailing===!1||(a=setTimeout(l,h)),o}},b.debounce=function(e,t,r){var n,i,o,a,s,l=function(){var c=b.now()-a;t>c?n=setTimeout(l,t-c):(n=null,r||(s=e.apply(o,i),o=i=null))};return function(){o=this,i=arguments,a=b.now();var c=r&&!n;return n||(n=setTimeout(l,t)),c&&(s=e.apply(o,i),o=i=null),s}},b.once=function(e){var t,r=!1;return function(){return r?t:(r=!0,t=e.apply(this,arguments),e=null,t)}},b.wrap=function(e,t){return b.partial(t,e)},b.compose=function(){var e=arguments;return function(){for(var t=arguments,r=e.length-1;r>=0;r--)t=[e[r].apply(this,t)];return t[0]}},b.after=function(e,t){return function(){return--e<1?t.apply(this,arguments):void 0}},b.keys=function(e){if(!b.isObject(e))return[];if(x)return x(e);var t=[];for(var r in e)b.has(e,r)&&t.push(r);return t},b.values=function(e){for(var t=b.keys(e),r=t.length,n=new Array(r),i=0;r>i;i++)n[i]=e[t[i]];return n},b.pairs=function(e){for(var t=b.keys(e),r=t.length,n=new Array(r),i=0;r>i;i++)n[i]=[t[i],e[t[i]]];return n},b.invert=function(e){for(var t={},r=b.keys(e),n=0,i=r.length;i>n;n++)t[e[r[n]]]=r[n];return t},b.functions=b.methods=function(e){var t=[];for(var r in e)b.isFunction(e[r])&&t.push(r);return t.sort()},b.extend=function(e){return R(s.call(arguments,1),function(t){if(t)for(var r in t)e[r]=t[r]}),e},b.pick=function(e){var t={},r=l.apply(n,s.call(arguments,1));return R(r,function(r){r in e&&(t[r]=e[r])}),t},b.omit=function(e){var t={},r=l.apply(n,s.call(arguments,1));for(var i in e)b.contains(r,i)||(t[i]=e[i]);return t},b.defaults=function(e){return R(s.call(arguments,1),function(t){if(t)for(var r in t)void 0===e[r]&&(e[r]=t[r])}),e},b.clone=function(e){return b.isObject(e)?b.isArray(e)?e.slice():b.extend({},e):e},b.tap=function(e,t){return t(e),e};var k=function(e,t,r,n){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof b&&(e=e._wrapped),t instanceof b&&(t=t._wrapped);var i=c.call(e);if(i!=c.call(t))return!1;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var o=r.length;o--;)if(r[o]==e)return n[o]==t;var a=e.constructor,s=t.constructor;if(a!==s&&!(b.isFunction(a)&&a instanceof a&&b.isFunction(s)&&s instanceof s)&&"constructor"in e&&"constructor"in t)return!1;r.push(e),n.push(t);var l=0,h=!0;if("[object Array]"==i){if(l=e.length,h=l==t.length)for(;l--&&(h=k(e[l],t[l],r,n)););}else{for(var u in e)if(b.has(e,u)&&(l++,!(h=b.has(t,u)&&k(e[u],t[u],r,n))))break;if(h){for(u in t)if(b.has(t,u)&&!l--)break;h=!l}}return r.pop(),n.pop(),h};b.isEqual=function(e,t){return k(e,t,[],[])},b.isEmpty=function(e){if(null==e)return!0;if(b.isArray(e)||b.isString(e))return 0===e.length;for(var t in e)if(b.has(e,t))return!1;return!0},b.isElement=function(e){return!(!e||1!==e.nodeType)},b.isArray=T||function(e){return"[object Array]"==c.call(e)},b.isObject=function(e){return e===Object(e)},R(["Arguments","Function","String","Number","Date","RegExp"],function(e){b["is"+e]=function(t){return c.call(t)=="[object "+e+"]"}}),b.isArguments(arguments)||(b.isArguments=function(e){return!(!e||!b.has(e,"callee"))}),"function"!=typeof/./&&(b.isFunction=function(e){return"function"==typeof e}),b.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},b.isNaN=function(e){return b.isNumber(e)&&e!=+e},b.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==c.call(e)},b.isNull=function(e){return null===e},b.isUndefined=function(e){return void 0===e},b.has=function(e,t){return h.call(e,t)},b.noConflict=function(){return e._=t,this},b.identity=function(e){return e},b.constant=function(e){return function(){return e}},b.property=function(e){return function(t){return t[e]}},b.matches=function(e){return function(t){if(t===e)return!0;for(var r in e)if(e[r]!==t[r])return!1;return!0}},b.times=function(e,t,r){for(var n=Array(Math.max(0,e)),i=0;e>i;i++)n[i]=t.call(r,i);return n},b.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},b.now=Date.now||function(){return(new Date).getTime()};var L={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};L.unescape=b.invert(L.escape);var P={escape:new RegExp("["+b.keys(L.escape).join("")+"]","g"),unescape:new RegExp("("+b.keys(L.unescape).join("|")+")","g")};b.each(["escape","unescape"],function(e){b[e]=function(t){return null==t?"":(""+t).replace(P[e],function(t){return L[e][t]})}}),b.result=function(e,t){if(null==e)return void 0;var r=e[t];return b.isFunction(r)?r.call(e):r},b.mixin=function(e){R(b.functions(e),function(t){var r=b[t]=e[t];b.prototype[t]=function(){var e=[this._wrapped];return a.apply(e,arguments),O.call(this,r.apply(b,e))}})};var F=0;b.uniqueId=function(e){var t=++F+"";return e?e+t:t},b.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var N=/(.)^/,D={"'":"'","\\":"\\","\r":"r","\n":"n"," ":"t","\u2028":"u2028","\u2029":"u2029"},U=/\\|'|\r|\n|\t|\u2028|\u2029/g;b.template=function(e,t,r){var n;r=b.defaults({},r,b.templateSettings);var i=new RegExp([(r.escape||N).source,(r.interpolate||N).source,(r.evaluate||N).source].join("|")+"|$","g"),o=0,a="__p+='";e.replace(i,function(t,r,n,i,s){return a+=e.slice(o,s).replace(U,function(e){return"\\"+D[e]}),r&&(a+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'"),n&&(a+="'+\n((__t=("+n+"))==null?'':__t)+\n'"),i&&(a+="';\n"+i+"\n__p+='"),o=s+t.length,t}),a+="';\n",r.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{n=new Function(r.variable||"obj","_",a)}catch(s){throw s.source=a,s}if(t)return n(t,b);var l=function(e){return n.call(this,e,b)};return l.source="function("+(r.variable||"obj")+"){\n"+a+"}",l},b.chain=function(e){return b(e).chain()};var O=function(e){return this._chain?b(e).chain():e};b.mixin(b),R(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=n[e];b.prototype[e]=function(){var r=this._wrapped;return t.apply(r,arguments),"shift"!=e&&"splice"!=e||0!==r.length||delete r[0],O.call(this,r)}}),R(["concat","join","slice"],function(e){var t=n[e];b.prototype[e]=function(){return O.call(this,t.apply(this._wrapped,arguments))}}),b.extend(b.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return b})}.call(this),function(e){"use strict";var t,r,n,i,o,a,s,l,c,h,u,f,d,p,m,g,v,E,y,T,x,w,b,R,_,H,M,S,C,A,k,L,P,F,N,D,U,O,z,I,V,B,G,j,W,X,q,Y,K,Q,Z,$,J,et,tt,rt,nt,it,ot,at,st,lt,ct,ht,ut,ft,dt,pt,mt,gt,vt,Et,yt,Tt,xt="0.3.6",wt=e.document||null,bt={},Rt={},_t={},Ht={},Mt={}.hasOwnProperty,St=function(){},Ct=e.console||{log:St,warn:St},At={},kt=/^\s+/,Lt=/\s+$/,Pt="Missing Ractive.parse - cannot parse template. Either preparse or use the version that includes the parser",Ft=1,Nt=2,Dt=3,Ut=4,Ot=5,zt=6,It=7,Vt=8,Bt=9,Gt=10,jt=11,Wt=12,Xt=15,qt=20,Yt=21,Kt=22,Qt=23,Zt=24,$t=26,Jt=27,er=30,tr=31,rr=32,nr=33,ir=34,or=35,ar=36,sr=40,lr={unset:!0},cr=wt?wt.createElement("div"):null,hr={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};try{Object.defineProperty({},"test",{value:0}),Object.defineProperties({},{test:{value:0}}),wt&&(Object.defineProperty(cr,"test",{value:0}),Object.defineProperties(cr,{test:{value:0}})),k=Object.defineProperty,L=Object.defineProperties}catch(ur){k=function(e,t,r){e[t]=r.value},L=function(e,t){var r;for(r in t)t.hasOwnProperty(r)&&k(e,r,t[r])},Tt=!0}try{Object.create(null),P=Object.create,F=function(){return Object.create(null)}}catch(ur){P=function(){var e=function(){};return function(t,r){var n;return e.prototype=t,n=new e,r&&Object.defineProperties(n,r),n}}(),F=function(){return{}}}var fr,dr,pr,mr=function(e){return e.replace(/[A-Z]/g,function(e){return"-"+e.toLowerCase()})};!function(){wt&&(void 0!==cr.style.transition?(dr="transition",pr="transitionend",fr=!0):void 0!==cr.style.webkitTransition?(dr="webkitTransition",pr="webkitTransitionEnd",fr=!0):fr=!1)}(),function(){var e,t,r,n,i,o,a,s,l,c,h,u;B=function(){var t,n,i=this.parentNode;return this.fragment&&(t=e(this))?(this.interpolator=t,this.keypath=t.keypath||t.descriptor.r,(n=r(this))?(i._ractive.binding=n,this.twoway=!0,!0):!1):!1},t=function(){this._ractive.binding.update()},e=function(e){var t;return 1!==e.fragment.items.length?null:(t=e.fragment.items[0],t.type!==Nt?null:t.keypath||t.ref?t:null)},r=function(e){var t=e.parentNode;if("SELECT"===t.tagName)return t.multiple?new o(e,t):new a(e,t);if("checkbox"===t.type||"radio"===t.type){if("name"===e.propertyName){if("checkbox"===t.type)return new l(e,t);if("radio"===t.type)return new s(e,t)}return"checked"===e.propertyName?new c(e,t):null}return"value"!==e.propertyName&&Ct.warn("This is... odd"),"file"===e.parentNode.type?new h(e,t):new u(e,t)},o=function(e,r){n(this,e,r),r.addEventListener("change",t,!1)},o.prototype={update:function(){var e,t,r,n,i,o,a;for(e=this.attr,i=e.value||[],t=[],r=this.node.querySelectorAll("option:checked"),a=r.length,n=0;a>n;n+=1)t[t.length]=r[n]._ractive.value;for(o=a!==i.length,n=t.length;n--;)t[n]!==i[n]&&(o=!0);(o=!0)&&(e.receiving=!0,e.value=t,this.root.set(this.keypath,t),e.receiving=!1)},teardown:function(){this.node.removeEventListener("change",t,!1)}},a=function(e,r){n(this,e,r),r.addEventListener("change",t,!1)},a.prototype={update:function(){var e,t;e=this.node.querySelector("option:checked"),e&&(t=e._ractive.value,this.attr.receiving=!0,this.attr.value=t,this.root.set(this.keypath,t),this.attr.receiving=!1)},teardown:function(){this.node.removeEventListener("change",t,!1)}},s=function(e,r){n(this,e,r),r.name="{{"+e.keypath+"}}",r.addEventListener("change",t,!1),r.attachEvent&&r.addEventListener("click",t,!1)},s.prototype={update:function(){var e=this.node;e.checked&&(this.attr.receiving=!0,this.root.set(this.keypath,e._ractive?e._ractive.value:e.value),this.attr.receiving=!1)},teardown:function(){this.node.removeEventListener("change",t,!1),this.node.removeEventListener("click",t,!1)}},l=function(e,r){n(this,e,r),r.name="{{"+this.keypath+"}}",this.query='input[type="checkbox"][name="'+r.name+'"]',r.addEventListener("change",t,!1),r.attachEvent&&r.addEventListener("click",t,!1)},l.prototype={update:function(){var e,t,r,n,o,a;for(e=this.root.get(this.keypath),r=this.root.el.querySelectorAll(this.query),n=r.length,t=[],o=0;n>o;o+=1)a=r[o],a.checked&&(t[t.length]=a._ractive.value);i(e,t)||(this.attr.receiving=!0,this.root.set(this.keypath,t),this.attr.receiving=!1)},teardown:function(){this.node.removeEventListener("change",t,!1),this.node.removeEventListener("click",t,!1)}},c=function(e,r){n(this,e,r),r.addEventListener("change",t,!1),r.attachEvent&&r.addEventListener("click",t,!1)},c.prototype={update:function(){this.attr.receiving=!0,this.root.set(this.keypath,this.node.checked),this.attr.receiving=!1},teardown:function(){this.node.removeEventListener("change",t,!1),this.node.removeEventListener("click",t,!1)}},h=function(e,r){n(this,e,r),r.addEventListener("change",t,!1)},h.prototype={update:function(){this.attr.root.set(this.attr.keypath,this.attr.parentNode.files)},teardown:function(){this.node.removeEventListener("change",t,!1)}},u=function(e,r){n(this,e,r),r.addEventListener("change",t,!1),this.root.lazy||(r.addEventListener("input",t,!1),r.attachEvent&&r.addEventListener("keyup",t,!1))},u.prototype={update:function(){var e=this.attr,t=e.parentNode.value;+t+""===t&&-1===t.indexOf("e")&&(t=+t),e.receiving=!0,e.root.set(e.keypath,t),e.receiving=!1},teardown:function(){this.node.removeEventListener("change",t,!1),this.node.removeEventListener("input",t,!1),this.node.removeEventListener("keyup",t,!1)}},n=function(e,t,r){e.attr=t,e.node=r,e.root=t.root,e.keypath=t.keypath},i=function(e,t){var r;if(!E(e)||!E(t))return!1;if(e.length!==t.length)return!1;for(r=e.length;r--;)if(e[r]!==t[r])return!1;return!0}}(),function(){var e,t,r,n,i,o,a,s;V=function(){var n;if(!this.ready)return this;if(n=this.parentNode,"SELECT"===n.tagName&&"value"===this.name)return this.update=t,this.deferredUpdate=r,this.update();if(this.isFileInputValue)return this.update=e,this;if(this.twoway&&"name"===this.name){if("radio"===n.type)return this.update=o,this.update();if("checkbox"===n.type)return this.update=a,this.update()}return this.update=s,this.update()},e=function(){return this},r=function(){this.deferredUpdate=this.parentNode.multiple?i:n,this.deferredUpdate()},t=function(){return this.root._defSelectValues.push(this),this},n=function(){var e,t,r,n=this.fragment.getValue();for(this.value=n,e=this.parentNode.querySelectorAll("option"),r=e.length;r--;)if(t=e[r],t._ractive.value===n)return t.selected=!0,this;return this},i=function(){var e,t,r=this.fragment.getValue();for(E(r)||(r=[r]),e=this.parentNode.querySelectorAll("option"),t=e.length;t--;)e[t].selected=-1!==r.indexOf(e[t]._ractive.value);return this.value=r,this},o=function(){var e,t;return e=this.parentNode,t=this.fragment.getValue(),e.checked=t===e._ractive.value,this},a=function(){var e,t;return e=this.parentNode,t=this.fragment.getValue(),E(t)?(e.checked=-1!==t.indexOf(e._ractive.value),this):(e.checked=t===e._ractive.value,this)},s=function(){var e,t;if(e=this.parentNode,t=this.fragment.getValue(),this.isValueAttribute&&(e._ractive.value=t),void 0===t&&(t=""),t!==this.value){if(this.useProperty)return this.receiving||(e[this.propertyName]=t),this.value=t,this;if(this.namespace)return e.setAttributeNS(this.namespace,this.name,t),this.value=t,this;"id"===this.name&&(void 0!==this.value&&(this.root.nodes[this.value]=void 0),this.root.nodes[t]=e),e.setAttribute(this.name,t),this.value=t}return this}}(),N=function(e,t){var r,n,i;for(n in t)if(Mt.call(t,n))for(i=n.split("-"),r=i.length;r--;)D(e,i[r],t[n],e.parentFragment.contextStack)},function(){var e,r,n,i,o,a,s,l;D=function(t,r,n,i,o){var a,s;a=t.ractify().events,s=a[r]||(a[r]=new e(t,r,i,o)),s.add(n)},e=function(e,r,n){var i;this.element=e,this.root=e.root,this.node=e.node,this.name=r,this.contextStack=n,this.proxies=[],(i=this.root.eventDefinitions[r]||t.eventDefinitions[r])?this.custom=i(this.node,l(r)):this.node.addEventListener(r,s,!1)},e.prototype={add:function(e){this.proxies[this.proxies.length]=new r(this.element,this.root,e,this.contextStack)},teardown:function(){var e;for(this.custom?this.custom.teardown():this.node.removeEventListener(this.name,s,!1),e=this.proxies.length;e--;)this.proxies[e].teardown()},fire:function(e){for(var t=this.proxies.length;t--;)this.proxies[t].fire(e)}},r=function(e,t,r,a){var s;return this.root=t,s=r.n||r,this.n="string"==typeof s?s:new $({descriptor:r.n,root:this.root,owner:e,contextStack:a}),r.a?(this.a=r.a,void(this.fire=i)):r.d?(this.d=new $({descriptor:r.d,root:this.root,owner:e,contextStack:a}),void(this.fire=o)):void(this.fire=n)},r.prototype={teardown:function(){this.n.teardown&&this.n.teardown(),this.d&&this.d.teardown()},bubble:St},n=function(e){this.root.fire(this.n.toString(),e)},i=function(e){this.root.fire(this.n.toString(),e,this.a)},o=function(e){this.root.fire(this.n.toString(),e,this.d.toJSON())},s=function(e){var t=this._ractive;t.events[e.type].fire({node:this,original:e,index:t.index,keypath:t.keypath,context:t.root.get(t.keypath)})},a={},l=function(e){return a[e]?a[e]:a[e]=function(t){var r=t.node._ractive;t.index=r.index,t.keypath=r.keypath,t.context=r.root.get(r.keypath),r.events[e].fire(t)}}}(),U=function(e,t,r,n){"string"!=typeof r.f||t&&t.namespaceURI&&t.namespaceURI!==hr.html?"style"===r.e&&void 0!==t.styleSheet?(e.fragment=new $({descriptor:r.f,root:e.root,contextStack:e.parentFragment.contextStack,owner:e}),n&&(e.bubble=function(){t.styleSheet.cssText=e.fragment.toString()
})):(e.fragment=new G({descriptor:r.f,root:e.root,parentNode:t,contextStack:e.parentFragment.contextStack,owner:e}),n&&t.appendChild(e.fragment.docFrag)):(e.html=r.f,n&&(t.innerHTML=e.html))},O=function(e,t){switch(e.ractify(),e.descriptor.e){case"select":case"textarea":return void(t.value&&t.value.bind());case"input":if("radio"===e.node.type||"checkbox"===e.node.type){if(t.name&&t.name.bind())return void e.node._ractive.binding.update();if(t.checked&&t.checked.bind())return}if(t.value&&t.value.bind())return}},z=function(e,t){var r,n,i;e.attributes=[];for(r in t)Mt.call(t,r)&&(n=t[r],i=new W({element:e,name:r,value:n,root:e.root,parentNode:e.node,contextStack:e.parentFragment.contextStack}),e.attributes[e.attributes.length]=i,("value"===r||"name"===r||"checked"===r)&&(e.attributes[r]=i),"name"!==r&&i.update());return e.attributes},I=function(e,t){return e.a&&e.a.xmlns?e.a.xmlns:"svg"===e.e.toLowerCase()?hr.svg:t.namespaceURI},_=function(e,r,n,i,o){var a,s,l,c,h;r.transitionsEnabled&&("string"==typeof e?a=e:(a=e.n,e.a?s=e.a:e.d&&(l=new $({descriptor:e.d,root:r,owner:n,contextStack:n.parentFragment.contextStack}),s=l.toJSON(),l.teardown())),h=r.transitions[a]||t.transitions[a],h&&(c=r._transitionManager,c.push(n.node),h.call(r,n.node,function(){c.pop(n.node)},s,o)))},M=function(e,t){return e.components[t]},b=function(e,t){var r,n=[];for(r=wt.createElement("div"),r.innerHTML=e;r.firstChild;)n[n.length]=r.firstChild,t.appendChild(r.firstChild);return n},function(){var e,t,r;R=function(t,r,n,i,o){var a,s,l,c,h,u,f;for(l=r.descriptor.i,a=n;i>a;a+=1)s=r.fragments[a],c=a-o,h=a,u=r.keypath+"."+(a-o),f=r.keypath+"."+a,s.index+=o,e(s,l,c,h,o,u,f);m(t)},e=function(n,i,o,a,s,l,c){var h,u,f;for(n.indexRefs&&void 0!==n.indexRefs[i]&&(n.indexRefs[i]=a),h=n.contextStack.length;h--;)f=n.contextStack[h],f.substr(0,l.length)===l&&(n.contextStack[h]=f.replace(l,c));for(h=n.items.length;h--;)switch(u=n.items[h],u.type){case It:t(u,i,o,a,s,l,c);break;case Vt:e(u.fragment,i,o,a,s,l,c);break;case Ut:case Nt:case Dt:r(u,i,o,a,s,l,c)}},t=function(t,r,n,i,o,a,s){var l,c;for(l=t.attributes.length;l--;)c=t.attributes[l],c.fragment&&(e(c.fragment,r,n,i,o,a,s),c.twoway&&c.updateBindings());if(t.proxyFrags)for(l=t.proxyFrags.length;l--;)e(t.proxyFrags[l],r,n,i,o,a,s);t.node._ractive&&(t.node._ractive.keypath.substr(0,a.length)===a&&(t.node._ractive.keypath=t.node._ractive.keypath.replace(a,s)),void 0!==r&&(t.node._ractive.index[r]=i)),t.fragment&&e(t.fragment,r,n,i,o,a,s)},r=function(t,r,n,i,o,a,s){var l;if(t.descriptor.x&&(t.keypath&&h(t),t.expressionResolver&&t.expressionResolver.teardown(),t.expressionResolver=new rt(t)),t.keypath?t.keypath.substr(0,a.length)===a&&(h(t),t.keypath=t.keypath.replace(a,s),c(t)):t.indexRef===r&&(t.value=i,t.render(i)),t.fragments)for(l=t.fragments.length;l--;)e(t.fragments[l],r,n,i,o,a,s)}}(),function(e){var t,r,n,i;nt=function(e,n,i,o,a){var s,l;for(this.root=e,this.keypath=n,this.fn=r(i,o.length),this.values=[],this.refs=[],s=o.length;s--;)l=o[s],l[0]?this.values[s]=l[1]:this.refs[this.refs.length]=new t(e,l[1],this,s,a);this.selfUpdating=this.refs.length<=1},nt.prototype={bubble:function(){this.selfUpdating?this.update():this.deferred||(this.root._defEvals[this.root._defEvals.length]=this,this.deferred=!0)},update:function(){var e;if(this.evaluating)return this;this.evaluating=!0;try{e=this.fn.apply(null,this.values)}catch(t){if(this.root.debug)throw t;e=void 0}return x(e,this.value)||(l(this.root,this.keypath),this.root._cache[this.keypath]=e,u(this.root,this.keypath),this.value=e),this.evaluating=!1,this},teardown:function(){for(;this.refs.length;)this.refs.pop().teardown();l(this.root,this.keypath),this.root._evaluators[this.keypath]=null},refresh:function(){this.selfUpdating||(this.deferred=!0);for(var e=this.refs.length;e--;)this.refs[e].update();this.deferred&&(this.update(),this.deferred=!1)}},t=function(e,t,r,n,o){var a;this.evaluator=r,this.keypath=t,this.root=e,this.argNum=n,this.type=er,this.priority=o,a=e.get(t),"function"==typeof a&&(a=a._wrapped||i(a,e)),this.value=r.values[n]=a,c(this)},t.prototype={update:function(){var e=this.root.get(this.keypath);"function"==typeof e&&(e=e._wrapped||i(e,this.root)),x(e,this.value)||(this.evaluator.values[this.argNum]=e,this.evaluator.bubble(),this.value=e)},teardown:function(){h(this)}},r=function(t,r){var n,i;if(t=t.replace(/\$\{([0-9]+)\}/g,"_$1"),e[t])return e[t];for(i=[];r--;)i[r]="_"+r;return n=new Function(i.join(","),"return("+t+")"),e[t]=n,n},n=/this/,i=function(e,t){var r;if(!n.test(e.toString()))return e._wrapped=e;k(e,"_wrapped",{value:function(){return e.apply(t,arguments)},writable:!0});for(r in e)Mt.call(e,r)&&(e._wrapped[r]=e[r]);return e._wrapped}}({}),function(){var e,t;rt=function(t){var r,n,i,o,a;for(this.root=t.root,this.mustache=t,this.args=[],this.scouts=[],r=t.descriptor.x,a=t.parentFragment.indexRefs,this.str=r.s,i=this.unresolved=r.r?r.r.length:0,i||this.init(),n=0;i>n;n+=1)o=r.r[n],a&&void 0!==a[o]?this.resolveRef(n,!0,a[o]):this.scouts[this.scouts.length]=new e(this,o,t.contextStack,n)},rt.prototype={init:function(){this.keypath=t(this.str,this.args),this.createEvaluator(),this.mustache.resolve(this.keypath)},teardown:function(){for(;this.scouts.length;)this.scouts.pop().teardown()},resolveRef:function(e,t,r){this.args[e]=[t,r],--this.unresolved||this.init()},createEvaluator:function(){this.root._evaluators[this.keypath]?this.root._evaluators[this.keypath].refresh():(this.root._evaluators[this.keypath]=new nt(this.root,this.keypath,this.str,this.args,this.mustache.priority),this.root._evaluators[this.keypath].update())}},e=function(e,t,r,n){var i,o;o=this.root=e.root,i=p(o,t,r),i?e.resolveRef(n,!1,i):(this.ref=t,this.argNum=n,this.resolver=e,this.contextStack=r,o._pendingResolution[o._pendingResolution.length]=this)},e.prototype={resolve:function(e){this.keypath=e,this.resolver.resolveRef(this.argNum,!1,e)},teardown:function(){this.keypath||s(this)}},t=function(e,t){var r;return r=e.replace(/\$\{([0-9]+)\}/g,function(e,r){return t[r][1]}),"("+r.replace(/[\.\[\]]/g,"-")+")"}}(),function(){var e,r;H=function(n,i){var o,a;if(a=e(n,i))return a;if(a=e(t,i))return a;if(wt&&(o=wt.getElementById(i),o&&"SCRIPT"===o.tagName)){if(!t.parse)throw new Error(Pt);t.partials[i]=t.parse(o.innerHTML)}return a=t.partials[i],a?r(a):(n.debug&&Ct&&Ct.warn&&Ct.warn('Could not find descriptor for partial "'+i+'"'),[])},e=function(e,n){if(e.partials[n]){if("string"==typeof e.partials[n]){if(!t.parse)throw new Error(Pt);e.partials[n]=t.parse(e.partials[n])}return r(e.partials[n])}},r=function(e){return 1===e.length&&"string"==typeof e[0]?e[0]:e}}(),ct=function(e,t){var r,n,i,o,a;if(e.owner=t.owner,i=e.owner.parentFragment,e.root=t.root,e.parentNode=t.parentNode,e.contextStack=t.contextStack||[],e.owner.type===Ut&&(e.index=t.index),i&&(o=i.indexRefs)){e.indexRefs=F();for(a in o)e.indexRefs[a]=o[a]}for(e.priority=i?i.priority+1:0,t.indexRef&&(e.indexRefs||(e.indexRefs={}),e.indexRefs[t.indexRef]=t.index),e.items=[],r=t.descriptor?t.descriptor.length:0,n=0;r>n;n+=1)e.items[e.items.length]=e.createItem({parentFragment:e,descriptor:t.descriptor[n],index:n})},S=function(e){var t,r,n;for(t=e.items.length;t--;)if(r=e.items[t],r.type!==Ft){if(r.type!==Nt)return!1;if(n)return!1;n=!0}return!0},at=function(e,t){var r,n,i;i=e.parentFragment=t.parentFragment,e.root=i.root,e.contextStack=i.contextStack,e.descriptor=t.descriptor,e.index=t.index||0,e.priority=i.priority,i.parentNode&&(e.parentNode=i.parentNode),e.type=t.descriptor.t,t.descriptor.r&&(i.indexRefs&&void 0!==i.indexRefs[t.descriptor.r]?(n=i.indexRefs[t.descriptor.r],e.indexRef=t.descriptor.r,e.value=n,e.render(e.value)):(r=p(e.root,t.descriptor.r,e.contextStack),r?e.resolve(r):(e.ref=t.descriptor.r,e.root._pendingResolution[e.root._pendingResolution.length]=e,e.descriptor.n&&e.render(!1)))),t.descriptor.x&&(e.expressionResolver=new rt(e))},st=function(){var e;e=this.root.get(this.keypath,!0),x(e,this.value)||(this.render(e),this.value=e)},lt=function(e){this.keypath=e,c(this),this.update(),this.expressionResolver&&(this.expressionResolver=null)},function(){var e,t,r,n;ht=function(i,o){var a;return a={descriptor:i.descriptor.f,root:i.root,parentNode:i.parentNode,owner:i},i.descriptor.n?void n(i,o,!0,a):void(E(o)?e(i,o,a):y(o)?i.descriptor.i?t(i,o,a):r(i,a):n(i,o,!1,a))},e=function(e,t,r){var n,i,o;if(i=t.length,i<e.length)for(o=e.fragments.splice(i,e.length-i);o.length;)o.pop().teardown(!0);else if(i>e.length)for(n=e.length;i>n;n+=1)r.contextStack=e.contextStack.concat(e.keypath+"."+n),r.index=n,e.descriptor.i&&(r.indexRef=e.descriptor.i),e.fragments[n]=e.createFragment(r);e.length=i},t=function(e,t,r){var n,i;i=e.fragmentsById||(e.fragmentsById=F());for(n in i)void 0===t[n]&&(i[n].teardown(!0),i[n]=null);for(n in t)void 0===t[n]||i[n]||(r.contextStack=e.contextStack.concat(e.keypath+"."+n),r.index=n,e.descriptor.i&&(r.indexRef=e.descriptor.i),i[n]=e.createFragment(r))},r=function(e,t){e.length||(t.contextStack=e.contextStack.concat(e.keypath),t.index=0,e.fragments[0]=e.createFragment(t),e.length=1)},n=function(e,t,r,n){var i,o,a;if(o=E(t)&&0===t.length,i=r?o||!t:t&&!o){if(e.length||(n.contextStack=e.contextStack,n.index=0,e.fragments[0]=e.createFragment(n),e.length=1),e.length>1)for(a=e.fragments.splice(1);a.length;)a.pop().teardown(!0)}else e.length&&(e.teardownFragments(!0),e.length=0)}}();var gr;!function(){var e,t,r;gr=function(n,i){return n.next()?e(n,i)||t(n,i)||r(n,i):null},e=function(e,t){var r=e.next();return r.type===Ft?(e.pos+=1,new Ar(r,t)):null},t=function(e,t){var r=e.next();return r.type===jt||r.type===Dt?r.mustacheType===Ut||r.mustacheType===Ot?new Cr(r,e,t):new Sr(r,e):null},r=function(e,t){var r,n=e.next();return n.type===Wt?(r=new _r(n,e,t),e.options.sanitize&&e.options.sanitize.elements&&-1!==e.options.sanitize.elements.indexOf(r.lcTag)?null:r):null}}();var vr=function(e,t){var r,n;return t||(r=Er(e),r===!1)?n=e.map(function(e){return e.toJSON(t)}):r},Er=function(e){var t,r,n,i="";if(!e)return"";for(r=0,n=e.length;n>r;r+=1){if(t=e[r].toString(),t===!1)return!1;i+=t}return i},yr=function(e){var t=kt.exec(e.str.substring(e.pos));return t?(e.pos+=t[0].length,t[0]):null},Tr=function(e,t){var r=e.remaining().substr(0,40);throw 40===r.length&&(r+="..."),new Error('Tokenizer failed: unexpected string "'+r+'" (expected '+t+")")},xr=function(e){return function(t){var r=e.exec(t.str.substring(t.pos));return r?(t.pos+=r[0].length,r[1]||r[0]):null}},wr=function(e,t){var r;return r=e.str.substr(e.pos,t.length),r===t?(e.pos+=t.length,t):null};vt=function(e){var t,r,n,i;for(t=0;t<e.length;t+=1)r=e[t],n=e[t-1],i=e[t+1],(r.mustacheType===Bt||r.mustacheType===Gt)&&(e.splice(t,1),n&&i&&n.type===Ft&&i.type===Ft&&(n.value+=i.value,e.splice(t,1)),t-=1);return e},Et=function(e){var t,r,n;for(n="";e.length;){if(t=e.indexOf("<!--"),r=e.indexOf("-->"),-1===t&&-1===r){n+=e;break}if(-1!==t&&-1===r)throw"Illegal HTML - expected closing comment sequence ('-->')";if(-1!==r&&-1===t||t>r)throw"Illegal HTML - unexpected closing comment sequence ('-->')";n+=e.substr(0,t),e=e.substring(r+3)}return n},yt=function(e){var t,r,n,i,o,a;for(o=/^\s*\r?\n/,a=/\r?\n\s*$/,t=2;t<e.length;t+=1)r=e[t],n=e[t-1],i=e[t-2],r.type===Ft&&n.type===jt&&i.type===Ft&&a.test(i.value)&&o.test(r.value)&&(n.mustacheType!==Nt&&n.mustacheType!==Dt&&(i.value=i.value.replace(a,"\n")),r.value=r.value.replace(o,""),""===r.value&&e.splice(t--,1));return e},function(e){var t=function(e,t,r){var n;if("string"==typeof t&&T(r)){if(n=e.get(t),void 0===n&&(n=0),T(n))e.set(t,n+r);else if(e.debug)throw new Error("Cannot add to a non-numeric value")}else if(e.debug)throw new Error("Bad arguments")};e.add=function(e,r){t(this,e,void 0===r?1:r)},e.subtract=function(e,r){t(this,e,void 0===r?-1:-r)},e.toggle=function(e){var t;if("string"==typeof e)t=this.get(e),this.set(e,!t);else if(this.debug)throw new Error("Bad arguments")}}(bt),function(e){var r,n;e.animate=function(e,t,n){var i,o,a;if("object"==typeof e){n=t||{},a=[];for(i in e)Mt.call(e,i)&&(a[a.length]=r(this,i,e[i],n));return{stop:function(){for(;a.length;)a.pop().stop()}}}return n=n||{},o=r(this,e,t,n),{stop:function(){o.stop()}}},n={stop:St},r=function(e,r,i,o){var a,s,l,c,h;for(h=e.get(r),c=ut.animations.length;c--;)l=ut.animations[c],l.root===e&&l.keypath===r&&l.stop();return x(h,i)?(o.complete&&o.complete(1,o.to),n):(o.easing&&(a="function"==typeof o.easing?o.easing:e.easing&&e.easing[o.easing]?e.easing[o.easing]:t.easing[o.easing],"function"!=typeof a&&(a=null)),s=void 0===o.duration?400:o.duration,l=new it({keypath:r,from:h,to:i,root:e,duration:s,easing:a,step:o.step,complete:o.complete}),ut.push(l),e._animations[e._animations.length]=l,l)}}(bt),bt.bind=function(e){var t=this._bound;-1===t.indexOf(e)&&(t[t.length]=e,e.init(this))},bt.cancelFullscreen=function(){t.cancelFullscreen(this.el)},bt.find=function(e){return this.el?this.el.querySelector(e):null},bt.findAll=function(e){return this.el?this.el.querySelectorAll(e):[]},bt.fire=function(e){var t,r,n,i=this._subs[e];if(i)for(t=Array.prototype.slice.call(arguments,1),r=0,n=i.length;n>r;r+=1)i[r].apply(this,t)},function(e){var t;e.get=function(e){var r,n,i,o,a,s,l,c,h;if(!e)return this.data;if(r=this._cache,E(e)){if(!e.length)return this.data;i=e.slice(),o=i.join("."),h=!0}else{if(Mt.call(r,e)&&r[e]!==lr)return r[e];i=g(e),o=i.join(".")}return!Mt.call(r,o)||r[o]===lr||void 0===r[o]&&h?this._evaluators[o]?(c=this._evaluators[o].value,r[o]=c,c):(a=i.pop(),s=i.join("."),l=i.length?this.get(i):this.data,null!==l&&void 0!==l&&l!==lr?(this.magic&&"object"==typeof l&&Mt.call(l,a)&&(this._wrapped[o]||(this._wrapped[o]=t(l,a,this,o))),(n=this._cacheMap[s])?-1===n.indexOf(o)&&(n[n.length]=o):this._cacheMap[s]=[o],c=l[a],this.modifyArrays&&("("===o.charAt(0)||!E(c)||c._ractive&&c._ractive.setting||ft(c,o,this)),r[o]=c,c):void 0):r[o]},t=function(e,t,r,n){var i,o,a,s,l,c,h,u;if(o=Object.getOwnPropertyDescriptor(e,t)){if(o.set&&(h=o.set.ractives))return-1===h.indexOf(r)&&(h[h.length]=r),u=o.set[r._guid]||(o.set[r._guid]=[]),void(-1===u.indexOf(n)&&(u[u.length]=n));if(!o.configurable)throw new Error("Cannot configure property")}if(!o||Mt.call(o,"value"))o&&(i=o.value),a=function(){return i},s=function(e){var t,r,n,o,a;for(i=e,t=s.ractives,o=t.length;o--;)if(r=t[o],!r.muggleSet){for(r.magicSet=!0,n=s[r._guid],a=n.length;a--;)r.set(n[a],e);r.magicSet=!1}},s.ractives=[r],s[r._guid]=[n],Object.defineProperty(e,t,{get:a,set:s,enumerable:!0,configurable:!0});else{if(o.set&&!o.get||!o.set&&o.get)throw new Error("Property with getter but no setter, or vice versa. I am confused.");if(o.set._ractive)return;l=o.get,c=o.set,s=function(e){c(e),r.muggleSet||(r.magicSet=!0,r.set(n,l()),r.magicSet=!1)},s[r._guid+n]=!0,Object.defineProperty(e,t,{get:l,set:s,enumerable:!0,configurable:!0})}return{teardown:function(){var r=e[t];Object.defineProperty(e,t,o),e[t]=r}}}}(bt),l=function(e,t){var r,n,i,o;if(e.modifyArrays&&"("!==t.charAt(0)&&(r=e._cache[t],E(r)&&!r._ractive.setting&&dt(r,t,e)),e._cache[t]=lr,n=e._cacheMap[t])for(;n.length;)i=n.pop(),l(e,i),o=e._wrapped[i],o&&o.teardown(),e._wrapped[i]=null},u=function(e,t,r){var n;for(n=0;n<e._deps.length;n+=1)d(e,t,n,r)},d=function(e,t,r,n){var i,o,a,s;if(i=e._deps[r]){if(o=i[t])for(a=o.length;a--;)o[a].update();if(!n&&(s=e._depsMap[t]))for(a=s.length;a--;)d(e,s[a],r)}},f=function(e,t,r){var n,i,o;for(o=t.length,n=0;n<e._deps.length;n+=1)if(e._deps[n])for(i=o;i--;)d(e,t[i],n,r)},m=function(e){for(var t,r;e._defEvals.length;)t=e._defEvals.pop(),t.update().deferred=!1;for(;e._defAttrs.length;)r=e._defAttrs.pop(),r.update().deferred=!1;for(;e._defSelectValues.length;)e._defSelectValues.pop().deferredUpdate()},c=function(e){var t,r,n,i,o,a,s,l;for(a=e.root,s=e.keypath,l=e.priority,t=a._deps[l]||(a._deps[l]={}),r=t[s]||(t[s]=[]),r[r.length]=e,n=g(s);n.length;)n.pop(),i=n.join("."),o=a._depsMap[i]||(a._depsMap[i]=[]),void 0===o[s]&&(o[s]=0,o[o.length]=s),o[s]+=1,s=i},ot=function(e,t){var r,n;r=t.el?w(t.el):e.el,r&&!t.append&&(r.innerHTML=""),e._transitionManager=n=C(e,t.complete),e.fragment=new G({descriptor:e.template,root:e,owner:e,parentNode:r}),m(e),r&&r.appendChild(e.fragment.docFrag),e._transitionManager=null,n.ready()},p=function(e,t,r){var n,i,o,a,s,l;if("."===t)return r.length?r[r.length-1]:"";if("."===t.charAt(0))return r.length?r[r.length-1]+t:t.substring(1);for(n=g(t),i=n.pop(),r=r.concat();r.length;)if(o=r.pop(),a=g(o),s=e.get(a.concat(n)),"object"==typeof s&&null!==s&&Mt.call(s,i)){l=o+"."+t;break}return l||void 0===e.get(t)||(l=t),l},s=function(e){if(e.keypath)h(e);else{var t=e.root._pendingResolution.indexOf(e);-1!==t&&e.root._pendingResolution.splice(t,1)}},h=function(e){var t,r,n,i,o,a,s;for(o=e.root,a=e.keypath,s=e.priority,t=o._deps[s][a],t.splice(t.indexOf(e),1),r=g(a);r.length;)r.pop(),n=r.join("."),i=o._depsMap[n],i[a]-=1,i[a]||(i.splice(i.indexOf(a),1),i[a]=void 0),a=n},bt.link=function(e){var t=this;return function(r){t.set(e,r)}},function(e){var t,r;e.observe=function(e,r,n){var i,o=[];if("object"==typeof e){n=r;for(i in e)Mt.call(e,i)&&(r=e[i],o[o.length]=t(this,i,r,n));return{cancel:function(){for(;o.length;)o.pop().cancel()}}}return t(this,e,r,n)},t=function(e,t,n,i){var o;return o=new r(e,t,n,i),i&&i.init===!1||o.update(!0),c(o),{cancel:function(){h(o)}}},r=function(e,t,r,n){this.root=e,this.keypath=t,this.callback=r,this.priority=0,this.context=n&&n.context?n.context:e},r.prototype={update:function(e){var t;t=this.root.get(this.keypath,!0),(!x(t,this.value)||e)&&(this.callback.call(this.context,t,this.value),this.value=t)}}}(bt),bt.off=function(e,t){var r,n;t||(e?this._subs[e]=[]:this._subs={}),r=this._subs[e],r&&(n=r.indexOf(t),-1!==n&&r.splice(n,1))},bt.on=function(e,t){var r,n,i=this;if("object"==typeof e){r=[];for(n in e)Mt.call(e,n)&&(r[r.length]=this.on(n,e[n]));return{cancel:function(){for(;r.length;)r.pop().cancel()}}}return this._subs[e]?this._subs[e].push(t):this._subs[e]=[t],{cancel:function(){i.off(e,t)}}},bt.renderHTML=function(){return this.fragment.toString()},bt.requestFullscreen=function(){t.requestFullscreen(this.el)},function(e){var t,r;e.set=function(e,n,i){var o,a,s,l,c,h,u;if(a=[""],o=[],y(e)&&(i=n),h=this._transitionManager,this._transitionManager=u=C(this,i),y(e))for(s in e)Mt.call(e,s)&&(c=g(s),l=c.join("."),n=e[s],t(this,l,c,n,o,a));else c=g(e),l=c.join("."),t(this,l,c,n,o,a);return o.length&&this._pendingResolution.length&&r(this),a.length&&f(this,a,!0),o.length&&f(this,o),m(this),this._transitionManager=h,u.ready(),this.setting||(this.setting=!0,"object"==typeof e?this.fire("set",e):this.fire("set",e,n),this.setting=!1),this},t=function(e,t,r,n,i,o){var a,s,c,h,u,f;if(h=r.slice(),u=[],a=e.get(t),a!==n){if(!e.magicSet){for(e.muggleSet=!0,c=e.data;r.length>1;)s=u[u.length]=r.shift(),c[s]||(f||(f=u.join(".")),c[s]=/^\s*[0-9]+\s*$/.test(r[0])?[]:{}),c=c[s];s=r[0],c[s]=n,e.muggleSet=!1}}else if("object"!=typeof n)return;for(l(e,f||t),i[i.length]=t;h.length>1;)h.pop(),t=h.join("."),-1===o.indexOf(t)&&(o[o.length]=t)},r=function(e){var t,r,n;for(t=e._pendingResolution.length;t--;)r=e._pendingResolution.splice(t,1)[0],(n=p(e,r.ref,r.contextStack))?r.resolve(n):e._pendingResolution[e._pendingResolution.length]=r}}(bt),bt.teardown=function(e){var t,r,n;for(this.fire("teardown"),n=this._transitionManager,this._transitionManager=r=C(this,e),this.fragment.teardown(!0);this._animations[0];)this._animations[0].stop();for(t in this._cache)l(this,t);for(;this._bound.length;)this.unbind(this._bound.pop());this._transitionManager=n,r.ready()},bt.toggleFullscreen=function(){t.isFullscreen(this.el)?this.cancelFullscreen():this.requestFullscreen()},bt.unbind=function(e){var t,r=this._bound;t=r.indexOf(e),-1!==t&&(r.splice(t,1),e.teardown(this))},bt.update=function(e,t){var r,n;return"function"==typeof e&&(t=e),n=this._transitionManager,this._transitionManager=r=C(this,t),l(this,e||""),u(this,e||""),m(this),this._transitionManager=n,r.ready(),"string"==typeof e?this.fire("update",e):this.fire("update"),this},Rt.backbone=function(e,t){var r,n,i,o,a,s,l;return t&&(t+=".",a=new RegExp("^"+t.replace(/\./g,"\\.")),s=t.length),{init:function(c){t?(l=function(e){var r,n;n={};for(r in e)Mt.call(e,r)&&(n[t+r]=e[r]);return n},o=function(e){r||(n=!0,c.set(l(e.changed)),n=!1)},i=function(t,i){n||a.test(t)&&(r=!0,e.set(t.substring(s),i),r=!1)}):(o=function(e){r||(n=!0,c.set(e.changed),n=!1)},i=function(t,i){n||(r=!0,e.set(t,i),r=!1)}),e.on("change",o),c.on("set",i),c.set(t?l(e.attributes):e.attributes)},teardown:function(t){e.off("change",o),t.off("set",i)}}},Rt.backboneCollection=function(e,t){var r,n,i,o,a,s,l;return t&&(t+=".",a=new RegExp("^"+t.replace(/\./g,"\\.")),s=t.length),{init:function(s){t?(l=function(e){var r,n;for(r={},n=0;n<e.length;n++)r[t+n]=e[n];return r},o=function(e){"string"==typeof arguments[0]&&(e=arguments[1]),r||(n=!0,s.set(l(e.collection.toJSON())),n=!1)},i=function(t,i){n||a.test(t)&&(r=!0,e.reset(i),r=!1)}):(o=function(e){r||(n=!0,s.set(e.collection.toJSON()),n=!1)},i=function(t,i){n||(r=!0,e.reset(i),r=!1)}),e.on("all",o),s.on("set",i),s.set(t?l(e.toJSON()):e.toJSON())},teardown:function(t){e.off("change",o),t.off("set",i)}}},Rt.statesman=function(e,t){var r,n,i,o,a,s,l;return t&&(t+=".",a=new RegExp("^"+t.replace(/\./g,"\\.")),s=t.length,l=function(e){var r,n;if(e){n={};for(r in e)Mt.call(e,r)&&(n[t+r]=e[r]);return n}}),{init:function(c){var h;t?(o=function(e){r||(n=!0,e=l(e),c.set(e),n=!1)},c.twoway&&(i=function(t,i){n||a.test(t)&&(r=!0,e.set(t.substring(s),i),r=!1)})):(o=function(e){r||(n=!0,c.set(e),n=!1)},c.twoway&&(i=function(t,i){n||(r=!0,e.set(t,i),r=!1)})),e.on("change",o),c.twoway&&c.on("set",i),h=t?l(e.get()):e.get(),h&&c.set(t?l(e.get()):e.get())},teardown:function(t){e.off("change",o),t.off("set",i)}}},r={linear:function(e){return e},easeIn:function(e){return Math.pow(e,3)},easeOut:function(e){return Math.pow(e-1,3)+1},easeInOut:function(e){return(e/=.5)<1?.5*Math.pow(e,3):.5*(Math.pow(e-2,3)+2)}},_t.hover=function(e,t){var r,n;return r=function(r){t({node:e,original:r,hover:!0})},n=function(r){t({node:e,original:r,hover:!1})},e.addEventListener("mouseover",r,!1),e.addEventListener("mouseout",n,!1),{teardown:function(){e.removeEventListener("mouseover",r,!1),e.removeEventListener("mouseout",n,!1)}}},function(){var e=function(e){return function(t,r){var n;return t.addEventListener("keydown",n=function(n){var i=n.which||n.keyCode;i===e&&(n.preventDefault(),r({node:t,original:n}))},!1),{teardown:function(){t.removeEventListener("keydown",n,!1)}}}};_t.enter=e(13),_t.tab=e(9),_t.escape=e(27),_t.space=e(32)}(),_t.tap=function(e,t){var r,n,i,o;return i=5,o=400,r=function(r){var n,a,s,l,c,h,u;(void 0===r.which||1===r.which)&&(a=r.clientX,s=r.clientY,n=this,l=r.pointerId,c=function(e){e.pointerId==l&&(t({node:n,original:e}),u())},h=function(e){e.pointerId==l&&(Math.abs(e.clientX-a)>=i||Math.abs(e.clientY-s)>=i)&&u()},u=function(){e.removeEventListener("MSPointerUp",c,!1),wt.removeEventListener("MSPointerMove",h,!1),wt.removeEventListener("MSPointerCancel",u,!1),e.removeEventListener("pointerup",c,!1),wt.removeEventListener("pointermove",h,!1),wt.removeEventListener("pointercancel",u,!1),e.removeEventListener("click",c,!1),wt.removeEventListener("mousemove",h,!1)},window.navigator.pointerEnabled?(e.addEventListener("pointerup",c,!1),wt.addEventListener("pointermove",h,!1),wt.addEventListener("pointercancel",u,!1)):window.navigator.msPointerEnabled?(e.addEventListener("MSPointerUp",c,!1),wt.addEventListener("MSPointerMove",h,!1),wt.addEventListener("MSPointerCancel",u,!1)):(e.addEventListener("click",c,!1),wt.addEventListener("mousemove",h,!1)),setTimeout(u,o))},window.navigator.pointerEnabled?e.addEventListener("pointerdown",r,!1):window.navigator.msPointerEnabled?e.addEventListener("MSPointerDown",r,!1):e.addEventListener("mousedown",r,!1),n=function(r){var n,a,s,l,c,h,u,f;1===r.touches.length&&(l=r.touches[0],a=l.clientX,s=l.clientY,n=this,c=l.identifier,u=function(e){var r;r=e.changedTouches[0],r.identifier!==c&&f(),e.preventDefault(),t({node:n,original:e}),f()},h=function(e){var t;(1!==e.touches.length||e.touches[0].identifier!==c)&&f(),t=e.touches[0],(Math.abs(t.clientX-a)>=i||Math.abs(t.clientY-s)>=i)&&f()},f=function(){e.removeEventListener("touchend",u,!1),window.removeEventListener("touchmove",h,!1),window.removeEventListener("touchcancel",f,!1)},e.addEventListener("touchend",u,!1),window.addEventListener("touchmove",h,!1),window.addEventListener("touchcancel",f,!1),setTimeout(f,o))},e.addEventListener("touchstart",n,!1),{teardown:function(){e.removeEventListener("pointerdown",r,!1),e.removeEventListener("MSPointerDown",r,!1),e.removeEventListener("mousedown",r,!1),e.removeEventListener("touchstart",n,!1)}}},function(){var e,r,i,o,a,s,l,c,h,u,f,d,p;n=function(e){var r,n=this;return r=function(e){u(this,r,e||{})},r.prototype=P(n.prototype),n!==t&&o(r,n),s(r,e),l(r),c(r,e),h(r),r.extend=n.extend,r},f=["data","partials","transitions","eventDefinitions","components"],d=["el","template","complete","modifyArrays","twoway","lazy","append","preserveWhitespace","sanitize","noIntro","transitionsEnabled"],p=f.concat(d),o=function(e,t){f.forEach(function(n){t[n]&&(e[n]=r(t[n]))}),d.forEach(function(r){void 0!==t[r]&&(e[r]=t[r])})},a=function(e,t){return/_super/.test(e)?function(){var r,n=this._super;return this._super=t,r=e.apply(this,arguments),this._super=n,r}:e},s=function(e,t){var r,n;f.forEach(function(r){var n=t[r];n&&(e[r]?i(e[r],n):e[r]=n)}),d.forEach(function(r){void 0!==t[r]&&(e[r]=t[r])});for(r in t)Mt.call(t,r)&&!Mt.call(e.prototype,r)&&-1===p.indexOf(r)&&(n=t[r],e.prototype[r]="function"==typeof n&&"function"==typeof e.prototype[r]?a(n,e.prototype[r]):n)},l=function(e){var r;if("string"==typeof e.template){if(!t.parse)throw new Error(Pt);if("#"===e.template.charAt(0)&&wt){if(r=wt.getElementById(e.template.substring(1)),!r||"SCRIPT"!==r.tagName)throw new Error("Could not find template element ("+e.template+")");e.template=t.parse(r.innerHTML,e)}else e.template=t.parse(e.template,e)}},c=function(e,t){y(e.template)&&(e.partials||(e.partials={}),i(e.partials,e.template.partials),t.partials&&i(e.partials,t.partials),e.template=e.template.main)},h=function(e){var r,n;if(e.partials)for(r in e.partials)if(Mt.call(e.partials,r)){if("string"==typeof e.partials[r]){if(!t.parse)throw new Error(Pt);n=t.parse(e.partials[r],e)}else n=e.partials[r];e.partials[r]=n}},u=function(n,i,o){!o.template&&i.template&&(o.template=i.template),f.forEach(function(t){o[t]?e(o[t],i[t]):i[t]&&(o[t]=r(i[t]))}),d.forEach(function(e){void 0===o[e]&&void 0!==i[e]&&(o[e]=i[e])}),n.beforeInit&&n.beforeInit.call(n,o),t.call(n,o),n.init&&n.init.call(n,o)},e=function(e,t){var r;for(r in t)Mt.call(t,r)&&!Mt.call(e,r)&&(e[r]=t[r])},r=function(e){var t,r={};for(t in e)Mt.call(e,t)&&(r[t]=e[t]);return r},i=function(e,t){var r;for(r in t)Mt.call(t,r)&&(e[r]=t[r])}}(),o=function(e,r){return T(e)&&T(r)?t.interpolators.number(+e,+r):E(e)&&E(r)?t.interpolators.array(e,r):y(e)&&y(r)?t.interpolators.object(e,r):function(){return r}},a={number:function(e,t){var r=t-e;return r?function(t){return e+t*r}:function(){return e}},array:function(e,r){var n,i,o,a;for(n=[],i=[],a=o=Math.min(e.length,r.length);a--;)i[a]=t.interpolate(e[a],r[a]);for(a=o;a<e.length;a+=1)n[a]=e[a];for(a=o;a<r.length;a+=1)n[a]=r[a];return function(e){for(var t=o;t--;)n[t]=i[t](e);return n}},object:function(e,r){var n,i,o,a,s=[];o={},i={};for(a in e)Mt.call(e,a)&&(Mt.call(r,a)?(s[s.length]=a,i[a]=t.interpolate(e[a],r[a])):o[a]=e[a]);for(a in r)Mt.call(r,a)&&!Mt.call(e,a)&&(o[a]=r[a]);return n=s.length,function(e){for(var t,r=n;r--;)t=s[r],o[t]=i[t](e);return o}}};var br=F();L(br,{preserveWhitespace:{enumerable:!0,value:!1},append:{enumerable:!0,value:!1},twoway:{enumerable:!0,value:!0},modifyArrays:{enumerable:!0,value:!0},data:{enumerable:!0,value:{}},lazy:{enumerable:!0,value:!1},debug:{enumerable:!0,value:!1},transitions:{enumerable:!0,value:{}},eventDefinitions:{enumerable:!0,value:{}},noIntro:{enumerable:!0,value:!1},transitionsEnabled:{enumerable:!0,value:!0},magic:{enumerable:!0,value:!1}}),t=function(e){var r,n,i,o,a,s;for(r in br)Mt.call(e,r)||(e[r]="object"==typeof br[r]?{}:br[r]);if(L(this,{_guid:{value:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t,r;return t=16*Math.random()|0,r="x"==e?t:3&t|8,r.toString(16)})},_subs:{value:F()},_cache:{value:{}},_cacheMap:{value:F()},_deps:{value:[]},_depsMap:{value:F()},_pendingResolution:{value:[]},_defAttrs:{value:[]},_defEvals:{value:[]},_defSelectValues:{value:[]},_evaluators:{value:F()},_bound:{value:[]},_transitionManager:{value:null,writable:!0},_animations:{value:[]},nodes:{value:{}},_wrapped:{value:F()}}),this.modifyArrays=e.modifyArrays,this.magic=e.magic,this.twoway=e.twoway,this.lazy=e.lazy,this.debug=e.debug,this.magic&&Tt)throw new Error("Getters and setters (magic mode) are not supported in this browser");if(e.el&&(this.el=w(e.el),!this.el&&this.debug))throw new Error("Could not find container element");this.data={};for(r in e.data)Mt.call(e.data,r)&&(this.data[r]=e.data[r]);if(this.partials={},this.components=e.components||{},this.transitions=e.transitions,this.eventDefinitions=e.eventDefinitions,e.bindings)if(E(e.bindings))for(i=0;i<e.bindings.length;i+=1)this.bind(e.bindings[i]);else this.bind(e.bindings);if(o=e.template,"string"==typeof o){if(!t.parse)throw new Error(Pt);if("#"===o.charAt(0)&&wt){if(a=wt.getElementById(o.substring(1)),!a)throw new Error("Could not find template element ("+o+")");s=t.parse(a.innerHTML,e)}else s=t.parse(o,e)}else s=o;if(y(s)&&(this.partials=s.partials,s=s.main),s&&1===s.length&&"string"==typeof s[0]&&(s=s[0]),this.template=s,e.partials)for(r in e.partials)if(Mt.call(e.partials,r)){if(n=e.partials[r],"string"==typeof n){if(!t.parse)throw new Error(Pt);n=t.parse(n,e)}this.partials[r]=n}this.transitionsEnabled=e.noIntro?!1:e.transitionsEnabled,ot(this,{el:this.el,append:e.append,complete:e.complete}),this.transitionsEnabled=e.transitionsEnabled},function(){var e,t,n,i;wt&&(e=function(e,t){var r,n={};for(r=t.length;r--;)n[t[r]]=e[t[r]];return n},t=function(e,t,r,n){for(var i,o=t.length;o--;)i=t[o],e.style[i]=r&&r[i]?"function"==typeof r[i]?r[i](n):r[i]:0},n=function(e,t){var r;if(!t)return e;for(r in t)Mt.call(t,r)&&(e[r]=t[r]);return e},fr&&(i=function(i,o,a,s){return"string"==typeof i&&(i=[i]),function(l,c,h,u){var f,d,p,m,g,v,E,y,T,x,w;h=Rr(h),v=h.duration||o.duration,r=mr(h.easing||o.easing),E=h.delay||0,y=u?a:s,T=u?s:a,d=window.getComputedStyle(l),g=l.getAttribute("style"),u?(x=l.style.position,w=l.style.visibility,l.style.position="absolute",l.style.visibility="hidden",setTimeout(function(){p=e(d,i),y=a,T=n(p,s),l.style.position=x,l.style.visibility=w,t(l,i,y,h),setTimeout(m,0)},E)):setTimeout(function(){p=e(d,i),y=n(p,s),T=a,t(l,i,y,h),setTimeout(m,0)},E),m=function(){l.style[dr+"Duration"]=v/1e3+"s",l.style[dr+"Properties"]=i.map(mr).join(","),l.style[dr+"TimingFunction"]=r,f=function(){l.removeEventListener(pr,f,!1),u&&l.setAttribute("style",g||""),c()},l.addEventListener(pr,f,!1),t(l,i,T,h)}}},Ht.slide=i(["height","borderTopWidth","borderBottomWidth","paddingTop","paddingBottom","overflowY"],{duration:400,easing:"easeInOut"},{overflowY:"hidden"},{overflowY:"hidden"}),Ht.fade=i("opacity",{duration:300,easing:"linear"}),Ht.fly=i(["opacity","left","position"],{duration:400,easing:"easeOut"},{position:"relative",left:"-500px"},{position:"relative",left:0})))}();var Rr=function(e){return"fast"===e?{duration:200}:"slow"===e?{duration:600}:T(e)?{duration:+e}:e||{}};!function(e){var t,r,n;wt&&(r=function(e,t,i){var o,a;return 1===e.nodeType&&(e.style.display=e._display),3===e.nodeType?void n(e,t,i):(o=Array.prototype.slice.call(e.childNodes),a=function(){return o.length?void r(o.shift(),a,i):(1===e.nodeType&&e.setAttribute("style",e._style||""),void t())},void a())},n=function(e,t,r){var n,i,o,a;return n=e._hiddenData,(i=n.length)?(a=0,void(o=setInterval(function(){var r,s,l,c,h;r=n.substr(0,a),s=n.substring(a),l=/^\w+/.exec(s),c=l?l[0].length:0,h=new Array(c+1).join(""),e.data=r+h,a===i&&(clearInterval(o),delete e._hiddenData,t()),a+=1
},r))):void t()},t=function(e,t,n){var i,o,a,s;n=Rr(n),i=n.interval||(n.speed?1e3/n.speed:n.duration?e.textContent.length/n.duration:4),o=e.getAttribute("style"),a=window.getComputedStyle(e),e.style.visibility="hidden",setTimeout(function(){var l,c,h;c=a.width,l=a.height,h=a.visibility,s(e),setTimeout(function(){e.style.width=c,e.style.height=l,e.style.visibility="visible",r(e,function(){e.setAttribute("style",o||""),t()},i)},n.delay||0)}),s=function(e){var t,r;if(1===e.nodeType&&(e._style=e.getAttribute("style"),e._display=window.getComputedStyle(e).display,e.style.display="none"),3===e.nodeType)return e._hiddenData=""+e.data,void(e.data="");for(t=Array.prototype.slice.call(e.childNodes),r=t.length;r--;)s(t[r])}},e.typewriter=t)}(Ht),function(e){var t,r,n;if(wt){if(e.fullscreenEnabled=wt.fullscreenEnabled||wt.mozFullScreenEnabled||wt.webkitFullscreenEnabled,!e.fullscreenEnabled)return void(e.requestFullscreen=e.cancelFullscreen=St);cr.requestFullscreen?t="requestFullscreen":cr.mozRequestFullScreen?t="mozRequestFullScreen":cr.webkitRequestFullscreen&&(t="webkitRequestFullscreen"),e.requestFullscreen=function(e){e[t]&&e[t]()},wt.cancelFullscreen?r="cancelFullscreen":wt.mozCancelFullScreen?r="mozCancelFullScreen":wt.webkitCancelFullScreen&&(r="webkitCancelFullScreen"),e.cancelFullscreen=function(){wt[r]()},void 0!==wt.fullscreenElement?n="fullscreenElement":void 0!==wt.mozFullScreenElement?n="mozFullScreenElement":void 0!==wt.webkitFullscreenElement&&(n="webkitFullscreenElement"),e.isFullscreen=function(e){return e===wt[n]}}}(t),it=function(e){var r;this.startTime=Date.now();for(r in e)Mt.call(e,r)&&(this[r]=e[r]);this.interpolator=t.interpolate(this.from,this.to),this.running=!0},it.prototype={tick:function(){var e,t,r,n,i;return this.running?(n=Date.now(),e=n-this.startTime,e>=this.duration?(this.root.set(this.keypath,this.to),this.step&&this.step(1,this.to),this.complete&&this.complete(1,this.to),i=this.root._animations.indexOf(this),-1===i&&Ct&&Ct.warn&&Ct.warn("Animation was not found"),this.root._animations.splice(i,1),this.running=!1,!1):(t=this.easing?this.easing(e/this.duration):e/this.duration,r=this.interpolator(t),this.root.set(this.keypath,r),this.step&&this.step(t,r),!0)):!1},stop:function(){var e;this.running=!1,e=this.root._animations.indexOf(this),-1===e&&Ct&&Ct.warn&&Ct.warn("Animation was not found"),this.root._animations.splice(e,1)}},ut={animations:[],tick:function(){var e,t;for(e=0;e<this.animations.length;e+=1)t=this.animations[e],t.tick()||this.animations.splice(e--,1);this.animations.length?A(this.boundTick):this.running=!1},boundTick:function(){ut.tick()},push:function(e){this.animations[this.animations.length]=e,this.running||(this.running=!0,this.tick())}},function(e,t,r){var n,i;if(r.requestAnimationFrame)return void(A=r.requestAnimationFrame);for(n=0;n<e.length&&!A;++n)A=r[e[n]+"RequestAnimationFrame"];A||(i=r.setTimeout,A=function(e){var r,n,o;return r=Date.now(),n=Math.max(0,16-(r-t)),o=i(function(){e(r+n)},n),t=r+n,o})}(["ms","moz","webkit","o"],0,e),function(){var e,t,r,n,i,o;ft=function(e,r,n){var i,o,a;e._ractive?(i=e._ractive.roots,o=e._ractive.keypathsByGuid,o[n._guid]||(i[i.length]=n,o[n._guid]=[]),a=o[n._guid],-1===a.indexOf(r)&&(a[a.length]=r)):(k(e,"_ractive",{value:{roots:[n],keypathsByGuid:{}},configurable:!0}),e._ractive.keypathsByGuid[n._guid]=[r],t(e))},dt=function(e,t,n){var i,o,a,s;if(!e._ractive)throw new Error("Attempted to remove keypath from non-wrapped array. This error is unexpected - please send a bug report to @rich_harris");if(i=e._ractive.roots,o=e._ractive.keypathsByGuid,!o[n._guid])throw new Error("Ractive instance was not listed as a dependent of this array. This error is unexpected - please send a bug report to @rich_harris");if(a=o[n._guid],s=a.indexOf(t),-1===s)throw new Error("Attempted to unlink non-linked keypath from array. This error is unexpected - please send a bug report to @rich_harris");a.splice(s,1),a.length||(i.splice(i.indexOf(n),1),o[n._guid]=null),i.length||r(e)},e=function(e,t,r){var n,i,o,a,s,c;c=e._ractive.keypathsByGuid,n=function(e){for(var t=e.length;t--;)i(e[t])},i=function(e){var t,r=e._transitionManager;e._transitionManager=t=C(e,St),o(e,c[e._guid]),e._transitionManager=r,t.ready()},o=function(e,t){for(var r=t.length;r--;)a(e,t[r])},a=function(n,i){var o,a,c,h,d,p,v;if("sort"===t||"reverse"===t)return void n.set(i,e);for(l(n,i),d=[],p=[],v=0;v<n._deps.length;v+=1)if(o=n._deps[v],o&&(a=o[i])){for(s(n,i,a,d,p),m(n);d.length;)d.pop().smartUpdate(t,r);for(;p.length;)p.pop().update()}for(m(n),h=[],c=g(i);c.length;)c.pop(),h[h.length]=c.join(".");f(n,h,!0),u(n,i+".length",!0)},s=function(e,t,r,n,i){var o,a;for(o=r.length;o--;)a=r[o],a.type===er?a.update():a.keypath===t&&a.type===Ut?n[n.length]=a:i[i.length]=a},n(e._ractive.roots)},n=[],o=["pop","push","reverse","shift","sort","splice","unshift"],o.forEach(function(t){var r=function(){var r=Array.prototype[t].apply(this,arguments);return this._ractive.setting=!0,e(this,t,arguments),this._ractive.setting=!1,r};k(n,t,{value:r})}),i={},i.__proto__?(t=function(e){e.__proto__=n},r=function(e){delete e._ractive,e.__proto__=Array.prototype}):(t=function(e){var t,r;for(t=o.length;t--;)r=o[t],k(e,r,{value:n[r],configurable:!0})},r=function(e){var t;for(t=o.length;t--;)delete e[o[t]];delete e._ractive})}(),function(){var e,t,r,n;e={"accept-charset":"acceptCharset",accesskey:"accessKey",bgcolor:"bgColor","class":"className",codebase:"codeBase",colspan:"colSpan",contenteditable:"contentEditable",datetime:"dateTime",dirname:"dirName","for":"htmlFor","http-equiv":"httpEquiv",ismap:"isMap",maxlength:"maxLength",novalidate:"noValidate",pubdate:"pubDate",readonly:"readOnly",rowspan:"rowSpan",tabindex:"tabIndex",usemap:"useMap"},W=function(e){return this.element=e.element,t(this,e.name),null===e.value||"string"==typeof e.value?void r(this,e):(this.root=e.root,this.parentNode=e.parentNode,this.parentFragment=this.element.parentFragment,this.fragment=new $({descriptor:e.value,root:this.root,owner:this,contextStack:e.contextStack}),void(this.parentNode&&("value"===this.name&&(e.element.ractify(),this.isValueAttribute=!0,"INPUT"===this.parentNode.tagName&&"file"===this.parentNode.type&&(this.isFileInputValue=!0)),n(this,e),this.selfUpdating=S(this.fragment),this.ready=!0)))},W.prototype={bind:B,update:V,updateBindings:function(){this.keypath=this.interpolator.keypath||this.interpolator.r,"name"===this.propertyName&&(this.parentNode.name="{{"+this.keypath+"}}")},teardown:function(){var e;if(this.boundEvents)for(e=this.boundEvents.length;e--;)this.parentNode.removeEventListener(this.boundEvents[e],this.updateModel,!1);this.fragment&&this.fragment.teardown()},bubble:function(){this.selfUpdating?this.update():!this.deferred&&this.ready&&(this.root._defAttrs[this.root._defAttrs.length]=this,this.deferred=!0)},toString:function(){var e;return null===this.value?this.name:this.fragment?(e=this.fragment.toString(),this.name+"="+JSON.stringify(e)):this.name+"="+JSON.stringify(this.value)}},t=function(e,t){var r,n;if(r=t.indexOf(":"),-1===r||(n=t.substr(0,r),"xmlns"===n))e.name=t;else if(t=t.substring(r+1),e.name=t,e.namespace=hr[n],!e.namespace)throw'Unknown namespace ("'+n+'")'},r=function(e,t){t.parentNode&&(e.namespace?t.parentNode.setAttributeNS(e.namespace,t.name,t.value):t.parentNode.setAttribute(t.name,t.value),"id"===e.name&&(t.root.nodes[t.value]=t.parentNode),"value"===e.name&&(e.element.ractify().value=t.value)),e.value=t.value},n=function(t,r){var n;!t.parentNode||t.namespace||r.parentNode.namespaceURI&&r.parentNode.namespaceURI!==hr.html||(n=e[t.name]||t.name,void 0!==r.parentNode[n]&&(t.propertyName=n),("boolean"==typeof r.parentNode[n]||"value"===n)&&(t.useProperty=!0))}}(),function(){var e;q=function(t){var r,n,i,o,a,s,l,c,h,u,f,d,m,g,v,E,y,T,x,w=this,b=this.parentFragment=t.parentFragment;if(r=b.root,this.type=Xt,this.name=t.descriptor.r,n=M(b.root,t.descriptor.e),i=n.twoway!==!1,l={},c=[],this.complexParameters=[],y=function(t,n){var i;if("string"!=typeof n){if(null===n)return void(l[t]=!0);if(1===n.length&&n[0].t===Nt&&n[0].r)return b.indexRefs&&void 0!==b.indexRefs[n[0].r]?void(l[t]=b.indexRefs[n[0].r]):(s=p(r,n[0].r,b.contextStack)||n[0].r,l[t]=r.get(s),void(c[c.length]=[t,s]));i=new e(r,w,t,n,b.contextStack),w.complexParameters[w.complexParameters.length]=i,l[t]=i.value}else try{l[t]=JSON.parse(n)}catch(o){l[t]=n}},t.descriptor.a)for(v in t.descriptor.a)t.descriptor.a.hasOwnProperty(v)&&y(v,t.descriptor.a[v]);for(o={},t.descriptor.f&&(o.content=t.descriptor.f),a=this.instance=new n({append:!0,el:b.parentNode,data:l,partials:o}),w.observers=[],E={init:!1},f=function(e){var t=r.observe(e[1],function(t){m||(g=!0,a.set(e[0],t),g=!1)},E);w.observers[w.observers.length]=t},i&&(d=function(e){var t=a.observe(e[0],function(t){g||(m=!0,r.set(e[1],t),m=!1)},E);w.observers[w.observers.length]=t}),h=c.length;h--;)u=c[h],f(u),i&&d(u);if(x=function(e,t){a.on(e,function(){var e=Array.prototype.slice.call(arguments);e.unshift(t),r.fire.apply(r,e)})},t.descriptor.v)for(T in t.descriptor.v)t.descriptor.v.hasOwnProperty(T)&&x(T,t.descriptor.v[T])},q.prototype={firstNode:function(){return this.instance.fragment.firstNode()},findNextNode:function(){return this.parentFragment.findNextNode(this)},teardown:function(){for(;this.complexParameters.length;)this.complexParameters.pop().teardown();for(;this.observers.length;)this.observers.pop().cancel();this.instance.teardown()},toString:function(){return this.instance.fragment.toString()}},e=function(e,t,r,n,i){this.parentFragment=t.parentFragment,this.component=t,this.key=r,this.fragment=new $({descriptor:n,root:e,owner:this,contextStack:i}),this.selfUpdating=S(this.fragment),this.value=this.fragment.getValue()},e.prototype={bubble:function(){this.selfUpdating?this.update():!this.deferred&&this.ready&&(this.root._defAttrs[this.root._defAttrs.length]=this,this.deferred=!0)},update:function(){var e=this.fragment.getValue();this.component.set(this.key,e),this.value=e}}}(),j=function(e,t){var r,n,i,o,a;this.type=It,r=this.parentFragment=e.parentFragment,n=this.descriptor=e.descriptor,this.root=a=r.root,this.parentNode=r.parentNode,this.index=e.index,this.eventListeners=[],this.customEventListeners=[],this.parentNode&&(i=I(n,this.parentNode),this.node=wt.createElementNS(i,n.e)),n.f&&U(this,this.node,n,t),t&&n.v&&N(this,n.v),o=z(this,n.a),t&&(a.twoway&&O(this,o),o.name&&o.name.update(),t.appendChild(this.node),n.t1&&_(n.t1,a,this,r.contextStack,!0))},j.prototype={teardown:function(e){var t;for(this.fragment&&this.fragment.teardown(!1);this.attributes.length;)this.attributes.pop().teardown();if(this.node._ractive)for(t in this.node._ractive.events)this.node._ractive.events[t].teardown();this.descriptor.t2&&_(this.descriptor.t2,this.root,this,this.parentFragment.contextStack,!1),e&&this.root._transitionManager.detachWhenReady(this.node)},firstNode:function(){return this.node},findNextNode:function(){return null},bubble:St,toString:function(){var e,t,r;for(e="<"+this.descriptor.e,r=this.attributes.length,t=0;r>t;t+=1)e+=" "+this.attributes[t].toString();return e+=">",this.html?e+=this.html:this.fragment&&(e+=this.fragment.toString()),e+="</"+this.descriptor.e+">"},ractify:function(){var e=this.parentFragment.contextStack;return this.node._ractive||k(this.node,"_ractive",{value:{keypath:e.length?e[e.length-1]:"",index:this.parentFragment.indexRefs,events:F(),root:this.root}}),this.node._ractive}},G=function(e){return e.parentNode&&(this.docFrag=wt.createDocumentFragment()),"string"==typeof e.descriptor?(this.html=e.descriptor,void(this.docFrag&&(this.nodes=b(e.descriptor,this.docFrag)))):void ct(this,e)},G.prototype={createItem:function(e){if("string"==typeof e.descriptor)return new Z(e,this.docFrag);switch(e.descriptor.t){case Nt:return new Y(e,this.docFrag);case Ut:return new Q(e,this.docFrag);case Dt:return new K(e,this.docFrag);case It:return new j(e,this.docFrag);case Vt:return new X(e,this.docFrag);case Xt:return new q(e,this.docFrag);default:throw new Error("WTF? not sure what happened here...")}},teardown:function(e){var t;if(e&&this.nodes)for(;this.nodes.length;)t=this.nodes.pop(),t.parentNode.removeChild(t);else if(this.items)for(;this.items.length;)this.items.pop().teardown(e)},firstNode:function(){return this.items&&this.items[0]?this.items[0].firstNode():this.nodes?this.nodes[0]||null:null},findNextNode:function(e){var t=e.index;return this.items[t+1]?this.items[t+1].firstNode():this.owner===this.root?null:this.owner.findNextNode(this)},toString:function(){var e,t,r,n;if(this.html)return this.html;if(e="",!this.items)return e;for(r=this.items.length,t=0;r>t;t+=1)n=this.items[t],e+=n.toString();return e}},Y=function(e,t){this.type=Nt,t&&(this.node=wt.createTextNode(""),t.appendChild(this.node)),at(this,e)},Y.prototype={update:st,resolve:lt,teardown:function(e){s(this),e&&this.node.parentNode.removeChild(this.node)},render:function(e){this.node&&(this.node.data=void 0===e?"":e)},firstNode:function(){return this.node},toString:function(){var e=void 0!==this.value?""+this.value:"";return e.replace("<","&lt;").replace(">","&gt;")}},X=function(e,t){var r,n=this.parentFragment=e.parentFragment;this.type=Vt,this.name=e.descriptor.r,r=H(n.root,e.descriptor.r),this.fragment=new G({descriptor:r,root:n.root,parentNode:n.parentNode,contextStack:n.contextStack,owner:this}),t&&t.appendChild(this.fragment.docFrag)},X.prototype={firstNode:function(){return this.fragment.firstNode()},findNextNode:function(){return this.parentFragment.findNextNode(this)},teardown:function(e){this.fragment.teardown(e)},toString:function(){return this.fragment.toString()}},Q=function(e,t){this.type=Ut,this.fragments=[],this.length=0,t&&(this.docFrag=wt.createDocumentFragment()),this.initialising=!0,at(this,e),t&&t.appendChild(this.docFrag),this.initialising=!1},Q.prototype={update:st,resolve:lt,smartUpdate:function(e,t){var r;("push"===e||"unshift"===e||"splice"===e)&&(r={descriptor:this.descriptor.f,root:this.root,parentNode:this.parentNode,owner:this},this.descriptor.i&&(r.indexRef=this.descriptor.i)),this[e]&&this[e](r,t)},pop:function(){this.length&&(this.fragments.pop().teardown(!0),this.length-=1)},push:function(e,t){var r,n,i;for(r=this.length,n=r+t.length,i=r;n>i;i+=1)e.contextStack=this.contextStack.concat(this.keypath+"."+i),e.index=i,this.fragments[i]=this.createFragment(e);this.length+=t.length,this.parentNode.insertBefore(this.docFrag,this.parentFragment.findNextNode(this))},shift:function(){this.splice(null,[0,1])},unshift:function(e,t){this.splice(e,[0,0].concat(new Array(t.length)))},splice:function(e,t){var r,n,i,o,a,s,l,c,h;if(t.length&&(s=+(t[0]<0?this.length+t[0]:t[0]),n=Math.max(0,t.length-2),i=void 0!==t[1]?t[1]:this.length-s,o=n-i)){if(0>o){for(l=s-o,a=s;l>a;a+=1)this.fragments[a].teardown(!0);this.fragments.splice(s,-o)}else{for(l=s+o,r=this.fragments[s]?this.fragments[s].firstNode():this.parentFragment.findNextNode(this),c=[s,0].concat(new Array(o)),this.fragments.splice.apply(this.fragments,c),a=s;l>a;a+=1)e.contextStack=this.contextStack.concat(this.keypath+"."+a),e.index=a,this.fragments[a]=this.createFragment(e);this.parentNode.insertBefore(this.docFrag,r)}this.length+=o,h=s+n,R(this.root,this,h,this.length,o)}},teardown:function(e){this.teardownFragments(e),s(this)},firstNode:function(){return this.fragments[0]?this.fragments[0].firstNode():this.parentFragment.findNextNode(this)},findNextNode:function(e){return this.fragments[e.index+1]?this.fragments[e.index+1].firstNode():this.parentFragment.findNextNode(this)},teardownFragments:function(e){for(var t;this.fragments.length;)this.fragments.shift().teardown(e);if(this.fragmentsById)for(t in this.fragmentsById)this.fragmentsById[t].teardown(),this.fragmentsById[t]=null},render:function(e){var t;this.rendering||(this.rendering=!0,ht(this,e),this.rendering=!1,(!this.docFrag||this.docFrag.childNodes.length)&&(this.initialising||(t=this.parentFragment.findNextNode(this),t&&t.parentNode===this.parentNode?this.parentNode.insertBefore(this.docFrag,t):this.parentNode.appendChild(this.docFrag))))},createFragment:function(e){var t=new G(e);return this.docFrag&&this.docFrag.appendChild(t.docFrag),t},toString:function(){var e,t,r;for(e="",t=0,r=this.length,t=0;r>t;t+=1)e+=this.fragments[t].toString();return e}},Z=function(e,t){this.type=Ft,this.descriptor=e.descriptor,t&&(this.node=wt.createTextNode(e.descriptor),this.parentNode=e.parentFragment.parentNode,t.appendChild(this.node))},Z.prototype={teardown:function(e){e&&this.node.parentNode.removeChild(this.node)},firstNode:function(){return this.node},toString:function(){return(""+this.descriptor).replace("<","&lt;").replace(">","&gt;")}},K=function(e,t){this.type=Dt,t&&(this.nodes=[],this.docFrag=wt.createDocumentFragment()),this.initialising=!0,at(this,e),t&&t.appendChild(this.docFrag),this.initialising=!1},K.prototype={update:st,resolve:lt,teardown:function(e){var t;if(e)for(;this.nodes.length;)t=this.nodes.pop(),t.parentNode.removeChild(t);s(this)},firstNode:function(){return this.nodes[0]?this.nodes[0]:this.parentFragment.findNextNode(this)},render:function(e){var t;if(this.nodes){for(;this.nodes.length;)t=this.nodes.pop(),t.parentNode.removeChild(t);if(void 0===e)return void(this.nodes=[]);this.nodes=b(e,this.docFrag),this.initialising||this.parentNode.insertBefore(this.docFrag,this.parentFragment.findNextNode(this))}},toString:function(){return void 0!==this.value?this.value:""}},$=function(e){ct(this,e)},$.prototype={createItem:function(e){if("string"==typeof e.descriptor)return new tt(e.descriptor);switch(e.descriptor.t){case Nt:return new J(e);case Dt:return new J(e);case Ut:return new et(e);default:throw"Something went wrong in a rather interesting way"}},bubble:function(){this.owner.bubble()},teardown:function(){var e,t;for(e=this.items.length,t=0;e>t;t+=1)this.items[t].teardown()},getValue:function(){var e;return 1===this.items.length&&this.items[0].type===Nt&&(e=this.items[0].value,void 0!==e)?e:this.toString()},toString:function(){return this.items.join("")},toJSON:function(){var e,t;e=this.toString();try{t=JSON.parse(e)}catch(r){t=e}return t}},J=function(e){this.type=Nt,at(this,e)},J.prototype={update:st,resolve:lt,render:function(e){this.value=e,this.parentFragment.bubble()},teardown:function(){s(this)},toString:function(){return void 0===this.value?"":this.value}},et=function(e){this.type=Ut,this.fragments=[],this.length=0,at(this,e)},et.prototype={update:st,resolve:lt,teardown:function(){this.teardownFragments(),s(this)},teardownFragments:function(){for(;this.fragments.length;)this.fragments.shift().teardown();this.length=0},bubble:function(){this.value=this.fragments.join(""),this.parentFragment.bubble()},render:function(e){ht(this,e),this.parentFragment.bubble()},createFragment:function(e){return new $(e)},toString:function(){return this.fragments.join("")}},tt=function(e){this.type=Ft,this.text=e},tt.prototype={toString:function(){return this.text},teardown:function(){}},w=function(e){var t;return"undefined"!=typeof window&&wt&&e?e.nodeType?e:"string"==typeof e&&(t=wt.getElementById(e),!t&&wt.querySelector&&(t=wt.querySelector(e)),t.nodeType)?t:e[0]&&e[0].nodeType?e[0]:null:null},v=Object.prototype.toString,E=function(e){return"[object Array]"===v.call(e)},x=function(e,t){return null===e&&null===t?!0:"object"==typeof e||"object"==typeof t?!1:e===t},T=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},y=function(e){return"object"==typeof e&&"[object Object]"===v.call(e)},C=function(e,t){var r,n,i,o;return n=[],i=function(){var e,t;for(e=n.length;e--;)t=n[e],o(t)&&(t.parentNode.removeChild(t),n.splice(e,1))},o=function(e){var t,n;for(t=r.active.length;t--;)if(n=r.active[t],e.contains(n))return!1;return!0},r={active:[],push:function(e){r.active[r.active.length]=e},pop:function(e){r.active.splice(r.active.indexOf(e),1),i(),!r.active.length&&r._ready&&r.complete()},complete:function(){t&&t.call(e)},ready:function(){i(),r._ready=!0,r.active.length||r.complete()},detachWhenReady:function(e){n[n.length]=e}}},g=function(e){var t,r,n,i,o;if(At[e])return At[e].concat();for(n=[],i=e,r=0;i.length;){if(t=i.indexOf(".",r),-1===t)o=i,i="";else{if("\\"===i.charAt(t-1)&&"\\"!==i.charAt(t-2)){r=t+1;continue}o=i.substr(0,t),r=0}/\[/.test(o)?n=n.concat(o.replace(/\[\s*([0-9]+)\s*\]/g,".$1").split(".")):n[n.length]=o,i=i.substring(t+1)}return At[e]=n,n.concat()};var _r;!function(){var e,t,r,n,i,o,a,s,l,c,h,u,f,d,p;_r=function(t,r,n){var o,a,s,c,p;if(this.lcTag=t.name.toLowerCase(),this.tag=i[this.lcTag]?i[this.lcTag]:this.lcTag,r.pos+=1,n=n||"pre"===this.lcTag,t.attrs&&(s=u(t.attrs),a=s.attrs,c=s.proxies,r.options.sanitize&&r.options.sanitize.eventAttributes&&(a=a.filter(h)),a.length&&(this.attributes=a.map(f)),c.length&&(this.proxies=c.map(d)),s.intro&&(this.intro=d(s.intro)),s.outro&&(this.outro=d(s.outro))),t.selfClosing&&(this.selfClosing=!0),-1!==e.indexOf(this.lcTag)&&(this.isVoid=!0),!this.selfClosing&&!this.isVoid){for(this.siblings=l[this.lcTag],this.items=[],o=r.next();o&&o.mustacheType!==zt;){if(o.type===Wt){if(o.closing){o.name.toLowerCase()===this.lcTag&&(r.pos+=1);break}if(this.siblings&&-1!==this.siblings.indexOf(o.name.toLowerCase()))break}this.items[this.items.length]=gr(r),o=r.next()}n||(p=this.items[0],p&&p.type===Ft&&(p.text=p.text.replace(kt,""),p.text||this.items.shift()),p=this.items[this.items.length-1],p&&p.type===Ft&&(p.text=p.text.replace(Lt,""),p.text||this.items.pop()))}},_r.prototype={toJSON:function(e){var t,r,n,i,o,a;if(this["json_"+e])return this["json_"+e];if(t="rv-"===this.tag.substr(0,3)?{t:Xt,e:this.tag.substr(3)}:{t:It,e:this.tag},this.attributes&&this.attributes.length)for(t.a={},a=this.attributes.length,o=0;a>o;o+=1){if(r=this.attributes[o].name,t.a[r])throw new Error("You cannot have multiple elements with the same name");n=null===this.attributes[o].value?null:vr(this.attributes[o].value.items,e),t.a[r]=n}if(this.items&&this.items.length&&(t.f=vr(this.items,e)),this.proxies&&this.proxies.length)for(t.v={},a=this.proxies.length,o=0;a>o;o+=1)i=this.proxies[o],t.v[i.domEventName]=p(i);return this.intro&&(t.t1=this.intro.args?{n:this.intro.name,a:this.intro.args}:this.intro.dynamicArgs?{n:this.intro.name,d:vr(this.intro.dynamicArgs.items,e)}:this.intro.name),this.outro&&(t.t2=this.outro.args?{n:this.outro.name,a:this.outro.args}:this.outro.dynamicArgs?{n:this.outro.name,d:vr(this.outro.dynamicArgs.items,e)}:this.outro.name),this["json_"+e]=t,t},toString:function(){var r,n,i,o,a,s,l,c;if(void 0!==this.str)return this.str;if(-1===t.indexOf(this.tag.toLowerCase()))return this.str=!1;if(this.proxies||this.intro||this.outro)return this.str=!1;if(l=Er(this.items),l===!1)return this.str=!1;if(c=-1!==e.indexOf(this.tag.toLowerCase()),r="<"+this.tag,this.attributes)for(n=0,i=this.attributes.length;i>n;n+=1){if(a=this.attributes[n].name,-1!==a.indexOf(":"))return this.str=!1;if("id"===a||"intro"===a||"outro"===a)return this.str=!1;if(o=" "+a,null!==this.attributes[n].value){if(s=this.attributes[n].value.toString(),s===!1)return this.str=!1;""!==s&&(o+="=",o+=/[\s"'=<>`]/.test(s)?'"'+s.replace(/"/g,"&quot;")+'"':s)}r+=o}return this.selfClosing&&!c?(r+="/>",this.str=r):(r+=">",c?this.str=r:(r+=l,r+="</"+this.tag+">",this.str=r))}},e="area base br col command embed hr img input keygen link meta param source track wbr".split(" "),t="a abbr acronym address applet area b base basefont bdo big blockquote body br button caption center cite code col colgroup dd del dfn dir div dl dt em fieldset font form frame frameset h1 h2 h3 h4 h5 h6 head hr html i iframe img input ins isindex kbd label legend li link map menu meta noframes noscript object ol p param pre q s samp script select small span strike strong style sub sup textarea title tt u ul var article aside audio bdi canvas command data datagrid datalist details embed eventsource figcaption figure footer header hgroup keygen mark meter nav output progress ruby rp rt section source summary time track video wbr".split(" "),s="li dd rt rp optgroup option tbody tfoot tr td th".split(" "),n="altGlyph altGlyphDef altGlyphItem animateColor animateMotion animateTransform clipPath feBlend feColorMatrix feComponentTransfer feComposite feConvolveMatrix feDiffuseLighting feDisplacementMap feDistantLight feFlood feFuncA feFuncB feFuncG feFuncR feGaussianBlur feImage feMerge feMergeNode feMorphology feOffset fePointLight feSpecularLighting feSpotLight feTile feTurbulence foreignObject glyphRef linearGradient radialGradient textPath vkern".split(" "),o="attributeName attributeType baseFrequency baseProfile calcMode clipPathUnits contentScriptType contentStyleType diffuseConstant edgeMode externalResourcesRequired filterRes filterUnits glyphRef glyphRef gradientTransform gradientTransform gradientUnits gradientUnits kernelMatrix kernelUnitLength kernelUnitLength kernelUnitLength keyPoints keySplines keyTimes lengthAdjust limitingConeAngle markerHeight markerUnits markerWidth maskContentUnits maskUnits numOctaves pathLength patternContentUnits patternTransform patternUnits pointsAtX pointsAtY pointsAtZ preserveAlpha preserveAspectRatio primitiveUnits refX refY repeatCount repeatDur requiredExtensions requiredFeatures specularConstant specularExponent specularExponent spreadMethod spreadMethod startOffset stdDeviation stitchTiles surfaceScale surfaceScale systemLanguage tableValues targetX targetY textLength textLength viewBox viewTarget xChannelSelector yChannelSelector zoomAndPan".split(" "),r=function(e){for(var t={},r=e.length;r--;)t[e[r].toLowerCase()]=e[r];return t},i=r(n),a=r(o),l={li:["li"],dt:["dt","dd"],dd:["dt","dd"],p:"address article aside blockquote dir div dl fieldset footer form h1 h2 h3 h4 h5 h6 header hgroup hr menu nav ol p pre section table ul".split(" "),rt:["rt","rp"],rp:["rp","rt"],optgroup:["optgroup"],option:["option","optgroup"],thead:["tbody","tfoot"],tbody:["tbody","tfoot"],tr:["tr"],td:["td","th"],th:["td","th"]},c=/^on[a-zA-Z]/,h=function(e){var t=!c.test(e.name);return t},u=function(e){var t,r,n,i,o,a;for(n={},t=[],r=[],o=e.length,i=0;o>i;i+=1)if(a=e[i],"intro"===a.name){if(n.intro)throw new Error("An element can only have one intro transition");n.intro=a}else if("outro"===a.name){if(n.outro)throw new Error("An element can only have one outro transition");n.outro=a}else"proxy-"===a.name.substr(0,6)?(a.name=a.name.substring(6),r[r.length]=a):"on-"===a.name.substr(0,3)?(a.name=a.name.substring(3),r[r.length]=a):t[t.length]=a;return n.attrs=t,n.proxies=r,n},f=function(e){var t=e.name.toLowerCase();return{name:a[t]?a[t]:t,value:e.value?pt(e.value):null}},d=function(e){var t,r,n,i,o,a,s;for(o=function(){throw new Error("Illegal proxy event")},e.name&&e.value||o(),t={domEventName:e.name},r=e.value,a=[],s=[];r.length;)if(n=r.shift(),n.type===Ft){if(i=n.value.indexOf(":"),-1!==i){i&&(a[a.length]={type:Ft,value:n.value.substr(0,i)}),n.value.length>i+1&&(s[0]={type:Ft,value:n.value.substring(i+1)});break}a[a.length]=n}else a[a.length]=n;if(s=s.concat(r),t.name=1===a.length&&a[0].type===Ft?a[0].value:a,s.length)if(1===s.length&&s[0].type===Ft)try{t.args=JSON.parse(s[0].value)}catch(l){t.args=s[0].value}else t.dynamicArgs=s;return t},p=function(e){var t,r;if("string"==typeof e.name){if(!e.args&&!e.dynamicArgs)return e.name;r=e.name}else r=pt(e.name).toJSON();return t={n:r},e.args?(t.a=e.args,t):(e.dynamicArgs&&(t.d=pt(e.dynamicArgs).toJSON()),t)}}();var Hr;!function(){var e,t,r,n;Hr=function(r){this.refs=[],e(r,this.refs),this.str=t(r,this.refs)},Hr.prototype={toJSON:function(){return this.json?this.json:(this.json={r:this.refs,s:this.str},this.json)}},e=function(t,r){var n,i;if(t.t===er&&-1===r.indexOf(t.n)&&r.unshift(t.n),i=t.o||t.m)if(y(i))e(i,r);else for(n=i.length;n--;)e(i[n],r);t.x&&e(t.x,r),t.r&&e(t.r,r),t.v&&e(t.v,r)},t=function(e,n){var i=function(e){return t(e,n)};switch(e.t){case Zt:case $t:case qt:return e.v;case Yt:return"'"+e.v.replace(/'/g,"\\'")+"'";case Kt:return"["+(e.m?e.m.map(i).join(","):"")+"]";case Qt:return"{"+(e.m?e.m.map(i).join(","):"")+"}";case Jt:return r(e.k)+":"+t(e.v,n);case nr:return("typeof"===e.s?"typeof ":e.s)+t(e.o,n);case ar:return t(e.o[0],n)+("in"===e.s.substr(0,2)?" "+e.s+" ":e.s)+t(e.o[1],n);case sr:return t(e.x,n)+"("+(e.o?e.o.map(i).join(","):"")+")";case ir:return"("+t(e.x,n)+")";case rr:return t(e.x,n)+t(e.r,n);case tr:return e.n?"."+e.n:"["+t(e.x,n)+"]";case or:return t(e.o[0],n)+"?"+t(e.o[1],n)+":"+t(e.o[2],n);case er:return"${"+n.indexOf(e.n)+"}";default:throw Ct.log(e),new Error("Could not stringify expression token. This error is unexpected")}},r=function(e){return e.t===Yt?n.test(e.v)?e.v:'"'+e.v.replace(/"/g,'\\"')+'"':e.t===qt?e.v:e},n=/^[a-zA-Z_$][a-zA-Z_$0-9]*$/}();var Mr=function(e,t){var r,n;for(r=this.items=[],n=gr(e,t);null!==n;)r[r.length]=n,n=gr(e,t)};Mr.prototype={toJSON:function(e){var t;return this["json_"+e]?this["json_"+e]:t=this["json_"+e]=vr(this.items,e)},toString:function(){return void 0!==this.str?this.str:(this.str=Er(this.items),this.str)}};var Sr=function(e,t){this.type=e.type===Dt?Dt:e.mustacheType,e.ref&&(this.ref=e.ref),e.expression&&(this.expr=new Hr(e.expression)),t.pos+=1};Sr.prototype={toJSON:function(){var e;return this.json?this.json:(e={t:this.type},this.ref&&(e.r=this.ref),this.expr&&(e.x=this.expr.toJSON()),this.json=e,e)},toString:function(){return!1}};var Cr=function(e,t,r){var n;for(this.ref=e.ref,this.indexRef=e.indexRef,this.inverted=e.mustacheType===Ot,e.expression&&(this.expr=new Hr(e.expression)),t.pos+=1,this.items=[],n=t.next();n;){if(n.mustacheType===zt){if(n.ref.trim()===this.ref||this.expr){t.pos+=1;break}throw new Error("Could not parse template: Illegal closing section")}this.items[this.items.length]=gr(t,r),n=t.next()}};Cr.prototype={toJSON:function(e){var t;return this.json?this.json:(t={t:Ut},this.ref&&(t.r=this.ref),this.indexRef&&(t.i=this.indexRef),this.inverted&&(t.n=!0),this.expr&&(t.x=this.expr.toJSON()),this.items.length&&(t.f=vr(this.items,e)),this.json=t,t)},toString:function(){return!1}};var Ar;!function(){var e,t,r;Ar=function(e,t){this.type=Ft,this.text=t?e.value:e.value.replace(r," ")},Ar.prototype={toJSON:function(){return this.decoded||(this.decoded=t(this.text))},toString:function(){return this.text}},e={quot:34,amp:38,apos:39,lt:60,gt:62,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,copy:169,ordf:170,laquo:171,not:172,shy:173,reg:174,macr:175,deg:176,plusmn:177,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,sup1:185,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,Agrave:192,Aacute:193,Acirc:194,Atilde:195,Auml:196,Aring:197,AElig:198,Ccedil:199,Egrave:200,Eacute:201,Ecirc:202,Euml:203,Igrave:204,Iacute:205,Icirc:206,Iuml:207,ETH:208,Ntilde:209,Ograve:210,Oacute:211,Ocirc:212,Otilde:213,Ouml:214,times:215,Oslash:216,Ugrave:217,Uacute:218,Ucirc:219,Uuml:220,Yacute:221,THORN:222,szlig:223,agrave:224,aacute:225,acirc:226,atilde:227,auml:228,aring:229,aelig:230,ccedil:231,egrave:232,eacute:233,ecirc:234,euml:235,igrave:236,iacute:237,icirc:238,iuml:239,eth:240,ntilde:241,ograve:242,oacute:243,ocirc:244,otilde:245,ouml:246,divide:247,oslash:248,ugrave:249,uacute:250,ucirc:251,uuml:252,yacute:253,thorn:254,yuml:255,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,"int":8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},t=function(t){var r;
return r=t.replace(/&([a-zA-Z]+);/,function(t,r){return e[r]?String.fromCharCode(e[r]):t}),r=r.replace(/&#x([0-9]+);/,function(e,t){return String.fromCharCode(parseInt(t,16))}),r=r.replace(/&#([0-9]+);/,function(e,t){return String.fromCharCode(t)})},r=/\s+/g}(),pt=function(e,t,r){var n,i;return n={pos:0,tokens:e||[],next:function(){return n.tokens[n.pos]},options:t},i=new Mr(n,r)};var kr;!function(){var e,t,r,n,i,o,a,s,l,c,h,u,f,d,p,m,g,v,E,y,T,x,w,b,R,_,H,M,S,C,A,k;kr=function(e){return h(e)},e=function(t){var r,n,i,o;if(r=t.pos,yr(t),i=kr(t),null===i)return null;if(n=[i],yr(t),wr(t,",")){if(o=e(t),null===o)return t.pos=r,null;n=n.concat(o)}return n},n=function(e){var t,r;return t=e.pos,wr(e,"(")?(yr(e),(r=kr(e))?(yr(e),wr(e,")")?{t:ir,x:r}:(e.pos=t,null)):(e.pos=t,null)):null},i=function(e){return v(e)||m(e)||n(e)},o=function(e){var t,r,n;if(t=i(e),!t)return null;if(r=g(e),!r)return t;for(;null!==r;)n={t:rr,x:t,r:r},t=n,r=g(e);return n},a=function(t){var r,n,i,a;return(n=o(t))?(r=t.pos,wr(t,"(")?(yr(t),i=e(t),yr(t),wr(t,")")?(a={t:sr,x:n},i&&(a.o=i),a):(t.pos=r,n)):n):null},s=function(e){var t,r,n;if(t=a(e),!t)return null;if(t.t!==sr)return t;if(r=g(e),!r)return t;for(;null!==r;)n={t:rr,x:t,r:r},t=n,r=g(e);return n},t=function(e,t){return function(r){var n,i;return wr(r,e)?(n=r.pos,yr(r),i=kr(r),i||Tr(r,"an expression"),{s:e,o:i,t:nr}):t(r)}},function(){var e,r,n,i,o;for(i="! ~ + - typeof".split(" "),o=s,e=0,r=i.length;r>e;e+=1)n=t(i[e],o),o=n;l=o}(),r=function(e,t){return function(r){var n,i,o;return(i=t(r))?(n=r.pos,yr(r),wr(r,e)?"in"===e&&/[a-zA-Z_$0-9]/.test(r.remaining().charAt(0))?(r.pos=n,i):(yr(r),o=kr(r),o?{t:ar,s:e,o:[i,o]}:(r.pos=n,i)):(r.pos=n,i)):null}},function(){var e,t,n,i,o;for(i="* / % + - << >> >>> < <= > >= in instanceof == != === !== & ^ | && ||".split(" "),o=l,e=0,t=i.length;t>e;e+=1)n=r(i[e],o),o=n;c=o}(),h=function(e){var t,r,n,i;return(r=c(e))?(t=e.pos,yr(e),wr(e,"?")?(yr(e),(n=kr(e))?(yr(e),wr(e,":")?(yr(e),i=kr(e),i?{t:or,o:[r,n,i]}:(e.pos=t,r)):(e.pos=t,r)):(e.pos=t,r)):(e.pos=t,r)):null},u=xr(/^[0-9]+/),f=xr(/^[eE][\-+]?[0-9]+/),d=xr(/^\.[0-9]+/),p=xr(/^(0|[1-9][0-9]*)/),m=function(e){var t,r,n,i,o,a;if(t=e.pos,n=wr(e,".")||"",r=M(e)||"","this"===r&&(r=".",t+=3),i=n+r,!i)return null;for(;o=S(e)||C(e);)i+=o;return wr(e,"(")&&(a=i.lastIndexOf("."),-1!==a?(i=i.substr(0,a),e.pos=t+i.length):e.pos-=1),{t:er,n:i}},g=function(e){var t,r,n;if(t=e.pos,yr(e),wr(e,".")){if(yr(e),r=M(e))return{t:tr,n:r};Tr(e,"a property name")}return wr(e,"[")?(yr(e),n=kr(e),n||Tr(e,"an expression"),yr(e),wr(e,"]")||Tr(e,'"]"'),{t:tr,x:n}):null},v=function(e){var t=T(e)||y(e)||b(e)||x(e)||w(e)||E(e);return t},E=function(t){var r,n;return r=t.pos,yr(t),wr(t,"[")?(n=e(t),wr(t,"]")?{t:Kt,m:n}:(t.pos=r,null)):(t.pos=r,null)},y=function(e){var t=e.remaining();return"true"===t.substr(0,4)?(e.pos+=4,{t:Zt,v:"true"}):"false"===t.substr(0,5)?(e.pos+=5,{t:Zt,v:"false"}):null},k=/^(?:Array|Date|RegExp|decodeURIComponent|decodeURI|encodeURIComponent|encodeURI|isFinite|isNaN|parseFloat|parseInt|JSON|Math|NaN|undefined|null)/,b=function(e){var t,r,n;return t=e.pos,(r=M(e))?(n=k.exec(r))?(e.pos=t+n[0].length,{t:$t,v:n[0]}):(e.pos=t,null):null},T=function(e){var t,r;return t=e.pos,(r=d(e))?{t:qt,v:r}:(r=p(e),null===r?null:(r+=d(e)||"",r+=f(e)||"",{t:qt,v:r}))},w=function(e){var t,r;return t=e.pos,yr(e),wr(e,"{")?(r=R(e),yr(e),wr(e,"}")?{t:Qt,m:r}:(e.pos=t,null)):(e.pos=t,null)},R=function(e){var t,r,n,i;return t=e.pos,n=_(e),null===n?null:(r=[n],wr(e,",")?(i=R(e),i?r.concat(i):(e.pos=t,null)):r)},_=function(e){var t,r,n;return t=e.pos,yr(e),r=H(e),null===r?(e.pos=t,null):(yr(e),wr(e,":")?(yr(e),n=kr(e),null===n?(e.pos=t,null):{t:Jt,k:r,v:n}):(e.pos=t,null))},H=function(e){return M(e)||x(e)||T(e)},x=function(e){var t,r;return t=e.pos,wr(e,'"')?(r=Nr(e),wr(e,'"')?{t:Yt,v:r}:(e.pos=t,null)):wr(e,"'")?(r=zr(e),wr(e,"'")?{t:Yt,v:r}:(e.pos=t,null)):null},M=xr(/^[a-zA-Z_$][a-zA-Z_$0-9]*/),S=xr(/^\.[a-zA-Z_$0-9]+/),C=function(e){var t=A(e);return t?"."+t:null},A=xr(/^\[(0|[1-9][0-9]*)\]/)}();var Lr;!function(){var e,t,r,n,i,o,a,s;Lr=function(r){return r.tripleDelimiters[0].length>r.delimiters[0].length?t(r)||e(r):e(r)||t(r)},e=function(e){var t,n=e.pos;return wr(e,e.delimiters[0])?(t=s(e))?wr(e,e.delimiters[1])?(e.delimiters=t,{type:jt,mustacheType:Gt}):(e.pos=n,null):(t=r(e),null===t?(e.pos=n,null):(yr(e),wr(e,e.delimiters[1])||Tr(e,'"'+e.delimiters[1]+'"'),t)):null},t=function(e){var t,n=e.pos;return wr(e,e.tripleDelimiters[0])?(t=s(e))?wr(e,e.tripleDelimiters[1])?(e.tripleDelimiters=t,{type:jt,mustacheType:Gt}):(e.pos=n,null):(yr(e),t=r(e,!0),null===t?(e.pos=n,null):(yr(e),wr(e,e.tripleDelimiters[1])?t:(e.pos=n,null))):null},r=function(e,t){var r,o,a,s,l,c,h;if(r=e.pos,o={type:t?Dt:jt},!t&&(a=n(e),o.mustacheType=a||Nt,(a===Bt||a===zt)&&(c=e.remaining(),h=c.indexOf(e.delimiters[1]),-1!==h)))return o.ref=c.substr(0,h),e.pos+=h,o;for(yr(e),s=kr(e);s.t===ir&&s.x;)s=s.x;return s.t===er?o.ref=s.n:o.expression=s,l=i(e),null!==l&&(o.indexRef=l),o},o={"#":Ut,"^":Ot,"/":zt,">":Vt,"!":Bt,"&":Nt},n=function(e){var t=o[e.str.charAt(e.pos)];return t?(e.pos+=1,t):null},i=xr(/^\s*:\s*([a-zA-Z_$][a-zA-Z_$0-9]*)/),a=xr(/^[^\s=]+/),s=function(e){var t,r,n;return wr(e,"=")?(t=e.pos,yr(e),(r=a(e))?(yr(e),(n=a(e))?(yr(e),wr(e,"=")?[r,n]:(e.pos=t,null)):(e.pos=t,null)):(e.pos=t,null)):null}}();var Pr;!function(){var e,t,r,n,i,o,a,s,l,c,h,u,f,d;Pr=function(r){return e(r)||t(r)},e=function(e){var t,i,o;return t=e.pos,wr(e,"<")?(i={type:Wt},i.name=r(e),i.name?(o=n(e),o&&(i.attrs=o),yr(e),wr(e,"/")&&(i.selfClosing=!0),wr(e,">")?i:(e.pos=t,null)):(e.pos=t,null)):null},t=function(e){var t,n;if(t=e.pos,!wr(e,"<"))return null;if(n={type:Wt,closing:!0},!wr(e,"/"))throw new Error("Unexpected character "+e.remaining().charAt(0)+' (expected "/")');if(n.name=r(e),!n.name)throw new Error("Unexpected character "+e.remaining().charAt(0)+" (expected tag name)");if(!wr(e,">"))throw new Error("Unexpected character "+e.remaining().charAt(0)+' (expected ">")');return n},r=xr(/^[a-zA-Z][a-zA-Z0-9\-]*/),n=function(e){var t,r,n;if(t=e.pos,yr(e),n=i(e),!n)return e.pos=t,null;for(r=[];null!==n;)r[r.length]=n,yr(e),n=i(e);return r},i=function(e){var t,r,n;return(r=o(e))?(t={name:r},n=a(e),n&&(t.value=n),t):null},o=xr(/^[^\s"'>\/=]+/),a=function(e){var t,r;return t=e.pos,yr(e),wr(e,"=")?(r=h(e)||f(e)||s(e),null===r?(e.pos=t,null):r):(e.pos=t,null)},c=xr(/^[^\s"'=<>`]+/),l=function(e){var t,r,n;return t=e.pos,(r=c(e))?(-1!==(n=r.indexOf(e.delimiters[0]))&&(r=r.substr(0,n),e.pos=t+r.length),{type:Ft,value:r}):null},s=function(e){var t,r;for(t=[],r=Lr(e)||l(e);null!==r;)t[t.length]=r,r=Lr(e)||l(e);return t.length?t:null},u=function(e){var t,r,n;return t=e.pos,(r=zr(e))?(-1!==(n=r.indexOf(e.delimiters[0]))&&(r=r.substr(0,n),e.pos=t+r.length),{type:Ft,value:r}):null},h=function(e){var t,r,n;if(t=e.pos,!wr(e,"'"))return null;for(r=[],n=Lr(e)||u(e);null!==n;)r[r.length]=n,n=Lr(e)||u(e);return wr(e,"'")?r:(e.pos=t,null)},d=function(e){var t,r,n;return t=e.pos,(r=Nr(e))?(-1!==(n=r.indexOf(e.delimiters[0]))&&(r=r.substr(0,n),e.pos=t+r.length),{type:Ft,value:r}):null},f=function(e){var t,r,n;if(t=e.pos,!wr(e,'"'))return null;for(r=[],n=Lr(e)||d(e);null!==n;)r[r.length]=n,n=Lr(e)||d(e);return wr(e,'"')?r:(e.pos=t,null)}}();var Fr=function(e){var t,r;return t=e.str.length,[e.delimiters[0],e.tripleDelimiters[0],"<"].forEach(function(r){var n=e.str.indexOf(r,e.pos);-1!==n&&(t=Math.min(n,t))}),t===e.pos?null:(r=e.str.substring(e.pos,t),e.pos=t,{type:Ft,value:r})};mt=function(e){var t=Lr(e)||Pr(e)||Fr(e);return t};var Nr=function(e){var t,r,n,i,o;if(t=e.pos,r="",n=Or(e),n&&(r+=n),i=Dr(e),i&&(r+=i),!r)return"";for(o=Nr(e);""!==o;)r+=o;return r},Dr=xr(/^[^\\"]+/),Ur=function(e){var t;return wr(e,"\\")?(t=e.str.charAt(e.pos),e.pos+=1,t):null},Or=function(e){var t,r="";for(t=Ur(e);t;)r+=t,t=Ur(e);return r||null},zr=function(e){var t,r,n,i,o;if(t=e.pos,r="",n=Or(e),n&&(r+=n),i=Ir(e),i&&(r+=i),r)for(o=zr(e);o;)r+=o,o=zr(e);return r},Ir=xr(/^[^\\']+/);!function(){var e,t,r,n;e=/^\s*$/,t=/<!--\s*\{\{\s*>\s*([a-zA-Z_$][a-zA-Z_$0-9]*)\s*}\}\s*-->/,r=/<!--\s*\{\{\s*\/\s*([a-zA-Z_$][a-zA-Z_$0-9]*)\s*}\}\s*-->/,i=function(r,i){var o,a,s,l;return i=i||{},t.test(r)?n(r,i):(i.sanitize===!0&&(i.sanitize={elements:"applet base basefont body frame frameset head html isindex link meta noframes noscript object param script style title".split(" "),eventAttributes:!0}),o=gt(r,i),i.preserveWhitespace||(l=o[0],l&&l.type===Ft&&e.test(l.value)&&o.shift(),l=o[o.length-1],l&&l.type===Ft&&e.test(l.value)&&o.pop()),a=pt(o,i,i.preserveWhitespace),s=a.toJSON(),"string"==typeof s?[s]:s)},n=function(e,n){var o,a,s,l,c,h;for(s={},o="",a=e;c=t.exec(a);){if(l=c[1],o+=a.substr(0,c.index),a=a.substring(c.index+c[0].length),h=r.exec(a),!h||h[1]!==l)throw new Error("Inline partials must have a closing delimiter, and cannot be nested");s[l]=i(a.substr(0,h.index),n),a=a.substring(h.index+h[0].length)}return{main:i(o,n),partials:s}}}(),gt=function(e,t){var r,n,i,o,a;for(t=t||{},r={str:Et(e),pos:0,delimiters:t.delimiters||["{{","}}"],tripleDelimiters:t.tripleDelimiters||["{{{","}}}"],remaining:function(){return r.str.substring(r.pos)}},n=[];r.pos<r.str.length;){if(i=mt(r),null===i&&r.remaining())throw o=r.str.substr(0,r.pos).substr(-20),20===o.length&&(o="..."+o),a=r.remaining().substr(0,20),20===a.length&&(a+="..."),new Error("Could not parse template: "+(o?o+"<- ":"")+"failed at character "+r.pos+" ->"+a);n[n.length]=i}return yt(n),vt(n),n},t.prototype=bt,t.adaptors=Rt,t.eventDefinitions=_t,t.partials={},t.easing=r,t.extend=n,t.interpolate=o,t.interpolators=a,t.parse=i,t.transitions=Ht,t.VERSION=xt,"undefined"!=typeof module&&module.exports?module.exports=t:"function"==typeof define&&define.amd?define(function(){return t}):e.Ractive=t}("undefined"!=typeof window?window:this),void 0===Date.now&&(Date.now=function(){return(new Date).valueOf()});var TWEEN=TWEEN||function(){var e=[];return{REVISION:"12",getAll:function(){return e},removeAll:function(){e=[]},add:function(t){e.push(t)},remove:function(t){var r=e.indexOf(t);-1!==r&&e.splice(r,1)},update:function(t){if(0===e.length)return!1;var r=0;for(t=void 0!==t?t:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now();r<e.length;)e[r].update(t)?r++:e.splice(r,1);return!0}}}();TWEEN.Tween=function(e){var t=e,r={},n={},i={},o=1e3,a=0,s=!1,l=!1,c=!1,h=0,u=null,f=TWEEN.Easing.Linear.None,d=TWEEN.Interpolation.Linear,p=[],m=null,g=!1,v=null,E=null;this.to=function(t,i){for(var a in t)r[a]=e[a];return void 0!==i&&(o=i),n=t,this},this.start=function(e){TWEEN.add(this),l=!0,g=!1,u=void 0!==e?e:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now(),u+=h;for(var o in n){if(n[o]instanceof Array){if(0===n[o].length)continue;n[o]=[t[o]].concat(n[o])}r[o]=t[o],r[o]instanceof Array==!1&&(r[o]*=1),i[o]=r[o]||0}return this},this.stop=function(){return l?(TWEEN.remove(this),l=!1,this.stopChainedTweens(),this):this},this.stopChainedTweens=function(){for(var e=0,t=p.length;t>e;e++)p[e].stop()},this.delay=function(e){return h=e,this},this.repeat=function(e){return a=e,this},this.yoyo=function(e){return s=e,this},this.easing=function(e){return f=e,this},this.interpolation=function(e){return d=e,this},this.chain=function(){return p=arguments,this},this.onStart=function(e){return m=e,this},this.onUpdate=function(e){return v=e,this},this.onComplete=function(e){return E=e,this},this.update=function(e){var l;if(u>e)return!0;g===!1&&(null!==m&&m.call(t),g=!0);var y=(e-u)/o;y=y>1?1:y;var T=f(y);for(l in n){var x=r[l]||0,w=n[l];w instanceof Array?t[l]=d(w,T):("string"==typeof w&&(w=x+parseFloat(w,10)),"number"==typeof w&&(t[l]=x+(w-x)*T))}if(null!==v&&v.call(t,T),1==y){if(a>0){isFinite(a)&&a--;for(l in i){if("string"==typeof n[l]&&(i[l]=i[l]+parseFloat(n[l],10)),s){var b=i[l];i[l]=n[l],n[l]=b,c=!c}r[l]=i[l]}return u=e+h,!0}null!==E&&E.call(t);for(var R=0,_=p.length;_>R;R++)p[R].start(e);return!1}return!0}},TWEEN.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(-Math.pow(2,-10*(e-1))+2)}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){var t,r=.1,n=.4;return 0===e?0:1===e?1:(!r||1>r?(r=1,t=n/4):t=n*Math.asin(1/r)/(2*Math.PI),-(r*Math.pow(2,10*(e-=1))*Math.sin(2*(e-t)*Math.PI/n)))},Out:function(e){var t,r=.1,n=.4;return 0===e?0:1===e?1:(!r||1>r?(r=1,t=n/4):t=n*Math.asin(1/r)/(2*Math.PI),r*Math.pow(2,-10*e)*Math.sin(2*(e-t)*Math.PI/n)+1)},InOut:function(e){var t,r=.1,n=.4;return 0===e?0:1===e?1:(!r||1>r?(r=1,t=n/4):t=n*Math.asin(1/r)/(2*Math.PI),(e*=2)<1?-.5*r*Math.pow(2,10*(e-=1))*Math.sin(2*(e-t)*Math.PI/n):r*Math.pow(2,-10*(e-=1))*Math.sin(2*(e-t)*Math.PI/n)*.5+1)}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?.5*e*e*((t+1)*e-t):.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-TWEEN.Easing.Bounce.Out(1-e)},Out:function(e){return 1/2.75>e?7.5625*e*e:2/2.75>e?7.5625*(e-=1.5/2.75)*e+.75:2.5/2.75>e?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return.5>e?.5*TWEEN.Easing.Bounce.In(2*e):.5*TWEEN.Easing.Bounce.Out(2*e-1)+.5}}},TWEEN.Interpolation={Linear:function(e,t){var r=e.length-1,n=r*t,i=Math.floor(n),o=TWEEN.Interpolation.Utils.Linear;return 0>t?o(e[0],e[1],n):t>1?o(e[r],e[r-1],r-n):o(e[i],e[i+1>r?r:i+1],n-i)},Bezier:function(e,t){var r,n=0,i=e.length-1,o=Math.pow,a=TWEEN.Interpolation.Utils.Bernstein;for(r=0;i>=r;r++)n+=o(1-t,i-r)*o(t,r)*e[r]*a(i,r);return n},CatmullRom:function(e,t){var r=e.length-1,n=r*t,i=Math.floor(n),o=TWEEN.Interpolation.Utils.CatmullRom;return e[0]===e[r]?(0>t&&(i=Math.floor(n=r*(1+t))),o(e[(i-1+r)%r],e[i],e[(i+1)%r],e[(i+2)%r],n-i)):0>t?e[0]-(o(e[0],e[0],e[1],e[1],-n)-e[0]):t>1?e[r]-(o(e[r],e[r],e[r-1],e[r-1],n-r)-e[r]):o(e[i?i-1:0],e[i],e[i+1>r?r:i+1],e[i+2>r?r:i+2],n-i)},Utils:{Linear:function(e,t,r){return(t-e)*r+e},Bernstein:function(e,t){var r=TWEEN.Interpolation.Utils.Factorial;return r(e)/r(t)/r(e-t)},Factorial:function(){var e=[1];return function(t){var r,n=1;if(e[t])return e[t];for(r=t;r>1;r--)n*=r;return e[t]=n}}(),CatmullRom:function(e,t,r,n,i){var o=.5*(r-e),a=.5*(n-t),s=i*i,l=i*s;return(2*t-2*r+o+a)*l+(-3*t+3*r-2*o-a)*s+o*i+t}}},function(){var e,t=this,r=t.Backbone,n=[],i=n.push,o=n.slice,a=n.splice;e="undefined"!=typeof exports?exports:t.Backbone={},e.VERSION="1.0.0";var s=t._;s||"undefined"==typeof require||(s=require("underscore")),e.$=t.jQuery||t.Zepto||t.ender||t.$,e.noConflict=function(){return t.Backbone=r,this},e.emulateHTTP=!1,e.emulateJSON=!1;var l=e.Events={on:function(e,t,r){if(!h(this,"on",e,[t,r])||!t)return this;this._events||(this._events={});var n=this._events[e]||(this._events[e]=[]);return n.push({callback:t,context:r,ctx:r||this}),this},once:function(e,t,r){if(!h(this,"once",e,[t,r])||!t)return this;var n=this,i=s.once(function(){n.off(e,i),t.apply(this,arguments)});return i._callback=t,this.on(e,i,r)},off:function(e,t,r){var n,i,o,a,l,c,u,f;if(!this._events||!h(this,"off",e,[t,r]))return this;if(!e&&!t&&!r)return this._events={},this;for(a=e?[e]:s.keys(this._events),l=0,c=a.length;c>l;l++)if(e=a[l],o=this._events[e]){if(this._events[e]=n=[],t||r)for(u=0,f=o.length;f>u;u++)i=o[u],(t&&t!==i.callback&&t!==i.callback._callback||r&&r!==i.context)&&n.push(i);n.length||delete this._events[e]}return this},trigger:function(e){if(!this._events)return this;var t=o.call(arguments,1);if(!h(this,"trigger",e,t))return this;var r=this._events[e],n=this._events.all;return r&&u(r,t),n&&u(n,arguments),this},stopListening:function(e,t,r){var n=this._listeners;if(!n)return this;var i=!t&&!r;"object"==typeof t&&(r=this),e&&((n={})[e._listenerId]=e);for(var o in n)n[o].off(t,r,this),i&&delete this._listeners[o];return this}},c=/\s+/,h=function(e,t,r,n){if(!r)return!0;if("object"==typeof r){for(var i in r)e[t].apply(e,[i,r[i]].concat(n));return!1}if(c.test(r)){for(var o=r.split(c),a=0,s=o.length;s>a;a++)e[t].apply(e,[o[a]].concat(n));return!1}return!0},u=function(e,t){var r,n=-1,i=e.length,o=t[0],a=t[1],s=t[2];switch(t.length){case 0:for(;++n<i;)(r=e[n]).callback.call(r.ctx);return;case 1:for(;++n<i;)(r=e[n]).callback.call(r.ctx,o);return;case 2:for(;++n<i;)(r=e[n]).callback.call(r.ctx,o,a);return;case 3:for(;++n<i;)(r=e[n]).callback.call(r.ctx,o,a,s);return;default:for(;++n<i;)(r=e[n]).callback.apply(r.ctx,t)}},f={listenTo:"on",listenToOnce:"once"};s.each(f,function(e,t){l[t]=function(t,r,n){var i=this._listeners||(this._listeners={}),o=t._listenerId||(t._listenerId=s.uniqueId("l"));return i[o]=t,"object"==typeof r&&(n=this),t[e](r,n,this),this}}),l.bind=l.on,l.unbind=l.off,s.extend(e,l);var d=e.Model=function(e,t){var r,n=e||{};t||(t={}),this.cid=s.uniqueId("c"),this.attributes={},s.extend(this,s.pick(t,p)),t.parse&&(n=this.parse(n,t)||{}),(r=s.result(this,"defaults"))&&(n=s.defaults({},n,r)),this.set(n,t),this.changed={},this.initialize.apply(this,arguments)},p=["url","urlRoot","collection"];s.extend(d.prototype,l,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return s.clone(this.attributes)},sync:function(){return e.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return s.escape(this.get(e))},has:function(e){return null!=this.get(e)},set:function(e,t,r){var n,i,o,a,l,c,h,u;if(null==e)return this;if("object"==typeof e?(i=e,r=t):(i={})[e]=t,r||(r={}),!this._validate(i,r))return!1;o=r.unset,l=r.silent,a=[],c=this._changing,this._changing=!0,c||(this._previousAttributes=s.clone(this.attributes),this.changed={}),u=this.attributes,h=this._previousAttributes,this.idAttribute in i&&(this.id=i[this.idAttribute]);for(n in i)t=i[n],s.isEqual(u[n],t)||a.push(n),s.isEqual(h[n],t)?delete this.changed[n]:this.changed[n]=t,o?delete u[n]:u[n]=t;if(!l){a.length&&(this._pending=!0);for(var f=0,d=a.length;d>f;f++)this.trigger("change:"+a[f],this,u[a[f]],r)}if(c)return this;if(!l)for(;this._pending;)this._pending=!1,this.trigger("change",this,r);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,s.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var r in this.attributes)t[r]=void 0;return this.set(t,s.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!s.isEmpty(this.changed):s.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?s.clone(this.changed):!1;var t,r=!1,n=this._changing?this._previousAttributes:this.attributes;for(var i in e)s.isEqual(n[i],t=e[i])||((r||(r={}))[i]=t);return r},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return s.clone(this._previousAttributes)},fetch:function(e){e=e?s.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=this,r=e.success;return e.success=function(n){return t.set(t.parse(n,e),e)?(r&&r(t,n,e),void t.trigger("sync",t,n,e)):!1},U(this,e),this.sync("read",this,e)},save:function(e,t,r){var n,i,o,a=this.attributes;if(null==e||"object"==typeof e?(n=e,r=t):(n={})[e]=t,!(!n||r&&r.wait||this.set(n,r)))return!1;if(r=s.extend({validate:!0},r),!this._validate(n,r))return!1;n&&r.wait&&(this.attributes=s.extend({},a,n)),void 0===r.parse&&(r.parse=!0);var l=this,c=r.success;return r.success=function(e){l.attributes=a;var t=l.parse(e,r);return r.wait&&(t=s.extend(n||{},t)),s.isObject(t)&&!l.set(t,r)?!1:(c&&c(l,e,r),void l.trigger("sync",l,e,r))},U(this,r),i=this.isNew()?"create":r.patch?"patch":"update","patch"===i&&(r.attrs=n),o=this.sync(i,this,r),n&&r.wait&&(this.attributes=a),o},destroy:function(e){e=e?s.clone(e):{};var t=this,r=e.success,n=function(){t.trigger("destroy",t,t.collection,e)};if(e.success=function(i){(e.wait||t.isNew())&&n(),r&&r(t,i,e),t.isNew()||t.trigger("sync",t,i,e)},this.isNew())return e.success(),!1;U(this,e);var i=this.sync("delete",this,e);return e.wait||n(),i},url:function(){var e=s.result(this,"urlRoot")||s.result(this.collection,"url")||D();return this.isNew()?e:e+("/"===e.charAt(e.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(e){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(e){return this._validate({},s.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=s.extend({},this.attributes,e);var r=this.validationError=this.validate(e,t)||null;return r?(this.trigger("invalid",this,r,s.extend(t||{},{validationError:r})),!1):!0}});var m=["keys","values","pairs","invert","pick","omit"];s.each(m,function(e){d.prototype[e]=function(){var t=o.call(arguments);return t.unshift(this.attributes),s[e].apply(s,t)}});var g=e.Collection=function(e,t){t||(t={}),t.url&&(this.url=t.url),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,s.extend({silent:!0},t))},v={add:!0,remove:!0,merge:!0},E={add:!0,merge:!1,remove:!1};s.extend(g.prototype,l,{model:d,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return e.sync.apply(this,arguments)},add:function(e,t){return this.set(e,s.defaults(t||{},E))},remove:function(e,t){e=s.isArray(e)?e.slice():[e],t||(t={});var r,n,i,o;for(r=0,n=e.length;n>r;r++)o=this.get(e[r]),o&&(delete this._byId[o.id],delete this._byId[o.cid],i=this.indexOf(o),this.models.splice(i,1),this.length--,t.silent||(t.index=i,o.trigger("remove",o,this,t)),this._removeReference(o));return this},set:function(e,t){t=s.defaults(t||{},v),t.parse&&(e=this.parse(e,t)),s.isArray(e)||(e=e?[e]:[]);var r,n,o,l,c,h=t.at,u=this.comparator&&null==h&&t.sort!==!1,f=s.isString(this.comparator)?this.comparator:null,d=[],p=[],m={};for(r=0,n=e.length;n>r;r++)(o=this._prepareModel(e[r],t))&&((l=this.get(o))?(t.remove&&(m[l.cid]=!0),t.merge&&(l.set(o.attributes,t),u&&!c&&l.hasChanged(f)&&(c=!0))):t.add&&(d.push(o),o.on("all",this._onModelEvent,this),this._byId[o.cid]=o,null!=o.id&&(this._byId[o.id]=o)));if(t.remove){for(r=0,n=this.length;n>r;++r)m[(o=this.models[r]).cid]||p.push(o);p.length&&this.remove(p,t)}if(d.length&&(u&&(c=!0),this.length+=d.length,null!=h?a.apply(this.models,[h,0].concat(d)):i.apply(this.models,d)),c&&this.sort({silent:!0}),t.silent)return this;for(r=0,n=d.length;n>r;r++)(o=d[r]).trigger("add",o,this,t);return c&&this.trigger("sort",this,t),this},reset:function(e,t){t||(t={});for(var r=0,n=this.models.length;n>r;r++)this._removeReference(this.models[r]);return t.previousModels=this.models,this._reset(),this.add(e,s.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,s.extend({at:this.length},t)),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,s.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(e,t){return this.models.slice(e,t)},get:function(e){return null==e?void 0:this._byId[null!=e.id?e.id:e.cid||e]},at:function(e){return this.models[e]},where:function(e,t){return s.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var r in e)if(e[r]!==t.get(r))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),s.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(s.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},sortedIndex:function(e,t,r){t||(t=this.comparator);var n=s.isFunction(t)?t:function(e){return e.get(t)};return s.sortedIndex(this.models,e,n,r)},pluck:function(e){return s.invoke(this.models,"get",e)},fetch:function(e){e=e?s.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=e.success,r=this;return e.success=function(n){var i=e.reset?"reset":"set";r[i](n,e),t&&t(r,n,e),r.trigger("sync",r,n,e)},U(this,e),this.sync("read",this,e)},create:function(e,t){if(t=t?s.clone(t):{},!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var r=this,n=t.success;return t.success=function(i){t.wait&&r.add(e,t),n&&n(e,i,t)},e.save(null,t),e},parse:function(e){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof d)return e.collection||(e.collection=this),e;t||(t={}),t.collection=this;var r=new this.model(e,t);return r._validate(e,t)?r:(this.trigger("invalid",this,e,t),!1)},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,r,n){("add"!==e&&"remove"!==e||r===this)&&("destroy"===e&&this.remove(t,n),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],null!=t.id&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments))}});var y=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];s.each(y,function(e){g.prototype[e]=function(){var t=o.call(arguments);return t.unshift(this.models),s[e].apply(s,t)}});var T=["groupBy","countBy","sortBy"];s.each(T,function(e){g.prototype[e]=function(t,r){var n=s.isFunction(t)?t:function(e){return e.get(t)};return s[e](this.models,n,r)}});var x=e.View=function(e){this.cid=s.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},w=/^(\S+)\s*(.*)$/,b=["model","collection","el","id","attributes","className","tagName","events"];s.extend(x.prototype,l,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(t,r){return this.$el&&this.undelegateEvents(),this.$el=t instanceof e.$?t:e.$(t),this.el=this.$el[0],r!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=s.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var r=e[t];if(s.isFunction(r)||(r=this[e[t]]),r){var n=t.match(w),i=n[1],o=n[2];r=s.bind(r,this),i+=".delegateEvents"+this.cid,""===o?this.$el.on(i,r):this.$el.on(i,o,r)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_configure:function(e){this.options&&(e=s.extend({},s.result(this,"options"),e)),s.extend(this,s.pick(e,b)),this.options=e},_ensureElement:function(){if(this.el)this.setElement(s.result(this,"el"),!1);else{var t=s.extend({},s.result(this,"attributes"));this.id&&(t.id=s.result(this,"id")),this.className&&(t["class"]=s.result(this,"className"));var r=e.$("<"+s.result(this,"tagName")+">").attr(t);this.setElement(r,!1)}}}),e.sync=function(t,r,n){var i=R[t];s.defaults(n||(n={}),{emulateHTTP:e.emulateHTTP,emulateJSON:e.emulateJSON});var o={type:i,dataType:"json"};if(n.url||(o.url=s.result(r,"url")||D()),null!=n.data||!r||"create"!==t&&"update"!==t&&"patch"!==t||(o.contentType="application/json",o.data=JSON.stringify(n.attrs||r.toJSON(n))),n.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{}),n.emulateHTTP&&("PUT"===i||"DELETE"===i||"PATCH"===i)){o.type="POST",n.emulateJSON&&(o.data._method=i);var a=n.beforeSend;n.beforeSend=function(e){return e.setRequestHeader("X-HTTP-Method-Override",i),a?a.apply(this,arguments):void 0}}"GET"===o.type||n.emulateJSON||(o.processData=!1),"PATCH"!==o.type||!window.ActiveXObject||window.external&&window.external.msActiveXFilteringEnabled||(o.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var l=n.xhr=e.ajax(s.extend(o,n));return r.trigger("request",r,l,n),l};var R={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};e.ajax=function(){return e.$.ajax.apply(e.$,arguments)};var _=e.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},H=/\((.*?)\)/g,M=/(\(\?)?:\w+/g,S=/\*\w+/g,C=/[\-{}\[\]+?.,\\\^$|#\s]/g;s.extend(_.prototype,l,{initialize:function(){},route:function(t,r,n){s.isRegExp(t)||(t=this._routeToRegExp(t)),s.isFunction(r)&&(n=r,r=""),n||(n=this[r]);var i=this;return e.history.route(t,function(o){var a=i._extractParameters(t,o);n&&n.apply(i,a),i.trigger.apply(i,["route:"+r].concat(a)),i.trigger("route",r,a),e.history.trigger("route",i,r,a)}),this},navigate:function(t,r){return e.history.navigate(t,r),this},_bindRoutes:function(){if(this.routes){this.routes=s.result(this,"routes");for(var e,t=s.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])}},_routeToRegExp:function(e){return e=e.replace(C,"\\$&").replace(H,"(?:$1)?").replace(M,function(e,t){return t?e:"([^/]+)"}).replace(S,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){var r=e.exec(t).slice(1);return s.map(r,function(e){return e?decodeURIComponent(e):null})}});var A=e.History=function(){this.handlers=[],s.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},k=/^[#\/]|\s+$/g,L=/^\/+|\/+$/g,P=/msie [\w.]+/,F=/\/$/;A.started=!1,s.extend(A.prototype,l,{interval:50,getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(null==e)if(this._hasPushState||!this._wantsHashChange||t){e=this.location.pathname;var r=this.root.replace(F,"");e.indexOf(r)||(e=e.substr(r.length))}else e=this.getHash();return e.replace(k,"")},start:function(t){if(A.started)throw new Error("Backbone.history has already been started");A.started=!0,this.options=s.extend({},{root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var r=this.getFragment(),n=document.documentMode,i=P.exec(navigator.userAgent.toLowerCase())&&(!n||7>=n);this.root=("/"+this.root+"/").replace(L,"/"),i&&this._wantsHashChange&&(this.iframe=e.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(r)),this._hasPushState?e.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!i?e.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=r;var o=this.location,a=o.pathname.replace(/[^\/]$/,"$&/")===this.root;return this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!a?(this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&a&&o.hash&&(this.fragment=this.getHash().replace(k,""),this.history.replaceState({},document.title,this.root+this.fragment+o.search)),this.options.silent?void 0:this.loadUrl())
},stop:function(){e.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),A.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(){var e=this.getFragment();return e===this.fragment&&this.iframe&&(e=this.getFragment(this.getHash(this.iframe))),e===this.fragment?!1:(this.iframe&&this.navigate(e),void(this.loadUrl()||this.loadUrl(this.getHash())))},loadUrl:function(e){var t=this.fragment=this.getFragment(e),r=s.any(this.handlers,function(e){return e.route.test(t)?(e.callback(t),!0):void 0});return r},navigate:function(e,t){if(!A.started)return!1;if(t&&t!==!0||(t={trigger:t}),e=this.getFragment(e||""),this.fragment!==e){this.fragment=e;var r=this.root+e;if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,r);else{if(!this._wantsHashChange)return this.location.assign(r);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}t.trigger&&this.loadUrl(e)}},_updateHash:function(e,t,r){if(r){var n=e.href.replace(/(javascript:|#).*$/,"");e.replace(n+"#"+t)}else e.hash="#"+t}}),e.history=new A;var N=function(e,t){var r,n=this;r=e&&s.has(e,"constructor")?e.constructor:function(){return n.apply(this,arguments)},s.extend(r,n,t);var i=function(){this.constructor=r};return i.prototype=n.prototype,r.prototype=new i,e&&s.extend(r.prototype,e),r.__super__=n.prototype,r};d.extend=g.extend=_.extend=x.extend=A.extend=N;var D=function(){throw new Error('A "url" property or function must be specified')},U=function(e,t){var r=t.error;t.error=function(n){r&&r(e,n,t),e.trigger("error",e,n,t)}}}.call(this),function(){var e=this,t=e.Sound||{},r=[],n=e.Sound=function(e,t){this.gain=n.ctx.createGain(),this.gain.connect(n.ctx.destination),n.get(e,_.bind(function(e){this.buffer=e,this._ready=!0,_.isFunction(t)&&t.call(this),this.trigger("load")},this))};_.extend(n,{ready:function(e){return n._ready?void e.call(n):void r.push(e)},noConflict:function(){return e.Sound=t,this},get:function(e,t){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){n.ctx.decodeAudioData(r.response,function(e){_.isFunction(t)&&t(e)},function(t){console.log("Error loading",e,t)})},r.send()}}),_.extend(n.prototype,Backbone.Events,{currentTime:function(){return n.ctx.currentTime},stop:function(){return this._ready&&this.source?(this.source.disconnect(this.gain),this):this},pause:function(){},play:function(e){if(!this._ready)return this;var t=_.defaults(e||{},{time:n.ctx.currentTime,loop:!1});return this.source=n.ctx.createBufferSource(),this.source.buffer=this.buffer,this.source.connect(this.gain),this.source.loop=t.loop,_.isFunction(this.source.start)?this.source.start(t.time):_.isFunction(this.source.noteOn)&&this.source.noteOn(t.time),this},setVolume:function(e){return this.gain.gain.value=e,this}})}(),!function(e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define(e):"undefined"!=typeof window?window.MIDIFile=e():"undefined"!=typeof global?global.MIDIFile=e():"undefined"!=typeof self&&(self.MIDIFile=e())}(function(){var e;return function t(e,r,n){function i(a,s){if(!r[a]){if(!e[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);throw new Error("Cannot find module '"+a+"'")}var c=r[a]={exports:{}};e[a][0].call(c.exports,function(t){var r=e[a][1][t];return i(r?r:t)},c,c.exports,t,e,r,n)}return r[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)i(n[a]);return i}({1:[function(e,t){function r(){throw new Error("MIDIEvents function not intended to be run.")}r.EVENT_META=255,r.EVENT_SYSEX=240,r.EVENT_DIVSYSEX=247,r.EVENT_MIDI=8,r.EVENT_META_SEQUENCE_NUMBER=0,r.EVENT_META_TEXT=1,r.EVENT_META_COPYRIGHT_NOTICE=2,r.EVENT_META_TRACK_NAME=3,r.EVENT_META_INSTRUMENT_NAME=4,r.EVENT_META_LYRICS=5,r.EVENT_META_MARKER=6,r.EVENT_META_CUE_POINT=7,r.EVENT_META_MIDI_CHANNEL_PREFIX=32,r.EVENT_META_END_OF_TRACK=47,r.EVENT_META_SET_TEMPO=81,r.EVENT_META_SMTPE_OFFSET=84,r.EVENT_META_TIME_SIGNATURE=88,r.EVENT_META_KEY_SIGNATURE=89,r.EVENT_META_SEQUENCER_SPECIFIC=127,r.EVENT_MIDI_NOTE_OFF=8,r.EVENT_MIDI_NOTE_ON=9,r.EVENT_MIDI_NOTE_AFTERTOUCH=10,r.EVENT_MIDI_CONTROLLER=11,r.EVENT_MIDI_PROGRAM_CHANGE=12,r.EVENT_MIDI_CHANNEL_AFTERTOUCH=13,r.EVENT_MIDI_PITCH_BEND=14,r.MIDI_1PARAM_EVENTS=[r.EVENT_MIDI_PROGRAM_CHANGE,r.EVENT_MIDI_CHANNEL_AFTERTOUCH],r.MIDI_2PARAMS_EVENTS=[r.EVENT_MIDI_NOTE_OFF,r.EVENT_MIDI_NOTE_ON,r.EVENT_MIDI_NOTE_AFTERTOUCH,r.EVENT_MIDI_CONTROLLER,r.EVENT_MIDI_PITCH_BEND],r.createParser=function(e,t,n){if(e instanceof DataView&&(e={position:t||0,buffer:e,readUint8:function(){return this.buffer.getUint8(this.position++)},readUint16:function(){var e=this.buffer.getUint16(this.position);return this.position=this.position+2,e},readUint32:function(){var e=this.buffer.getUint16(this.position);return this.position=this.position+2,e},readVarInt:function(){for(var e=0,t=0;t++<4;){var r=this.readUint8();if(!(128&r))return e+r;e+=127&r,e<<=7}throw new Error("0x"+this.position.toString(16)+": Variable integer length cannot exceed 4 bytes")},readBytes:function(e){var t=[];for(e;e>0;e--)t.push(this.readUint8());return t},pos:function(){return"0x"+(this.buffer.byteOffset+this.position).toString(16)},end:function(){return this.position===this.buffer.byteLength}},t=0),t>0)for(;t--;)e.readUint8();var i,o,a,s,l;return{next:function(){if(e.end())return null;if(o={index:e.pos(),delta:e.readVarInt()},i=e.readUint8(),240==(240&i)){if(i!=r.EVENT_META){if(i==r.EVENT_SYSEX||i==r.EVENT_DIVSYSEX)return o.type=i,o.length=e.readVarInt(),o.data=e.readBytes(o.length),o;if(n)throw new Error(e.pos()+" Unknown event type "+i.toString(16)+", Delta: "+o.delta+".");return o.type=i,o.badsubtype=e.readVarInt(),o.length=e.readUint8(),o.data=e.readBytes(o.length),o}switch(o.type=r.EVENT_META,o.subtype=e.readUint8(),o.length=e.readVarInt(),o.subtype){case r.EVENT_META_SEQUENCE_NUMBER:if(n&&2!==o.length)throw new Error(e.pos()+" Bad metaevent length.");return o.msb=e.readUint8(),o.lsb=e.readUint8(),o;case r.EVENT_META_TEXT:case r.EVENT_META_COPYRIGHT_NOTICE:case r.EVENT_META_TRACK_NAME:case r.EVENT_META_INSTRUMENT_NAME:case r.EVENT_META_LYRICS:case r.EVENT_META_MARKER:case r.EVENT_META_CUE_POINT:return o.data=e.readBytes(o.length),o;case r.EVENT_META_MIDI_CHANNEL_PREFIX:if(n&&1!==o.length)throw new Error(e.pos()+" Bad metaevent length.");return o.prefix=e.readUint8(),o;case r.EVENT_META_END_OF_TRACK:if(n&&0!==o.length)throw new Error(e.pos()+" Bad metaevent length.");return o;case r.EVENT_META_SET_TEMPO:if(n&&3!==o.length)throw new Error(e.pos()+" Tempo meta event length must be 3.");return o.tempo=(e.readUint8()<<16)+(e.readUint8()<<8)+e.readUint8(),o.tempoBPM=6e7/o.tempo,o;case r.EVENT_META_SMTPE_OFFSET:if(n&&5!==o.length)throw new Error(e.pos()+" Bad metaevent length.");if(o.hour=e.readUint8(),n&&o.hour>23)throw new Error(e.pos()+" SMTPE offset hour value must be part of 0-23.");if(o.minutes=e.readUint8(),n&&o.minutes>59)throw new Error(e.pos()+" SMTPE offset minutes value must be part of 0-59.");if(o.seconds=e.readUint8(),n&&o.seconds>59)throw new Error(e.pos()+" SMTPE offset seconds value must be part of 0-59.");if(o.frames=e.readUint8(),n&&o.frames>30)throw new Error(e.pos()+" SMTPE offset frames value must be part of 0-30.");if(o.subframes=e.readUint8(),n&&o.subframes>99)throw new Error(e.pos()+" SMTPE offset subframes value must be part of 0-99.");return o;case r.EVENT_META_KEY_SIGNATURE:if(n&&2!==o.length)throw new Error(e.pos()+" Bad metaevent length.");if(o.key=e.readUint8(),n&&(o.key<-7||o.key>7))throw new Error(e.pos()+" Bad metaevent length.");if(o.scale=e.readUint8(),n&&0!==o.scale&&1!==o.scale)throw new Error(e.pos()+" Key signature scale value must be 0 or 1.");return o;case r.EVENT_META_TIME_SIGNATURE:if(n&&4!==o.length)throw new Error(e.pos()+" Bad metaevent length.");return o.data=e.readBytes(o.length),o;case r.EVENT_META_SEQUENCER_SPECIFIC:return o.data=e.readBytes(o.length),o;default:if(n)throw new Error(e.pos()+" Unknown meta event type ("+o.subtype.toString(16)+").");return o.data=e.readBytes(o.length),o}}else{if(0==(128&i)){if(!a)throw new Error(e.pos()+" Running status without previous event");l=i}else a=i>>4,s=15&i,l=e.readUint8();switch(o.type=r.EVENT_MIDI,o.subtype=a,o.channel=s,o.param1=l,a){case r.EVENT_MIDI_NOTE_OFF:return o.param2=e.readUint8(),o;case r.EVENT_MIDI_NOTE_ON:var t=e.readUint8();return t?o.param2=t:(o.subtype=r.EVENT_MIDI_NOTE_OFF,o.param2=127),o;case r.EVENT_MIDI_NOTE_AFTERTOUCH:return o.param2=e.readUint8(),o;case r.EVENT_MIDI_CONTROLLER:return o.param2=e.readUint8(),o;case r.EVENT_MIDI_PROGRAM_CHANGE:return o;case r.EVENT_MIDI_CHANNEL_AFTERTOUCH:return o;case r.EVENT_MIDI_PITCH_BEND:return o.param2=e.readUint8(),o;default:if(n)throw new Error(e.pos()+" Unknown MIDI event type ("+a.toString(16)+").");return o}}}}},r.writeToTrack=function(e,t){for(var n=0,i=0,o=e.length;o>i;i++){if(e[i].delta>>>28)throw Error("Event #"+i+": Maximum delta time value reached ("+e[i].delta+"/134217728 max)");if(e[i].delta>>>21&&(t[n++]=e[i].delta>>>21&127|128),e[i].delta>>>14&&(t[n++]=e[i].delta>>>14&127|128),e[i].delta>>>7&&(t[n++]=e[i].delta>>>7&127|128),t[n++]=127&e[i].delta,e[i].type===r.EVENT_MIDI)t[n++]=(e[i].subtype<<4)+e[i].channel,t[n++]=e[i].param1,-1!==r.MIDI_2PARAMS_EVENTS.indexOf(e[i].subtype)&&(t[n++]=e[i].param2);else{if(t[n++]=e[i].type,e[i].type===r.EVENT_META&&(t[n++]=e[i].subtype),e[i].length>>>28)throw Error("Event #"+i+": Maximum length reached ("+e[i].length+"/134217728 max)");if(e[i].length>>>21&&(t[n++]=e[i].length>>>21&127|128),e[i].length>>>14&&(t[n++]=e[i].length>>>14&127|128),e[i].length>>>7&&(t[n++]=e[i].length>>>7&127|128),t[n++]=127&e[i].length,e[i].type===r.EVENT_META)switch(e[i].subtype){case r.EVENT_META_SEQUENCE_NUMBER:t[n++]=e[i].msb,t[n++]=e[i].lsb;break;case r.EVENT_META_TEXT:case r.EVENT_META_COPYRIGHT_NOTICE:case r.EVENT_META_TRACK_NAME:case r.EVENT_META_INSTRUMENT_NAME:case r.EVENT_META_LYRICS:case r.EVENT_META_MARKER:case r.EVENT_META_CUE_POINT:for(var a=0,s=e[i].length;s>a;a++)t[n++]=e[i].data[a];break;case r.EVENT_META_MIDI_CHANNEL_PREFIX:return t[n++]=e[i].prefix,event;case r.EVENT_META_END_OF_TRACK:break;case r.EVENT_META_SET_TEMPO:t[n++]=e[i].tempo>>16,t[n++]=e[i].tempo>>8&255,t[n++]=255&e[i].tempo;break;case r.EVENT_META_SMTPE_OFFSET:if(strictMode&&event.hour>23)throw new Error("Event #"+i+": SMTPE offset hour value must be part of 0-23.");if(t[n++]=e[i].hour,strictMode&&event.minutes>59)throw new Error("Event #"+i+": SMTPE offset minutes value must be part of 0-59.");if(t[n++]=e[i].minutes,strictMode&&event.seconds>59)throw new Error("Event #"+i+": SMTPE offset seconds value must be part of 0-59.");if(t[n++]=e[i].seconds,strictMode&&event.frames>30)throw new Error("Event #"+i+": SMTPE offset frames amount must be part of 0-30.");if(t[n++]=e[i].frames,strictMode&&event.subframes>99)throw new Error("Event #"+i+": SMTPE offset subframes amount must be part of 0-99.");return t[n++]=e[i].subframes,event;case r.EVENT_META_KEY_SIGNATURE:if("number"!=typeof e[i].key||e[i].key<-7||e[i].scale>7)throw new Error("Event #"+i+":The key signature key must be between -7 and 7");if("number"!=typeof e[i].scale||e[i].scale<0||e[i].scale>1)throw new Error("Event #"+i+":The key signature scale must be 0 or 1");t[n++]=e[i].key,t[n++]=e[i].scale;break;case r.EVENT_META_TIME_SIGNATURE:case r.EVENT_META_SEQUENCER_SPECIFIC:default:for(var a=0,s=e[i].length;s>a;a++)t[n++]=e[i].data[a]}else for(var a=0,s=e[i].length;s>a;a++)t[n++]=e[i].data[a]}}},r.getRequiredBufferLength=function(e){for(var t=0,n=0,i=e.length;i>n;n++)t+=e[n].delta>>>21?4:e[n].delta>>>14?3:e[n].delta>>>7?2:1,e[n].type===r.EVENT_MIDI?(t++,t++,-1!==r.MIDI_2PARAMS_EVENTS.indexOf(e[n].subtype)&&t++):(t++,e[n].type===r.EVENT_META&&t++,t+=e[n].length>>>21?4:e[n].length>>>14?3:e[n].length>>>7?2:1,t+=e[n].length);return t},t.exports=r},{}],2:[function(t,r,n){!function(e,t){t([],function(){var e={isUTF8:function(t){try{e.setBytesFromString(t)}catch(r){return!1}return!0},getCharLength:function(e){return 240==(240&e)?4:224==(224&e)?3:192==(192&e)?2:e==(127&e)?1:0},getCharCode:function(t,r,n){var i=0,o="";if(r=r||0,n=n||e.getCharLength(t[r]),0==n)throw new Error(t[r].toString(2)+" is not a significative byte (offset:"+r+").");if(1===n)return t[r];if(o="00000000",o[n]=1,t[r]&parseInt(o,2))throw Error("Index "+r+": A "+n+" bytes encoded char cannot encode the "+n+"th rank bit to 1.");for(o="0000".slice(0,n+1)+"11111111".slice(n+1),i+=(t[r]&parseInt(o,2))<<6*--n;n;){if(128!==t[r+1]&128||64===t[r+1]&64)throw Error("Index "+(r+1)+': Next bytes of encoded char must begin with a "10" bit sequence.');i+=(63&t[++r])<<6*--n}return i},getStringFromBytes:function(t,r,n,i){var o,a=[];for(r=0|r,n="number"==typeof n?n:t.byteLength||t.length;n>r;r++){if(o=e.getCharLength(t[r]),r+o>n){if(i)throw Error("Index "+r+": Found a "+o+" bytes encoded char declaration but only "+(n-r)+" bytes are available.")}else a.push(String.fromCharCode(e.getCharCode(t,r,o,i)));r+=o-1}return a.join("")},getBytesForCharCode:function(e){for(var t=0;4>t;t++)if(e<Math.pow(2,7+6*t))return t+1;throw new Error("CharCode "+e+" cannot be encoded with UTF8.")},setBytesFromCharCode:function(t,r,n,i){if(t=0|t,r=r||[],n=0|n,i=i||e.getBytesForCharCode(t),1==i)r[n]=t;else for(r[n++]=(parseInt("1111".slice(0,i),2)<<8-i)+(t>>>6*--i);i>0;)r[n++]=t>>>6*--i&63|128;return r},setBytesFromString:function(t,r,n,i){t=t||"",r=r||[],n=0|n,i="number"==typeof i?i:r.byteLength||1/0;for(var o=0,a=t.length;a>o;o++){var s=e.getBytesForCharCode(t[o].charCodeAt(0));e.setBytesFromCharCode(t[o].charCodeAt(0),r,n,s),n+=s}return r}};return e})}(this,"function"==typeof e&&e.amd?e:"object"==typeof n?function(e,n,i){"object"==typeof e&&(i=n,n=e),r.exports=i.apply(this,n.map(function(e){return t(e)}))}:function(e,t,r){var n=this;"object"==typeof e&&(r=t,t=e),this.UTF8=r.apply(this,t.map(function(e){return n[e.substring(e.lastIndexOf("/")+1)]}))}.bind(this))},{}],3:[function(e,t){function r(e,t){if(e){if(!(e instanceof ArrayBuffer))throw new Error("Invalid buffer received.");if(e.byteLength<25)throw new Error("A buffer of a valid MIDI file must have, at least, a size of 25bytes.");this.header=new n(e,t),this.tracks=[];for(var r,o=14,a=0,s=this.header.getTracksCount();s>a;a++){if(t&&o>=e.byteLength-1)throw new Error("Couldn't find datas corresponding to the track #"+a+".");var r=new i(e,o,t);this.tracks.push(r),o+=r.getTrackLength()+8}if(t&&o!=e.byteLength)throw new Error("It seems that the buffer contains too much datas.")}else this.header=new n,this.tracks=[new i]}var n=e("./MIDIFileHeader"),i=e("./MIDIFileTrack"),o=e("midievents"),a=e("utf-8");r.prototype.getEvents=function(e,t){var r,n,i=0,a=[],s=this.header.getFormat(),l=this.header.getTickResolution();if(1!==s||1===this.tracks.length)for(var c=0,h=this.tracks.length;h>c;c++)for(i=2==s&&i?i:0,r=new o.createParser(this.tracks[c].getTrackContent(),0,!1);n=r.next();)i+=n.delta?n.delta*l/1e3:0,n.type===o.EVENT_META&&n.subtype===o.EVENT_META_SET_TEMPO&&(l=this.header.getTickResolution(n.tempo)),e&&n.type!==e||t&&(!n.subtype||n.subtype!==e)||(n.playTime=i,a.push(n));else{var c,h,u=[],f=-1;for(c=0,h=this.tracks.length;h>c;c++)u[c]={},u[c].parser=new o.createParser(this.tracks[c].getTrackContent(),0,!1),u[c].curEvent=u[c].parser.next();do{for(f=-1,c=0,h=u.length;h>c;c++)u[c].curEvent&&(-1===f||u[c].curEvent.delta<u[f].curEvent.delta)&&(f=c);if(-1!==f){for(c=0,h=u.length;h>c;c++)c!==f&&u[c].curEvent&&(u[c].curEvent.delta-=u[f].curEvent.delta);n=u[f].curEvent,i+=n.delta?n.delta*l/1e3:0,n.type===o.EVENT_META&&n.subtype===o.EVENT_META_SET_TEMPO&&(l=this.header.getTickResolution(n.tempo)),e&&n.type!==e||t&&(!n.subtype||n.subtype!==e)||(n.playTime=i,n.track=f,a.push(n)),u[f].curEvent=u[f].parser.next()}}while(-1!==f)}return a},r.prototype.getMidiEvents=function(){return this.getEvents(o.EVENT_MIDI)},r.prototype.getLyrics=function(){for(var e,t=this.getEvents(o.EVENT_META),r=[],n=[],i=(this.header.getFormat(),0),s=t.length;s>i;i++)e=t[i],e.subtype===o.EVENT_META_LYRICS?n.push(e):e.subtype===o.EVENT_META_TEXT&&("@"===String.fromCharCode(e.data[0])?"T"===String.fromCharCode(e.data[1])||"I"===String.fromCharCode(e.data[1])||"L"===String.fromCharCode(e.data[1]):0===e.data.map(function(e){return String.fromCharCode(e)}).join("").indexOf("words")?r.length=0:0!==e.playTime&&r.push(e));n.length>2?r=n:r.length||(r=[]);try{r.forEach(function(e){e.text=a.getStringFromBytes(e.data,0,e.length,!0)})}catch(l){r.forEach(function(e){e.text=e.data.map(function(e){return String.fromCharCode(e)}).join("")})}return r},r.prototype.getTrackEvents=function(e){var t,r,n=[];if(e>this.tracks.length||0>e)throw Error("Invalid track index ("+e+")");r=new o.createParser(this.tracks[e].getTrackContent(),0,!1),t=r.next();do n.push(t),t=r.next();while(t);return n},r.prototype.setTrackEvents=function(e,t){var r,n;if(e>this.tracks.length||0>e)throw Error("Invalid track index ("+e+")");if(!t||!t.length)throw Error("A track must contain at least one event, none given.");r=o.getRequiredBufferLength(t),n=new Uint8Array(r),o.writeToTrack(t,n),this.tracks[e].setTrackContent(n)},r.prototype.deleteTrack=function(e){if(e>this.tracks.length||0>e)throw Error("Invalid track index ("+e+")");this.tracks.splice(e,1),this.header.setTracksCount(this.tracks.length)},r.prototype.addTrack=function(e){if(e>this.tracks.length||0>e)throw Error("Invalid track index ("+e+")");var t=new i;e==this.tracks.length?this.tracks.push(t):this.tracks.splice(e,0,t),this.header.setTracksCount(this.tracks.length)},r.prototype.getContent=function(){var e,t,r;e=n.HEADER_LENGTH;for(var i=0,o=this.tracks.length;o>i;i++)e+=this.tracks[i].getTrackLength()+8;t=new Uint8Array(e),r=new Uint8Array(this.header.datas.buffer,this.header.datas.byteOffset,n.HEADER_LENGTH);for(var i=0,o=n.HEADER_LENGTH;o>i;i++)t[i]=r[i];for(var a=0,s=this.tracks.length;s>a;a++){r=new Uint8Array(this.tracks[a].datas.buffer,this.tracks[a].datas.byteOffset,this.tracks[a].datas.byteLength);for(var l=0,c=this.tracks[a].datas.byteLength;c>l;l++)t[i++]=r[l]}return t.buffer},t.exports=r},{"./MIDIFileHeader":4,"./MIDIFileTrack":5,midievents:1,"utf-8":2}],4:[function(e,t){function r(e){if(e){if(!(e instanceof ArrayBuffer))throw Error("Invalid buffer received.");if(this.datas=new DataView(e,0,r.HEADER_LENGTH),"M"!==String.fromCharCode(this.datas.getUint8(0))||"T"!==String.fromCharCode(this.datas.getUint8(1))||"h"!==String.fromCharCode(this.datas.getUint8(2))||"d"!==String.fromCharCode(this.datas.getUint8(3)))throw new Error("Invalid MIDIFileHeader : MThd prefix not found");if(6!==this.datas.getUint32(4))throw new Error("Invalid MIDIFileHeader : Chunk length must be 6")}else{var t=new Uint8Array(r.HEADER_LENGTH);t[0]=77,t[1]=84,t[2]=104,t[3]=100,t[4]=0,t[5]=0,t[6]=0,t[7]=6,t[8]=0,t[9]=1,t[10]=0,t[11]=1,t[12]=0,t[13]=192,this.datas=new DataView(t.buffer,0,r.HEADER_LENGTH)}}r.HEADER_LENGTH=14,r.FRAMES_PER_SECONDS=1,r.TICKS_PER_BEAT=2,r.prototype.getFormat=function(){var e=this.datas.getUint16(8);if(0!==e&&1!==e&&2!==e)throw new Error("Invalid MIDI file : MIDI format ("+e+"), format can be 0, 1 or 2 only.");return e},r.prototype.setFormat=function(e){var e=this.datas.getUint16(8);if(0!==e&&1!==e&&2!==e)throw new Error("Invalid MIDI format given ("+e+"), format can be 0, 1 or 2 only.");return e},r.prototype.getTracksCount=function(){return this.datas.getUint16(10)},r.prototype.setTracksCount=function(e){return this.datas.setUint16(10,e)},r.prototype.getTickResolution=function(e){return 32768&this.datas.getUint16(12)?1e6/(this.getSMPTEFrames()*this.getTicksPerFrame()):(e=e||5e5,e/this.getTicksPerBeat())},r.prototype.getTimeDivision=function(){return 32768&this.datas.getUint16(12)?r.FRAMES_PER_SECONDS:r.TICKS_PER_BEAT},r.prototype.getTicksPerBeat=function(){var e=this.datas.getUint16(12);if(32768&e)throw new Error("Time division is not expressed as ticks per beat.");return e},r.prototype.setTicksPerBeat=function(e){this.datas.setUint16(12,32767&e)},r.prototype.getSMPTEFrames=function(){var e,t=this.datas.getUint16(12);if(!(32768&t))throw new Error("Time division is not expressed as frames per seconds.");if(e=32512&t,24!=e&&25!=e&&29!=e&&30!=e)throw new Error("Invalid SMPTE frames value ("+e+").");return 29===e?29.97:e},r.prototype.getTicksPerFrame=function(){var e=this.datas.getUint16(12);if(!(32768&e))throw new Error("Time division is not expressed as frames per seconds.");return 255&e},r.prototype.setSMTPEDivision=function(e,t){if(24!=e&&25!=e&&29.97!=e&&29!=e&&30!=e)throw new Error("Invalid SMPTE frames value given ("+e+").");if(29.97==e&&(e=29),0>t||t>255)throw new Error("Invalid ticks per frame value given ("+e+").");this.datas.setUint8(12,128|e),this.datas.setUint8(13,t)},t.exports=r},{}],5:[function(e,t){function r(e,t){if(e){if(!(e instanceof ArrayBuffer))throw Error("Invalid buffer received.");if(e.byteLength-t<12)throw Error("Invalid MIDIFileTrack (0x"+t.toString(16)+") : Buffer length must size at least 12bytes");if(this.datas=new DataView(e,t,r.HDR_LENGTH),"M"!==String.fromCharCode(this.datas.getUint8(0))||"T"!==String.fromCharCode(this.datas.getUint8(1))||"r"!==String.fromCharCode(this.datas.getUint8(2))||"k"!==String.fromCharCode(this.datas.getUint8(3)))throw Error("Invalid MIDIFileTrack (0x"+t.toString(16)+") : MTrk prefix not found");var n=this.getTrackLength();if(e.byteLength-t<n)throw Error("Invalid MIDIFileTrack (0x"+t.toString(16)+") : The track size exceed the buffer length.");if(this.datas=new DataView(e,t,r.HDR_LENGTH+n),255!==this.datas.getUint8(r.HDR_LENGTH+n-3)||47!==this.datas.getUint8(r.HDR_LENGTH+n-2)||0!==this.datas.getUint8(r.HDR_LENGTH+n-1))throw Error("Invalid MIDIFileTrack (0x"+t.toString(16)+") : No track end event found at the expected index ("+(r.HDR_LENGTH+n-1).toString(16)+").")}else{var i=new Uint8Array(12);i[0]=77,i[1]=84,i[2]=114,i[3]=107,i[4]=0,i[5]=0,i[6]=0,i[7]=4,i[8]=0,i[9]=255,i[10]=47,i[11]=0,this.datas=new DataView(i.buffer,0,r.HDR_LENGTH+4)}}r.HDR_LENGTH=8,r.prototype.getTrackLength=function(){return this.datas.getUint32(4)},r.prototype.setTrackLength=function(e){return this.datas.setUint32(e)},r.prototype.getTrackContent=function(){return new DataView(this.datas.buffer,this.datas.byteOffset+r.HDR_LENGTH,this.datas.byteLength-r.HDR_LENGTH)},r.prototype.setTrackContent=function(e){var t=e.byteLength-e.byteOffset;if(4>t)throw Error("Invalid track length, must size at least 4bytes");this.datas=new DataView(new Uint8Array(r.HDR_LENGTH+t).buffer),this.datas.setUint8(0,77),this.datas.setUint8(1,84),this.datas.setUint8(2,114),this.datas.setUint8(3,107),this.datas.setUint32(4,t);for(var n=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),i=new Uint8Array(this.datas.buffer,r.HDR_LENGTH,t),o=0,a=n.length;a>o;o++)i[o]=n[o]},t.exports=r},{}]},{},[3])(3)}),window.midi=function(){function e(e){return function(){console.error("MIDI: "+e)}}function t(e){return function(){console.warn("MIDI: "+e)}}function r(e){return function(t){console.log("MIDI Ready!"),l.access=t,l.inputs=t.inputs(),console.groupCollapsed("Inputs");for(var r=0;r<l.inputs.length;r++)console.log(l.inputs[r].name,l.inputs[r]),l.inputs[r].onmidimessage=n;console.groupEnd(),e&&e()}}function n(e){var t=i(e);l.onmessage(t,e);for(var r in s){var n=s[r],o=!0;for(var a in n.filter){var c=n.filter[a];o=c.apply?o&&c(t[a]):o&&c===t[a]}o&&n.callback.call(n.scope,t,e)}}function i(e){var t=l.types[(240&e.data[0])>>4],r={type:t.name,channel:(15&e.data[0])+1};return t.params.forEach(function(t,n){r[t]=e.data[n+1]}),r}function o(){return+new Date}var a=0,s={},l={access:null,debug:!1,types:{8:{name:"noteOff",params:["note","velocity"]},9:{name:"noteOn",params:["note","velocity"]},10:{name:"noteAftertouch",params:["note","value"]},11:{name:"controller",params:["controllerNumber","value"]},12:{name:"programChange",params:["programNumber"]},13:{name:"channelAftertouch",params:["value"]},14:{name:"pitchBend",params:["lowValue","highValue"]}},onmessage:function(e){l.debug&&console.log(e)},on:function(e,t,r){var n=a++;return s[n]={callback:t,filter:e,scope:r},{off:function(){delete s[n]}}}};return l.Player=function(e){this.position=0,this.lastPosition=-1/0,this.path=e,this.playing=!1,this.time=void 0,this.lastTime=void 0},l.Player.prototype.load=function(e){var t=this,r=new XMLHttpRequest;r.open("GET",this.path,!0),r.responseType="arraybuffer",r.onload=function(){t.buffer=r.response,t.midiFile=new MIDIFile(t.buffer),t.events=t.midiFile.getMidiEvents(),t.events.forEach(function(e){e.data=[(e.subtype<<4)+e.channel,e.param1,e.param2||0];var t=i(e);for(var r in t)e[r]=t[r]}),t.events.sort(function(e,t){var r=e.playTime-t.playTime;return 0==r?"noteOff"==e.type?-1:1:r}),e&&e()},r.send(null)},l.Player.prototype.play=function(){this.playing||(this.playing=!0,this.time=this.lastTime=o())},l.Player.prototype.pause=function(){this.playing&&(this.playing=!1)},l.Player.prototype.update=function(e){if(this.playing){this.lastTime=this.time,this.time=o(),void 0===e?this.position+=this.time-this.lastTime:this.position=e;var t;_.each(this.events,function(e){t=e.playTime,t>this.lastPosition&&t<=this.position&&n(e)},this),this.lastPosition=this.position}},l.Player.prototype.setPosition=function(e){this.position=e,this.lastPosition=e},navigator.requestMIDIAccess?navigator.requestMIDIAccess().then(r(),e("Failed to get midi access")):t("Web MIDI is not enabled")(),l}(),function(){var e,t=document.getElementsByTagName("head")[0],r=".disable-hover, .disable-hover * { pointer-events: none; }",n=document.createElement("style");n.type="text/css",n.appendChild(document.createTextNode(r)),t.appendChild(n),window.addEventListener("scroll",function(){clearTimeout(e),document.body.classList.contains("disable-hover")||document.body.classList.add("disable-hover"),e=setTimeout(function(){document.body.classList.remove("disable-hover")},230)},!1)}(),function(){function e(){if(i(arguments[0])){var e=arguments[0];return e[s.randomInt(e.length)]}var t,r=arguments.length,n=arguments[r-1];if(o(n)?(r--,t=n()):t=s.randomGenerator(),1==r)t*=arguments[0];else if(2==r){var a=arguments[0],l=arguments[1];t*=l-a,t+=a}return t}function t(e,t,r){void 0===h.generator&&(h.generator=new n(h.seed));for(var i=h.generator,o=1,a=1,s=0,l=0;l<h.octaves;++l){switch(o*=h.fallout,arguments.length){case 1:s+=o*(1+i.noise1d(a*e))/2;break;case 2:s+=o*(1+i.noise2d(a*e,a*t))/2;break;case 3:s+=o*(1+i.noise3d(a*e,a*t,a*r))/2}a*=2}return s}function r(e,t){var r=e||362436069,n=t||521288629,i=function(){return r=36969*(65535&r)+(r>>>16)&4294967295,n=18e3*(65535&n)+(n>>>16)&4294967295,4294967295&((65535&r)<<16|65535&n)};this.nextDouble=function(){var e=i()/4294967296;return 0>e?1+e:e},this.nextInt=i}function n(e){function t(e,t,r,n){var i=15&e,o=8>i?t:r,a=4>i?r:12===i||14===i?t:n;return(0===(1&i)?o:-o)+(0===(2&i)?a:-a)}function n(e,t,r){var n=0===(1&e)?t:r;return 0===(2&e)?-n:n}function i(e,t){return 0===(1&e)?-t:t}function o(e,t,r){return t+e*(r-t)}var a,l,c=void 0!==e?new r(e):r.createRandomized(),h=new Array(512);for(a=0;256>a;++a)h[a]=a;for(a=0;256>a;++a){var u=h[l=255&c.nextInt()];h[l]=h[a],h[a]=u}for(a=0;256>a;++a)h[a+256]=h[a];this.noise3d=function(e,r,n){var i=255&s.floor(e),a=255&s.floor(r),l=255&s.floor(n);e-=s.floor(e),r-=s.floor(r),n-=s.floor(n);var c=(3-2*e)*e*e,u=(3-2*r)*r*r,f=(3-2*n)*n*n,d=h[i]+a,p=h[d]+l,m=h[d+1]+l,g=h[i+1]+a,v=h[g]+l,E=h[g+1]+l;return o(f,o(u,o(c,t(h[p],e,r,n),t(h[v],e-1,r,n)),o(c,t(h[m],e,r-1,n),t(h[E],e-1,r-1,n))),o(u,o(c,t(h[p+1],e,r,n-1),t(h[v+1],e-1,r,n-1)),o(c,t(h[m+1],e,r-1,n-1),t(h[E+1],e-1,r-1,n-1))))},this.noise2d=function(e,t){var r=255&s.floor(e),i=255&s.floor(t);e-=s.floor(e),t-=s.floor(t);var a=(3-2*e)*e*e,l=(3-2*t)*t*t,c=h[r]+i,u=h[r+1]+i;return o(l,o(a,n(h[c],e,t),n(h[u],e-1,t)),o(a,n(h[c+1],e,t-1),n(h[u+1],e-1,t-1)))},this.noise1d=function(e){var t=255&s.floor(e);e-=s.floor(e);var r=(3-2*e)*e*e;return o(r,i(h[t],e),i(h[t+1],e-1))}}function i(e){return"[object Array]"===Object.prototype.toString.call(e)}function o(e){return e&&"[object Function]"=={}.toString.call(e)}function a(e,t){for(var r in t)e[r]=t[r]}var s=window.Math,l=s.random,c=s.round;s.DEFAULT_RANDOM_GENERATOR=function(){return l.call(s)},a(s,{TWO_PI:2*s.PI,HALF_PI:s.PI/2,clamp:function(e,t,r){return s.max(t,s.min(r,e))},lerp:function(e,t,r){return e+r*(t-e)},map:function(e,t,r,n,i){return(e-t)/(r-t)*(i-n)+n},cmap:function(e,t,r,n,i){return s.map(s.clamp(e,t,r),t,r,n,i)},sign:function(e){return 0>e?-1:1},sample:function(e,t){var r=~~t;if(r==t)return e[t];var n=r+1;return s.lerp(e[r],e[n],t-r)},isNumber:function(e){return e===e&&"[object Number]"==Object.prototype.toString.call(e)},smoothstep:function(e,t,r){return r=s.clamp((r-e)/(t-e),0,1),r*r*r*(r*(6*r-15)+10)},round:function(e,t){var r=s.pow(10,t||0);return c.call(s,e*r)/r},snap:function(e,t){return c.call(s,e/t)*t},gcf:function(){var e;if(e=void 0!=arguments[0].length?arguments[0]:arguments,1==e.length)return e[0];for(var t,r=e[0],n=e[1],i=1,o=e.length;o>i;){var a=s.max(r,n),l=s.min(r,n),c=1;do if(c=a%l,t=l,a=l,l=c,isNaN(c))return c;while(0!=c);r=t,n=e[++i]}return t},noise:t,random:e,randomGenerator:s.DEFAULT_RANDOM_GENERATOR,randomInt:function(){return s.floor(s.random.apply(s,arguments))},randomRange:function(e){return s.random(-e,e)},randomSign:function(){return s.chance()?-1:1},chance:function(e){return s.random()<(void 0!=e?e:.5)}});var h={generator:void 0,octaves:4,fallout:.5,seed:void 0};r.createRandomized=function(){var e=new Date;return new r(e/6e4&4294967295,4294967295&e)}}();var svg={NS:"http://www.w3.org/2000/svg",createElement:function(e){return document.createElementNS(svg.NS,e)},setHref:function(e,t){e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t)},create:function(){var e=svg.createElement("svg");return e.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),e},svgTextToSymbol:function(e,t){var r=svg.createElement("symbol");r.innerHTML=e;var n=r.firstElementChild,i=parseInt(n.getAttribute("width").replace(/px/gi,"")),o=parseInt(n.getAttribute("height").replace(/px/gi,""));return r.setAttribute("id",t),r.setAttribute("width",i),r.setAttribute("height",o),r.setAttribute("viewBox",n.getAttribute("viewBox")),r.width=i,r.height=o,r.innerHTML=n.innerHTML,r},createUse:function(e){var t=svg.createElement("use");return svg.setHref(t,"#"+e),t}};!function(e){function t(e,t){var n=void 0===t?r.defaults[e]:t;return r.params[e]=n,n}var r=window.url={},n=e.indexOf("#"),i=e.indexOf("?"),o=-1==n?e.substring(i):e.substring(i,n);o.replace(/([^?=&]+)(=([^&]+))?/g,function(e,t,n,i){r[t]=decodeURIComponent(i)}),r.hash=-1==n?void 0:e.substring(n+1),r.setUrl=arguments.callee,r.defaults={},r.params={},r["boolean"]=function(e,n){var i=t(e,n);return r.hasOwnProperty(e)?"false"!==r[e]:i},r.number=function(e,n){var i=t(e,n),o=parseFloat(r[e]);return o!=o?i:o},r["class"]=function(e,t){document.body.classList.toggle(e,r["boolean"](e,t))}}(location.href),TWEEN.__temp__={t:0},TWEEN.setTimeout=function(e,t){var r=!1,n=new TWEEN.Tween(TWEEN.__temp__).to(TWEEN.__temp__).delay(t).onStart(function(){r||e()});return n.start(),{stop:function(){r=!0,n.stop()}}},TWEEN.clearTimeout=function(e){e&&e.stop()},function(){function e(e,t,r,n,i,o){r=r||0,o=o||0,n=n||1,i=i||1,tx=this.$transformOriginX||0,ty=this.$transformOriginY||0,this.setAttribute("transform","translate("+(e+tx)+" "+(t+ty)+") scale("+n+" "+i+") rotate("+57.2957795*o+") translate("+-tx+" "+-ty+")")}function t(e,t){this.$transformOriginX=e,this.$transformOriginY=t}function r(e,t,r,n,i,o){r=r||0,o=o||0,n=n||1,i=i||1,this.style.webkitTransform="translate3d("+e+"px, "+t+"px, 0) scale("+n+", "+i+") rotate("+o+"rad)"}function n(e,t){this.style.webkitTransformOrigin=e+"px "+t+"px"}var i=function(){var e=document.createElement("p"),t={webkitTransform:1,transform:1};for(var r in t)if(void 0!==e.style[r])return r
}();SVGElement.prototype.$transform="webkitTransform"==i?r:e,SVGElement.prototype.$transformOrigin="webkitTransform"==i?n:t}();var utils={clone:function(e){return JSON.parse(JSON.stringify(e))},lerpAll:function(e,t,r,n){for(var i in t)e[i]=Math.lerp(t[i],r[i],n)}},Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var e=document.createElement("canvas");return!!window.WebGLRenderingContext&&(e.getContext("webgl")||e.getContext("experimental-webgl"))}catch(t){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var e=document.createElement("div");return e.id="webgl-error-message",e.style.fontFamily="monospace",e.style.fontSize="13px",e.style.fontWeight="normal",e.style.textAlign="center",e.style.background="#fff",e.style.color="#000",e.style.padding="1.5em",e.style.width="400px",e.style.margin="5em auto 0",this.webgl||(e.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n")),e},addGetWebGLMessage:function(e){var t,r,n;e=e||{},t=void 0!==e.parent?e.parent:document.body,r=void 0!==e.id?e.id:"oldie",n=Detector.getWebGLErrorMessage(),n.id=r,t.appendChild(n)}};pointer.EVENTS=["touch","release","tap","singletap","doubletap","hold","drag","dragend","dragstart","enter","leave","move"],pointer.DEFAULTS={tapMoveThreshold:Math.pow(10,2),holdDuration:600},_.each(pointer.EVENTS,function(e){Ractive.eventDefinitions["x"+e]=function(t,r){t.pointer=t.pointer||pointer(t),t.pointer.on(e,function(e){e.node=t,r(e)})}});var Elastic=function(){this.value=0,this.dest=0,this.velocity=0,this.strength=.43,this.damping=.55,this.epsilon=.001,this.onChange=function(){}};Elastic.prototype.update=function(){this.force=-this.strength*(this.value-this.dest),this.velocity+=this.force,this.velocity*=this.damping,this.value+=this.velocity,Math.abs(this.value-this.prevValue)>=this.epsilon&&this.onChange(this.value),this.prevValue=this.value},Video.prototype.start=function(e,t,r,n){function i(){s._start(e,function(){s.started=!0,r()})}function o(e){var t=0;return _.each(e,function(e){t+=_.keys(e).length}),t}if(!t){var a=this._canPlay();if(a!==!0)return void n(a)}var s=this,l=0;l+=this.player?0:1,l+=o(this.deps);var c=_.after(l,function(){s.depsLoaded=!0,s._resize&&window.removeEventListener("resize",this._resize,!1),i()});e.className=this.slug,this.player||(this.player=new midi.Player("audio/iii/"+this.slug+".mid"),this.player.load(c)),this.depsLoaded?i():_.each(this.deps,function(e,t){this.deps[t]={},_.each(e,function(e,r){get(e,function(e){s.deps[t][r]=e,c()})})},this)},Video.prototype.update=function(e){e=e||0,this.lastTime=this.time,this.time=Date.now(),e!=this.lastPosition?this.position=e:this.smoothPosition&&(this.position+=this.time-this.lastTime,this.position=Math.min(this.position,e+this.maxSmooth)),this.lastPosition=e,this.player.update(this.position-this.offset)},Video.prototype.loop=function(){this.started&&this._loop&&this._loop(this.position,this.lastPosition)},Video.prototype.setPosition=function(e){this._loop&&this.loop(e,this.lastPosition),this._setPosition(e,this.lastPosition),this.lastTime=this.time=Date.now(),this.player.setPosition(e)},Video.prototype.play=function(){this.lastTime=this.time=Date.now(),this.player&&this.player.play()},Video.prototype.pause=function(){this.player&&this.player.pause()},Video.prototype.teardown=function(e){this.lastPosition=this.position=0,this.pause(),this._teardown(e),this.started=!1,this._resize&&window.removeEventListener("resize",this._resize,!1)},PianoRollGeometry.TIME_SCALE=.016,PianoRollGeometry.NOTE_HEIGHT=-60,PianoRollGeometry.SCORE_WIDTH=140,PianoRollGeometry.SCORE_OFFSET=16,PianoRollGeometry.x=function(e){return e*PianoRollGeometry.TIME_SCALE},PianoRollGeometry.y=function(e){return e+PianoRollGeometry.NOTE_HEIGHT},PianoRollGeometry.z=function(e,t){return-Math.map(e,0,t-1,PianoRollGeometry.SCORE_WIDTH/2+PianoRollGeometry.SCORE_OFFSET,-PianoRollGeometry.SCORE_WIDTH/2+PianoRollGeometry.SCORE_OFFSET)},PianoRollGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);var iii=iii||{};PianoRollVideo.SCALE=30,PianoRollVideo.OFFSET=url.number("offset",-200);var iii=iii||{};PianoRollParticles.COUNT=100;var iii=iii||{};iii.params={updateFinger:!0,updateWater:!1,updateParticles:!0,updateUniforms:!1,pianoRollParticleDecay:.91,pianoRollParticleLifeSpan:100,pianoRollParticleInitialSize:1.6,pianoRollParticleVelocity:.1,pianoRollParticleGravity:.003,pianoRollParticleDrag:.9},iii.initGUI=function(){if(url["boolean"]("gui")){var e=iii.gui=new dat.GUI;e.add(iii.params,"updateFinger"),e.add(iii.params,"updateWater"),e.add(iii.params,"updateParticles"),e.add(iii.params,"updateUniforms"),e.add(iii.params,"pianoRollParticleDecay",.8,1).name("particle decay"),e.add(iii.params,"pianoRollParticleInitialSize",0,5).name("particle size"),e.add(iii.params,"pianoRollParticleVelocity",.1,3).name("particle vel"),e.add(iii.params,"pianoRollParticleGravity",-.1,0).name("particle grav"),e.add(iii.params,"pianoRollParticleDrag",0,1).name("particle drag")}};var iii=iii||{};iii.DATA={tracks:[{title:"Heaven",slug:"heaven",duration:79,bpm:100,ytid:"raSCKAPvxl4"},{title:"Jamn",slug:"jamn",duration:225,bpm:195,fingerBPM:97.5,ytid:"cNMGMV1gHso"},{title:"Puppy Love",slug:"puppy-love",duration:187,bpm:65,special:!0,ytid:"hOo0Hi0gJZQ"},{title:"R U IN 2 IT?",slug:"r-u-in-2-it",duration:181,bpm:111,ytid:"z4-XRrhAK3w"},{title:"Canopy",slug:"canopy",duration:216,bpm:100,ytid:"FzfrVDdOqLI"},{title:"Everyday Problems",slug:"everyday-problems",duration:158,bpm:100,ytid:"Dbw2wTYAl80"},{title:"A Brief Moment Of Clarity",slug:"a-brief-moment-of-clarity",duration:133,bpm:85,ytid:"cp4K1uLZVh8"},{title:"Rock",slug:"rock",duration:166,bpm:190,ytid:"j1BvCPN-n2k"},{title:"Hurtful Things",slug:"hurtful-things",duration:187,bpm:120,ytid:"EiGWIElGJtA"},{title:"Crystal",slug:"crystal",duration:232,bpm:72.5,ytid:"JKU3eMMWwTY"}]};var iii=iii||{};!function(){function e(e,t){return new Promise(function(r){Sound.ctx=t,Sound.has=!0,Sound._ready=!0,Sound.ready(function(){var t=iii.DATA.tracks[n];t.song=new Sound("audio/iii/jamn-short.mp3",function(){iii.METHODS.prepareData();var t=Ractive.extend({data:iii.DATA,init:function(){_.extend(this,iii.METHODS),_.each(iii.METHODS,function(e,t){this.on(t,e)},this),this.init(e,function(){r({enter:_.bind(iii.ractive.enter,iii.ractive),leave:_.bind(iii.ractive.leave,iii.ractive),render:_.bind(iii.ractive.update,iii.ractive),resize:_.bind(iii.ractive.resize,iii.ractive)})})}});iii.ractive=new t})})})}var t,r=97750,n=1;iii.METHODS={prepareData:function(){var e=iii.DATA;_.extend(e,iii.FILTERS),_.each(e.tracks,function(e,t){e.index=t,e.video=Video[e.slug]||PianoRollVideo(e.slug,e.bpm,e.fingerBPM||e.bpm)}),e.playing=!1,e.currentPosition=0,e.arrow_visible=!1,e.ever_scrolled=!1,e.Modernizr=Modernizr,e.audioRequiresTouch=!0},init:function(e,r){t=e;var i=n;url["class"]("playbar",!0),url["class"]("vr",!0),window.addEventListener("keydown",function(e){return 32===e.keyCode?(e.preventDefault(),iii.ractive.togglePlay(),!1):void 0}),this.setTrack(this.data.tracks[i],!1,_.bind(function(){r&&"function"==typeof r&&r()},this))},updatePercentLoaded:_.debounce(function(e,t){this.set("tracks."+e.index+".percentLoaded",t),e==this.data.currentTrack&&this.set("currentTrack.percentLoaded",t)},100),tryItAnyway:function(e){e.original.preventDefault(),this.setTrack(this.data.currentTrack,!0,_.bind(function(){this.play()},this))},setPosition:function(e){this.data.currentTrack.song.setPosition(e),this.data.currentTrack.video.setPosition(e)},setPositionFromPlaybar:function(e){var t=this.data.currentTrack.song.duration,r=t*(e.localX/this.data.playbar_progress_width);r=Math.clamp(r,0,t),this.setPosition(r),this.setDraggingTrue(),this.set("currentPosition",r/1e3)},enter:function(){return iii.renderer&&(iii.renderer.setClearColor(1510703,1),iii.renderer.sortObjects=!1),this.play(),this.set("playing",!0),this},leave:function(){return this.set("playing",!1),this.stop(),this},update:url["boolean"]("update",!0)?function(){var e;if(this.data.playing){e=1e3*this.data.currentTrack.song.currentTime()%r,this.data.currentTrack.video.update(e),e=this.data.currentTrack.video.position;var t=Math.floor(e/1e3||0);this.data.currentPosition!==t&&this.set("currentPosition",t)}TWEEN.update(),this.data.currentTrack.video.loop()}:function(){},resize:function(e,t,r){return this.width=e,this.height=t,console.log("resizing!"),this.data.currentTrack.video._resize(e,t,r),this},setTrackFromEvent:function(e){this.setTrack(e.context,!1,_.bind(function(){this.play()},this),_.bind(function(){},this))},scrollTo:function(e,t){var r=this;iii.scrollInterval=requestAnimationFrame(function(){e.scrollTop+=.1*(t-e.scrollTop),e.scrollTop!=t&&r.scrollTiiio(e,t)})},setTrack:function(e,r,n,i){if(this.data.currentTrack!=e||r){this.data.currentTrack&&this.stop(),this.set("currentPosition",0),this.set("currentTrack",e);var o=this;url["boolean"]("video",!0)&&e.video.start(t,r,function(){o.set("cantPlay",!1),n()},function(e){o.set("cantPlay",e),i&&i()})}},setDraggingTrue:function(){this.set("dragging",!0)},setDraggingFalse:function(){this.set("dragging",!1)},play:function(){this.data.playing||(this.data.currentTrack.song.play({loop:!0}),this.data.currentTrack.video.play())},pause:function(){this.data.playing&&(this.data.currentTrack.song.pause(),this.data.currentTrack.video.pause())},stop:function(){return this.data.currentTrack.song.stop(),this},togglePlay:function(){this.data.playing?this.pause():this.play()}},iii.FILTERS={minutesAndSeconds:function(e){function t(e){return 10>e?"0"+e:e}var r=e%60,n=Math.floor(e/60);return iii.FILTERS.prettyZero(n+":"+t(Math.floor(r)))},prettyZero:function(e){return e.toString().replace(/0/gi,"O")}},window.Demos.register({factory:e,slug:"georgenjonathan",preview:"images/preview/gandj.png",iOS:!1})}(),function(e){function t(e,t){this._imgs=[],Promise.all(e.map(r)).then(function(e){this._imgs=e;this._imgs[0];this._preRender(),this.onload()}.bind(this)),this.domElement=t||document.createElement("canvas"),this._ctx=this.domElement.getContext("2d");var n=this.animate.bind(this);this.animate=function(){requestAnimationFrame(n)}}function r(e){return new Promise(function(t,r){var n=new Image;n.src=e,n.onload=function(){t(n)},n.onerror=function(){r(Error("Failed to load."))}})}t.prototype.fps=24,t.prototype.loop=!0,t.prototype._index=0,t.prototype._lastTimestamp=void 0,t.prototype._playing=!1,t.prototype._needsUpdate=!1,t.prototype._width=0,t.prototype._height=0,t.prototype.onload=function(){},t.prototype.reset=function(){return this._index=0,this},t.prototype._preRender=function(){return this._imgs.forEach(function(e){this._ctx.drawImage(e,0,0,this._width,this._height)}),this._ctx.clearRect(0,0,this._width,this._height),this},t.prototype.update=function(){if(0===this._imgs.length)return this;var e=Date.now();this._lastTimestamp=this._lastTimestamp||e;var t=e-this._lastTimestamp;return this._needsUpdate=!1,t>1e3/this.fps&&(this._lastTimestamp=e,this._index+=1,this._needsUpdate=!0),this.loop?this._index%=this._imgs.length:this._index>=this._imgs.length&&(this._index=0,this.pause()),this},t.prototype.render=function(){return this._ctx.clearRect(0,0,this._width,this._height),this._ctx.drawImage(this._imgs[this._index],0,0,this._width,this._height),this},t.prototype.animate=function(){return this.update(),this._needsUpdate&&this.render(),this._playing&&requestAnimationFrame(this.animate.bind(this)),this},t.prototype.play=function(){return this._playing=!0,this.animate(),this},t.prototype.pause=function(){return this._playing=!1,this._lastTimestamp=void 0,this},t.prototype.setSize=function(e,t){return this._width=e,this._height=t,this.domElement.width=e,this.domElement.height=t,this},e.SpritePlayer=t}(window),THREE.FirstPersonControls=function(e,t){function r(e,t){return function(){t.apply(e,arguments)}}this.object=e,this.target=new THREE.Vector3(0,0,0),this.domElement=void 0!==t?t:document,this.movementSpeed=1,this.lookSpeed=.5,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.autoSpeedFactor=0,this.mouseX=0,this.mouseY=0,this.lat=0,this.lon=0,this.phi=0,this.theta=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.freeze=!1,this.mouseDragOn=!1,this.viewHalfX=0,this.viewHalfY=0,this.domElement!==document&&this.domElement.setAttribute("tabindex",-1),this.handleResize=function(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)},this.onMouseDown=function(e){if(this.domElement!==document&&this.domElement.focus(),e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0},this.onMouseUp=function(e){if(e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1},this.onMouseMove=function(e){this.domElement===document?(this.mouseX=e.pageX-this.viewHalfX,this.mouseY=e.pageY-this.viewHalfY):(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)},this.onKeyDown=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0;break;case 81:this.freeze=!this.freeze}},this.onKeyUp=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}},this.update=function(e){if(!this.freeze){if(this.heightSpeed){var t=THREE.Math.clamp(this.object.position.y,this.heightMin,this.heightMax),r=t-this.heightMin;this.autoSpeedFactor=e*r*this.heightCoef}else this.autoSpeedFactor=0;var n=e*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(n+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(n),this.moveLeft&&this.object.translateX(-n),this.moveRight&&this.object.translateX(n),this.moveUp&&this.object.translateY(n),this.moveDown&&this.object.translateY(-n);var i=e*this.lookSpeed;this.activeLook||(i=0);var o=1;this.constrainVertical&&(o=Math.PI/(this.verticalMax-this.verticalMin)),this.lon+=this.mouseX*i,this.lookVertical&&(this.lat-=this.mouseY*i*o),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=THREE.Math.degToRad(90-this.lat),this.theta=THREE.Math.degToRad(this.lon),this.constrainVertical&&(this.phi=THREE.Math.mapLinear(this.phi,0,Math.PI,this.verticalMin,this.verticalMax));var a=this.target,s=this.object.position;a.x=s.x+100*Math.sin(this.phi)*Math.cos(this.theta),a.y=s.y+100*Math.cos(this.phi),a.z=s.z+100*Math.sin(this.phi)*Math.sin(this.theta),this.object.lookAt(a)}},this.connect=function(){this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousemove",r(this,this.onMouseMove),!1)},this.handleResize()},function(){var e=this,t=e.ParticleField||{},r=new THREE.Matrix4,n=e.ParticleField=function(e,t,r,i,o){THREE.Object3D.call(this);var a=o||10;this.size=t||100,this.amount=r||100,this.reference=new THREE.Vector3,this.direction=new THREE.Vector3;for(var s=new THREE.PointCloudMaterial({size:i||1,color:16776960,transparent:!0,blending:THREE.AdditiveBlending,map:THREE.ImageUtils.loadTexture("textures/plus.png")}),l=0;a>l;l++){for(var c=new THREE.Geometry,h=0;h<this.amount;h++)c.vertices[h]=n.AssignRandomPointInField(this.size);var u=new THREE.PointCloud(c,s);u.index=l,n.AssignRandomPointInField(e.far,u.position),u.geometry.computeBoundingSphere(),this.add(u)}};n.noConflict=function(){return e.ParticleField=t,n},n.AssignRandomPointOnSphere=function(e,t){var n=Math.random()*Math.PI*2,i=e*Math.cos(n),o=e*Math.sin(n);return r.identity().makeRotationY(Math.random()*Math.PI*2),t?(t.set(i,o,0).applyMatrix4(r),t):new THREE.Vector3(i,o).applyMatrix4(r)},n.AssignRandomPointInField=function(e,t){var n=Math.sqrt(Math.random())*e,i=Math.random()*Math.PI*2,o=n*Math.cos(i),a=Math.random()*(n/2+5)-5;return r.identity().makeRotationY(Math.random()*Math.PI*2),t?(t.set(o,a,0).applyMatrix4(r),t):new THREE.Vector3(o,a).applyMatrix4(r)},n.prototype=Object.create(THREE.Object3D.prototype),n.prototype.update=function(e){var t=e,r=this.size/4;e.position&&(t=e.position,e.far&&(r+=e.far)),this.direction.copy(t).sub(this.reference).normalize();for(var n=0,i=this.children.length;i>n;n++){var o=this.children[n],a=t.x-o.position.x,s=t.z-o.position.z,l=Math.sqrt(a*a+s*s);l>r&&o.position.copy(this.direction).setLength(r).add(t)}return this.reference.copy(t),this}}(),function(){var e=this,t=e.Shadow||{},r=THREE.Mesh,n=e.Shadow=function(){r.call(this,n.Geometry,n.Material),this.rotation.x=Math.PI/2};n.noConflict=function(){return e.Shadow=t,n};var i=1,o=1,a=32,s=_.map(_.range(a),function(e){var t=e/(a-1),r=t*Math.PI*2;return new THREE.Vector2(i*Math.cos(r),o*Math.sin(r))}),l=new THREE.Shape(s);n.Geometry=new THREE.ShapeGeometry(l),n.Material=new THREE.MeshBasicMaterial({color:0,side:THREE.BackSide,transparent:!0,opacity:.05,depthWrite:!1}),n.prototype=Object.create(r.prototype)}(),function(){var e=this,t=e.Collectible||{},r=[],n={_ready:!1,play:function(){return n},stop:function(){return n}},i={coin:n,game:n,scoreboard:n,wind:n},o=function(e,t){THREE.Mesh.call(this,o.Geometry,o.Material),this.radius=t||1,this.scale.set(e||1,e||1,e||1);var r=this.shadow=new Shadow;r.scale.set(e||1,(e||1)/2,e||1),r.position.y=-2.9,this.add(r)};o.prototype=Object.create(THREE.Mesh.prototype),o.prototype.collect=function(){return i.coin.play(),this.reset()},o.prototype.reset=function(){return this.visible=!1,this.shadow.visible=!1,this};var a=1,s=1,l=32,c=_.map(_.range(l),function(e){var t=e/(l-1),r=t*Math.PI*2;return new THREE.Vector2(a*Math.cos(r),s*Math.sin(r))}),h=new THREE.Shape(c);o.Shape=h,o.Geometry=new THREE.ShapeGeometry(h),o.Material=new THREE.MeshLambertMaterial({color:16695565,side:THREE.DoubleSide,emissive:3355443}),o.Vector=new THREE.Vector3;var u=e.Collectible=function(e,t,n,i,a){THREE.Object3D.call(this),this.size=t,this.radius=e,this.bin=n,this.rows={min:1/0,max:-1/0,value:i},this.cols={min:1/0,max:-1/0,value:i},this.items={},this.callbacks=[],this.origin=new THREE.Vector3;for(var s=0;i*a>s;s++)this.add(new o(e,t));this.restart(),r.push(this)};u.Coin=o,u.noConflict=function(){return e.Collectible=t,u},u.prototype=Object.create(THREE.Object3D.prototype),u.prototype.collected=0,u.prototype._ready=!1,u.prototype._onCollect=function(){},u.prototype.setExplosion=function(e){return this.explosion=e,this},u.prototype.ready=function(e){return this._ready?(e(),this):void this.callbacks.push(e)},u.prototype.load=function(){return _.each(this.callbacks,function(e){e()}),this._ready=!0,this},u.prototype.update=function(e){var t,r=e.position,n=this.radius,i=Math.max(Math.min(Math.round(r.x/this.bin)*this.bin,this.rows.max),this.rows.min),o=Math.max(Math.min(Math.round(r.z/this.bin)*this.bin,this.cols.max),this.cols.min),a=this.items[i];a&&(a=a[o],a&&a.visible&&(t=r.distanceTo(a.position),n>t&&this.collect(a)));for(var s=0,l=this.children.length;l>s;s++){var c=this.children[s];c.visible&&(c.rotation.y+=Math.PI/32)}this.position.y<-1e-4?this.position.y-=.125*this.position.y:0!==this.position.y&&(this.position.y=0);var h=r.x-this.origin.x,u=r.z-this.origin.z;return t=h*h+u*u,n=1.33*e.far*1.33*e.far,t>n&&this.restart(r,!0),this},u.prototype.collect=function(e){var t=Date.now();this.explosion&&this.explosion.explode&&(this.explosion.position.copy(e.position),this.explosion.explode()),e.collect();var r=Math.floor(1e6*Math.random()/(t-this.lastTime));return this.collected+=Math.max(r,10),this._onCollect(e),this.lastTime=t,"vibrate"in navigator&&(navigator.vibrate(0),navigator.vibrate([150])),this},u.prototype.reset=function(){return this.lastTime=Date.now(),this.position.y=-5,this},u.prototype.restart=function(e,t){var r=this.rows.value,n=this.cols.value,i=0;t||(this.collected=0);for(var o=0;r>o;o++){var a=this.bin*o-this.bin*r/2;e&&(a+=Math.round(e.x/this.bin)*this.bin);var s={};this.rows.min=Math.min(a,this.rows.min),this.rows.max=Math.max(a,this.rows.max);for(var l=0;n>l;l++){var c=this.bin*l-this.bin*n/2;if(e&&(c+=Math.round(e.z/this.bin)*this.bin),this.cols.min=Math.min(c,this.cols.min),this.cols.max=Math.max(c,this.cols.max),0!==a||0!==c){var h=this.children[i];h.visible=!0,h.shadow.visible=!0,h.position.x=a,h.position.z=c,s[c]=h,i++}}this.items[a]=s}return this.width=this.rows.max-this.rows.min,this.height=this.cols.max-this.cols.min,e&&this.origin.copy(e),this.reset()};var f=_.after(4,function(){_.each(r,function(e){e.load()})});u.Sounds=i,u.Sounds.initialize=function(){Sound.ready(function(){i.coin=new Sound("./audio/coin.mp3",f),i.scoreboard=new Sound("./audio/scoreboard.mp3",f),i.game=new Sound("./audio/gameplay.mp3",f),i.wind=new Sound("./audio/wind.mp3",f)})}}(),function(){var e=this,t=e.Explosion||{},r=THREE.PointCloud,n=new THREE.PointCloudMaterial({color:16695565,transparent:!0,size:.2,depthTest:!1,blending:THREE.AdditiveBlending,map:THREE.ImageUtils.loadTexture("textures/circle.png")}),i=new THREE.Matrix4,o=e.Explosion=function(e){for(var t=new THREE.Geometry,o=0;e>o;o++){var a=Math.random()*Math.PI*2,s=Math.cos(a),l=Math.sin(a);i.identity().makeRotationY(Math.random()*Math.PI*2),t.vertices.push(new THREE.Vector3(s,l).applyMatrix4(i))}r.call(this,t,n)};o.noConflict=function(){return e.Explosion=t,o},o.prototype=Object.create(r.prototype),o.prototype._t=0,o.prototype._dest=0,o.prototype.scalar=4,o.prototype.explode=function(){return this._t=.001,this._dest=1,this.visible=!0,this.rotation.set(Math.random(),Math.random(),Math.random()),this},o.prototype.update=function(){if(this._t<.001||this._t>.999)return this.visible&&(this.visible=!1),this;this._t+=.2*(this._dest-this._t);var e=Math.max(this._t*this.scalar,.01);return this.scale.set(e,e,e),this.material.opacity=1-this._t,this}}(),function(){function e(e,t){for(var r=(e||0).toString(),n=Math.max(t-r.length,0),i="",o=0;n>o;o++)i+="0";return i+r}var t=this,r=t.UI||{},n=.2093023255813954,i="white",o=document.createElement("canvas");o.width=o.height=256;var a=o.getContext("2d"),s=40,l=1.25*s;a.font=""+s+"px Sniglet, sans-serif",a.textBaseline="middle",a.textAlign="center",a.fillStyle=i,has.localStorage&&!window.localStorage["collector-score"]&&(window.localStorage["collector-score"]="[]"),a.clearRect(0,0,o.width,o.height);var c=t.UI=function(e,t){THREE.Mesh.call(this,c.Geometry,c.Material);var r=this;this.collectible=e,this.collectible._onCollect=function(e){r.onCollect(e)},this.duration=1e3*(t||42),this.timer=function(){var e;e=new THREE.Geometry,e.vertices=[new THREE.Vector3(0,0,0),new THREE.Vector3(5,0,0)];var t=new THREE.Line(e,new THREE.LineBasicMaterial({color:h[0].string,linewidth:5}));e=new THREE.Geometry,e.vertices=[new THREE.Vector3(0,0,0),new THREE.Vector3(5.1,0,0)];var r=new THREE.Line(e,new THREE.LineBasicMaterial({color:16777215,linewidth:9}));t.position.x=-2.5,r.position.x=-2.55,t.position.z+=1e-4;var i=new THREE.Object3D;return i.color=h[0],i.add(r,t),i.reset=function(){t.material.color.set(h[0].string),t.material.needsUpdate=!0,i.color=h[0]},i.setTime=function(e){var r=Math.min(Math.max(e,.01),1);n>=r&&i.color!==h[1]&&(t.material.color.set(h[1].string),t.material.needsUpdate=!0,i.color=h[1]),t.scale.x=r},i}(),this.timer.position.y=c.Dimensions/2,this.add(this.timer)};c.noConflict=function(){return t.UI=r,c},c.Dimensions=7,c.Geometry=new THREE.PlaneGeometry(c.Dimensions,c.Dimensions),c.Material=new THREE.MeshBasicMaterial({color:16777215,transparent:!0,side:THREE.DoubleSide,depthTest:!1,depthWrite:!1,opacity:.9,map:new THREE.Texture(o)}),c.prototype=Object.create(THREE.Mesh.prototype),c.prototype.over=!0,c.prototype._init=!0,c.prototype.start=function(){return this.startTime=Date.now(),Collectible.Sounds.game.play(),Collectible.Sounds.scoreboard.stop(),this.timer.reset(),a.font=""+s+"px Sniglet, sans-serif",a.textBaseline="middle",a.textAlign="center",a.fillStyle=i,a.clearRect(0,0,o.width,o.height),a.fillText(this.collectible.collected,o.width/2,o.height-l),this.material.map.needsUpdate=!0,this.over=!1,this._init=!1,this},c.prototype.restart=function(){return Collectible.Sounds.scoreboard.stop(),this},c.prototype.end=function(){if(this.over=!0,Collectible.Sounds.game.stop(),Collectible.Sounds.scoreboard.play({loop:!0}),!has.localStorage)return this;var t=this.scores=JSON.parse(window.localStorage["collector-score"])||[],r=this.collectible.collected,n=0,i=!1;t.length=Math.min(t.length,20);for(var l=0;l<t.length;l++)if(r>t[l]){t.splice(l,0,r),n=l,i=!0;break}i||(n=t.length,t.push(r)),this.index=n,a.clearRect(0,0,o.width,o.height);var c=.75*s,h=1.25*c;a.font=""+c+"px Sniglet, sans-serif",a.save(),a.translate(o.width/2,o.height/4);var r,l,u,f=(this.scores[0]||0).toString().length;if(this.index<=2)for(l=0;l<Math.min(3,this.scores.length);l++)u=e(this.scores[l],f),r=l+1+". "+u,l===this.index&&(a.font="italic "+c+"px Sniglet, sans-serif"),a.fillText(r,0,l*h-c/2);else{for(l=0;l<Math.min(2,this.scores.length);l++)u=e(this.scores[l],f),r=l+1+". "+u,a.fillText(r,0,l*h-c/2);u=e(this.scores[this.index],f),r=this.index+1+". "+u,a.font="italic "+c+"px Sniglet, sans-serif",a.fillText(r,0,2*h-c/2)}return a.font=""+.66*c+"px Sniglet, sans-serif",a.fillText("LOOK DOWN TO RESTART",0,4.5*h-c/2),a.restore(),this.material.map.needsUpdate=!0,window.localStorage["collector-score"]=JSON.stringify(t),this},c.prototype.update=function(){var e=Date.now(),t=(e-this.startTime)/this.duration;return t>1&&!this.over&&this.end(),this.timer.setTime(1-t),this},c.prototype.onCollect=function(){return this.over?this:(a.clearRect(0,0,o.width,o.height),a.fillText(this.collectible.collected,o.width/2,o.height-l),this.material.map.needsUpdate=!0,this)};var h=[{r:85,g:98,b:180,string:"rgb(85, 98, 180)"},{r:255,g:100,b:100,string:"rgb(255, 100, 100)"}]}(),function(){for(var e=this,t=e.Sculpture||{},r=THREE.Mesh,n=[],i=50,o=6,a=["rgb(233, 30, 99)","rgb(85, 98, 180)","rgb(237, 131, 108)","rgb(245, 213, 98)","rgb(238, 255, 65)"],s=0;i>s;s++){var l=s/(i-1),c=2*Math.PI*l*o,h=Math.sin(l*Math.PI),u=h*Math.cos(c),f=2*(l-.5),d=h*Math.sin(c);n.push(new THREE.Vector3(u,f,d))}var p=new THREE.TubeGeometry(new THREE.SplineCurve3(n),200,.02,32,!1),m=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,transparent:!0}),g=e.Sculpture=function(){var e=m.clone();e.color=new THREE.Color(a[Math.floor(Math.random()*a.length)]),r.call(this,p,e),this.shadow=new Shadow,this.add(this.shadow)};g.noConflict=function(){return e.Sculpture=t,g},g.prototype=Object.create(r.prototype)}(),function(){var e=this,t=e.Garden||{},r=THREE.Object3D,n=e.Garden=function(e,t){r.call(this),this.size=e;for(var i=0;t>i;i++){var o=new Sculpture;this.add(o),o.scale.x=this.size*(Math.random()-.5)+1,o.scale.y=this.size*Math.random()+1,o.scale.z=o.scale.x,n.AssignRandomPointInField(this.size*this.size,o.position,i,t),o.shadow.position.y=-(o.position.y+2.9)/o.scale.y}};n.noConflict=function(){return e.Garden=t,n},n.AssignRandomPointInField=function(e,t){var r=e*Math.random()-e/2,n=e*Math.random()-e/2;return t?(t.set(r,0,n),t):new THREE.Vector3(r,0,n)},n.prototype=Object.create(r.prototype),n.prototype.update=function(e){for(var t=e.position,r=e.far*e.far,n=0,i=this.children.length;i>n;n++){var o=this.children[n],a=t.x-o.position.x,s=t.z-o.position.z,l=a*a+s*s;if(o.material.opacity+=.0125*(1-o.material.opacity),l>r){var c=Math.random()*Math.PI*2,h=e.far*Math.cos(c),u=e.far*Math.sin(c);o.position.copy(t),o.position.x+=h,o.position.z+=u,o.position.y=Math.random()*this.size*2-this.size/2,o.scale.x=this.size*(Math.random()-.5)+1,o.scale.y=this.size*Math.random()+1,o.scale.z=o.scale.x,o.shadow.position.y=-(o.position.y+2.9)/o.scale.y,o.material.opacity=0}}return this}}(),function(){function e(e,i,o){return s=new THREE.WebGLRenderer({canvas:e.canvas,antialias:!0}),l=new THREE.StereoEffect(s),f=o.deviceOrientation?new THREE.DeviceOrientationControls(u.firstPerson):new THREE.FirstPersonControls(u.firstPerson),f.connect(),f.movementSpeed=10,f.rollSpeed=Math.PI/4,f.autoForward=!0,h.fog=new THREE.Fog(7196662,10,45),d=new Garden(25,8),p=new ParticleField(u.firstPerson,50,20,.5,4),m=new THREE.Mesh(new THREE.PlaneGeometry(100*u.firstPerson.far,100*u.firstPerson.far,1,1),new THREE.MeshBasicMaterial({color:9225790,side:THREE.DoubleSide})),g=new Collectible(.66,u.firstPerson.far,10,10,10),v=new UI(g),E=new Explosion(100),g.explosion=E,v.position.z=-6,E.position.z=-6,m.rotation.x=Math.PI/2,m.scale.set(5,5,5),m.position.y=-3,u.firstPerson.shadow.position.y=-2.9,u.firstPerson.shadow.scale.set(5,5,5),h.add(g),h.add(p),h.add(m),h.add(d),h.add(u.firstPerson),h.add(u.firstPerson.shadow),h.add(E),u.firstPerson.add(v),u.firstPerson.add(u.firstPerson.light),u.wide.position.y=20,c={current:l,flat:s,stereo:l},y=0,T=new THREE.Vector3,l.separation=0,new Promise(function(e){Sound.ctx=i,Sound.has=!0,Sound._ready=!0,Collectible.Sounds.initialize(),g.ready(function(){e({enter:t,leave:r,render:n,resize:a})})})}function t(){s.setClearColor(7196662,1),h.visible=!0,R=!1,y=0,o(),w=!0}function r(){w=!1,h.visible=!1,Collectible.Sounds.wind.stop(),Collectible.Sounds.game.stop(),Collectible.Sounds.scoreboard.stop()}function n(){var e=u.firstPerson,t=e.position;f.movementSpeed=v.over||b?0:10,f.update(x.getDelta()),t.y+=y,t.y=Math.max(t.y,0),t.y<=0?(t.y=0,y=0,R=!1,b&&(v.start(),b=!1)):y-=.01;var r=Math.max(Math.min(1-t.y/50,1),.01);e.shadow.scale.set(r,r,r),Collectible.Sounds.game._ready&&(Collectible.Sounds.game.gain.gain.value=r),Collectible.Sounds.scoreboard._ready&&(Collectible.Sounds.scoreboard.gain.gain.value=r),Collectible.Sounds.coin._ready&&(Collectible.Sounds.coin.gain.gain.value=r),Collectible.Sounds.wind._ready&&(Collectible.Sounds.wind.gain.gain.value=1-Math.sqrt(r));var n=u.wide;n.lookAt(t),n.position.x=e.shadow.position.x=t.x,n.position.z=e.shadow.position.z=t.z,T.set(0,0,-1).applyQuaternion(e.quaternion),T.y<-.95&&w&&i(),g.update(e),v.update(e),p.update(e),m.position.x=t.x,m.position.z=t.z,d.update(e),E.update(),u.isFirstPerson&&(n=u.firstPerson),c.current.render(h,n)}function i(){R||(y=1,R=!0,v.over&&o())}function o(){v.restart(),g.restart(u.firstPerson.position),b=!0}function a(e,t,r){var n=u.isFirstPerson?u.firstPerson:u.wide;n.aspect=e/t,n.updateProjectionMatrix(),r&&(s.devicePixelRatio=l.devicePixelRatio=r),s.setSize(e,t),l.setSize(e,t)}var s,l,c,h=new THREE.Scene,u={isFirstPerson:!0,wide:new THREE.PerspectiveCamera(90,0,.001,700),firstPerson:new THREE.PerspectiveCamera(90,0,1,50)};u.firstPerson.light=new THREE.PointLight(16777215,1,0),u.firstPerson.shadow=new Shadow;var f,d,p,m,g,v,E,y,T,x=new THREE.Clock(!0),w=!1,b=!1,R=!1;Demos.register({factory:e,slug:"collector",preview:"/images/preview/collector.jpg"})}();var GalleryLoader=function(){function e(e){this.container=document.createElement("div"),this.container.className="gallery-loader",this.info=document.createElement("div"),this.heading=document.createElement("h1"),this.message=document.createElement("h2"),this.img=e,this.info.appendChild(this.heading),this.info.appendChild(this.message),e&&this.info.appendChild(this.img),this.container.appendChild(this.info),this.heading.innerHTML="Loading",this.setMessage("")
}return e.create=function(t){return new Promise(function(r){var n=new Image;n.onload=function(){r(new e(n))},n.onerror=function(){r(new e(null))},n.src=t})},e.prototype.setMessage=function(e){this.message.innerHTML=e},e.prototype.setProgress=function(e,t){var r=e+" of "+t;this.setMessage(r)},e.prototype.show=function(){this.container.classList.add("enabled")},e.prototype.hide=function(){this.container.classList.remove("enabled")},e}();!function(e){function t(){var e=new THREE.RingGeometry(.85*t.SIZE*l,1*t.SIZE*l,32),r=new THREE.MeshBasicMaterial({color:16777215,blending:THREE.AdditiveBlending,side:THREE.DoubleSide});THREE.Mesh.call(this,e,r)}function r(e){THREE.Object3D.call(this),this.slug=e.slug,this.href=e.href,this.app=e.app;var t=new THREE.PlaneGeometry(this.width,this.height),r=THREE.ImageUtils.loadTexture(e.preview),n=new THREE.MeshBasicMaterial({map:r}),i=new THREE.Mesh(t,n);this.add(i)}function n(){this.projector=new THREE.Projector,this.raycaster=new THREE.Raycaster}function i(e){return AudioPlayer.create(s,"/audio/open.mp3").then(function(t){e.openSound=t}),Promise.all([u,v.Nexus5.promise,v.Cardboard.promise])}function o(){THREE.Object3D.call(this),n.bind(this)(),this.openSound=this.selectSound={play:function(){}},this.intersectables=[];for(var e=0;e<arguments.length;e++)this.add(arguments[e])}function a(e,r,n){function a(e){x.addDemos(e)}function c(){T.scene.visible=!0,has.mobile&&b?p():d()}function h(){T.scene.visible=!1}function u(e){T.update(),x.update(e),T.render(e)}function f(){Cardboard.prototype.resize.apply(T,arguments)}function d(){E.visible=!1,E.playing=!1,w.visible=!0,T.currentRenderer=T.effect}function p(){return E.visible=!0,E.playing=!0,w.visible=!1,T.currentRenderer=T.renderer,v?(E.playIntro(),void(v=!1)):void E.playAlert()}function g(e){switch(e){case-90:case 90:d(),b=!1;break;case 0:case 180:p(),b=!0}}var v=!0;return s=r,T=new Cardboard(e),x=new o(m),T.scene.add(x),x.showOverlay=p,x.hideOverlay=d,w=new t,T.camera.add(w),T.camera.add(E),w.position.z=-3*l,E.position.z=w.position.z,w.lookAt(T.camera.position),T.effect.separation=.6,n.deviceOrientation&&(T.orbitControls.enabled=!1,T.controls.connect()),has.mobile||setTimeout(function(){T.orbitControls.target.set(0,.3,1)},0),i(x).then(function(){return{enter:c,leave:h,render:u,resize:f,orientationchange:g,addDemos:a}})}var s,l=3;t.SIZE=.1*l,t.prototype=Object.create(THREE.Mesh.prototype),t.prototype.constructor=t,r.prototype=Object.create(THREE.Object3D.prototype),r.prototype.constructor=r,r.prototype.width=1*l,r.prototype.height=1*l,r.prototype.highlight=function(){this.object.material.color.setHex(16711680)};var c,h=4*l,u=new Promise(function(e){c=e}),f=THREE.ImageUtils.loadTextureCube(["/textures/skybox_stars/512/s_px.jpg","/textures/skybox_stars/512/s_nx.jpg","/textures/skybox_stars/512/s_py.jpg","/textures/skybox_stars/512/s_ny.jpg","/textures/skybox_stars/512/s_pz.jpg","/textures/skybox_stars/512/s_nz.jpg"],void 0,c),d=THREE.ShaderLib.cube;d.uniforms=THREE.UniformsUtils.clone(d.uniforms),d.uniforms.tCube.value=f;var p=new THREE.ShaderMaterial({fragmentShader:d.fragmentShader,vertexShader:d.vertexShader,uniforms:d.uniforms,deptTest:!1,depthWrite:!1,side:THREE.BackSide}),m=new THREE.Mesh(new THREE.BoxGeometry(500,500,500),p),g=function(e,t,r){this.i=e,this.d=t,this.value=this.i,this.duration=r||250,this.tween=new TWEEN.Tween(this).to({value:this.d},this.duration).easing(TWEEN.Easing.Circular.Out)};g.prototype.reset=function(){return this.value=this.i,this.tween.stop(),this};var v=function(e,t){var r=this;this.canvas=document.createElement("canvas"),this.canvas.width=e,this.canvas.height=t,this.ctx=this.canvas.getContext("2d");var n=3*l,i=e/t,o=new THREE.PlaneGeometry(n,n/i),a=new THREE.MeshBasicMaterial({color:16777215,map:new THREE.Texture(this.canvas),transparent:!0,depthTest:!1});THREE.Mesh.call(this,o,a),this.params={nexus5:{rotation:new g(-Math.PI/2,0)},cardboard:{opacity:new g(0,1),y:new g(this.canvas.height/3,0),swing:{i:0,d:Math.PI/2,value:0}}},this.params.nexus5.rotation.tween.onStart(function(){r.message=v.IntroMessage}),this.params.cardboard.opacity.tween.delay(this.params.nexus5.rotation.duration/2),this.params.cardboard.y.tween.delay(this.params.nexus5.rotation.duration/2);var s=this.params.cardboard.swing;s.t1=new TWEEN.Tween(s).to({value:s.d},250).onStart(function(){r.message=v.AlertMessage}).easing(TWEEN.Easing.Circular.Out).delay(1e3).onComplete(function(){s.t2.delay(150).start()}),s.t2=new TWEEN.Tween(s).to({value:s.i},250).easing(TWEEN.Easing.Sinusoidal.Out).delay(150),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.material.map.needsUpdate=!0,this.message=v.IntroMessage,this.footnote=v.IntroFootnote};v.IntroMessage=["Turn up volume","and insert to begin"],v.AlertMessage=["Rotate phone to return","to virtual reality"],v.IntroFootnote="Having trouble? Set your screen to auto-rotate.",v.AlertFootnote="",v.Nexus5=document.createElement("img"),v.Cardboard=document.createElement("img"),v.Nexus5.promise=new Promise(function(e,t){v.Nexus5.onload=e,v.Nexus5.onerror=t,v.Nexus5.src="/images/gallery/nexus5.png"}),v.Cardboard.promise=new Promise(function(e,t){v.Cardboard.onload=e,v.Cardboard.onerror=t,v.Cardboard.src="/images/gallery/cardboard_icon.png"}),v.prototype=Object.create(THREE.Mesh.prototype),v.prototype.playing=!1,v.prototype.playIntro=function(){if(!this.playing)return this;var e=this;this.params.nexus5.rotation.reset().tween.start(),this.params.cardboard.opacity.reset().tween.start(),this.params.cardboard.y.reset().tween.start(),this.swing(),this.message=v.IntroMessage,this.footnote=v.IntroFootnote;var t=this.params.cardboard.swing;return t.t2.onComplete(function(){setTimeout(function(){e.playIntro()},1e3)}),this},v.prototype.playAlert=function(){this.params.nexus5.rotation.reset().value=this.params.nexus5.rotation.d,this.params.cardboard.opacity.reset().value=this.params.cardboard.opacity.d,this.params.cardboard.y.reset().value=this.params.cardboard.y.d,this.swing(),this.message=v.AlertMessage,this.footnote=v.AlertFootnote;var e=this.params.cardboard.swing;return e.t2.onComplete(function(){e.t1.start()}),this},v.prototype.swing=function(){var e=this.params.cardboard.swing;return e.t1.stop(),e.t2.stop(),e.value=e.i,e.t1.delay(this.params.nexus5.rotation.duration+this.params.cardboard.opacity.duration+1e3).start(),this.playing=!0,this},v.prototype.update=function(){if(!this.playing)return this;TWEEN.update(),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);var e,t,r,n;r=v.Cardboard.width,n=v.Cardboard.height,e=this.canvas.width/2,t=this.canvas.height/2-this.canvas.height/5,this.ctx.save(),this.ctx.translate(e+r/2,t+n/2),this.ctx.save(),this.ctx.rotate(this.params.cardboard.swing.value),this.ctx.translate(-r/2,-n/2),this.ctx.save(),this.ctx.rotate(this.params.nexus5.rotation.value),r=v.Nexus5.width,n=v.Nexus5.height,this.ctx.globalAlpha=1,this.ctx.drawImage(v.Nexus5,-r/2,-n/2),this.ctx.restore(),r=v.Cardboard.width,n=v.Cardboard.height,t=this.params.cardboard.y.value,this.ctx.globalAlpha=this.params.cardboard.opacity.value,this.ctx.drawImage(v.Cardboard,-r/2,t-n/2),this.ctx.restore(),this.ctx.restore();var i=24;this.ctx.font="bold "+i+'pt "Roboto", sans-serif',this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillStyle="#fff";for(var o=0;o<this.message.length;o++){var a=this.message[o];this.ctx.fillText(a,this.canvas.width/2,.66*this.canvas.height+i*o*1.5-i)}return this.ctx.font=.75*i+'pt "Roboto", sans-serif',this.ctx.fillStyle="#fff",this.ctx.fillText(this.footnote,this.canvas.width/2,this.canvas.height-i),this.material.map.needsUpdate=!0,this};var E=new v(600,400);E.position.z=-50,o.prototype=Object.create(THREE.Object3D.prototype),o.prototype.constructor=o,o.prototype.addDemos=function(e){for(var t=e.length/3,n=0;n<e.length;n++){var i=new r(e[n]),o=.3*(n+t);i.position.x=h*Math.cos(o),i.position.z=h*Math.sin(o),i.lookAt(T.camera.position),this.add(i),this.intersectables.push(i.children[0])}};var y=100;o.prototype.findIntersections=function(){var e=new THREE.Vector3(0,0,1);this.projector.unprojectVector(e,T.camera),this.raycaster.set(T.camera.position,e.sub(T.camera.position).normalize());var t=this.raycaster.intersectObjects(this.intersectables);if(this.intersectables.forEach(function(e){e.scale.set(1,1,1),e.position.z=0}),w.scale.set(1,1,1),t.length>0){var r=t[0];if(r.object.scale.set(1.2,1.2,1.2),r.object.position.z=.1,this.selected)if(this.selected.id===r.object.uuid){this.selected.ttl-=1;var n=this.selected.ttl/y;w.scale.set(n,n,n),this.selected.ttl<=0&&(n=100*n,w.scale.set(n,n,n),this.open(this.selected.obj.parent))}else this.selectSound.play(),navigator.vibrate(30),this.selected={id:r.object.uuid,ttl:y,obj:r.object};else this.selectSound.play(),navigator.vibrate(30),this.selected={id:r.object.uuid,ttl:y,obj:r.object}}else this.selected=null},o.prototype.open=function(e){this.open.opening||(this.openSound.play(),navigator.vibrate(100),this.open.opening=!0,setTimeout(function(){Demos.load(e),this.open.opening=!1,this.selected=null}.bind(this),1e3))},o.prototype.update=function(e,t){E.update(e,t),E.playing||this.findIntersections()},e.Gallery=o,e.Demo=r,e.Cursor=t;var T,x,w,b=!0;Demos.register({factory:a,slug:"gallery"})}(this),function(e){var t={GetScreenOrientation:function(){switch(window.screen.orientation||window.screen.mozOrientation){case"landscape-primary":return 90;case"landscape-secondary":return-90;case"portrait-secondary":return 180;case"portrait-primary":return 0}return void 0!==window.orientation?window.orientation:0}};e.util=t}(window);var Spherical=Spherical||{};!function(e){function t(e){this.container=document.createElement("div"),this.container.className="spherical-loader",this.img=e,this.info=document.createElement("div"),this.title=document.createElement("h1"),this.info.appendChild(this.title),this.subtitle=document.createElement("h2"),this.info.appendChild(this.subtitle),this.img&&this.info.appendChild(this.img),this.refresh()}t.create=function(e){return new Promise(function(r){var n=new Image;n.onload=function(){r(new t(n))},n.onerror=function(){r(new t(null))},n.src=e})},t.prototype.setMessage=function(e,t){this.title.innerText=e||"",this.subtitle.innerText=t||"",this.refresh()},t.prototype.refresh=function(){for(;this.container.hasChildNodes();)this.container.removeChild(this.container.lastChild);var e=this.info.cloneNode(!0);e.className="left",this.container.appendChild(e);var t=this.info.cloneNode(!0);t.className="right",this.container.appendChild(t)},t.prototype.show=function(){this.container.classList.add("enabled")},t.prototype.hide=function(){this.container.classList.remove("enabled")},e.Loader=t}(Spherical);var Spherical=function(e){function t(e,t,n){this.gl_=e,this.canvas_=e.canvas,this.fov_=65,this.pano_=t,this.stereo_=n,this.has_texture_=!1,this.SetupWebGL(),this.quad_=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.quad_),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0]),e.STATIC_DRAW),this.quad_idx_=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.quad_idx_),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),e.STATIC_DRAW),this.pano_texture_=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.pano_texture_),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),window.DeviceOrientationEvent&&window.addEventListener("deviceorientation",function(e){this.alpha_=e.alpha,this.beta_=e.beta,this.gamma_=e.gamma}.bind(this)),this.yaw_=-Math.PI/2,this.pitch_=0,this.dragging_=!1,this.last_x_=0,this.last_y_=0;var i=document.querySelector("body");i.addEventListener("mousedown",function(e){this.dragging_=!0,this.last_x_=e.clientX,this.last_y_=e.clientY}.bind(this),!1),i.addEventListener("mousemove",function(e){this.dragging_&&(this.yaw_+=(e.clientX-this.last_x_)*r,this.pitch_+=(e.clientY-this.last_y_)*r,this.last_x_=e.clientX,this.last_y_=e.clientY)}.bind(this),!1);var o=function(){this.dragging_=!1}.bind(this);i.addEventListener("mouseup",o,!1),i.addEventListener("mouseout",o,!1)}var r=.002;return t.prototype.SetupWebGL=function(){this.gl_.clearColor(0,0,0,1),this.SetupShaders()},t.prototype.SetupShaders=function(){function e(e,t){var n=r.createShader(t);return r.shaderSource(n,e),r.compileShader(n),r.getShaderParameter(n,r.COMPILE_STATUS)?n:null}var r=this.gl_;this.vertex_shader_=e(t.VERTEX_SHADER,this.gl_.VERTEX_SHADER),this.fragment_shader_=e(t.FRAGMENT_SHADER,this.gl_.FRAGMENT_SHADER);var n=this.gl_.createProgram();if(this.gl_.attachShader(n,this.vertex_shader_),this.gl_.attachShader(n,this.fragment_shader_),this.gl_.linkProgram(n),!this.gl_.getProgramParameter(n,this.gl_.LINK_STATUS))throw"Could not initialize shaders";n.vertexPositionAttribute=this.gl_.getAttribLocation(n,"v_pos");for(var i=["pano","aspect_ratio","fov_y","view"],o=0;o<i.length;++o)n[i[o]+"_uniform"]=this.gl_.getUniformLocation(n,i[o]);this.program_=n},t.prototype.UpdateTexture=function(){this.has_texture_=!0,this.gl_.bindTexture(this.gl_.TEXTURE_2D,this.pano_texture_),this.gl_.pixelStorei(this.gl_.UNPACK_FLIP_Y_WEBGL,!1),this.gl_.texImage2D(this.gl_.TEXTURE_2D,0,this.gl_.RGBA,this.gl_.RGBA,this.gl_.UNSIGNED_BYTE,this.pano_)},t.prototype.DrawFrame=function(){if(this.has_texture_){var e,t=90*Math.PI/180;this.stereo_?(this.gl_.viewport(0,0,this.canvas_.width/2,this.canvas_.height),e=this.canvas_.width/2/this.canvas_.height,e=Math.min(1.75,e)):(this.gl_.viewport(0,0,this.canvas_.width,this.canvas_.height),e=this.canvas_.width/this.canvas_.height,t=this.fov_*Math.PI/180),this.gl_.useProgram(this.program_),this.gl_.activeTexture(this.gl_.TEXTURE0),this.gl_.bindTexture(this.gl_.TEXTURE_2D,this.pano_texture_),this.gl_.uniform1i(this.program_.pano_uniform,0);var r=mat4.create();if(mat4.identity(r),this.alpha_&&this.beta_&&this.gamma_){var n=mat4.create(),i=mat4.create(),o=mat4.create(),a=3.141592/180;mat4.rotateX(i,r,this.beta_*a),mat4.rotateY(n,r,this.gamma_*a),mat4.rotateZ(o,r,this.alpha_*a),mat4.rotateX(r,r,-90*a),mat4.mul(r,r,o),mat4.mul(r,r,i),mat4.mul(r,r,n),mat4.rotateZ(r,r,-util.GetScreenOrientation()*a)}else mat4.rotateY(r,r,this.yaw_),mat4.rotateX(r,r,this.pitch_);this.gl_.uniform1f(this.program_.fov_y_uniform,t),this.gl_.uniform1f(this.program_.aspect_ratio_uniform,e),this.gl_.uniformMatrix4fv(this.program_.view_uniform,!1,r),this.gl_.enableVertexAttribArray(this.program_.vertexPositionAttribute),this.gl_.bindBuffer(this.gl_.ARRAY_BUFFER,this.quad_),this.gl_.vertexAttribPointer(this.program_.vertexPositionAttribute,3,this.gl_.FLOAT,!1,0,0),this.gl_.bindBuffer(this.gl_.ELEMENT_ARRAY_BUFFER,this.quad_idx_),this.gl_.drawElements(this.gl_.TRIANGLES,6,this.gl_.UNSIGNED_SHORT,0),this.stereo_&&(this.gl_.viewport(this.canvas_.width/2,0,this.canvas_.width/2,this.canvas_.height),this.gl_.drawElements(this.gl_.TRIANGLES,6,this.gl_.UNSIGNED_SHORT,0)),this.gl_.disableVertexAttribArray(this.program_.vertexPositionAttribute)}},t.VERTEX_SHADER="attribute vec3 v_pos;\nvarying vec3 pos;\n\nvoid main() {\n  gl_Position = vec4(v_pos.xyz, 1.0);\n  pos = v_pos;\n}",t.FRAGMENT_SHADER="precision highp float;\n\nvarying vec3 pos;\n\nuniform sampler2D pano;\nuniform float aspect_ratio;\nuniform float fov_y;\nuniform mat4 view;\n\n#define PI 3.1415926535897932384626433832795\n\nfloat saturate(float value) {\n  return clamp(value, 0.0, 1.0);\n}\n\nvoid main() {\n  // The view ray for this fragment.\n  vec3 ray = vec3(pos.x * tan(fov_y / 2.0 * aspect_ratio),\n                  pos.y * tan(fov_y / 2.0), -1);\n\n  // Transform by our view matrix.\n  ray = (view * vec4(ray, 1.0)).xyz;\n  ray = normalize(ray);\n\n  // Project into pano texture coords.\n  vec2 texcoords = vec2(saturate((1.0 - atan(ray.x, ray.z) / PI) / 2.0),\n                        saturate(acos(ray.y) / PI));\n  gl_FragColor = vec4(texture2D(pano, texcoords).xyz, 1.0);\n}",e.PanoViewer=t,e}(Spherical||{}),Spherical=function(e){function t(e,t){return new Promise(function(r){t.addEventListener("sourceopen",r),e.src=window.URL.createObjectURL(t)})}function r(e,t,r){return new Promise(function(n,i){var o=new XMLHttpRequest;o.open("GET",e,!0);var a="bytes="+t+"-"+(r-1);o.setRequestHeader("Range",a),o.responseType="arraybuffer",o.onreadystatechange=function(){if(4===o.readyState){206!==o.status&&i("XHR: status "+o.status+", want 206");var e=o.getResponseHeader("Content-Range");if(!e)return void i("No Content-Range header");var t=parseInt(e.split("-")[0]),r=parseInt(e.split("-")[1].split("/")[0])+1,a=parseInt(e.split("-")[1].split("/")[1]);n({data:new Uint8Array(o.response),start:t,end:r,size:a})}},o.onerror=function(){i("XHR failed")},o.send()})}function n(e,r){this.mediaSource_=new MediaSource,this.type_=r,this.openMediaSource_=t(e,this.mediaSource_),this.elem_=e,this.fetching_=null,this.offset_=0,this.loaded_=!1,this.fully_loaded_=!1,this.size_=0}var i=60;return n.prototype={load:function(e,t,n){this.urls_=e,this.current_url_=this.urls_.shift(),this.openMediaSource_.then(function(){return r(this.current_url_,0,262144)}.bind(this)).then(function(e){this.offset_=e.end,this.mediaSource_.addSourceBuffer(this.type_),this.mediaSource_.sourceBuffers[0].appendBuffer(e.data),this.interval_=window.setInterval(this.timerFired_.bind(this),500);var r=function(e){e.target.removeEventListener("loadeddata",r),this.loaded_=!0,t()}.bind(this);this.elem_.addEventListener("loadeddata",r)}.bind(this),n)},stopDownloading:function(){this.interval_&&clearInterval(this.interval_)},loaded:function(){return this.loaded_},fully_loaded:function(){return this.fully_loaded_},timerFired_:function(){if(this.size_&&this.offset_===this.size_)if(0===this.urls_.length){try{this.mediaSource_.endOfStream()}catch(e){}this.fully_loaded_=!0,this.stopDownloading(),console.log("Media loading complete.")}else this.current_url_=this.urls_.shift(),console.log("Starting new file: "+this.current_url_),this.offset_=0;if(!this.fetching_&&!this.fully_loaded_){var t=this.elem_.buffered.length?this.elem_.buffered.end(0)-this.elem_.currentTime:0;if(!(t>i)){var n=1048576;this.size_&&(n=Math.min(n,this.size_-this.offset_)),this.fetching_=r(this.current_url_,this.offset_,this.offset_+n),this.fetching_.then(function(e){var t=this.mediaSource_.sourceBuffers[0];0===this.offset_&&this.elem_.buffered.length&&(t.timestampOffset=this.elem_.buffered.end(0)),this.offset_=e.end,t.appendBuffer(e.data),this.size_=e.size,this.fetching_=null}.bind(this),function(e){console.error("fetch() failed: "+e),this.fetching_=null}.bind(this))}}}},e.MediaStreamer=n,e}(Spherical||{}),Spherical=Spherical||{};!function(e){function t(e,t,n,i){this.gl_=e,this.canvas_=e.canvas,this.videoPlayer_=null,this.state_=r.INITIAL,this.standalone_=i,this.videoElem_=t,this.videoElem_.volume=0,this.fade_=1,this.videoElem_.addEventListener("canplaythrough",function(){this.videoElem_.play(),setTimeout(function(){0!==this.videoElem_.currentTime||this.videoElem_.paused||(console.log("Failed to play video."),this.NextVideo()||this.onError("Uh oh, there was an error. Please reload!"))}.bind(this),1e3*s)}.bind(this),!1),this.videoElem_.addEventListener("ended",function(){this.state_=r.ENDED}.bind(this),!1);var o=new Spherical.PanoViewer(this.gl_,this.videoElem_,!0);this.viewer_=o,this.loader_=n}var r={INITIAL:0,PLAYING:1,BUFFERING:2,ERROR:3,ENDED:4},n=15,i=5,o=6,a=.5,s=4;return t.prototype.resize=function(){},t.prototype.enter=function(){this.started_=(new Date).getTime(),this.loader_.show(),this.state_=r.INITIAL,this.urlsToTry_=this.urls_.slice(0),-1!==this.urlsToTry_[0].indexOf("bear")?this.end_time_=165:-1!==this.urlsToTry_[0].indexOf("reef")&&(this.end_time_=230),this.NextVideo(),this.videoElem_.play()},t.prototype.leave=function(){this.videoElem_.pause(),this.videoElem_.src="",this.loader_.hide()},t.prototype.NextVideo=function(){return this.urlsToTry_.length?(this.videoElem_.src="",this.videoPlayer_&&this.videoPlayer_.stopDownloading(),window.MediaSource?(this.videoPlayer_=new Spherical.MediaStreamer(this.videoElem_,'video/mp4; codecs="avc1.4d4028"'),this.videoPlayer_.load([this.urlsToTry_.shift()],function(){this.videoElem_.play()}.bind(this),function(){})):(this.videoElem_.crossOrigin="anonymous",this.videoElem_.src=this.urlsToTry_.shift()),!0):!1},t.prototype.onError=function(e){this.loader_.setMessage("",e),this.loader_.show(),this.state_=r.ERROR},t.prototype.render=function(){this.gl_.clear(this.gl_.COLOR_BUFFER_BIT|this.gl_.DEPTH_BUFFER_BIT);var e=this.videoElem_.buffered.length?this.videoElem_.buffered.end(0)-this.videoElem_.currentTime:0,t=!1;switch(t=this.videoPlayer_?this.videoPlayer_.fully_loaded():Math.abs(this.videoElem_.duration-(this.videoElem_.length?this.videoElem_.buffered.end(0):0))<.01,this.state_){case r.INITIAL:this.videoElem_.currentTime>=o&&!this.videoElem_.paused&&this.videoElem_.pause(),e>a&&(new Date).getTime()-this.started_>1e3*i&&this.videoElem_.currentTime>=o&&(this.loader_.hide(),this.videoElem_.play(),this.state_=r.PLAYING);break;case r.PLAYING:(this.videoElem_.buffered.length||this.videoPlayer_.loaded())&&this.viewer_.UpdateTexture(),this.viewer_.DrawFrame(),a>e&&!t&&(this.state_=r.BUFFERING,this.videoElem_.pause()),this.end_time_&&this.videoElem_.currentTime>this.end_time_&&(this.videoElem_.pause(),this.state_=r.ENDED);break;case r.BUFFERING:(t||e>n)&&(this.videoElem_.play(),this.state_=r.PLAYING),this.videoPlayer_.loaded()&&this.viewer_.DrawFrame();break;case r.ERROR:break;case r.ENDED:return!1}return!0},e.Demo=t,e}(Spherical);var Spherical=function(e){function t(e,t,r,n,i,o,a,s){this.u=e,this.v=t,this.x=r,this.y=n,this.w=i,this.h=o,this.tw=a,this.th=s}function r(e,t,i){this.atlas_=t,this.canvas_=e,this.sprites_=[],this.num_indices_=0,this.atlas_px_x_=t.width,this.atlas_px_y_=t.height;for(var o={alpha:!1,depth:!1,stencil:!1,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1},a=["webgl","experimental-webgl"],s=0;s<a.length&&!(n=this.canvas_.getContext(a[s],o));s++);if(!n)throw"Unable to get a WebGL context.";this.atlas_texture_=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.atlas_texture_),i?(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR)):(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST)),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,this.atlas_),this.vbo_=n.createBuffer(),this.ibo_=n.createBuffer();var l=function(e,t){var r=n.createShader(t);return n.shaderSource(r,e),n.compileShader(r),n.getShaderParameter(r,n.COMPILE_STATUS)?r:null};this.vertex_shader_=l(r.VERTEX_SHADER,n.VERTEX_SHADER),this.fragment_shader_=l(r.FRAGMENT_SHADER,n.FRAGMENT_SHADER);var c=n.createProgram();if(n.attachShader(c,this.vertex_shader_),n.attachShader(c,this.fragment_shader_),n.linkProgram(c),!n.getProgramParameter(c,n.LINK_STATUS))throw"Could not initialize shaders";c.vertexPositionAttribute=n.getAttribLocation(c,"a_pos"),c.vertexTexcoordAttribute=n.getAttribLocation(c,"a_uv"),this.program_=c}var n;return r.prototype.SetAtlas=function(e){this.atlas_=e,n.bindTexture(n.TEXTURE_2D,this.atlas_texture_),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,this.atlas_),this.atlas_px_x_=e.width,this.atlas_px_y_=e.height},r.prototype.ClearSprites=function(){this.sprites_=[],this.num_indices_=0},r.prototype.AddSprite=function(e){this.sprites_.push(e)},r.prototype.UpdateGeometry=function(){var e=this.sprites_.length,t=4*e,r=6*e;this.num_indices_=r;for(var i=5,o=new Float32Array(t*i),a=new Uint16Array(r),s=0;e>s;++s){var l=this.sprites_[s],c=s*i*4,h=l.x/this.canvas_.width,u=l.y/this.canvas_.height,f=l.w/this.canvas_.width,d=l.h/this.canvas_.height,p=l.u/this.atlas_px_x_,m=l.v/this.atlas_px_y_,g=(l.tw||l.w)/this.atlas_px_x_,v=(l.th||l.h)/this.atlas_px_y_;o[c+0]=h,o[c+1]=1-u-d,o[c+2]=0,o[c+3]=p,o[c+4]=m+v,c+=5,o[c+0]=h+f,o[c+1]=1-u-d,o[c+2]=0,o[c+3]=p+g,o[c+4]=m+v,c+=5,o[c+0]=h,o[c+1]=1-u,o[c+2]=0,o[c+3]=p,o[c+4]=m,c+=5,o[c+0]=h+f,o[c+1]=1-u,o[c+2]=0,o[c+3]=p+g,o[c+4]=m,a[6*s+0]=4*s+0,a[6*s+1]=4*s+1,a[6*s+2]=4*s+2,a[6*s+3]=4*s+1,a[6*s+4]=4*s+2,a[6*s+5]=4*s+3}n.bindBuffer(n.ARRAY_BUFFER,this.vbo_),n.bufferData(n.ARRAY_BUFFER,o,n.DYNAMIC_DRAW),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.ibo_),n.bufferData(n.ELEMENT_ARRAY_BUFFER,a,n.DYNAMIC_DRAW)},r.prototype.Draw=function(){0!==this.num_indices_&&(n.enable(n.BLEND),n.disable(n.DEPTH_TEST),n.depthMask(!1),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),n.viewport(0,0,this.canvas_.width,this.canvas_.height),n.useProgram(this.program_),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,this.atlas_texture_),n.uniform1i(this.program_.pano_uniform,0),n.enableVertexAttribArray(this.program_.vertexPositionAttribute),n.enableVertexAttribArray(this.program_.vertexTexcoordAttribute),n.bindBuffer(n.ARRAY_BUFFER,this.vbo_),n.vertexAttribPointer(this.program_.vertexPositionAttribute,3,n.FLOAT,!1,20,0),n.vertexAttribPointer(this.program_.vertexTexcoordAttribute,2,n.FLOAT,!1,20,12),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.ibo_),n.drawElements(n.TRIANGLES,this.num_indices_,n.UNSIGNED_SHORT,0),n.disableVertexAttribArray(this.program_.vertexPositionAttribute),n.disableVertexAttribArray(this.program_.vertexTexcoordAttribute),n.disable(n.BLEND),n.enable(n.DEPTH_TEST),n.depthMask(!0))},r.VERTEX_SHADER="attribute vec3 a_pos;\nattribute vec2 a_uv;\nvarying vec2 uv;\n\nvoid main() {\n  gl_Position = vec4((a_pos.xyz - vec3(0.5, 0.5, 0.5)) * 2.0, 1.0);\n  uv = a_uv;\n}",r.FRAGMENT_SHADER="precision highp float;\n\nvarying vec2 uv;\n\nuniform sampler2D atlas;\n\nvoid main() {\n  gl_FragColor = texture2D(atlas, uv.xy);\n}",e.SpriteRenderer=r,e.Sprite=t,e}(Spherical||{});if(function(){function e(e){this.iOS=!1,this.name=e,this.preview="/images/preview/"+e+".jpg",this.slug=e}var t="//storage.googleapis.com/ce-virtual/sphericalvideo",r={bears:{title:"Bears in Kamchatka",urls:[t+"/bears_1920_4_frag.mp4",t+"/bears_1280_4_frag.mp4"],urlsWebM:[t+"/bears_1920_4.webm"]},reef:{title:"Great Barrier Reef",urls:[t+"/reef_1920_4_frag.mp4",t+"/reef_1280_4_frag.mp4"],urlsWebM:[t+"/reef_1920_4.webm"]}};e.prototype.touchstart=function(){var e=document.createElement("video");this.video=e,e.style.display="none",document.body.appendChild(e),e.play()},e.prototype.factory=function(e){var t=this,n=r[t.name];return Spherical.Loader.create("images/loader_sm.gif").then(function(r){r.setMessage(n.title,"Video by AirPano.com"),document.body.appendChild(r.container);var i=new Spherical.Demo(e,t.video,r,!1),o=n.urlsWebM;return window.MediaSource&&(o=n.urls),i.urls_=o,i})};for(var n in r){var i=new e(n);Demos.register(i)}}(),this.CodeExample=function(e){function t(){function e(t){t.alpha&&(u=new THREE.DeviceOrientationControls(s,!0),u.connect(),u.update(),f.addEventListener("click",a,!1),window.removeEventListener("deviceorientation",e,!0))}c=new THREE.WebGLRenderer,f=c.domElement,d=document.getElementById("example"),d.appendChild(f),h=new THREE.StereoEffect(c),l=new THREE.Scene,s=new THREE.PerspectiveCamera(90,1,.001,700),s.position.set(0,10,0),l.add(s),u=new THREE.OrbitControls(s,f),u.rotateUp(Math.PI/4),u.target.set(s.position.x+.1,s.position.y,s.position.z),u.noZoom=!0,u.noPan=!0,window.addEventListener("deviceorientation",e,!0);var t=new THREE.HemisphereLight(7829367,0,.6);l.add(t);var n=THREE.ImageUtils.loadTexture("textures/patterns/checker.png");n.wrapS=THREE.RepeatWrapping,n.wrapT=THREE.RepeatWrapping,n.repeat=new THREE.Vector2(50,50),n.anisotropy=c.getMaxAnisotropy();var i=new THREE.MeshPhongMaterial({color:16777215,specular:16777215,shininess:20,shading:THREE.FlatShading,map:n}),o=new THREE.PlaneGeometry(1e3,1e3),p=new THREE.Mesh(o,i);p.rotation.x=-Math.PI/2,l.add(p),window.addEventListener("resize",r,!1),setTimeout(r,1),m=!0}function r(){var e=d.offsetWidth,t=d.offsetHeight;s.aspect=e/t,s.updateProjectionMatrix(),c.setSize(e,t),h.setSize(e,t)}function n(e){r(),s.updateProjectionMatrix(),u.update(e)}function i(){h.render(l,s)}function o(){p&&(requestAnimationFrame(o),n(g.getDelta()),i(g.getDelta()))}function a(){d.requestFullscreen?d.requestFullscreen():d.msRequestFullscreen?d.msRequestFullscreen():d.mozRequestFullScreen?d.mozRequestFullScreen():d.webkitRequestFullscreen&&d.webkitRequestFullscreen()}var s,l,c,h,u,f,d,p=!0,m=!1,g=new THREE.Clock;return e.start=function(e){has.webgl?(p=!0,m||t(),e&&(u.autoRotate=!0),o()):document.getElementById("demo").style.display="none"},e.stop=function(){p=!1},e}(this.CodeExample||{}),this.LandingPage=function(e){function t(e){if(I=e,has.mobile?(M.className+=" mobile",z=!1,V="mobile15sec_12fps_256.gif"):(M.className+=" desktop",z=!1,V="desktop15sec_12fps_256.gif"),z){for(var t=document.getElementsByClassName("paging_block"),u=0;u<t.length;u++)t[u].style.display="block";document.getElementById("experiments_page_link").addEventListener("click",x,!0),document.getElementById("dev_page_link").addEventListener("click",T,!0),x(null)}p(),r(),h(),O&&(has.mobile?(S.addEventListener("click",o,!0),doSampleAutoRotate=!0):(S.addEventListener("click",s,!0),k.addEventListener("click",l,!0),A.addEventListener("click",o,!0))),L.addEventListener("click",a,!0),P.addEventListener("click",c,!0),setTimeout(n,1e3),U=!0,i(b.INTRO)}function r(){H=_.NONE,has.mobile&&(H=Modernizr.fullscreen?_.FULLSCREEN_API:_.ENCOURAGE_USER_SCROLL)}function n(){for(var e=document.getElementsByClassName("animated_gif_target"),t=0;t<e.length;t++)e[t].style["background-image"]="url('../images/landingPage/"+V+"')"}function i(e){if(R!=e){if(R=e,R==b.INTRO){var t=!has.mobile;CodeExample.start(t),F.style.height="0px",M.style.visibility="visible",d()}else R==b.IN_VR&&(CodeExample.stop(),I?startIFrameGallery():(M.style.visibility="hidden",H==_.FULLSCREEN_API&&y(document.body),F.style.height="9000px",Demos.open()))}}function o(e){e&&e.preventDefault(),i(b.IN_VR)}function a(){window.location="http://vr.chromeexperiments.com/cardboard.zip"}function s(e){e.preventDefault(),C.style.display="block"}function l(e){e.preventDefault(),C.style.display="none"}function c(e){e.preventDefault(),""==N.style.display?(N.style.display="none",P.innerHTML="+Code Preview"):(N.style.display="",P.innerHTML="-Code Preview")}function h(){var e=document.getElementById("code");D=CodeMirror(e,{mode:"htmlmixed",lineWrapping:!0,readOnly:!0,theme:"example"}),request=new XMLHttpRequest,request.open("GET","/cardboard/index.html",!0),CodeMirror.on(D.getDoc(),"change",u),request.onload=function(){if(request.status>=200&&request.status<400){var e=request.responseText;D.getDoc().setValue(e)}else f()},request.onerror=function(){f()},request.send()}function u(){N.style.display="none"}function f(){document.getElementById("developer_code_preview_block").style.display="none"}function d(){window.scrollTo(0,0)}function p(){var e=E();!has.mobile&&has.webgl?m():has.mobile&&has.Firefox?g("This experience doesnt support your browser (yet). Try anyway?"):""!=e?v("This experience requires a WebGL-enabled mobile browser, such as Google Chrome."):m()}function m(){O=!0}function g(e){var t=document.getElementById("warning_message");t.innerHTML=e,t.style.display="block",O=!0}function v(e){var t=document.getElementById("error_message");t.innerHTML=e,t.style.display="block",S.className+=" disabled",has.webgl||(document.getElementById("developer_example").style.display="none"),O=!1}function E(){return has.webgl?Modernizr.webaudio?Modernizr.canvas?Modernizr.devicemotion&&Modernizr.deviceorientation?Modernizr.history&&Modernizr.localstorage&&Modernizr.postmessage?Modernizr.touch?"":"touch":"HTML5":"gyroscope":"Canvas":"Web Audio API":"WebGL"}function y(e){e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}function T(e){e&&e.preventDefault(),w("dev")
}function x(e){e&&e.preventDefault(),w("experiments")}function w(e){for(var t=document.getElementsByClassName("page"),r=0;r<t.length;r++)t[r].style.display="none";document.getElementById(e+"_page").style.display="block",d()}var b={};b.NOT_INITIALIZED="NOT_INITIALIZED",b.INTRO="INTRO",b.IN_VR="IN_VR";var R=b.NOT_INITIALIZED,_={};_.NONE="NONE",_.FULLSCREEN_API="FULLSCREEN_API",_.ENCOURAGE_USER_SCROLL="ENCOURAGE_USER_SCROLL";var H=_.NONE,M=document.getElementById("landing_page"),S=(document.getElementById("loadDemos"),document.getElementById("launch_button")),C=document.getElementById("popup_window"),A=document.getElementById("try_anyway"),k=document.getElementById("popup_close_button"),L=document.getElementById("download_code_button"),P=document.getElementById("code_preview"),F=document.getElementById("scroll_dummy"),N=document.getElementById("code"),D=null,U=!1,O=!1,z=!1,I=!1,V="";return e.start=function(e){U?i(b.INTRO):t(e)},Demos.onBack=function(){Demos.close(),e.start(I)},e}(this.LandingPage||{}),!window.console)var console={};console.log||(console.log=function(){}),LandingPage.start(!1),function(e,t,r,n,i,o,a){e.GoogleAnalyticsObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,o=t.createElement(r),a=t.getElementsByTagName(r)[0],o.async=1,o.src=n,a.parentNode.insertBefore(o,a)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-51967321-1","auto"),ga("send","pageview");
//# sourceMappingURL=app.min.js.map